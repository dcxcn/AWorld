!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var WEBGL={isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},i='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',r=document.createElement("div");return r.id="webglmessage",r.style.fontFamily="monospace",r.style.fontSize="13px",r.style.fontWeight="normal",r.style.textAlign="center",r.style.background="#fff",r.style.color="#000",r.style.padding="1.5em",r.style.width="400px",r.style.margin="5em auto 0",i=(i=i.replace("$0",t[e]?"graphics card":"browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),r.innerHTML=i,r}},_ENCODINGS;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(e){return}}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(r){return function(){var e,t=_getPrototypeOf(r);if(_isNativeReflectConstruct()){var i=_getPrototypeOf(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=_superPropBase(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i):n.value}})(e,t,i||e)}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t});var REVISION="120",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,SmoothShading=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es";function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,e)}}}});for(var _lut=[],i=0;i<256;i++)_lut[i]=(i<16?"0":"")+i.toString(16);var _seed=1234567,MathUtils={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(_lut[255&e]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]+"-"+_lut[255&t]+_lut[t>>8&255]+"-"+_lut[t>>16&15|64]+_lut[t>>24&255]+"-"+_lut[63&i|128]+_lut[i>>8&255]+"-"+_lut[i>>16&255]+_lut[i>>24&255]+_lut[255&r]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(_seed=e%2147483647),((_seed=16807*_seed%2147483647)-1)/2147483646},degToRad:function(e){return e*MathUtils.DEG2RAD},radToDeg:function(e){return e*MathUtils.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,r,n){var a=Math.cos,o=Math.sin,s=a(i/2),l=o(i/2),c=a((t+r)/2),h=o((t+r)/2),u=a((t-r)/2),d=o((t-r)/2),p=a((r-t)/2),m=o((r-t)/2);switch(n){case"XYX":e.set(s*h,l*u,l*d,s*c);break;case"YZY":e.set(l*d,s*h,l*u,s*c);break;case"ZXZ":e.set(l*u,l*d,s*h,s*c);break;case"XZX":e.set(s*h,l*m,l*p,s*c);break;case"YXY":e.set(l*p,s*h,l*m,s*c);break;case"ZYZ":e.set(l*m,l*p,s*h,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}},Vector2=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,i),Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}return _createClass(i,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*i-a*r+e.x,this.y=n*r+a*i+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}]),i}(),Matrix3=function(){function e(){_classCallCheck(this,e),Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return _createClass(e,[{key:"set",value:function(e,t,i,r,n,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=n,c[5]=s,c[6]=i,c[7]=a,c[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}},{key:"extractBasis",value:function(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var i=e.elements,r=t.elements,n=this.elements,a=i[0],o=i[3],s=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],m=r[0],f=r[3],g=r[6],v=r[1],y=r[4],x=r[7],_=r[2],b=r[5],w=r[8];return n[0]=a*m+o*v+s*_,n[3]=a*f+o*y+s*b,n[6]=a*g+o*x+s*w,n[1]=l*m+c*v+h*_,n[4]=l*f+c*y+h*b,n[7]=l*g+c*x+h*w,n[2]=u*m+d*v+p*_,n[5]=u*f+d*y+p*b,n[8]=u*g+d*x+p*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-i*n*c+i*o*s+r*n*l-r*a*s}},{key:"getInverse",value:function(e,t){void 0!==t&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var i=e.elements,r=this.elements,n=i[0],a=i[1],o=i[2],s=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=d*l-c*u,m=c*h-d*s,f=u*s-l*h,g=n*p+a*m+o*f;if(0==g)return this.set(0,0,0,0,0,0,0,0,0);var v=1/g;return r[0]=p*v,r[1]=(o*u-d*a)*v,r[2]=(c*a-o*l)*v,r[3]=m*v,r[4]=(d*n-o*h)*v,r[5]=(o*s-c*n)*v,r[6]=f*v,r[7]=(a*h-u*n)*v,r[8]=(l*n-a*s)*v,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,i,r,n,a,o){var s=Math.cos(n),l=Math.sin(n);this.set(i*s,i*l,-i*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1)}},{key:"scale",value:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],a=r[3],o=r[6],s=r[1],l=r[4],c=r[7];return r[0]=t*n+i*s,r[3]=t*a+i*l,r[6]=t*o+i*c,r[1]=-i*n+t*s,r[4]=-i*a+t*l,r[7]=-i*o+t*c,this}},{key:"translate",value:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}},{key:"equals",value:function(e){for(var t=this.elements,i=e.elements,r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}},{key:"fromArray",value:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this}},{key:"toArray",value:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}}]),e}(),_canvas,ImageUtils={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===_canvas&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=e.width,_canvas.height=e.height;var i=_canvas.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=_canvas}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},textureId=0;function Texture(e,t,i,r,n,a,o,s,l,c){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.image=void 0!==e?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:ClampToEdgeWrapping,this.wrapT=void 0!==r?r:ClampToEdgeWrapping,this.magFilter=void 0!==n?n:LinearFilter,this.minFilter=void 0!==a?a:LinearMipmapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:RGBAFormat,this.internalFormat=null,this.type=void 0!==s?s:UnsignedByteType,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:LinearEncoding,this.version=0,this.onUpdate=null}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=UVMapping,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=MathUtils.generateUUID()),!t&&void 0===e.images[r.uuid]){var n;if(Array.isArray(r)){n=[];for(var a=0,o=r.length;a<o;a++)n.push(ImageUtils.getDataURL(r[a]))}else n=ImageUtils.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});var Vector4=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;_classCallCheck(this,n),Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=i,this.w=r}return _createClass(n,[{key:"set",value:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*n,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*n,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*n,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*n,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,i,r,n,a=e.elements,o=a[0],s=a[4],l=a[8],c=a[1],h=a[5],u=a[9],d=a[2],p=a[6],m=a[10];if(Math.abs(s-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(o+h+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var f=(o+1)/2,g=(h+1)/2,v=(m+1)/2,y=(s+c)/4,x=(l+d)/4,_=(u+p)/4;return g<f&&v<f?n=f<.01?(i=0,r=.707106781):(r=y/(i=Math.sqrt(f)),x/i):v<g?n=g<.01?(r=0,i=.707106781):(i=y/(r=Math.sqrt(g)),_/r):v<.01?(r=i=.707106781,n=0):(i=x/(n=Math.sqrt(v)),r=_/n),this.set(i,r,n,t),this}var b=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-s)*(c-s));return Math.abs(b)<.001&&(b=1),this.x=(p-u)/b,this.y=(l-d)/b,this.z=(c-s)/b,this.w=Math.acos((o+h+m-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}}]),n}();function WebGLRenderTarget(e,t,i){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),this.texture=new Texture(void 0,(i=i||{}).mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:LinearFilter,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function WebGLMultisampleRenderTarget(e,t,i){WebGLRenderTarget.call(this,e,t,i),this.samples=4}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(e){return WebGLRenderTarget.prototype.copy.call(this,e),this.samples=e.samples,this}});var Quaternion=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;_classCallCheck(this,n),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=i,this._w=r}return _createClass(n,[{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(i/2),c=o(r/2),h=o(n/2),u=s(i/2),d=s(r/2),p=s(n/2);switch(a){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,i=t[0],r=t[4],n=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],h=t[10],u=i+o+h;if(0<u){var d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(c-s)*d,this._y=(n-l)*d,this._z=(a-r)*d}else if(o<i&&h<i){var p=2*Math.sqrt(1+i-o-h);this._w=(c-s)/p,this._x=.25*p,this._y=(r+a)/p,this._z=(n+l)/p}else if(h<o){var m=2*Math.sqrt(1+o-i-h);this._w=(n-l)/m,this._x=(r+a)/m,this._y=.25*m,this._z=(s+c)/m}else{var f=2*Math.sqrt(1+h-i-o);this._w=(a-r)/f,this._x=(n+l)/f,this._y=(s+c)/f,this._z=.25*f}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=i,this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(MathUtils.clamp(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var i=this.angleTo(e);if(0===i)return this;var r=Math.min(1,t/i);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"inverse",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var i=e._x,r=e._y,n=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=i*c+a*o+r*l-n*s,this._y=r*c+a*s+n*o-i*l,this._z=n*c+a*l+i*s-r*o,this._w=a*c-i*o-r*s-n*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,a=this._w,o=a*e._w+i*e._x+r*e._y+n*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),1<=o)return this._w=a,this._x=i,this._y=r,this._z=n,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*i+t*this._x,this._y=l*r+t*this._y,this._z=l*n+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),h=Math.atan2(c,o),u=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=a*u+this._w*d,this._x=i*u+this._x*d,this._y=r*u+this._y*d,this._z=n*u+this._z*d,this._onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}],[{key:"slerp",value:function(e,t,i,r){return i.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,i,r,n,a,o){var s=i[r+0],l=i[r+1],c=i[r+2],h=i[r+3],u=n[a+0],d=n[a+1],p=n[a+2],m=n[a+3];if(h!==m||s!==u||l!==d||c!==p){var f=1-o,g=s*u+l*d+c*p+h*m,v=0<=g?1:-1,y=1-g*g;if(y>Number.EPSILON){var x=Math.sqrt(y),_=Math.atan2(x,g*v);f=Math.sin(f*_)/x,o=Math.sin(o*_)/x}var b=o*v;if(s=s*f+u*b,l=l*f+d*b,c=c*f+p*b,h=h*f+m*b,f===1-o){var w=1/Math.sqrt(s*s+l*l+c*c+h*h);s*=w,l*=w,c*=w,h*=w}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=h}},{key:"multiplyQuaternionsFlat",value:function(e,t,i,r,n,a){var o=i[r],s=i[r+1],l=i[r+2],c=i[r+3],h=n[a],u=n[a+1],d=n[a+2],p=n[a+3];return e[t]=o*p+c*h+s*d-l*u,e[t+1]=s*p+c*u+l*h-o*d,e[t+2]=l*p+c*d+o*u-s*h,e[t+3]=c*p-o*h-s*u-l*d,e}}]),n}(),Vector3=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;_classCallCheck(this,r),Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=i}return _createClass(r,[{key:"set",value:function(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(_quaternion.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,a=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*a,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*a,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*i,c=s*i+o*t-n*r,h=s*r+n*i-a*t,u=-n*t-a*i-o*r;return this.x=l*s+u*-n+c*-o-h*-a,this.y=c*s+u*-a+h*-n-l*-o,this.z=h*s+u*-o+l*-a-c*-n,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var i=e.x,r=e.y,n=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-n*o,this.y=n*a-i*s,this.z=i*o-r*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}},{key:"projectOnPlane",value:function(e){return _vector.copy(this).projectOnVector(e),this.sub(_vector)}},{key:"reflect",value:function(e){return this.sub(_vector.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var i=this.dot(e)/t;return Math.acos(MathUtils.clamp(i,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,i){var r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}]),r}(),_vector=new Vector3,_quaternion=new Quaternion,Box3=function(){function i(e,t){_classCallCheck(this,i),Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}return _createClass(i,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],h=e[s+1],u=e[s+2];c<t&&(t=c),h<i&&(i=h),u<r&&(r=u),n<c&&(n=c),a<h&&(a=h),o<u&&(o=u)}return this.min.set(t,i,r),this.max.set(n,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),h=e.getY(s),u=e.getZ(s);c<t&&(t=c),h<i&&(i=h),u<r&&(r=u),n<c&&(n=c),a<h&&(a=h),o<u&&(o=u)}return this.min.set(t,i,r),this.max.set(n,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=_vector$1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),_box.copy(t.boundingBox),_box.applyMatrix4(e.matrixWorld),this.union(_box));for(var i=e.children,r=0,n=i.length;r<n;r++)this.expandByObject(i[r]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||this.max.x<e.x||e.y<this.min.y||this.max.y<e.y||e.z<this.min.z||this.max.z<e.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||this.max.x<e.min.x||e.max.y<this.min.y||this.max.y<e.min.y||e.max.z<this.min.z||this.max.z<e.min.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,_vector$1),_vector$1.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,i;return i=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&-e.constant<=i}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0.subVectors(e.a,_center),_v1.subVectors(e.b,_center),_v2.subVectors(e.c,_center),_f0.subVectors(_v1,_v0),_f1.subVectors(_v2,_v1),_f2.subVectors(_v0,_v2);var t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!!satForAxes(t,_v0,_v1,_v2,_extents)&&(!!satForAxes(t=[1,0,0,0,1,0,0,0,1],_v0,_v1,_v2,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),satForAxes(t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],_v0,_v1,_v2,_extents)))}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return _vector$1.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(_vector$1).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),i}();function satForAxes(e,t,i,r,n){for(var a=0,o=e.length-3;a<=o;a+=3){_testAxis.fromArray(e,a);var s=n.x*Math.abs(_testAxis.x)+n.y*Math.abs(_testAxis.y)+n.z*Math.abs(_testAxis.z),l=t.dot(_testAxis),c=i.dot(_testAxis),h=r.dot(_testAxis);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>s)return!1}return!0}var _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$1=new Vector3,_box=new Box3,_v0=new Vector3,_v1=new Vector3,_v2=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3,_box$1=new Box3,Sphere=function(){function i(e,t){_classCallCheck(this,i),this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:-1}return _createClass(i,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var i=this.center;void 0!==t?i.copy(t):_box$1.setFromPoints(e).getCenter(i);for(var r=0,n=0,a=e.length;n<a;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),this.radius*this.radius<i&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),i}(),_vector$2=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal=new Vector3,Ray=function(){function i(e,t){_classCallCheck(this,i),this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3(0,0,-1)}return _createClass(i,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,_vector$2)),this}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=_vector$2.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$2.copy(this.direction).multiplyScalar(t).add(this.origin),_vector$2.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,i,r){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);var n,a,o,s,l=.5*e.distanceTo(t),c=-this.direction.dot(_segDir),h=_diff.dot(this.direction),u=-_diff.dot(_segDir),d=_diff.lengthSq(),p=Math.abs(1-c*c);if(0<p)if(a=c*h-u,s=l*p,0<=(n=c*u-h))if(-s<=a)if(a<=s){var m=1/p;o=(n*=m)*(n+c*(a*=m)+2*h)+a*(c*n+a+2*u)+d}else a=l,o=-(n=Math.max(0,-(c*a+h)))*n+a*(a+2*u)+d;else a=-l,o=-(n=Math.max(0,-(c*a+h)))*n+a*(a+2*u)+d;else o=a<=-s?-(n=Math.max(0,-(-c*l+h)))*n+(a=0<n?-l:Math.min(Math.max(-l,-u),l))*(a+2*u)+d:a<=s?(n=0,(a=Math.min(Math.max(-l,-u),l))*(a+2*u)+d):-(n=Math.max(0,-(c*l+h)))*n+(a=0<n?l:Math.min(Math.max(-l,-u),l))*(a+2*u)+d;else a=0<c?-l:l,o=-(n=Math.max(0,-(c*a+h)))*n+a*(a+2*u)+d;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(_segDir).multiplyScalar(a).add(_segCenter),o}},{key:"intersectSphere",value:function(e,t){_vector$2.subVectors(e.center,this.origin);var i=_vector$2.dot(this.direction),r=_vector$2.dot(_vector$2)-i*i,n=e.radius*e.radius;if(n<r)return null;var a=Math.sqrt(n-r),o=i-a,s=i+a;return o<0&&s<0?null:this.at(o<0?s:o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=i?i:null}},{key:"intersectPlane",value:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var i,r,n,a,o,s,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return r=0<=l?(i=(e.min.x-u.x)*l,(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,(e.min.x-u.x)*l),(a=0<=c?(n=(e.min.y-u.y)*c,(e.max.y-u.y)*c):(n=(e.max.y-u.y)*c,(e.min.y-u.y)*c))<i||r<n?null:((i<n||i!=i)&&(i=n),(a<r||r!=r)&&(r=a),(s=0<=h?(o=(e.min.z-u.z)*h,(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,(e.min.z-u.z)*h))<i||r<o?null:((i<o||i!=i)&&(i=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(0<=i?i:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,_vector$2)}},{key:"intersectTriangle",value:function(e,t,i,r,n){_edge1.subVectors(t,e),_edge2.subVectors(i,e),_normal.crossVectors(_edge1,_edge2);var a,o=this.direction.dot(_normal);if(0<o){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}_diff.subVectors(this.origin,e);var s=a*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(s<0)return null;var l=a*this.direction.dot(_edge1.cross(_diff));if(l<0)return null;if(o<s+l)return null;var c=-a*_diff.dot(_normal);return c<0?null:this.at(c/o,n)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),i}(),Matrix4=function(){function e(){_classCallCheck(this,e),Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return _createClass(e,[{key:"set",value:function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,m,f){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}},{key:"extractBasis",value:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,i=e.elements,r=1/_v1$1.setFromMatrixColumn(e,0).length(),n=1/_v1$1.setFromMatrixColumn(e,1).length(),a=1/_v1$1.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,a=Math.cos(i),o=Math.sin(i),s=Math.cos(r),l=Math.sin(r),c=Math.cos(n),h=Math.sin(n);if("XYZ"===e.order){var u=a*c,d=a*h,p=o*c,m=o*h;t[0]=s*c,t[4]=-s*h,t[8]=l,t[1]=d+p*l,t[5]=u-m*l,t[9]=-o*s,t[2]=m-u*l,t[6]=p+d*l,t[10]=a*s}else if("YXZ"===e.order){var f=s*c,g=s*h,v=l*c,y=l*h;t[0]=f+y*o,t[4]=v*o-g,t[8]=a*l,t[1]=a*h,t[5]=a*c,t[9]=-o,t[2]=g*o-v,t[6]=y+f*o,t[10]=a*s}else if("ZXY"===e.order){var x=s*c,_=s*h,b=l*c,w=l*h;t[0]=x-w*o,t[4]=-a*h,t[8]=b+_*o,t[1]=_+b*o,t[5]=a*c,t[9]=w-x*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var M=a*c,S=a*h,T=o*c,A=o*h;t[0]=s*c,t[4]=T*l-S,t[8]=M*l+A,t[1]=s*h,t[5]=A*l+M,t[9]=S*l-T,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var E=a*s,C=a*l,L=o*s,R=o*l;t[0]=s*c,t[4]=R-E*h,t[8]=L*h+C,t[1]=h,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=C*h+L,t[10]=E-R*h}else if("XZY"===e.order){var P=a*s,D=a*l,k=o*s,B=o*l;t[0]=s*c,t[4]=-h,t[8]=l*c,t[1]=P*h+B,t[5]=a*c,t[9]=D*h-k,t[2]=k*h-D,t[6]=o*c,t[10]=B*h+P}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(_zero,e,_one)}},{key:"lookAt",value:function(e,t,i){var r=this.elements;return _z.subVectors(e,t),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(i,_z),0===_x.lengthSq()&&(1===Math.abs(i.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(i,_z)),_x.normalize(),_y.crossVectors(_z,_x),r[0]=_x.x,r[4]=_y.x,r[8]=_z.x,r[1]=_x.y,r[5]=_y.y,r[9]=_z.y,r[2]=_x.z,r[6]=_y.z,r[10]=_z.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var i=e.elements,r=t.elements,n=this.elements,a=i[0],o=i[4],s=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],m=i[6],f=i[10],g=i[14],v=i[3],y=i[7],x=i[11],_=i[15],b=r[0],w=r[4],M=r[8],S=r[12],T=r[1],A=r[5],E=r[9],C=r[13],L=r[2],R=r[6],P=r[10],D=r[14],k=r[3],B=r[7],F=r[11],I=r[15];return n[0]=a*b+o*T+s*L+l*k,n[4]=a*w+o*A+s*R+l*B,n[8]=a*M+o*E+s*P+l*F,n[12]=a*S+o*C+s*D+l*I,n[1]=c*b+h*T+u*L+d*k,n[5]=c*w+h*A+u*R+d*B,n[9]=c*M+h*E+u*P+d*F,n[13]=c*S+h*C+u*D+d*I,n[2]=p*b+m*T+f*L+g*k,n[6]=p*w+m*A+f*R+g*B,n[10]=p*M+m*E+f*P+g*F,n[14]=p*S+m*C+f*D+g*I,n[3]=v*b+y*T+x*L+_*k,n[7]=v*w+y*A+x*R+_*B,n[11]=v*M+y*E+x*P+_*F,n[15]=v*S+y*C+x*D+_*I,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(n*s*h-r*l*h-n*o*u+i*l*u+r*o*d-i*s*d)+e[7]*(t*s*d-t*l*u+n*a*u-r*a*d+r*l*c-n*s*c)+e[11]*(t*l*h-t*o*d-n*a*h+i*a*d+n*o*c-i*l*c)+e[15]*(-r*o*c-t*s*h+t*o*u+r*a*h-i*a*u+i*s*c)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,i){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}},{key:"getInverse",value:function(e,t){void 0!==t&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var i=this.elements,r=e.elements,n=r[0],a=r[1],o=r[2],s=r[3],l=r[4],c=r[5],h=r[6],u=r[7],d=r[8],p=r[9],m=r[10],f=r[11],g=r[12],v=r[13],y=r[14],x=r[15],_=p*y*u-v*m*u+v*h*f-c*y*f-p*h*x+c*m*x,b=g*m*u-d*y*u-g*h*f+l*y*f+d*h*x-l*m*x,w=d*v*u-g*p*u+g*c*f-l*v*f-d*c*x+l*p*x,M=g*p*h-d*v*h-g*c*m+l*v*m+d*c*y-l*p*y,S=n*_+a*b+o*w+s*M;if(0==S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var T=1/S;return i[0]=_*T,i[1]=(v*m*s-p*y*s-v*o*f+a*y*f+p*o*x-a*m*x)*T,i[2]=(c*y*s-v*h*s+v*o*u-a*y*u-c*o*x+a*h*x)*T,i[3]=(p*h*s-c*m*s-p*o*u+a*m*u+c*o*f-a*h*f)*T,i[4]=b*T,i[5]=(d*y*s-g*m*s+g*o*f-n*y*f-d*o*x+n*m*x)*T,i[6]=(g*h*s-l*y*s-g*o*u+n*y*u+l*o*x-n*h*x)*T,i[7]=(l*m*s-d*h*s+d*o*u-n*m*u-l*o*f+n*h*f)*T,i[8]=w*T,i[9]=(g*p*s-d*v*s-g*a*f+n*v*f+d*a*x-n*p*x)*T,i[10]=(l*v*s-g*c*s+g*a*u-n*v*u-l*a*x+n*c*x)*T,i[11]=(d*c*s-l*p*s-d*a*u+n*p*u+l*a*f-n*c*f)*T,i[12]=M*T,i[13]=(d*v*o-g*p*o+g*a*m-n*v*m-d*a*y+n*p*y)*T,i[14]=(g*c*o-l*v*o-g*a*h+n*v*h+l*a*y-n*c*y)*T,i[15]=(l*p*o-d*c*o+d*a*h-n*p*h-l*a*m+n*c*m)*T,this}},{key:"scale",value:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}},{key:"makeTranslation",value:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,a=e.x,o=e.y,s=e.z,l=n*a,c=n*o;return this.set(l*a+i,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+i,c*s-r*a,0,l*s-r*o,c*s+r*a,n*s*s+i,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,i){var r=this.elements,n=t._x,a=t._y,o=t._z,s=t._w,l=n+n,c=a+a,h=o+o,u=n*l,d=n*c,p=n*h,m=a*c,f=a*h,g=o*h,v=s*l,y=s*c,x=s*h,_=i.x,b=i.y,w=i.z;return r[0]=(1-(m+g))*_,r[1]=(d+x)*_,r[2]=(p-y)*_,r[3]=0,r[4]=(d-x)*b,r[5]=(1-(u+g))*b,r[6]=(f+v)*b,r[7]=0,r[8]=(p+y)*w,r[9]=(f-v)*w,r[10]=(1-(u+m))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,i){var r=this.elements,n=_v1$1.set(r[0],r[1],r[2]).length(),a=_v1$1.set(r[4],r[5],r[6]).length(),o=_v1$1.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],_m1.copy(this);var s=1/n,l=1/a,c=1/o;return _m1.elements[0]*=s,_m1.elements[1]*=s,_m1.elements[2]*=s,_m1.elements[4]*=l,_m1.elements[5]*=l,_m1.elements[6]*=l,_m1.elements[8]*=c,_m1.elements[9]*=c,_m1.elements[10]*=c,t.setFromRotationMatrix(_m1),i.x=n,i.y=a,i.z=o,this}},{key:"makePerspective",value:function(e,t,i,r,n,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*n/(i-r),l=(t+e)/(t-e),c=(i+r)/(i-r),h=-(a+n)/(a-n),u=-2*a*n/(a-n);return o[0]=2*n/(t-e),o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=s,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=u,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,i,r,n,a){var o=this.elements,s=1/(t-e),l=1/(i-r),c=1/(a-n),h=(t+e)*s,u=(i+r)*l,d=(a+n)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}},{key:"fromArray",value:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this}},{key:"toArray",value:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}]),e}(),_v1$1=new Vector3,_m1=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,Euler=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:n.DefaultOrder;_classCallCheck(this,n),Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=i,this._order=r}return _createClass(n,[{key:"set",value:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e,t,i){var r=MathUtils.clamp,n=e.elements,a=n[0],o=n[4],s=n[8],l=n[1],c=n[5],h=n[9],u=n[2],d=n[6],p=n[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,a),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-r(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(s,p));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,i){return _matrix.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix,t,i)}},{key:"setFromVector3",value:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)}},{key:"reorder",value:function(e){return _quaternion$1.setFromEuler(this),this.setFromQuaternion(_quaternion$1,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}]),n}();Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var _matrix=new Matrix4,_quaternion$1=new Quaternion,Layers=function(){function e(){_classCallCheck(this,e),this.mask=1}return _createClass(e,[{key:"set",value:function(e){this.mask=1<<e|0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!=(this.mask&e.mask)}}]),e}(),_object3DId=0,_v1$2=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position=new Vector3,_scale=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,i=new Quaternion,r=new Vector3(1,1,1);t._onChange(function(){i.setFromEuler(t,!1)}),i._onChange(function(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this},rotateOnWorldAxis:function(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this},rotateX:function(e){return this.rotateOnAxis(_xAxis,e)},rotateY:function(e){return this.rotateOnAxis(_yAxis,e)},rotateZ:function(e){return this.rotateOnAxis(_zAxis,e)},translateOnAxis:function(e,t){return _v1$2.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$2.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(_xAxis,e)},translateY:function(e){return this.translateOnAxis(_yAxis,e)},translateZ:function(e){return this.translateOnAxis(_zAxis,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(_m1$1.getInverse(this.matrixWorld))},lookAt:function(e,t,i){e.isVector3?_target.copy(e):_target.set(e,t,i);var r=this.parent;this.updateWorldMatrix(!0,!1),_position.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position,_target,this.up):_m1$1.lookAt(_target,_position,this.up),this.quaternion.setFromRotationMatrix(_m1$1),r&&(_m1$1.extractRotation(r.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.inverse()))},add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return-1!==i&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(_removedEvent)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),_m1$1.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,e,_scale),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,_quaternion$2,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,n=0,a=r.length;n<a;n++)r[n].updateWorldMatrix(!1,!0)},toJSON:function(i){var e=void 0===i||"string"==typeof i,t={};e&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{}},t.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function n(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(i)),t.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=n(i.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){n(i.shapes,o[s])}else n(i.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,u=this.material.length;h<u;h++)c.push(n(i.materials,this.material[h]));r.material=c}else r.material=n(i.materials,this.material);if(0<this.children.length){r.children=[];for(var d=0;d<this.children.length;d++)r.children.push(this.children[d].toJSON(i).object)}if(e){var p=y(i.geometries),m=y(i.materials),f=y(i.textures),g=y(i.images),v=y(i.shapes);0<p.length&&(t.geometries=p),0<m.length&&(t.materials=m),0<f.length&&(t.textures=f),0<g.length&&(t.images=g),0<v.length&&(t.shapes=v)}return t.object=r,t;function y(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){this.add(e.children[i].clone())}return this}});var _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3,Plane=function(){function i(e,t){_classCallCheck(this,i),Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}return _createClass(i,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,i){var r=_vector1.subVectors(i,t).cross(_vector2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Vector3);var i=e.delta(_vector1),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||1<n?void 0:t.copy(i).multiplyScalar(n).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&0<i||i<0&&0<t}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var i=t||_normalMatrix.getNormalMatrix(e),r=this.coplanarPoint(_vector1).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),i}(),_v0$1=new Vector3,_v1$3=new Vector3,_v2$1=new Vector3,_v3=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3,Triangle=function(){function a(e,t,i){_classCallCheck(this,a),this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==i?i:new Vector3}return _createClass(a,[{key:"set",value:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}},{key:"setFromPointsAndIndices",value:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()}},{key:"getMidpoint",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(e){return a.getNormal(this.a,this.b,this.c,e)}},{key:"getPlane",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Plane),e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(e,t){return a.getBarycoord(e,this.a,this.b,this.c,t)}},{key:"getUV",value:function(e,t,i,r,n){return a.getUV(e,this.a,this.b,this.c,t,i,r,n)}},{key:"containsPoint",value:function(e){return a.containsPoint(e,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(e){return a.isFrontFacing(this.a,this.b,this.c,e)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Vector3);var i,r,n=this.a,a=this.b,o=this.c;_vab.subVectors(a,n),_vac.subVectors(o,n),_vap.subVectors(e,n);var s=_vab.dot(_vap),l=_vac.dot(_vap);if(s<=0&&l<=0)return t.copy(n);_vbp.subVectors(e,a);var c=_vab.dot(_vbp),h=_vac.dot(_vbp);if(0<=c&&h<=c)return t.copy(a);var u=s*h-c*l;if(u<=0&&0<=s&&c<=0)return i=s/(s-c),t.copy(n).addScaledVector(_vab,i);_vcp.subVectors(e,o);var d=_vab.dot(_vcp),p=_vac.dot(_vcp);if(0<=p&&d<=p)return t.copy(o);var m=d*l-s*p;if(m<=0&&0<=l&&p<=0)return r=l/(l-p),t.copy(n).addScaledVector(_vac,r);var f=c*p-d*h;if(f<=0&&0<=h-c&&0<=d-p)return _vbc.subVectors(o,a),r=(h-c)/(h-c+(d-p)),t.copy(a).addScaledVector(_vbc,r);var g=1/(f+m+u);return i=m*g,r=u*g,t.copy(n).addScaledVector(_vab,i).addScaledVector(_vac,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,i,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Vector3),r.subVectors(i,t),_v0$1.subVectors(e,t),r.cross(_v0$1);var n=r.lengthSq();return 0<n?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,i,r,n){_v0$1.subVectors(r,t),_v1$3.subVectors(i,t),_v2$1.subVectors(e,t);var a=_v0$1.dot(_v0$1),o=_v0$1.dot(_v1$3),s=_v0$1.dot(_v2$1),l=_v1$3.dot(_v1$3),c=_v1$3.dot(_v2$1),h=a*l-o*o;if(void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new Vector3),0==h)return n.set(-2,-1,-1);var u=1/h,d=(l*s-o*c)*u,p=(a*c-o*s)*u;return n.set(1-d-p,p,d)}},{key:"containsPoint",value:function(e,t,i,r){return this.getBarycoord(e,t,i,r,_v3),0<=_v3.x&&0<=_v3.y&&_v3.x+_v3.y<=1}},{key:"getUV",value:function(e,t,i,r,n,a,o,s){return this.getBarycoord(e,t,i,r,_v3),s.set(0,0),s.addScaledVector(n,_v3.x),s.addScaledVector(a,_v3.y),s.addScaledVector(o,_v3.z),s}},{key:"isFrontFacing",value:function(e,t,i,r){return _v0$1.subVectors(i,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(r)<0}}]),a}(),_colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(e,t,i){return i<0&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function SRGBToLinear(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function LinearToSRGB(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Color=function(){function r(e,t,i){return _classCallCheck(this,r),Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}return _createClass(r,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,i){return this.r=e,this.g=t,this.b=i,this}},{key:"setHSL",value:function(e,t,i){if(e=MathUtils.euclideanModulo(e,1),t=MathUtils.clamp(t,0,1),i=MathUtils.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{var r=i<=.5?i*(1+t):i+t-i*t,n=2*i-r;this.r=hue2rgb(n,r,e+1/3),this.g=hue2rgb(n,r,e),this.b=hue2rgb(n,r,e-1/3)}return this}},{key:"setStyle",value:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,n=i[2];switch(i[1]){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){var a=parseFloat(r[1])/360,o=parseInt(r[2],10)/100,s=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(a,o,s)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l=i[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this}},{key:"setColorName",value:function(e){var t=_colorKeywords[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e,t){void 0===t&&(t=2);var i=0<t?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i,r=this.r,n=this.g,a=this.b,o=Math.max(r,n,a),s=Math.min(r,n,a),l=(s+o)/2;if(s===o)i=t=0;else{var c=o-s;switch(i=l<=.5?c/(o+s):c/(2-o-s),o){case r:t=(n-a)/c+(n<a?6:0);break;case n:t=(a-r)/c+2;break;case a:t=(r-n)/c+4}t/=6}return e.h=t,e.s=i,e.l=l,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,i){return this.getHSL(_hslA),_hslA.h+=e,_hslA.s+=t,_hslA.l+=i,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(_hslA),e.getHSL(_hslB);var i=MathUtils.lerp(_hslA.h,_hslB.h,t),r=MathUtils.lerp(_hslA.s,_hslB.s,t),n=MathUtils.lerp(_hslA.l,_hslB.l,t);return this.setHSL(i,r,n),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),r}();Color.NAMES=_colorKeywords,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;var Face3=function(){function o(e,t,i,r,n,a){_classCallCheck(this,o),this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==a?a:0}return _createClass(o,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,n=e.vertexColors.length;r<n;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this}}]),o}(),materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function MeshBasicMaterial(e){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===FlatShading;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==FrontSide&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),0<this.alphaTest&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),1<this.wireframeLinewidth&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){var n=r(e.textures),a=r(e.images);0<n.length&&(i.textures=n),0<a.length&&(i.images=a)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var _vector$3=new Vector3,_vector2$1=new Vector2;function BufferAttribute(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(e,t,i){BufferAttribute.call(this,new Int8Array(e),t,i)}function Uint8BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8Array(e),t,i)}function Uint8ClampedBufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8ClampedArray(e),t,i)}function Int16BufferAttribute(e,t,i){BufferAttribute.call(this,new Int16Array(e),t,i)}function Uint16BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint16Array(e),t,i)}function Int32BufferAttribute(e,t,i){BufferAttribute.call(this,new Int32Array(e),t,i)}function Uint32BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint32Array(e),t,i)}function Float32BufferAttribute(e,t,i){BufferAttribute.call(this,new Float32Array(e),t,i)}function Float64BufferAttribute(e,t,i){BufferAttribute.call(this,new Float64Array(e),t,i)}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new Color),t[i++]=a.r,t[i++]=a.g,t[i++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new Vector2),t[i++]=a.x,t[i++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new Vector3),t[i++]=a.x,t[i++]=a.y,t[i++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Vector4),t[i++]=a.x,t[i++]=a.y,t[i++]=a.z,t[i++]=a.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(var t=0,i=this.count;t<i;t++)_vector2$1.fromBufferAttribute(this,t),_vector2$1.applyMatrix3(e),this.setXY(t,_vector2$1.x,_vector2$1.y);else if(3===this.itemSize)for(var r=0,n=this.count;r<n;r++)_vector$3.fromBufferAttribute(this,r),_vector$3.applyMatrix3(e),this.setXYZ(r,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyMatrix4:function(e){for(var t=0,i=this.count;t<i;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.applyMatrix4(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},applyNormalMatrix:function(e){for(var t=0,i=this.count;t<i;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.applyNormalMatrix(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},transformDirection:function(e){for(var t=0,i=this.count;t<i;t++)_vector$3.x=this.getX(t),_vector$3.y=this.getY(t),_vector$3.z=this.getZ(t),_vector$3.transformDirection(e),this.setXYZ(t,_vector$3.x,_vector$3.y,_vector$3.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return this.array[(e*=this.itemSize)+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return this.array[(e*=this.itemSize)+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return this.array[(e*=this.itemSize)+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;var DirectGeometry=function(){function e(){_classCallCheck(this,e),this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}return _createClass(e,[{key:"computeGroups",value:function(e){var t,i,r=[],n=void 0,a=e.faces;for(i=0;i<a.length;i++){var o=a[i];o.materialIndex!==n&&(n=o.materialIndex,void 0!==t&&(t.count=3*i-t.start,r.push(t)),t={start:3*i,materialIndex:n})}void 0!==t&&(t.count=3*i-t.start,r.push(t)),this.groups=r}},{key:"fromGeometry",value:function(e){var t,i=e.faces,r=e.vertices,n=e.faceVertexUvs,a=n[0]&&0<n[0].length,o=n[1]&&0<n[1].length,s=e.morphTargets,l=s.length;if(0<l){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var h,u=e.morphNormals,d=u.length;if(0<d){h=[];for(var p=0;p<d;p++)h[p]={name:u[p].name,data:[]};this.morphTargets.normal=h}var m=e.skinIndices,f=e.skinWeights,g=m.length===r.length,v=f.length===r.length;0<r.length&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var y=0;y<i.length;y++){var x=i[y];this.vertices.push(r[x.a],r[x.b],r[x.c]);var _=x.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var b=x.normal;this.normals.push(b,b,b)}var w=x.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var M=x.color;this.colors.push(M,M,M)}if(!0===a){var S=n[0][y];void 0!==S?this.uvs.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(!0===o){var T=n[1][y];void 0!==T?this.uvs2.push(T[0],T[1],T[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(var A=0;A<l;A++){var E=s[A].vertices;t[A].data.push(E[x.a],E[x.b],E[x.c])}for(var C=0;C<d;C++){var L=u[C].vertexNormals[y];h[C].data.push(L.a,L.b,L.c)}g&&this.skinIndices.push(m[x.a],m[x.b],m[x.c]),v&&this.skinWeights.push(f[x.a],f[x.b],f[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}]),e}();function arrayMax(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)t<e[i]&&(t=e[i]);return t}var _bufferGeometryId=1,_m1$2=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$4=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:_bufferGeometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<arrayMax(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){var r=(new Matrix3).getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}var n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return _m1$2.makeRotationX(e),this.applyMatrix4(_m1$2),this},rotateY:function(e){return _m1$2.makeRotationY(e),this.applyMatrix4(_m1$2),this},rotateZ:function(e){return _m1$2.makeRotationZ(e),this.applyMatrix4(_m1$2),this},translate:function(e,t,i){return _m1$2.makeTranslation(e,t,i),this.applyMatrix4(_m1$2),this},scale:function(e,t,i){return _m1$2.makeScale(e,t,i),this.applyMatrix4(_m1$2),this},lookAt:function(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new Float32BufferAttribute(3*t.vertices.length,3),r=new Float32BufferAttribute(3*t.colors.length,3);if(this.setAttribute("position",i.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Float32BufferAttribute(t.lineDistances.length,1);this.setAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(i=void 0,t.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}if(!0===t.verticesNeedUpdate){var r=this.attributes.position;void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){var n=this.attributes.normal;void 0!==n&&(n.copyVector3sArray(t.normals),n.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){var a=this.attributes.color;void 0!==a&&(a.copyColorsArray(t.colors),a.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var o=this.attributes.uv;void 0!==o&&(o.copyVector2sArray(t.uvs),o.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var s=this.attributes.lineDistance;void 0!==s&&(s.copyArray(t.lineDistances),s.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var i=new Float32Array(3*e.normals.length);this.setAttribute("normal",new BufferAttribute(i,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new BufferAttribute(r,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var n=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var a=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new BufferAttribute(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],c=0,h=l.length;c<h;c++){var u=l[c],d=new Float32BufferAttribute(3*u.data.length,3);d.name=u.name,s.push(d.copyVector3sArray(u.data))}this.morphAttributes[o]=s}if(0<e.skinIndices.length){var p=new Float32BufferAttribute(4*e.skinIndices.length,4);this.setAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var m=new Float32BufferAttribute(4*e.skinWeights.length,4);this.setAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){_box$2.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(_vector$4.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$4),_vector$4.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$4)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(e){var i=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(e),t)for(var r=0,n=t.length;r<n;r++){_boxMorphTargets.setFromBufferAttribute(t[r]),this.morphTargetsRelative?(_vector$4.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$4),_vector$4.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$4)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(i);for(var a=0,o=0,s=e.count;o<s;o++)_vector$4.fromBufferAttribute(e,o),a=Math.max(a,i.distanceToSquared(_vector$4));if(t)for(var l=0,c=t.length;l<c;l++)for(var h=t[l],u=this.morphTargetsRelative,d=0,p=h.count;d<p;d++)_vector$4.fromBufferAttribute(h,d),u&&(_offset.fromBufferAttribute(e,d),_vector$4.add(_offset)),a=Math.max(a,i.distanceToSquared(_vector$4));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(var r=0,n=i.count;r<n;r++)i.setXYZ(r,0,0,0);var a=new Vector3,o=new Vector3,s=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3,u=new Vector3,d=new Vector3;if(e)for(var p=0,m=e.count;p<m;p+=3){var f=e.getX(p+0),g=e.getX(p+1),v=e.getX(p+2);a.fromBufferAttribute(t,f),o.fromBufferAttribute(t,g),s.fromBufferAttribute(t,v),u.subVectors(s,o),d.subVectors(a,o),u.cross(d),l.fromBufferAttribute(i,f),c.fromBufferAttribute(i,g),h.fromBufferAttribute(i,v),l.add(u),c.add(u),h.add(u),i.setXYZ(f,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z),i.setXYZ(v,h.x,h.y,h.z)}else for(var y=0,x=t.count;y<x;y+=3)a.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),u.subVectors(s,o),d.subVectors(a,o),u.cross(d),i.setXYZ(y+0,u.x,u.y,u.z),i.setXYZ(y+1,u.x,u.y,u.z),i.setXYZ(y+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,l=Math.min(o.length,n.length-s),c=0,h=s;c<l;c++,h++)n[h]=o[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,i=e.count;t<i;t++)_vector$4.fromBufferAttribute(e,t),_vector$4.normalize(),e.setXYZ(t,_vector$4.x,_vector$4.y,_vector$4.z)},toNonIndexed:function(){function e(e,t){for(var i=e.array,r=e.itemSize,n=e.normalized,a=new i.constructor(t.length*r),o=0,s=0,l=0,c=t.length;l<c;l++){o=t[l]*r;for(var h=0;h<r;h++)a[s++]=i[o++]}return new BufferAttribute(a,r,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new BufferGeometry,i=this.index.array,r=this.attributes;for(var n in r){var a=e(r[n],i);t.setAttribute(n,a)}var o=this.morphAttributes;for(var s in o){for(var l=[],c=o[s],h=0,u=c.length;h<u;h++){var d=e(c[h],i);l.push(d)}t.morphAttributes[s]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,m=0,f=p.length;m<f;m++){var g=p[m];t.addGroup(g.start,g.count,g.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var n=this.attributes;for(var a in n){var o=n[a],s=o.toJSON(e.data);""!==o.name&&(s.name=o.name),e.data.attributes[a]=s}var l={},c=!1;for(var h in this.morphAttributes){for(var u=this.morphAttributes[h],d=[],p=0,m=u.length;p<m;p++){var f=u[p],g=f.toJSON(e.data);""!==f.name&&(g.name=f.name),d.push(g)}0<d.length&&(l[h]=d,c=!0)}c&&(e.data.morphAttributes=l,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;0<v.length&&(e.data.groups=JSON.parse(JSON.stringify(v)));var y=this.boundingSphere;return null!==y&&(e.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),e},clone:function(){return(new BufferGeometry).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone(t));var r=e.attributes;for(var n in r){this.setAttribute(n,r[n].clone(t))}var a=e.morphAttributes;for(var o in a){for(var s=[],l=a[o],c=0,h=l.length;c<h;c++)s.push(l[c].clone(t));this.morphAttributes[o]=s}this.morphTargetsRelative=e.morphTargetsRelative;for(var u=e.groups,d=0,p=u.length;d<p;d++){var m=u[d];this.addGroup(m.start,m.count,m.materialIndex)}var f=e.boundingBox;null!==f&&(this.boundingBox=f.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial,this.updateMorphTargets()}function checkIntersection(e,t,i,r,n,a,o,s){if(null===(t.side===BackSide?r.intersectTriangle(o,a,n,!0,s):r.intersectTriangle(n,a,o,t.side!==DoubleSide,s)))return null;_intersectionPointWorld.copy(s),_intersectionPointWorld.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo(_intersectionPointWorld);return l<i.near||i.far<l?null:{distance:l,point:_intersectionPointWorld.clone(),object:e}}function checkBufferGeometryIntersection(e,t,i,r,n,a,o,s,l,c,h,u){_vA.fromBufferAttribute(n,c),_vB.fromBufferAttribute(n,h),_vC.fromBufferAttribute(n,u);var d=e.morphTargetInfluences;if(t.morphTargets&&a&&d){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(var p=0,m=a.length;p<m;p++){var f=d[p],g=a[p];0!==f&&(_tempA.fromBufferAttribute(g,c),_tempB.fromBufferAttribute(g,h),_tempC.fromBufferAttribute(g,u),o?(_morphA.addScaledVector(_tempA,f),_morphB.addScaledVector(_tempB,f),_morphC.addScaledVector(_tempC,f)):(_morphA.addScaledVector(_tempA.sub(_vA),f),_morphB.addScaledVector(_tempB.sub(_vB),f),_morphC.addScaledVector(_tempC.sub(_vC),f)))}_vA.add(_morphA),_vB.add(_morphB),_vC.add(_morphC)}e.isSkinnedMesh&&(e.boneTransform(c,_vA),e.boneTransform(h,_vB),e.boneTransform(u,_vC));var v=checkIntersection(e,t,i,r,_vA,_vB,_vC,_intersectionPoint);if(v){s&&(_uvA.fromBufferAttribute(s,c),_uvB.fromBufferAttribute(s,h),_uvC.fromBufferAttribute(s,u),v.uv=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),l&&(_uvA.fromBufferAttribute(l,c),_uvB.fromBufferAttribute(l,h),_uvC.fromBufferAttribute(l,u),v.uv2=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2));var y=new Face3(c,h,u);Triangle.getNormal(_vA,_vB,_vC,y.normal),v.face=y}return v}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(0<i.length){var r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0,a=r.length;n<a;n++){var o=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}else{var s=e.morphTargets;void 0!==s&&0<s.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var i,r=this.geometry,n=this.material,a=this.matrixWorld;if(void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere.copy(r.boundingSphere),_sphere.applyMatrix4(a),!1!==e.ray.intersectsSphere(_sphere)&&(_inverseMatrix.getInverse(a),_ray.copy(e.ray).applyMatrix4(_inverseMatrix),null===r.boundingBox||!1!==_ray.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o=r.index,s=r.attributes.position,l=r.morphAttributes.position,c=r.morphTargetsRelative,h=r.attributes.uv,u=r.attributes.uv2,d=r.groups,p=r.drawRange;if(null!==o)if(Array.isArray(n))for(var m=0,f=d.length;m<f;m++)for(var g=d[m],v=n[g.materialIndex],y=Math.max(g.start,p.start),x=Math.min(g.start+g.count,p.start+p.count);y<x;y+=3){var _=o.getX(y),b=o.getX(y+1),w=o.getX(y+2);(i=checkBufferGeometryIntersection(this,v,e,_ray,s,l,c,h,u,_,b,w))&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=g.materialIndex,t.push(i))}else for(var M=Math.max(0,p.start),S=Math.min(o.count,p.start+p.count);M<S;M+=3){var T=o.getX(M),A=o.getX(M+1),E=o.getX(M+2);(i=checkBufferGeometryIntersection(this,n,e,_ray,s,l,c,h,u,T,A,E))&&(i.faceIndex=Math.floor(M/3),t.push(i))}else if(void 0!==s)if(Array.isArray(n))for(var C=0,L=d.length;C<L;C++)for(var R=d[C],P=n[R.materialIndex],D=Math.max(R.start,p.start),k=Math.min(R.start+R.count,p.start+p.count);D<k;D+=3){(i=checkBufferGeometryIntersection(this,P,e,_ray,s,l,c,h,u,D,D+1,D+2))&&(i.faceIndex=Math.floor(D/3),i.face.materialIndex=R.materialIndex,t.push(i))}else for(var B=Math.max(0,p.start),F=Math.min(s.count,p.start+p.count);B<F;B+=3){(i=checkBufferGeometryIntersection(this,n,e,_ray,s,l,c,h,u,B,B+1,B+2))&&(i.faceIndex=Math.floor(B/3),t.push(i))}}else if(r.isGeometry){var I,O=Array.isArray(n),V=r.vertices,U=r.faces,G=r.faceVertexUvs[0];0<G.length&&(I=G);for(var N=0,z=U.length;N<z;N++){var H=U[N],j=O?n[H.materialIndex]:n;if(void 0!==j){var W=V[H.a],q=V[H.b],$=V[H.c];if(i=checkIntersection(this,j,e,_ray,W,q,$,_intersectionPoint)){if(I&&I[N]){var X=I[N];_uvA.copy(X[0]),_uvB.copy(X[1]),_uvC.copy(X[2]),i.uv=Triangle.getUV(_intersectionPoint,W,q,$,_uvA,_uvB,_uvC,new Vector2)}i.face=H,i.faceIndex=N,t.push(i)}}}}}});var _geometryId=0,_m1$3=new Matrix4,_obj$1=new Object3D,_offset$1=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:_geometryId+=2}),this.uuid=MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(e){for(var t=(new Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(var n=0,a=this.faces.length;n<a;n++){var o=this.faces[n];o.normal.applyMatrix3(t).normalize();for(var s=0,l=o.vertexNormals.length;s<l;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return _m1$3.makeRotationX(e),this.applyMatrix4(_m1$3),this},rotateY:function(e){return _m1$3.makeRotationY(e),this.applyMatrix4(_m1$3),this},rotateZ:function(e){return _m1$3.makeRotationZ(e),this.applyMatrix4(_m1$3),this},translate:function(e,t,i){return _m1$3.makeTranslation(e,t,i),this.applyMatrix4(_m1$3),this},scale:function(e,t,i){return _m1$3.makeScale(e,t,i),this.applyMatrix4(_m1$3),this},lookAt:function(e){return _obj$1.lookAt(e),_obj$1.updateMatrix(),this.applyMatrix4(_obj$1.matrix),this},fromBufferGeometry:function(e){var s=this,t=null!==e.index?e.index:void 0,i=e.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var r=i.position,l=i.normal,c=i.color,h=i.uv,u=i.uv2;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var n=0;n<r.count;n++)s.vertices.push((new Vector3).fromBufferAttribute(r,n)),void 0!==c&&s.colors.push((new Color).fromBufferAttribute(c,n));function a(e,t,i,r){var n=void 0===c?[]:[s.colors[e].clone(),s.colors[t].clone(),s.colors[i].clone()],a=void 0===l?[]:[(new Vector3).fromBufferAttribute(l,e),(new Vector3).fromBufferAttribute(l,t),(new Vector3).fromBufferAttribute(l,i)],o=new Face3(e,t,i,a,n,r);s.faces.push(o),void 0!==h&&s.faceVertexUvs[0].push([(new Vector2).fromBufferAttribute(h,e),(new Vector2).fromBufferAttribute(h,t),(new Vector2).fromBufferAttribute(h,i)]),void 0!==u&&s.faceVertexUvs[1].push([(new Vector2).fromBufferAttribute(u,e),(new Vector2).fromBufferAttribute(u,t),(new Vector2).fromBufferAttribute(u,i)])}var o=e.groups;if(0<o.length)for(var d=0;d<o.length;d++)for(var p=o[d],m=p.start,f=m,g=m+p.count;f<g;f+=3)void 0!==t?a(t.getX(f),t.getX(f+1),t.getX(f+2),p.materialIndex):a(f,f+1,f+2,p.materialIndex);else if(void 0!==t)for(var v=0;v<t.count;v+=3)a(t.getX(v),t.getX(v+1),t.getX(v+2));else for(var y=0;y<r.count;y+=3)a(y,y+1,y+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$1).negate(),this.translate(_offset$1.x,_offset$1.y,_offset$1.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new Matrix4;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],a=this.vertices[n.a],o=this.vertices[n.b];e.subVectors(this.vertices[n.c],o),t.subVectors(a,o),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);for(var t=new Array(this.vertices.length),i=0,r=this.vertices.length;i<r;i++)t[i]=new Vector3;if(e)for(var n=new Vector3,a=new Vector3,o=0,s=this.faces.length;o<s;o++){var l=this.faces[o],c=this.vertices[l.a],h=this.vertices[l.b];n.subVectors(this.vertices[l.c],h),a.subVectors(c,h),n.cross(a),t[l.a].add(n),t[l.b].add(n),t[l.c].add(n)}else{this.computeFaceNormals();for(var u=0,d=this.faces.length;u<d;u++){var p=this.faces[u];t[p.a].add(p.normal),t[p.b].add(p.normal),t[p.c].add(p.normal)}}for(var m=0,f=this.vertices.length;m<f;m++)t[m].normalize();for(var g=0,v=this.faces.length;g<v;g++){var y=this.faces[g],x=y.vertexNormals;3===x.length?(x[0].copy(t[y.a]),x[1].copy(t[y.b]),x[2].copy(t[y.c])):(x[0]=t[y.a].clone(),x[1]=t[y.b].clone(),x[2]=t[y.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(var e=0,t=this.faces.length;e<t;e++){var i=this.faces[e],r=i.vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(var e=0,t=this.faces.length;e<t;e++){var i=this.faces[e];i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]);for(var r=0,n=i.vertexNormals.length;r<n;r++)i.__originalVertexNormals[r]?i.__originalVertexNormals[r].copy(i.vertexNormals[r]):i.__originalVertexNormals[r]=i.vertexNormals[r].clone()}var a=new Geometry;a.faces=this.faces;for(var o=0,s=this.morphTargets.length;o<s;o++){if(!this.morphNormals[o]){this.morphNormals[o]={},this.morphNormals[o].faceNormals=[],this.morphNormals[o].vertexNormals=[];for(var l=this.morphNormals[o].faceNormals,c=this.morphNormals[o].vertexNormals,h=0,u=this.faces.length;h<u;h++){var d=new Vector3,p={a:new Vector3,b:new Vector3,c:new Vector3};l.push(d),c.push(p)}}var m=this.morphNormals[o];a.vertices=this.morphTargets[o].vertices,a.computeFaceNormals(),a.computeVertexNormals();for(var f=0,g=this.faces.length;f<g;f++){var v=this.faces[f],y=m.vertexNormals[f];m.faceNormals[f].copy(v.normal),y.a.copy(v.vertexNormals[0]),y.b.copy(v.vertexNormals[1]),y.c.copy(v.vertexNormals[2])}}for(var x=0,_=this.faces.length;x<_;x++){var b=this.faces[x];b.normal=b.__originalFaceNormal,b.vertexNormals=b.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var r,n=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0===i&&(i=0),void 0!==t&&(r=(new Matrix3).getNormalMatrix(t));for(var u=0,d=o.length;u<d;u++){var p=o[u].clone();void 0!==t&&p.applyMatrix4(t),a.push(p)}for(var m=0,f=h.length;m<f;m++)c.push(h[m].clone());for(var g=0,v=l.length;g<v;g++){var y=l[g],x=void 0,_=y.vertexNormals,b=y.vertexColors,w=new Face3(y.a+n,y.b+n,y.c+n);w.normal.copy(y.normal),void 0!==r&&w.normal.applyMatrix3(r).normalize();for(var M=0,S=_.length;M<S;M++)x=_[M].clone(),void 0!==r&&x.applyMatrix3(r).normalize(),w.vertexNormals.push(x);w.color.copy(y.color);for(var T=0,A=b.length;T<A;T++)w.vertexColors.push(b[T].clone());w.materialIndex=y.materialIndex+i,s.push(w)}for(var E=0,C=e.faceVertexUvs.length;E<C;E++){var L=e.faceVertexUvs[E];void 0===this.faceVertexUvs[E]&&(this.faceVertexUvs[E]=[]);for(var R=0,P=L.length;R<P;R++){for(var D=L[R],k=[],B=0,F=D.length;B<F;B++)k.push(D[B].clone());this.faceVertexUvs[E].push(k)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){for(var e={},t=[],i=[],r=Math.pow(10,4),n=0,a=this.vertices.length;n<a;n++){var o=this.vertices[n],s=Math.round(o.x*r)+"_"+Math.round(o.y*r)+"_"+Math.round(o.z*r);void 0===e[s]?(t.push(this.vertices[e[s]=n]),i[n]=t.length-1):i[n]=i[e[s]]}for(var l=[],c=0,h=this.faces.length;c<h;c++){var u=this.faces[c];u.a=i[u.a],u.b=i[u.b],u.c=i[u.c];for(var d=[u.a,u.b,u.c],p=0;p<3;p++)if(d[p]===d[(p+1)%3]){l.push(c);break}}for(var m=l.length-1;0<=m;m--){var f=l[m];this.faces.splice(f,1);for(var g=0,v=this.faceVertexUvs.length;g<v;g++)this.faceVertexUvs[g].splice(f,1)}var y=this.vertices.length-t.length;return this.vertices=t,y},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new Vector3(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var r,n,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(r=[]),o&&o.length===t&&(n=[]);for(var s=0;s<t;s++){var l=e[s]._id;r&&r.push(a[l]),n&&n.push(o[l])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var a=this.vertices[n];r.push(a.x,a.y,a.z)}for(var o=[],s=[],l={},c=[],h={},u=[],d={},p=0;p<this.faces.length;p++){var m=this.faces[p],f=void 0!==this.faceVertexUvs[0][p],g=0<m.normal.length(),v=0<m.vertexNormals.length,y=1!==m.color.r||1!==m.color.g||1!==m.color.b,x=0<m.vertexColors.length,_=0;if(_=S(_,0,0),_=S(_,1,!0),_=S(_,2,!1),_=S(_,3,f),_=S(_,4,g),_=S(_,5,v),_=S(_,6,y),_=S(_,7,x),o.push(_),o.push(m.a,m.b,m.c),o.push(m.materialIndex),f){var b=this.faceVertexUvs[0][p];o.push(E(b[0]),E(b[1]),E(b[2]))}if(g&&o.push(T(m.normal)),v){var w=m.vertexNormals;o.push(T(w[0]),T(w[1]),T(w[2]))}if(y&&o.push(A(m.color)),x){var M=m.vertexColors;o.push(A(M[0]),A(M[1]),A(M[2]))}}function S(e,t,i){return i?e|1<<t:e&~(1<<t)}function T(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function A(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==h[t]||(h[t]=c.length,c.push(e.getHex())),h[t]}function E(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=u.length/2,u.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=s,0<c.length&&(e.data.colors=c),0<u.length&&(e.data.uvs=[u]),e.data.faces=o,e},clone:function(){return(new Geometry).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var t=e.vertices,i=0,r=t.length;i<r;i++)this.vertices.push(t[i].clone());for(var n=e.colors,a=0,o=n.length;a<o;a++)this.colors.push(n[a].clone());for(var s=e.faces,l=0,c=s.length;l<c;l++)this.faces.push(s[l].clone());for(var h=0,u=e.faceVertexUvs.length;h<u;h++){var d=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(var p=0,m=d.length;p<m;p++){for(var f=d[p],g=[],v=0,y=f.length;v<y;v++){g.push(f[v].clone())}this.faceVertexUvs[h].push(g)}}for(var x=e.morphTargets,_=0,b=x.length;_<b;_++){var w={};if(w.name=x[_].name,void 0!==x[_].vertices){w.vertices=[];for(var M=0,S=x[_].vertices.length;M<S;M++)w.vertices.push(x[_].vertices[M].clone())}if(void 0!==x[_].normals){w.normals=[];for(var T=0,A=x[_].normals.length;T<A;T++)w.normals.push(x[_].normals[T].clone())}this.morphTargets.push(w)}for(var E=e.morphNormals,C=0,L=E.length;C<L;C++){var R={};if(void 0!==E[C].vertexNormals){R.vertexNormals=[];for(var P=0,D=E[C].vertexNormals.length;P<D;P++){var k=E[C].vertexNormals[P],B={};B.a=k.a.clone(),B.b=k.b.clone(),B.c=k.c.clone(),R.vertexNormals.push(B)}}if(void 0!==E[C].faceNormals){R.faceNormals=[];for(var F=0,I=E[C].faceNormals.length;F<I;F++)R.faceNormals.push(E[C].faceNormals[F].clone())}this.morphNormals.push(R)}for(var O=e.skinWeights,V=0,U=O.length;V<U;V++)this.skinWeights.push(O[V].clone());for(var G=e.skinIndices,N=0,z=G.length;N<z;N++)this.skinIndices.push(G[N].clone());for(var H=e.lineDistances,j=0,W=H.length;j<W;j++)this.lineDistances.push(H[j]);var q=e.boundingBox;null!==q&&(this.boundingBox=q.clone());var $=e.boundingSphere;return null!==$&&(this.boundingSphere=$.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var BoxGeometry=function(){_inherits(l,Geometry);var s=_createSuper(l);function l(e,t,i,r,n,a){var o;return _classCallCheck(this,l),(o=s.call(this)).type="BoxGeometry",o.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:a},o.fromBufferGeometry(new BoxBufferGeometry(e,t,i,r,n,a)),o.mergeVertices(),o}return l}(),BoxBufferGeometry=function(){_inherits(c,BufferGeometry);var l=_createSuper(c);function c(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1;_classCallCheck(this,c),(e=l.call(this)).type="BoxBufferGeometry",e.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:a,depthSegments:o};var L=_assertThisInitialized(e);n=Math.floor(n),a=Math.floor(a),o=Math.floor(o);var R=[],P=[],D=[],k=[],B=0,F=0;function s(e,t,i,r,n,a,o,s,l,c,h){for(var u=a/l,d=o/c,p=a/2,m=o/2,f=s/2,g=l+1,v=c+1,y=0,x=0,_=new Vector3,b=0;b<v;b++)for(var w=b*d-m,M=0;M<g;M++){_[e]=(M*u-p)*r,_[t]=w*n,_[i]=f,P.push(_.x,_.y,_.z),_[e]=0,_[t]=0,_[i]=0<s?1:-1,D.push(_.x,_.y,_.z),k.push(M/l),k.push(1-b/c),y+=1}for(var S=0;S<c;S++)for(var T=0;T<l;T++){var A=B+T+g*(S+1),E=B+(T+1)+g*(S+1),C=B+(T+1)+g*S;R.push(B+T+g*S,A,C),R.push(A,E,C),x+=6}L.addGroup(F,x,h),F+=x,B+=y}return s("z","y","x",-1,-1,r,i,t,o,a,0),s("z","y","x",1,-1,r,i,-t,o,a,1),s("x","z","y",1,1,t,r,i,n,o,2),s("x","z","y",1,-1,t,r,-i,n,o,3),s("x","y","z",1,-1,t,i,r,n,a,4),s("x","y","z",-1,-1,t,i,-r,n,a,5),e.setIndex(R),e.setAttribute("position",new Float32BufferAttribute(P,3)),e.setAttribute("normal",new Float32BufferAttribute(D,3)),e.setAttribute("uv",new Float32BufferAttribute(k,2)),e}return c}();function cloneUniforms(e){var t={};for(var i in e)for(var r in t[i]={},e[i]){var n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}return t}function mergeUniforms(e){for(var t={},i=0;i<e.length;i++){var r=cloneUniforms(e[i]);for(var n in r)t[n]=r[n]}return t}var UniformsUtils={clone:cloneUniforms,merge:mergeUniforms},default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ShaderMaterial(e){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(e,t,i,r){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},ShaderMaterial.prototype.toJSON=function(e){var t=Material.prototype.toJSON.call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;t.uniforms[i]=r&&r.isTexture?{type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var n={};for(var a in this.extensions)!0===this.extensions[a]&&(n[a]=!0);return 0<Object.keys(n).length&&(t.extensions=n),t},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){Object3D.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*MathUtils.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*MathUtils.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*MathUtils.RAD2DEG*Math.atan(Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*MathUtils.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;n+=a.offsetX*r/o,t-=a.offsetY*i/s,r*=a.width/o,i*=a.height/s}var l=this.filmOffset;0!==l&&(n+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var fov=90,aspect=1;function CubeCamera(e,t,o){if(Object3D.call(this),this.type="CubeCamera",!0===o.isWebGLCubeRenderTarget){this.renderTarget=o;var a=new PerspectiveCamera(fov,aspect,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(1,0,0)),this.add(a);var s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Vector3(-1,0,0)),this.add(s);var l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,l.up.set(0,0,1),l.lookAt(new Vector3(0,1,0)),this.add(l);var c=new PerspectiveCamera(fov,aspect,e,t);c.layers=this.layers,c.up.set(0,0,-1),c.lookAt(new Vector3(0,-1,0)),this.add(c);var h=new PerspectiveCamera(fov,aspect,e,t);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new Vector3(0,0,1)),this.add(h);var u=new PerspectiveCamera(fov,aspect,e,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new Vector3(0,0,-1)),this.add(u),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=e.xr.enabled,r=e.getRenderTarget(),n=o.texture.generateMipmaps;o.texture.generateMipmaps=e.xr.enabled=!1,e.setRenderTarget(o,0),e.render(t,a),e.setRenderTarget(o,1),e.render(t,s),e.setRenderTarget(o,2),e.render(t,l),e.setRenderTarget(o,3),e.render(t,c),e.setRenderTarget(o,4),e.render(t,h),o.texture.generateMipmaps=n,e.setRenderTarget(o,5),e.render(t,u),e.setRenderTarget(r),e.xr.enabled=i},this.clear=function(e,t,i,r){for(var n=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,i,r);e.setRenderTarget(n)}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function WebGLCubeRenderTarget(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),WebGLRenderTarget.call(this,e,e,t),this.texture.isWebGLCubeRenderTargetTexture=!0}function DataTexture(e,t,i,r,n,a,o,s,l,c,h,u){Texture.call(this,null,a,o,s,l,c,r,n,h,u),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:NearestFilter,this.minFilter=void 0!==c?c:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype),WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget,WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0,WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=RGBAFormat,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var i={tEquirect:{value:null}},r="\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",n="\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",a=new BoxBufferGeometry(5,5,5),o=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i),vertexShader:r,fragmentShader:n,side:BackSide,blending:NoBlending});o.uniforms.tEquirect.value=t;var s=new Mesh(a,o),l=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this},DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;var _sphere$1=new Sphere,_vector$5=new Vector3,Frustum=function(){function o(e,t,i,r,n,a){_classCallCheck(this,o),this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==i?i:new Plane,void 0!==r?r:new Plane,void 0!==n?n:new Plane,void 0!==a?a:new Plane]}return _createClass(o,[{key:"set",value:function(e,t,i,r,n,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(n),o[5].copy(a),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],a=i[2],o=i[3],s=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],m=i[11],f=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(o-r,h-s,m-u,y-f).normalize(),t[1].setComponents(o+r,h+s,m+u,y+f).normalize(),t[2].setComponents(o+n,h+l,m+d,y+g).normalize(),t[3].setComponents(o-n,h-l,m-d,y-g).normalize(),t[4].setComponents(o-a,h-c,m-p,y-v).normalize(),t[5].setComponents(o+a,h+c,m+p,y+v).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),_sphere$1.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$1)}},{key:"intersectsSprite",value:function(e){return _sphere$1.center.set(0,0,0),_sphere$1.radius=.7071067811865476,_sphere$1.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$1)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];if(_vector$5.x=0<r.normal.x?e.max.x:e.min.x,_vector$5.y=0<r.normal.y?e.max.y:e.min.y,_vector$5.z=0<r.normal.z?e.max.z:e.min.z,r.distanceToPoint(_vector$5)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}}]),o}();function WebGLAnimation(){var i=null,e=!1,r=null,n=null;function a(e,t){r(e,t),n=i.requestAnimationFrame(a)}return{start:function(){!0!==e&&null!==r&&(n=i.requestAnimationFrame(a),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(e){r=e},setContext:function(e){i=e}}}function WebGLAttributes(l,e){var c=e.isWebGL2,h=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),h.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=h.get(e);t&&(l.deleteBuffer(t.buffer),h.delete(e))},update:function(e,t){if(e.isGLBufferAttribute){var i=h.get(e);(!i||i.version<e.version)&&h.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);var r,n,a,o,s=h.get(e);void 0===s?h.set(e,function(e,t){var i=e.array,r=e.usage,n=l.createBuffer();l.bindBuffer(t,n),l.bufferData(t,i,r),e.onUploadCallback();var a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:i instanceof Uint8Array&&(a=5121),{buffer:n,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,t)):s.version<e.version&&(a=(r=e).array,o=r.updateRange,l.bindBuffer(n=t,s.buffer),-1===o.count?l.bufferSubData(n,0,a):(c?l.bufferSubData(n,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):l.bufferSubData(n,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),s.version=e.version)}}}}var PlaneGeometry=function(){_inherits(o,Geometry);var a=_createSuper(o);function o(e,t,i,r){var n;return _classCallCheck(this,o),(n=a.call(this)).type="PlaneGeometry",n.parameters={width:e,height:t,widthSegments:i,heightSegments:r},n.fromBufferGeometry(new PlaneBufferGeometry(e,t,i,r)),n.mergeVertices(),n}return o}(),PlaneBufferGeometry=function(){_inherits(A,BufferGeometry);var T=_createSuper(A);function A(e,t,i,r){var n;_classCallCheck(this,A),(n=T.call(this)).type="PlaneBufferGeometry",n.parameters={width:e,height:t,widthSegments:i,heightSegments:r};for(var a=(e=e||1)/2,o=(t=t||1)/2,s=Math.floor(i)||1,l=Math.floor(r)||1,c=s+1,h=l+1,u=e/s,d=t/l,p=[],m=[],f=[],g=[],v=0;v<h;v++)for(var y=v*d-o,x=0;x<c;x++){m.push(x*u-a,-y,0),f.push(0,0,1),g.push(x/s),g.push(1-v/l)}for(var _=0;_<l;_++)for(var b=0;b<s;b++){var w=b+c*(_+1),M=b+1+c*(_+1),S=b+1+c*_;p.push(b+c*_,w,S),p.push(w,M,S)}return n.setIndex(p),n.setAttribute("position",new Float32BufferAttribute(m,3)),n.setAttribute("normal",new Float32BufferAttribute(f,3)),n.setAttribute("uv",new Float32BufferAttribute(g,2)),n}return A}(),alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex="#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment="#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment="#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert="#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_pars_fragment:clearcoat_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,transmissionmap_fragment:transmissionmap_fragment,transmissionmap_pars_fragment:transmissionmap_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_frag:background_frag,background_vert:background_vert,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshmatcap_frag:meshmatcap_frag,meshmatcap_vert:meshmatcap_vert,meshtoon_frag:meshtoon_frag,meshtoon_vert:meshtoon_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert,sprite_frag:sprite_frag,sprite_vert:sprite_vert},UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};function WebGLBackground(s,l,i,c,r){var h,u,d=new Color(0),p=0,m=null,f=0,g=null;function v(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return d},setClearColor:function(e,t){d.set(e),v(d,p=void 0!==t?t:1)},getClearAlpha:function(){return p},setClearAlpha:function(e){v(d,p=e)},render:function(e,t,i,r){var n=!0===t.isScene?t.background:null;n&&n.isTexture&&(n=l.get(n));var a=s.xr,o=a.getSession&&a.getSession();o&&"additive"===o.environmentBlendMode&&(n=null),null===n?v(d,p):n&&n.isColor&&(v(n,1),r=!0),(s.autoClear||r)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),n&&(n.isCubeTexture||n.isWebGLCubeRenderTarget||n.isWebGLCubeRenderTargetTexture||n.mapping===CubeUVReflectionMapping)?(void 0===u&&((u=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),c.update(u)),n.isWebGLCubeRenderTarget&&(n=n.texture),u.material.uniforms.envMap.value=n,u.material.uniforms.flipEnvMap.value=n.isCubeTexture?-1:1,m===n&&f===n.version&&g===s.toneMapping||(u.material.needsUpdate=!0,f=(m=n).version,g=s.toneMapping),e.unshift(u,u.geometry,u.material,0,0,null)):n&&n.isTexture&&(void 0===h&&((h=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),c.update(h)),!0===(h.material.uniforms.t2D.value=n).matrixAutoUpdate&&n.updateMatrix(),h.material.uniforms.uvTransform.value.copy(n.matrix),m===n&&f===n.version&&g===s.toneMapping||(h.material.needsUpdate=!0,f=(m=n).version,g=s.toneMapping),e.unshift(h,h.geometry,h.material,0,0,null))}}}function WebGLBindingStates(A,E,C,L){var a=A.getParameter(34921),l=L.isWebGL2?null:E.get("OES_vertex_array_object"),c=L.isWebGL2||null!==l,h={},e=p(null),u=e;function d(e){return L.isWebGL2?A.bindVertexArray(e):l.bindVertexArrayOES(e)}function o(e){return L.isWebGL2?A.deleteVertexArray(e):l.deleteVertexArrayOES(e)}function p(e){for(var t=[],i=[],r=[],n=0;n<a;n++)r[n]=i[n]=t[n]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function R(){for(var e=u.newAttributes,t=0,i=e.length;t<i;t++)e[t]=0}function P(e){D(e,0)}function D(e,t){var i=u.enabledAttributes,r=u.attributeDivisors;u.newAttributes[e]=1,0===i[e]&&(A.enableVertexAttribArray(e),i[e]=1),r[e]!==t&&((L.isWebGL2?A:E.get("ANGLE_instanced_arrays"))[L.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),r[e]=t)}function k(){for(var e=u.newAttributes,t=u.enabledAttributes,i=0,r=t.length;i<r;i++)t[i]!==e[i]&&(A.disableVertexAttribArray(i),t[i]=0)}function B(e,t,i,r,n,a){!0!==L.isWebGL2||5124!==i&&5125!==i?A.vertexAttribPointer(e,t,i,r,n,a):A.vertexAttribIPointer(e,t,i,n,a)}function s(){t(),u!==e&&d((u=e).object)}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(e,t,i,r,n){var a=!1;if(c){var o=function(e,t,i){var r=!0===i.wireframe,n=h[e.id];void 0===n&&(h[e.id]=n={});var a=n[t.id];void 0===a&&(n[t.id]=a={});var o=a[r];void 0===o&&(o=p(L.isWebGL2?A.createVertexArray():l.createVertexArrayOES()),a[r]=o);return o}(r,i,t);u!==o&&d((u=o).object),(a=function(e,t){var i=u.attributes,r=e.attributes;if(Object.keys(i).length!==Object.keys(r).length)return!0;for(var n in r){var a=i[n],o=r[n];if(void 0===a)return!0;if(a.attribute!==o)return!0;if(a.data!==o.data)return!0}return u.index!==t}(r,n))&&function(e,t){var i={},r=e.attributes;for(var n in r){var a=r[n],o={};(o.attribute=a).data&&(o.data=a.data),i[n]=o}u.attributes=i,u.index=t}(r,n)}else{var s=!0===t.wireframe;u.geometry===r.id&&u.program===i.id&&u.wireframe===s||(u.geometry=r.id,u.program=i.id,u.wireframe=s,a=!0)}!0===e.isInstancedMesh&&(a=!0),null!==n&&C.update(n,34963),a&&(function(e,t,i,r){if(!1===L.isWebGL2&&(e.isInstancedMesh||r.isInstancedBufferGeometry)&&null===E.get("ANGLE_instanced_arrays"))return;R();var n=r.attributes,a=i.getAttributes(),o=t.defaultAttributeValues;for(var s in a){var l=a[s];if(0<=l){var c=n[s];if(void 0!==c){var h=c.normalized,u=c.itemSize,d=C.get(c);if(void 0===d)continue;var p=d.buffer,m=d.type,f=d.bytesPerElement;if(c.isInterleavedBufferAttribute){var g=c.data,v=g.stride,y=c.offset;g&&g.isInstancedInterleavedBuffer?(D(l,g.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=g.meshPerAttribute*g.count)):P(l),A.bindBuffer(34962,p),B(l,u,m,h,v*f,y*f)}else c.isInstancedBufferAttribute?(D(l,c.meshPerAttribute),void 0===r._maxInstanceCount&&(r._maxInstanceCount=c.meshPerAttribute*c.count)):P(l),A.bindBuffer(34962,p),B(l,u,m,h,0,0)}else if("instanceMatrix"===s){var x=C.get(e.instanceMatrix);if(void 0===x)continue;var _=x.buffer,b=x.type;D(l+0,1),D(l+1,1),D(l+2,1),D(l+3,1),A.bindBuffer(34962,_),A.vertexAttribPointer(l+0,4,b,!1,64,0),A.vertexAttribPointer(l+1,4,b,!1,64,16),A.vertexAttribPointer(l+2,4,b,!1,64,32),A.vertexAttribPointer(l+3,4,b,!1,64,48)}else if("instanceColor"===s){var w=C.get(e.instanceColor);if(void 0===w)continue;var M=w.buffer,S=w.type;D(l,1),A.bindBuffer(34962,M),A.vertexAttribPointer(l,3,S,!1,12,0)}else if(void 0!==o){var T=o[s];if(void 0!==T)switch(T.length){case 2:A.vertexAttrib2fv(l,T);break;case 3:A.vertexAttrib3fv(l,T);break;case 4:A.vertexAttrib4fv(l,T);break;default:A.vertexAttrib1fv(l,T)}}}}k()}(e,t,i,r),null!==n&&A.bindBuffer(34963,C.get(n).buffer))},reset:s,resetDefaultState:t,dispose:function(){for(var e in s(),h){var t=h[e];for(var i in t){var r=t[i];for(var n in r)o(r[n].object),delete r[n];delete t[i]}delete h[e]}},releaseStatesOfGeometry:function(e){if(void 0!==h[e.id]){var t=h[e.id];for(var i in t){var r=t[i];for(var n in r)o(r[n].object),delete r[n];delete t[i]}delete h[e.id]}},releaseStatesOfProgram:function(e){for(var t in h){var i=h[t];if(void 0!==i[e.id]){var r=i[e.id];for(var n in r)o(r[n].object),delete r[n];delete i[e.id]}}},initAttributes:R,enableAttribute:P,disableUnusedAttributes:k}}function WebGLBufferRenderer(a,o,s,e){var l,c=e.isWebGL2;this.setMode=function(e){l=e},this.render=function(e,t){a.drawArrays(l,e,t),s.update(t,l,1)},this.renderInstances=function(e,t,i){if(0!==i){var r,n;if(c)r=a,n="drawArraysInstanced";else if(n="drawArraysInstancedANGLE",null===(r=o.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[n](l,e,t,i),s.update(t,l,i)}}}function WebGLCapabilities(t,i,e){var r;function n(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,o=void 0!==e.precision?e.precision:"highp",s=n(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===e.logarithmicDepthBuffer,c=t.getParameter(34930),h=t.getParameter(35660),u=t.getParameter(3379),d=t.getParameter(34076),p=t.getParameter(34921),m=t.getParameter(36347),f=t.getParameter(36348),g=t.getParameter(36349),v=0<h,y=a||!!i.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==r)return r;var e=i.get("EXT_texture_filter_anisotropic");return r=null!==e?t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:m,maxVaryings:f,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:a?t.getParameter(36183):0}}function WebGLClipping(u){var h=this,d=null,p=0,m=!1,f=!1,g=new Plane,v=new Matrix3,y={value:null,needsUpdate:!1};function x(){y.value!==d&&(y.value=d,y.needsUpdate=0<p),h.numPlanes=p,h.numIntersection=0}function _(e,t,i,r){var n=null!==e?e.length:0,a=null;if(0!==n){if(a=y.value,!0!==r||null===a){var o=i+4*n,s=t.matrixWorldInverse;v.getNormalMatrix(s),(null===a||a.length<o)&&(a=new Float32Array(o));for(var l=0,c=i;l!==n;++l,c+=4)g.copy(e[l]).applyMatrix4(s,v),g.normal.toArray(a,c),a[c+3]=g.constant}y.value=a,y.needsUpdate=!0}return h.numPlanes=n,h.numIntersection=0,a}this.uniform=y,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,i){var r=0!==e.length||t||0!==p||m;return m=t,d=_(e,i,0),p=e.length,r},this.beginShadows=function(){f=!0,_(null)},this.endShadows=function(){f=!1,x()},this.setState=function(e,t,i){var r=e.clippingPlanes,n=e.clipIntersection,a=e.clipShadows,o=u.get(e);if(!m||null===r||0===r.length||f&&!a)f?_(null):x();else{var s=f?0:p,l=4*s,c=o.clippingState||null;y.value=c,c=_(r,t,l,i);for(var h=0;h!==l;++h)c[h]=d[h];o.clippingState=c,this.numIntersection=n?this.numPlanes:0,this.numPlanes+=s}}}function WebGLCubeMaps(s){var l=new WeakMap;function c(e,t){return t===EquirectangularReflectionMapping?e.mapping=CubeReflectionMapping:t===EquirectangularRefractionMapping&&(e.mapping=CubeRefractionMapping),e}return{get:function(e){if(e&&e.isTexture){var t=e.mapping;if(t===EquirectangularReflectionMapping||t===EquirectangularRefractionMapping){if(l.has(e))return c(l.get(e).texture,e.mapping);var i=e.image;if(i&&0<i.height){var r=s.getRenderList(),n=s.getRenderTarget(),a=s.getRenderState(),o=new WebGLCubeRenderTarget(i.height/2);return o.fromEquirectangularTexture(s,e),l.set(e,o),s.setRenderTarget(n),s.setRenderList(r),s.setRenderState(a),c(o.texture,e.mapping)}return null}}return e},dispose:function(){l=new WeakMap}}}function WebGLExtensions(i){var r={};return{has:function(e){if(void 0!==r[e])return null!==r[e];var t;switch(e){case"WEBGL_depth_texture":t=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=i.getExtension(e)}return null!==(r[e]=t)},get:function(e){return this.has(e)||console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),r[e]}}}function WebGLGeometries(e,y,a,o){var s=new WeakMap,x=new WeakMap;function l(e){var t=e.target,i=s.get(t);for(var r in null!==i.index&&y.remove(i.index),i.attributes)y.remove(i.attributes[r]);t.removeEventListener("dispose",l),s.delete(t);var n=x.get(i);n&&(y.remove(n),x.delete(i)),o.releaseStatesOfGeometry(t),!0===t.isInstancedBufferGeometry&&delete t._maxInstanceCount,a.memory.geometries--}function r(e){var t=[],i=e.index,r=e.attributes.position,n=0;if(null!==i){var a=i.array;n=i.version;for(var o=0,s=a.length;o<s;o+=3){var l=a[o+0],c=a[o+1],h=a[o+2];t.push(l,c,c,h,h,l)}}else{n=r.version;for(var u=0,d=r.array.length/3-1;u<d;u+=3){var p=u+0,m=u+1,f=u+2;t.push(p,m,m,f,f,p)}}var g=new(65535<arrayMax(t)?Uint32BufferAttribute:Uint16BufferAttribute)(t,1);g.version=n;var v=x.get(e);v&&y.remove(v),x.set(e,g)}return{get:function(e,t){var i=s.get(t);return i||(t.addEventListener("dispose",l),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new BufferGeometry).setFromObject(e)),i=t._bufferGeometry),s.set(t,i),a.memory.geometries++,i)},update:function(e){var t=e.attributes;for(var i in t)y.update(t[i],34962);var r=e.morphAttributes;for(var n in r)for(var a=r[n],o=0,s=a.length;o<s;o++)y.update(a[o],34962)},getWireframeAttribute:function(e){var t=x.get(e);if(t){var i=e.index;null!==i&&t.version<i.version&&r(e)}else r(e);return x.get(e)}}}function WebGLIndexedBufferRenderer(a,o,s,e){var l,c,h,u=e.isWebGL2;this.setMode=function(e){l=e},this.setIndex=function(e){c=e.type,h=e.bytesPerElement},this.render=function(e,t){a.drawElements(l,t,c,e*h),s.update(t,l,1)},this.renderInstances=function(e,t,i){if(0!==i){var r,n;if(u)r=a,n="drawElementsInstanced";else if(n="drawElementsInstancedANGLE",null===(r=o.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[n](l,t,c,e*h,i),s.update(t,l,i)}}}function WebGLInfo(e){var r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(e,t,i){switch(r.calls++,t){case 4:r.triangles+=i*(e/3);break;case 1:r.lines+=i*(e/2);break;case 3:r.lines+=i*(e-1);break;case 2:r.lines+=i*e;break;case 0:r.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function numericalSort(e,t){return e[0]-t[0]}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(x){for(var _={},b=new Float32Array(8),w=[],e=0;e<8;e++)w[e]=[e,0];return{update:function(e,t,i,r){var n=e.morphTargetInfluences,a=void 0===n?0:n.length,o=_[t.id];if(void 0===o){o=[];for(var s=0;s<a;s++)o[s]=[s,0];_[t.id]=o}for(var l=0;l<a;l++){var c=o[l];c[0]=l,c[1]=n[l]}o.sort(absNumericalSort);for(var h=0;h<8;h++)h<a&&o[h][1]?(w[h][0]=o[h][0],w[h][1]=o[h][1]):(w[h][0]=Number.MAX_SAFE_INTEGER,w[h][1]=0);w.sort(numericalSort);for(var u=i.morphTargets&&t.morphAttributes.position,d=i.morphNormals&&t.morphAttributes.normal,p=0,m=0;m<8;m++){var f=w[m],g=f[0],v=f[1];g!==Number.MAX_SAFE_INTEGER&&v?(u&&t.getAttribute("morphTarget"+m)!==u[g]&&t.setAttribute("morphTarget"+m,u[g]),d&&t.getAttribute("morphNormal"+m)!==d[g]&&t.setAttribute("morphNormal"+m,d[g]),p+=b[m]=v):(u&&void 0!==t.getAttribute("morphTarget"+m)&&t.deleteAttribute("morphTarget"+m),d&&void 0!==t.getAttribute("morphNormal"+m)&&t.deleteAttribute("morphNormal"+m),b[m]=0)}var y=t.morphTargetsRelative?1:1-p;r.getUniforms().setValue(x,"morphTargetBaseInfluence",y),r.getUniforms().setValue(x,"morphTargetInfluences",b)}}}function WebGLObjects(e,n,a,o){var s=new WeakMap;return{update:function(e){var t=o.render.frame,i=e.geometry,r=n.get(e,i);return s.get(r)!==t&&(i.isGeometry&&r.updateFromObject(e),n.update(r),s.set(r,t)),e.isInstancedMesh&&(a.update(e.instanceMatrix,34962),null!==e.instanceColor&&a.update(e.instanceColor,34962)),r},dispose:function(){s=new WeakMap}}}function CubeTexture(e,t,i,r,n,a,o,s,l,c){Texture.call(this,e=void 0!==e?e:[],t=void 0!==t?t:CubeReflectionMapping,i,r,n,a,o=void 0!==o?o:RGBFormat,s,l,c),this.flipY=!1}function DataTexture2DArray(e,t,i,r){Texture.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function DataTexture3D(e,t,i,r){Texture.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:r||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),DataTexture2DArray.prototype=Object.create(Texture.prototype),DataTexture2DArray.prototype.constructor=DataTexture2DArray,DataTexture2DArray.prototype.isDataTexture2DArray=!0,DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;var emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(e,t,i){var r=e[0];if(r<=0||0<r)return e;var n=t*i,a=arrayCacheF32[n];if(void 0===a&&(a=new Float32Array(n),arrayCacheF32[n]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)e[o].toArray(a,s+=i)}return a}function arraysEqual(e,t){if(e.length===t.length){for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return;return 1}}function copyArray(e,t){for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}function allocTexUnits(e,t){var i=arrayCacheI32[t];void 0===i&&(i=new Int32Array(t),arrayCacheI32[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function setValueV1f(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function setValueV2f(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(arraysEqual(i,t))return;e.uniform2fv(this.addr,t),copyArray(i,t)}}function setValueV3f(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(arraysEqual(i,t))return;e.uniform3fv(this.addr,t),copyArray(i,t)}}function setValueV4f(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(arraysEqual(i,t))return;e.uniform4fv(this.addr,t),copyArray(i,t)}}function setValueM2(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat2array.set(r),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(i,r)}}function setValueM3(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat3array.set(r),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(i,r)}}function setValueM4(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat4array.set(r),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(i,r)}}function setValueT1(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTexture2D(t||emptyTexture,n)}function setValueT2DArray1(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||emptyTexture2dArray,n)}function setValueT3D1(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||emptyTexture3d,n)}function setValueT6(e,t,i){var r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.safeSetTextureCube(t||emptyCubeTexture,n)}function setValueV1i(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function setValueV2i(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform2iv(this.addr,t),copyArray(i,t))}function setValueV3i(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform3iv(this.addr,t),copyArray(i,t))}function setValueV4i(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform4iv(this.addr,t),copyArray(i,t))}function setValueV1ui(e,t){var i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function getSingularSetter(e){switch(e){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(e,t){e.uniform1fv(this.addr,t)}function setValueV1iArray(e,t){e.uniform1iv(this.addr,t)}function setValueV2iArray(e,t){e.uniform2iv(this.addr,t)}function setValueV3iArray(e,t){e.uniform3iv(this.addr,t)}function setValueV4iArray(e,t){e.uniform4iv(this.addr,t)}function setValueV2fArray(e,t){var i=flatten(t,this.size,2);e.uniform2fv(this.addr,i)}function setValueV3fArray(e,t){var i=flatten(t,this.size,3);e.uniform3fv(this.addr,i)}function setValueV4fArray(e,t){var i=flatten(t,this.size,4);e.uniform4fv(this.addr,i)}function setValueM2Array(e,t){var i=flatten(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function setValueM3Array(e,t){var i=flatten(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function setValueM4Array(e,t){var i=flatten(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function setValueT1Array(e,t,i){var r=t.length,n=allocTexUnits(i,r);e.uniform1iv(this.addr,n);for(var a=0;a!==r;++a)i.safeSetTexture2D(t[a]||emptyTexture,n[a])}function setValueT6Array(e,t,i){var r=t.length,n=allocTexUnits(i,r);e.uniform1iv(this.addr,n);for(var a=0;a!==r;++a)i.safeSetTextureCube(t[a]||emptyCubeTexture,n[a])}function getPureArraySetter(e){switch(e){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}function StructuredUniform(e){this.id=e,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)},StructuredUniform.prototype.setValue=function(e,t,i){for(var r=this.seq,n=0,a=r.length;n!==a;++n){var o=r[n];o.setValue(e,t[o.id],i)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,i){var r=e.name,n=r.length;for(RePathPart.lastIndex=0;;){var a=RePathPart.exec(r),o=a[1],s=a[3];if("]"===a[2]&&(o|=0),void 0===s||"["===s&&RePathPart.lastIndex+2===n){addUniform(i,new(void 0===s?SingleUniform:PureArrayUniform)(o,e,t));break}var l=i.map[o];void 0===l&&addUniform(i,l=new StructuredUniform(o)),i=l}}function WebGLUniforms(e,t){this.seq=[],this.map={};for(var i=e.getProgramParameter(t,35718),r=0;r<i;++r){var n=e.getActiveUniform(t,r);parseUniform(n,e.getUniformLocation(t,n.name),this)}}function WebGLShader(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}WebGLUniforms.prototype.setValue=function(e,t,i,r){var n=this.map[t];void 0!==n&&n.setValue(e,i,r)},WebGLUniforms.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},WebGLUniforms.upload=function(e,t,i,r){for(var n=0,a=t.length;n!==a;++n){var o=t[n],s=i[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},WebGLUniforms.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var a=e[r];a.id in t&&i.push(a)}return i};var programIdCount=0;function addLineNumbers(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function getShaderErrors(e,t,i){var r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();return r&&""===n?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+n+addLineNumbers(e.getShaderSource(t))}function getTexelDecodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(e,t){var i;switch(t){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;case CustomToneMapping:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateExtensions(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}function fetchAttributeLocations(e,t){for(var i={},r=e.getProgramParameter(t,35721),n=0;n<r;n++){var a=e.getActiveAttrib(t,n).name;i[a]=e.getAttribLocation(t,a)}return i}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(e){return e.replace(includePattern,includeReplacer)}function includeReplacer(e,t){var i=ShaderChunk[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return resolveIncludes(i)}var deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(e){return e.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(e,t,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(e,t,i,r)}function loopReplacer(e,t,i,r){for(var n="",a=parseInt(t);a<parseInt(i);a++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return n}function generatePrecision(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function generateShadowMapTypeDefine(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===PCFShadowMap?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===PCFSoftShadowMap?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===VSMShadowMap&&(t="SHADOWMAP_TYPE_VSM"),t}function generateEnvMapTypeDefine(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:t="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:t="ENVMAP_TYPE_CUBE_UV"}return t}function generateEnvMapModeDefine(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case CubeRefractionMapping:case CubeUVRefractionMapping:t="ENVMAP_MODE_REFRACTION"}return t}function generateEnvMapBlendingDefine(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case MultiplyOperation:t="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:t="ENVMAP_BLENDING_MIX";break;case AddOperation:t="ENVMAP_BLENDING_ADD"}return t}function WebGLProgram(e,t,i,r){var n,a,o=e.getContext(),s=i.defines,l=i.vertexShader,c=i.fragmentShader,h=generateShadowMapTypeDefine(i),u=generateEnvMapTypeDefine(i),d=generateEnvMapModeDefine(i),p=generateEnvMapBlendingDefine(i),m=0<e.gammaFactor?e.gammaFactor:1,f=i.isWebGL2?"":generateExtensions(i),g=generateDefines(s),v=o.createProgram(),y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(0<(n=[g].filter(filterEmptyLine).join("\n")).length&&(n+="\n"),0<(a=[f,g].filter(filterEmptyLine).join("\n")).length&&(a+="\n")):(n=[generatePrecision(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),a=[f,generatePrecision(i),"#define SHADER_NAME "+i.shaderName,g,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",i.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",i.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",ShaderChunk.encodings_pars_fragment,i.map?getTexelDecodingFunction("mapTexelToLinear",i.mapEncoding):"",i.matcap?getTexelDecodingFunction("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?getTexelDecodingFunction("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",i.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),l=replaceClippingPlaneNums(l=replaceLightNums(l=resolveIncludes(l),i),i),c=replaceClippingPlaneNums(c=replaceLightNums(c=resolveIncludes(c),i),i),l=unrollLoops(l),c=unrollLoops(c),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",n=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,a=["#define varying in",i.glslVersion===GLSL3?"":"out highp vec4 pc_fragColor;",i.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var x,_,b=y+a+c,w=WebGLShader(o,35633,y+n+l),M=WebGLShader(o,35632,b);if(o.attachShader(v,w),o.attachShader(v,M),void 0!==i.index0AttributeName?o.bindAttribLocation(v,0,i.index0AttributeName):!0===i.morphTargets&&o.bindAttribLocation(v,0,"position"),o.linkProgram(v),e.debug.checkShaderErrors){var S=o.getProgramInfoLog(v).trim(),T=o.getShaderInfoLog(w).trim(),A=o.getShaderInfoLog(M).trim(),E=!0,C=!0;if(!1===o.getProgramParameter(v,35714)){E=!1;var L=getShaderErrors(o,w,"vertex"),R=getShaderErrors(o,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(v,35715),"gl.getProgramInfoLog",S,L,R)}else""!==S?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",S):""!==T&&""!==A||(C=!1);C&&(this.diagnostics={runnable:E,programLog:S,vertexShader:{log:T,prefix:n},fragmentShader:{log:A,prefix:a}})}return o.deleteShader(w),o.deleteShader(M),this.getUniforms=function(){return void 0===x&&(x=new WebGLUniforms(o,v)),x},this.getAttributes=function(){return void 0===_&&(_=fetchAttributeLocations(o,v)),_},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=programIdCount++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=M,this}function WebGLPrograms(p,m,f,g,o,v){var s=[],y=g.isWebGL2,x=g.logarithmicDepthBuffer,_=g.floatVertexTextures,b=g.maxVertexUniforms,w=g.vertexTextures,M=g.precision,S={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},n=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function T(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=LinearEncoding,t}return{getParameters:function(e,t,i,r,n){var a,o,s=r.fog,l=m.get(e.envMap||(e.isMeshStandardMaterial?r.environment:null)),c=S[e.type],h=n.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(_)return 1024;var i=Math.floor((b-20)/4),r=Math.min(i,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}(n):0;if(null!==e.precision&&(M=g.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",M,"instead."),c){var u=ShaderLib[c];a=u.vertexShader,o=u.fragmentShader}else a=e.vertexShader,o=e.fragmentShader;var d=p.getRenderTarget();return{isWebGL2:y,shaderID:c,shaderName:e.type,vertexShader:a,fragmentShader:o,defines:e.defines,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:M,instancing:!0===n.isInstancedMesh,instancingColor:!0===n.isInstancedMesh&&null!==n.instanceColor,supportsVertexTextures:w,outputEncoding:null!==d?T(d.texture):p.outputEncoding,map:!!e.map,mapEncoding:T(e.map),matcap:!!e.matcap,matcapEncoding:T(e.matcap),envMap:!!l,envMapMode:l&&l.mapping,envMapEncoding:T(l),envMapCubeUV:!!l&&(l.mapping===CubeUVReflectionMapping||l.mapping===CubeUVRefractionMapping),lightMap:!!e.lightMap,lightMapEncoding:T(e.lightMap),aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:T(e.emissiveMap),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:e.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!e.clearcoatMap,clearcoatRoughnessMap:!!e.clearcoatRoughnessMap,clearcoatNormalMap:!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,sheen:!!e.sheen,transmissionMap:!!e.transmissionMap,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatMap||e.clearcoatRoughnessMap||e.clearcoatNormalMap||e.displacementMap||e.transmissionMap),uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||e.transmissionMap||!e.displacementMap),fog:!!s,useFog:e.fog,fogExp2:s&&s.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:x,skinning:e.skinning&&0<h,maxBones:h,useVertexTexture:_,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:p.maxMorphTargets,maxMorphNormals:p.maxMorphNormals,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:v.numPlanes,numClipIntersection:v.numIntersection,dithering:e.dithering,shadowMapEnabled:p.shadowMap.enabled&&0<i.length,shadowMapType:p.shadowMap.type,toneMapping:e.toneMapped?p.toneMapping:NoToneMapping,physicallyCorrectLights:p.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===DoubleSide,flipSided:e.side===BackSide,depthPacking:void 0!==e.depthPacking&&e.depthPacking,index0AttributeName:e.index0AttributeName,extensionDerivatives:e.extensions&&e.extensions.derivatives,extensionFragDepth:e.extensions&&e.extensions.fragDepth,extensionDrawBuffers:e.extensions&&e.extensions.drawBuffers,extensionShaderTextureLOD:e.extensions&&e.extensions.shaderTextureLOD,rendererExtensionFragDepth:y||f.has("EXT_frag_depth"),rendererExtensionDrawBuffers:y||f.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:y||f.has("EXT_shader_texture_lod"),customProgramCacheKey:e.customProgramCacheKey()}},getProgramCacheKey:function(e){var t=[];if(e.shaderID?t.push(e.shaderID):(t.push(e.fragmentShader),t.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)t.push(i),t.push(e.defines[i]);if(!1===e.isRawShaderMaterial){for(var r=0;r<n.length;r++)t.push(e[n[r]]);t.push(p.outputEncoding),t.push(p.gammaFactor)}return t.push(e.customProgramCacheKey),t.join()},getUniforms:function(e){var t=S[e.type];return t?UniformsUtils.clone(ShaderLib[t].uniforms):e.uniforms},acquireProgram:function(e,t){for(var i,r=0,n=s.length;r<n;r++){var a=s[r];if(a.cacheKey===t){++(i=a).usedTimes;break}}return void 0===i&&(i=new WebGLProgram(p,t,e,o),s.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){var t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function WebGLProperties(){var r=new WeakMap;return{get:function(e){var t=r.get(e);return void 0===t&&r.set(e,t={}),t},remove:function(e){r.delete(e)},update:function(e,t,i){r.get(e)[t]=i},dispose:function(){r=new WeakMap}}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(l){var c=[],h=0,s=[],u=[],d={id:-1};function p(e,t,i,r,n,a){var o=c[h],s=l.get(i);return void 0===o?c[h]=o={id:e.id,object:e,geometry:t,material:i,program:s.program||d,groupOrder:r,renderOrder:e.renderOrder,z:n,group:a}:(o.id=e.id,o.object=e,o.geometry=t,o.material=i,o.program=s.program||d,o.groupOrder=r,o.renderOrder=e.renderOrder,o.z=n,o.group=a),h++,o}return{opaque:s,transparent:u,init:function(){u.length=s.length=h=0},push:function(e,t,i,r,n,a){var o=p(e,t,i,r,n,a);(!0===i.transparent?u:s).push(o)},unshift:function(e,t,i,r,n,a){var o=p(e,t,i,r,n,a);(!0===i.transparent?u:s).unshift(o)},finish:function(){for(var e=h,t=c.length;e<t;e++){var i=c[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){1<s.length&&s.sort(e||painterSortStable),1<u.length&&u.sort(t||reversePainterSortStable)}}}function WebGLRenderLists(n){var a=new WeakMap;return{get:function(e,t){var i,r=a.get(e);return void 0===r?(i=new WebGLRenderList(n),a.set(e,new WeakMap),a.get(e).set(t,i)):void 0===(i=r.get(t))&&(i=new WebGLRenderList(n),r.set(t,i)),i},dispose:function(){a=new WeakMap}}}function UniformsCache(){var i={};return{get:function(e){if(void 0!==i[e.id])return i[e.id];var t;switch(e.type){case"DirectionalLight":t={direction:new Vector3,color:new Color};break;case"SpotLight":t={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":t={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return i[e.id]=t}}}function ShadowUniformsCache(){var i={};return{get:function(e){if(void 0!==i[e.id])return i[e.id];var t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return i[e.id]=t}}}var nextVersion=0;function shadowCastingLightsFirst(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function WebGLLights(){for(var I=new UniformsCache,O=ShadowUniformsCache(),V={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},e=0;e<9;e++)V.probe.push(new Vector3);var U=new Vector3,G=new Matrix4,N=new Matrix4;return{setup:function(e,t,i){for(var r=0,n=0,a=0,o=0;o<9;o++)V.probe[o].set(0,0,0);var s=0,l=0,c=0,h=0,u=0,d=0,p=0,m=0,f=i.matrixWorldInverse;e.sort(shadowCastingLightsFirst);for(var g=0,v=e.length;g<v;g++){var y=e[g],x=y.color,_=y.intensity,b=y.distance,w=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)r+=x.r*_,n+=x.g*_,a+=x.b*_;else if(y.isLightProbe)for(var M=0;M<9;M++)V.probe[M].addScaledVector(y.sh.coefficients[M],_);else if(y.isDirectionalLight){var S=I.get(y);if(S.color.copy(y.color).multiplyScalar(y.intensity),S.direction.setFromMatrixPosition(y.matrixWorld),U.setFromMatrixPosition(y.target.matrixWorld),S.direction.sub(U),S.direction.transformDirection(f),y.castShadow){var T=y.shadow,A=O.get(y);A.shadowBias=T.bias,A.shadowNormalBias=T.normalBias,A.shadowRadius=T.radius,A.shadowMapSize=T.mapSize,V.directionalShadow[s]=A,V.directionalShadowMap[s]=w,V.directionalShadowMatrix[s]=y.shadow.matrix,d++}V.directional[s]=S,s++}else if(y.isSpotLight){var E=I.get(y);if(E.position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(f),E.color.copy(x).multiplyScalar(_),E.distance=b,E.direction.setFromMatrixPosition(y.matrixWorld),U.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(U),E.direction.transformDirection(f),E.coneCos=Math.cos(y.angle),E.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),E.decay=y.decay,y.castShadow){var C=y.shadow,L=O.get(y);L.shadowBias=C.bias,L.shadowNormalBias=C.normalBias,L.shadowRadius=C.radius,L.shadowMapSize=C.mapSize,V.spotShadow[c]=L,V.spotShadowMap[c]=w,V.spotShadowMatrix[c]=y.shadow.matrix,m++}V.spot[c]=E,c++}else if(y.isRectAreaLight){var R=I.get(y);R.color.copy(x).multiplyScalar(_),R.position.setFromMatrixPosition(y.matrixWorld),R.position.applyMatrix4(f),N.identity(),G.copy(y.matrixWorld),G.premultiply(f),N.extractRotation(G),R.halfWidth.set(.5*y.width,0,0),R.halfHeight.set(0,.5*y.height,0),R.halfWidth.applyMatrix4(N),R.halfHeight.applyMatrix4(N),V.rectArea[h]=R,h++}else if(y.isPointLight){var P=I.get(y);if(P.position.setFromMatrixPosition(y.matrixWorld),P.position.applyMatrix4(f),P.color.copy(y.color).multiplyScalar(y.intensity),P.distance=y.distance,P.decay=y.decay,y.castShadow){var D=y.shadow,k=O.get(y);k.shadowBias=D.bias,k.shadowNormalBias=D.normalBias,k.shadowRadius=D.radius,k.shadowMapSize=D.mapSize,k.shadowCameraNear=D.camera.near,k.shadowCameraFar=D.camera.far,V.pointShadow[l]=k,V.pointShadowMap[l]=w,V.pointShadowMatrix[l]=y.shadow.matrix,p++}V.point[l]=P,l++}else if(y.isHemisphereLight){var B=I.get(y);B.direction.setFromMatrixPosition(y.matrixWorld),B.direction.transformDirection(f),B.direction.normalize(),B.skyColor.copy(y.color).multiplyScalar(_),B.groundColor.copy(y.groundColor).multiplyScalar(_),V.hemi[u]=B,u++}}0<h&&(V.rectAreaLTC1=UniformsLib.LTC_1,V.rectAreaLTC2=UniformsLib.LTC_2),V.ambient[0]=r,V.ambient[1]=n,V.ambient[2]=a;var F=V.hash;F.directionalLength===s&&F.pointLength===l&&F.spotLength===c&&F.rectAreaLength===h&&F.hemiLength===u&&F.numDirectionalShadows===d&&F.numPointShadows===p&&F.numSpotShadows===m||(V.directional.length=s,V.spot.length=c,V.rectArea.length=h,V.point.length=l,V.hemi.length=u,V.directionalShadow.length=d,V.directionalShadowMap.length=d,V.pointShadow.length=p,V.pointShadowMap.length=p,V.spotShadow.length=m,V.spotShadowMap.length=m,V.directionalShadowMatrix.length=d,V.pointShadowMatrix.length=p,V.spotShadowMatrix.length=m,F.directionalLength=s,F.pointLength=l,F.spotLength=c,F.rectAreaLength=h,F.hemiLength=u,F.numDirectionalShadows=d,F.numPointShadows=p,F.numSpotShadows=m,V.version=nextVersion++)},state:V}}function WebGLRenderState(){var t=new WebGLLights,i=[],r=[];return{init:function(){r.length=i.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function(e){t.setup(i,r,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function WebGLRenderStates(){var r=new WeakMap;return{get:function(e,t){var i;return!1===r.has(e)?(i=new WebGLRenderState,r.set(e,new WeakMap),r.get(e).set(t,i)):!1===r.get(e).has(t)?(i=new WebGLRenderState,r.get(e).set(t,i)):i=r.get(e).get(t),i},dispose:function(){r=new WeakMap}}}function MeshDepthMaterial(e){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function MeshDistanceMaterial(e){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var vsm_frag="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",vsm_vert="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function WebGLShadowMap(v,y,g){var x=new Frustum,_=new Vector2,b=new Vector2,w=new Vector4,a=[],o=[],M={},S={0:BackSide,1:FrontSide,2:DoubleSide},r=new ShaderMaterial({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),n=r.clone();n.defines.HORIZONAL_PASS=1;var e=new BufferGeometry;e.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var s=new Mesh(e,r),T=this;function A(e,t){var i=y.update(s);r.uniforms.shadow_pass.value=e.map.texture,r.uniforms.resolution.value=e.mapSize,r.uniforms.radius.value=e.radius,v.setRenderTarget(e.mapPass),v.clear(),v.renderBufferDirect(t,null,i,r,s,null),n.uniforms.shadow_pass.value=e.mapPass.texture,n.uniforms.resolution.value=e.mapSize,n.uniforms.radius.value=e.radius,v.setRenderTarget(e.map),v.clear(),v.renderBufferDirect(t,null,i,n,s,null)}function E(e,t,i){var r=e<<0|t<<1|i<<2,n=a[r];return void 0===n&&(n=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:e,skinning:t}),a[r]=n),n}function C(e,t,i){var r=e<<0|t<<1|i<<2,n=o[r];return void 0===n&&(n=new MeshDistanceMaterial({morphTargets:e,skinning:t}),o[r]=n),n}function L(e,t,i,r,n,a,o){var s=null,l=E,c=e.customDepthMaterial;if(!0===r.isPointLight&&(l=C,c=e.customDistanceMaterial),void 0===c){var h=!1;!0===i.morphTargets&&(h=t.morphAttributes&&t.morphAttributes.position&&0<t.morphAttributes.position.length);var u=!1;!0===e.isSkinnedMesh&&(!0===i.skinning?u=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),s=l(h,u,!0===e.isInstancedMesh)}else s=c;if(v.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var d=s.uuid,p=i.uuid,m=M[d];void 0===m&&(M[d]=m={});var f=m[p];void 0===f&&(f=s.clone(),m[p]=f),s=f}return s.visible=i.visible,s.wireframe=i.wireframe,s.side=o===VSMShadowMap?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:S[i.side],s.clipShadows=i.clipShadows,s.clippingPlanes=i.clippingPlanes,s.clipIntersection=i.clipIntersection,s.wireframeLinewidth=i.wireframeLinewidth,s.linewidth=i.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial&&(s.referencePosition.setFromMatrixPosition(r.matrixWorld),s.nearDistance=n,s.farDistance=a),s}function R(e,t,i,r,n){if(!1!==e.visible){if(e.layers.test(t.layers)&&(e.isMesh||e.isLine||e.isPoints)&&(e.castShadow||e.receiveShadow&&n===VSMShadowMap)&&(!e.frustumCulled||x.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld);var a=y.update(e),o=e.material;if(Array.isArray(o))for(var s=a.groups,l=0,c=s.length;l<c;l++){var h=s[l],u=o[h.materialIndex];if(u&&u.visible){var d=L(e,a,u,r,i.near,i.far,n);v.renderBufferDirect(i,null,a,d,e,h)}}else if(o.visible){var p=L(e,a,o,r,i.near,i.far,n);v.renderBufferDirect(i,null,a,p,e,null)}}for(var m=e.children,f=0,g=m.length;f<g;f++)R(m[f],t,i,r,n)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(e,t,i){if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)&&0!==e.length){var r=v.getRenderTarget(),n=v.getActiveCubeFace(),a=v.getActiveMipmapLevel(),o=v.state;o.setBlending(NoBlending),o.buffers.color.setClear(1,1,1,1),o.buffers.depth.setTest(!0),o.setScissorTest(!1);for(var s=0,l=e.length;s<l;s++){var c=e[s],h=c.shadow;if(!1!==h.autoUpdate||!1!==h.needsUpdate)if(void 0!==h){_.copy(h.mapSize);var u=h.getFrameExtents();if(_.multiply(u),b.copy(h.mapSize),(g<_.x||g<_.y)&&(g<_.x&&(b.x=Math.floor(g/u.x),_.x=b.x*u.x,h.mapSize.x=b.x),g<_.y&&(b.y=Math.floor(g/u.y),_.y=b.y*u.y,h.mapSize.y=b.y)),null===h.map&&!h.isPointLightShadow&&this.type===VSMShadowMap){var d={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};h.map=new WebGLRenderTarget(_.x,_.y,d),h.map.texture.name=c.name+".shadowMap",h.mapPass=new WebGLRenderTarget(_.x,_.y,d),h.camera.updateProjectionMatrix()}if(null===h.map)h.map=new WebGLRenderTarget(_.x,_.y,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat}),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix();v.setRenderTarget(h.map),v.clear();for(var p=h.getViewportCount(),m=0;m<p;m++){var f=h.getViewport(m);w.set(b.x*f.x,b.y*f.y,b.x*f.z,b.y*f.w),o.viewport(w),h.updateMatrices(c,m),x=h.getFrustum(),R(t,i,h.camera,c,this.type)}h.isPointLightShadow||this.type!==VSMShadowMap||A(h,i),h.needsUpdate=!1}else console.warn("THREE.WebGLShadowMap:",c,"has no shadow.")}T.needsUpdate=!1,v.setRenderTarget(r,n,a)}}}function WebGLState(h,e,t){var i,r,n=t.isWebGL2;var a=new function(){var t=!1,a=new Vector4,i=null,o=new Vector4(0,0,0,0);return{setMask:function(e){i===e||t||(h.colorMask(e,e,e,e),i=e)},setLocked:function(e){t=e},setClear:function(e,t,i,r,n){!0===n&&(e*=r,t*=r,i*=r),a.set(e,t,i,r),!1===o.equals(a)&&(h.clearColor(e,t,i,r),o.copy(a))},reset:function(){t=!1,i=null,o.set(-1,0,0,0)}}},o=new function(){var t=!1,i=null,r=null,n=null;return{setTest:function(e){(e?F:I)(2929)},setMask:function(e){i===e||t||(h.depthMask(e),i=e)},setFunc:function(e){if(r!==e){if(e)switch(e){case NeverDepth:h.depthFunc(512);break;case AlwaysDepth:h.depthFunc(519);break;case LessDepth:h.depthFunc(513);break;case LessEqualDepth:h.depthFunc(515);break;case EqualDepth:h.depthFunc(514);break;case GreaterEqualDepth:h.depthFunc(518);break;case GreaterDepth:h.depthFunc(516);break;case NotEqualDepth:h.depthFunc(517);break;default:h.depthFunc(515)}else h.depthFunc(515);r=e}},setLocked:function(e){t=e},setClear:function(e){n!==e&&(h.clearDepth(e),n=e)},reset:function(){t=!1,n=r=i=null}}},s=new function(){var t=!1,i=null,r=null,n=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){t||(e?F:I)(2960)},setMask:function(e){i===e||t||(h.stencilMask(e),i=e)},setFunc:function(e,t,i){r===e&&n===t&&a===i||(h.stencilFunc(e,t,i),r=e,n=t,a=i)},setOp:function(e,t,i){o===e&&s===t&&l===i||(h.stencilOp(e,t,i),o=e,s=t,l=i)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(h.clearStencil(e),c=e)},reset:function(){t=!1,c=l=s=o=a=n=r=i=null}}},l={},c=null,u=null,d=null,p=null,m=null,f=null,g=null,v=null,y=null,x=!1,_=null,b=null,w=null,M=null,S=null,T=h.getParameter(35661),A=!1,E=0,C=h.getParameter(7938);-1!==C.indexOf("WebGL")?(E=parseFloat(/^WebGL\ ([0-9])/.exec(C)[1]),A=1<=E):-1!==C.indexOf("OpenGL ES")&&(E=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(C)[1]),A=2<=E);var L=null,R={},P=new Vector4,D=new Vector4;function k(e,t,i){var r=new Uint8Array(4),n=h.createTexture();h.bindTexture(e,n),h.texParameteri(e,10241,9728),h.texParameteri(e,10240,9728);for(var a=0;a<i;a++)h.texImage2D(t+a,0,6408,1,1,0,6408,5121,r);return n}var B={};function F(e){!0!==l[e]&&(h.enable(e),l[e]=!0)}function I(e){!1!==l[e]&&(h.disable(e),l[e]=!1)}B[3553]=k(3553,3553,1),B[34067]=k(34067,34069,6),a.setClear(0,0,0,1),o.setClear(1),s.setClear(0),F(2929),o.setFunc(LessEqualDepth),N(!1),z(CullFaceBack),F(2884),G(NoBlending);var O=(_defineProperty(i={},AddEquation,32774),_defineProperty(i,SubtractEquation,32778),_defineProperty(i,ReverseSubtractEquation,32779),i);if(n)O[MinEquation]=32775,O[MaxEquation]=32776;else{var V=e.get("EXT_blend_minmax");null!==V&&(O[MinEquation]=V.MIN_EXT,O[MaxEquation]=V.MAX_EXT)}var U=(_defineProperty(r={},ZeroFactor,0),_defineProperty(r,OneFactor,1),_defineProperty(r,SrcColorFactor,768),_defineProperty(r,SrcAlphaFactor,770),_defineProperty(r,SrcAlphaSaturateFactor,776),_defineProperty(r,DstColorFactor,774),_defineProperty(r,DstAlphaFactor,772),_defineProperty(r,OneMinusSrcColorFactor,769),_defineProperty(r,OneMinusSrcAlphaFactor,771),_defineProperty(r,OneMinusDstColorFactor,775),_defineProperty(r,OneMinusDstAlphaFactor,773),r);function G(e,t,i,r,n,a,o,s){if(e!==NoBlending){if(u||(F(3042),u=!0),e===CustomBlending)n=n||t,a=a||i,o=o||r,t===p&&n===g||(h.blendEquationSeparate(O[t],O[n]),p=t,g=n),i===m&&r===f&&a===v&&o===y||(h.blendFuncSeparate(U[i],U[r],U[a],U[o]),m=i,f=r,v=a,y=o),d=e,x=null;else if(e!==d||s!==x){if(p===AddEquation&&g===AddEquation||(h.blendEquation(32774),g=p=AddEquation),s)switch(e){case NormalBlending:h.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:h.blendFunc(1,1);break;case SubtractiveBlending:h.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:h.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case NormalBlending:h.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:h.blendFunc(770,1);break;case SubtractiveBlending:h.blendFunc(0,769);break;case MultiplyBlending:h.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}y=v=f=m=null,d=e,x=s}}else u&&(I(3042),u=!1)}function N(e){_!==e&&(h.frontFace(e?2304:2305),_=e)}function z(e){e!==CullFaceNone?(F(2884),e!==b&&h.cullFace(e===CullFaceBack?1029:e===CullFaceFront?1028:1032)):I(2884),b=e}function H(e,t,i){e?(F(32823),M===t&&S===i||(h.polygonOffset(t,i),M=t,S=i)):I(32823)}function j(e){void 0===e&&(e=33984+T-1),L!==e&&(h.activeTexture(e),L=e)}return{buffers:{color:a,depth:o,stencil:s},enable:F,disable:I,useProgram:function(e){return c!==e&&(h.useProgram(e),c=e,!0)},setBlending:G,setMaterial:function(e,t){(e.side===DoubleSide?I:F)(2884);var i=e.side===BackSide;t&&(i=!i),N(i),e.blending===NormalBlending&&!1===e.transparent?G(NoBlending):G(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),a.setMask(e.colorWrite);var r=e.stencilWrite;s.setTest(r),r&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),H(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:N,setCullFace:z,setLineWidth:function(e){e!==w&&(A&&h.lineWidth(e),w=e)},setPolygonOffset:H,setScissorTest:function(e){(e?F:I)(3089)},activeTexture:j,bindTexture:function(e,t){null===L&&j();var i=R[L];void 0===i&&(R[L]=i={type:void 0,texture:void 0}),i.type===e&&i.texture===t||(h.bindTexture(e,t||B[e]),i.type=e,i.texture=t)},unbindTexture:function(){var e=R[L];void 0!==e&&void 0!==e.type&&(h.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{h.compressedTexImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{h.texImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{h.texImage3D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===P.equals(e)&&(h.scissor(e.x,e.y,e.z,e.w),P.copy(e))},viewport:function(e){!1===D.equals(e)&&(h.viewport(e.x,e.y,e.z,e.w),D.copy(e))},reset:function(){l={},R={},b=_=d=c=L=null,a.reset(),o.reset(),s.reset()}}}function WebGLTextures(_,n,b,w,a,M,d){var e,t,c,S=a.isWebGL2,i=a.maxTextures,T=a.maxCubemapSize,x=a.maxTextureSize,r=a.maxSamples,o=new WeakMap,s=!1;try{s="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function h(e,t){return s?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function A(e,t,i,r){var n=1;if((r<e.width||r<e.height)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?MathUtils.floorPowerOfTwo:Math.floor,o=a(n*e.width),s=a(n*e.height);void 0===c&&(c=h(o,s));var l=i?h(o,s):c;return l.width=o,l.height=s,l.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function E(e){return MathUtils.isPowerOfTwo(e.width)&&MathUtils.isPowerOfTwo(e.height)}function C(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function L(e,t,i,r){_.generateMipmap(e),w.get(t).__maxMipLevel=Math.log(Math.max(i,r))*Math.LOG2E}function R(e,t,i){if(!1===S)return t;if(null!==e){if(void 0!==_[e])return _[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}var r=t;return 6403===t&&(5126===i&&(r=33326),5131===i&&(r=33325),5121===i&&(r=33321)),6407===t&&(5126===i&&(r=34837),5131===i&&(r=34843),5121===i&&(r=32849)),6408===t&&(5126===i&&(r=34836),5131===i&&(r=34842),5121===i&&(r=32856)),33325!==r&&33326!==r&&34842!==r&&34836!==r||n.get("EXT_color_buffer_float"),r}function l(e){return e===NearestFilter||e===NearestMipmapNearestFilter||e===NearestMipmapLinearFilter?9728:9729}function u(e){var t=e.target;t.removeEventListener("dispose",u),function(e){var t=w.get(e);if(void 0===t.__webglInit)return;_.deleteTexture(t.__webglTexture),w.remove(e)}(t),t.isVideoTexture&&o.delete(t),d.memory.textures--}function p(e){var t=e.target;t.removeEventListener("dispose",p),function(e){var t=w.get(e),i=w.get(e.texture);if(!e)return;void 0!==i.__webglTexture&&_.deleteTexture(i.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(var r=0;r<6;r++)_.deleteFramebuffer(t.__webglFramebuffer[r]),t.__webglDepthbuffer&&_.deleteRenderbuffer(t.__webglDepthbuffer[r]);else _.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&_.deleteRenderbuffer(t.__webglDepthbuffer),t.__webglMultisampledFramebuffer&&_.deleteFramebuffer(t.__webglMultisampledFramebuffer),t.__webglColorRenderbuffer&&_.deleteRenderbuffer(t.__webglColorRenderbuffer),t.__webglDepthRenderbuffer&&_.deleteRenderbuffer(t.__webglDepthRenderbuffer);w.remove(e.texture),w.remove(e)}(t),d.memory.textures--}var m=0;function f(e,t){var i,r,n=w.get(e);if(e.isVideoTexture&&(r=d.render.frame,o.get(i=e)!==r&&(o.set(i,r),i.update())),0<e.version&&n.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void B(n,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}b.activeTexture(33984+t),b.bindTexture(3553,n.__webglTexture)}function g(e,t){if(6===e.image.length){var i=w.get(e);if(0<e.version&&i.__version!==e.version){k(i,e),b.activeTexture(33984+t),b.bindTexture(34067,i.__webglTexture),_.pixelStorei(37440,e.flipY);for(var r=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),n=e.image[0]&&e.image[0].isDataTexture,a=[],o=0;o<6;o++)a[o]=r||n?n?e.image[o].image:e.image[o]:A(e.image[o],!1,!0,T);var s,l=a[0],c=E(l)||S,h=M.convert(e.format),u=M.convert(e.type),d=R(e.internalFormat,h,u);if(D(34067,e,c),r){for(var p=0;p<6;p++){s=a[p].mipmaps;for(var m=0;m<s.length;m++){var f=s[m];e.format!==RGBAFormat&&e.format!==RGBFormat?null!==h?b.compressedTexImage2D(34069+p,m,d,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):b.texImage2D(34069+p,m,d,f.width,f.height,0,h,u,f.data)}}i.__maxMipLevel=s.length-1}else{s=e.mipmaps;for(var g=0;g<6;g++)if(n){b.texImage2D(34069+g,0,d,a[g].width,a[g].height,0,h,u,a[g].data);for(var v=0;v<s.length;v++){var y=s[v].image[g].image;b.texImage2D(34069+g,v+1,d,y.width,y.height,0,h,u,y.data)}}else{b.texImage2D(34069+g,0,d,h,u,a[g]);for(var x=0;x<s.length;x++){b.texImage2D(34069+g,x+1,d,h,u,s[x].image[g])}}i.__maxMipLevel=s.length}C(e,c)&&L(34067,e,l.width,l.height),i.__version=e.version,e.onUpdate&&e.onUpdate(e)}else b.activeTexture(33984+t),b.bindTexture(34067,i.__webglTexture)}}function v(e,t){b.activeTexture(33984+t),b.bindTexture(34067,w.get(e).__webglTexture)}var y=(_defineProperty(e={},RepeatWrapping,10497),_defineProperty(e,ClampToEdgeWrapping,33071),_defineProperty(e,MirroredRepeatWrapping,33648),e),P=(_defineProperty(t={},NearestFilter,9728),_defineProperty(t,NearestMipmapNearestFilter,9984),_defineProperty(t,NearestMipmapLinearFilter,9986),_defineProperty(t,LinearFilter,9729),_defineProperty(t,LinearMipmapNearestFilter,9985),_defineProperty(t,LinearMipmapLinearFilter,9987),t);function D(e,t,i){i?(_.texParameteri(e,10242,y[t.wrapS]),_.texParameteri(e,10243,y[t.wrapT]),32879!==e&&35866!==e||_.texParameteri(e,32882,y[t.wrapR]),_.texParameteri(e,10240,P[t.magFilter]),_.texParameteri(e,10241,P[t.minFilter])):(_.texParameteri(e,10242,33071),_.texParameteri(e,10243,33071),32879!==e&&35866!==e||_.texParameteri(e,32882,33071),t.wrapS===ClampToEdgeWrapping&&t.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),_.texParameteri(e,10240,l(t.magFilter)),_.texParameteri(e,10241,l(t.minFilter)),t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var r=n.get("EXT_texture_filter_anisotropic");if(r){if(t.type===FloatType&&null===n.get("OES_texture_float_linear"))return;if(t.type===HalfFloatType&&null===(S||n.get("OES_texture_half_float_linear")))return;(1<t.anisotropy||w.get(t).__currentAnisotropy)&&(_.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,a.getMaxAnisotropy())),w.get(t).__currentAnisotropy=t.anisotropy)}}function k(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",u),e.__webglTexture=_.createTexture(),d.memory.textures++)}function B(e,t,i){var r=3553;t.isDataTexture2DArray&&(r=35866),t.isDataTexture3D&&(r=32879),k(e,t),b.activeTexture(33984+i),b.bindTexture(r,e.__webglTexture),_.pixelStorei(37440,t.flipY),_.pixelStorei(37441,t.premultiplyAlpha),_.pixelStorei(3317,t.unpackAlignment);var n,a,o=(n=t,!S&&(n.wrapS!==ClampToEdgeWrapping||n.wrapT!==ClampToEdgeWrapping||n.minFilter!==NearestFilter&&n.minFilter!==LinearFilter)&&!1===E(t.image)),s=A(t.image,o,!1,x),l=E(s)||S,c=M.convert(t.format),h=M.convert(t.type),u=R(t.internalFormat,c,h);D(r,t,l);var d=t.mipmaps;if(t.isDepthTexture)u=6402,S?u=t.type===FloatType?36012:t.type===UnsignedIntType?33190:t.type===UnsignedInt248Type?35056:33189:t.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),t.format===DepthFormat&&6402===u&&t.type!==UnsignedShortType&&t.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),t.type=UnsignedShortType,h=M.convert(t.type)),t.format===DepthStencilFormat&&6402===u&&(u=34041,t.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),t.type=UnsignedInt248Type,h=M.convert(t.type))),b.texImage2D(3553,0,u,s.width,s.height,0,c,h,null);else if(t.isDataTexture)if(0<d.length&&l){for(var p=0,m=d.length;p<m;p++)b.texImage2D(3553,p,u,(a=d[p]).width,a.height,0,c,h,a.data);t.generateMipmaps=!1,e.__maxMipLevel=d.length-1}else b.texImage2D(3553,0,u,s.width,s.height,0,c,h,s.data),e.__maxMipLevel=0;else if(t.isCompressedTexture){for(var f=0,g=d.length;f<g;f++)a=d[f],t.format!==RGBAFormat&&t.format!==RGBFormat?null!==c?b.compressedTexImage2D(3553,f,u,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b.texImage2D(3553,f,u,a.width,a.height,0,c,h,a.data);e.__maxMipLevel=d.length-1}else if(t.isDataTexture2DArray)b.texImage3D(35866,0,u,s.width,s.height,s.depth,0,c,h,s.data),e.__maxMipLevel=0;else if(t.isDataTexture3D)b.texImage3D(32879,0,u,s.width,s.height,s.depth,0,c,h,s.data),e.__maxMipLevel=0;else if(0<d.length&&l){for(var v=0,y=d.length;v<y;v++)b.texImage2D(3553,v,u,c,h,a=d[v]);t.generateMipmaps=!1,e.__maxMipLevel=d.length-1}else b.texImage2D(3553,0,u,c,h,s),e.__maxMipLevel=0;C(t,l)&&L(r,t,s.width,s.height),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function F(e,t,i,r){var n=M.convert(t.texture.format),a=M.convert(t.texture.type),o=R(t.texture.internalFormat,n,a);b.texImage2D(r,0,o,t.width,t.height,0,n,a,null),_.bindFramebuffer(36160,e),_.framebufferTexture2D(36160,i,r,w.get(t.texture).__webglTexture,0),_.bindFramebuffer(36160,null)}function I(e,t,i){if(_.bindRenderbuffer(36161,e),t.depthBuffer&&!t.stencilBuffer){var r=33189;if(i){var n=t.depthTexture;n&&n.isDepthTexture&&(n.type===FloatType?r=36012:n.type===UnsignedIntType&&(r=33190));var a=V(t);_.renderbufferStorageMultisample(36161,a,r,t.width,t.height)}else _.renderbufferStorage(36161,r,t.width,t.height);_.framebufferRenderbuffer(36160,36096,36161,e)}else if(t.depthBuffer&&t.stencilBuffer){if(i){var o=V(t);_.renderbufferStorageMultisample(36161,o,35056,t.width,t.height)}else _.renderbufferStorage(36161,34041,t.width,t.height);_.framebufferRenderbuffer(36160,33306,36161,e)}else{var s=M.convert(t.texture.format),l=M.convert(t.texture.type),c=R(t.texture.internalFormat,s,l);if(i){var h=V(t);_.renderbufferStorageMultisample(36161,h,c,t.width,t.height)}else _.renderbufferStorage(36161,c,t.width,t.height)}_.bindRenderbuffer(36161,null)}function O(e){var t=w.get(e),i=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(_.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");w.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),f(t.depthTexture,0);var i=w.get(t.depthTexture).__webglTexture;if(t.depthTexture.format===DepthFormat)_.framebufferTexture2D(36160,36096,3553,i,0);else{if(t.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");_.framebufferTexture2D(36160,33306,3553,i,0)}}(t.__webglFramebuffer,e)}else if(i){t.__webglDepthbuffer=[];for(var r=0;r<6;r++)_.bindFramebuffer(36160,t.__webglFramebuffer[r]),t.__webglDepthbuffer[r]=_.createRenderbuffer(),I(t.__webglDepthbuffer[r],e,!1)}else _.bindFramebuffer(36160,t.__webglFramebuffer),t.__webglDepthbuffer=_.createRenderbuffer(),I(t.__webglDepthbuffer,e,!1);_.bindFramebuffer(36160,null)}function V(e){return S&&e.isWebGLMultisampleRenderTarget?Math.min(r,e.samples):0}var U=!1,G=!1;this.allocateTextureUnit=function(){var e=m;return i<=e&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i),m+=1,e},this.resetTextureUnits=function(){m=0},this.setTexture2D=f,this.setTexture2DArray=function(e,t){var i=w.get(e);0<e.version&&i.__version!==e.version?B(i,e,t):(b.activeTexture(33984+t),b.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=w.get(e);0<e.version&&i.__version!==e.version?B(i,e,t):(b.activeTexture(33984+t),b.bindTexture(32879,i.__webglTexture))},this.setTextureCube=g,this.setTextureCubeDynamic=v,this.setupRenderTarget=function(e){var t=w.get(e),i=w.get(e.texture);e.addEventListener("dispose",p),i.__webglTexture=_.createTexture(),d.memory.textures++;var r=!0===e.isWebGLCubeRenderTarget,n=!0===e.isWebGLMultisampleRenderTarget,a=E(e)||S;if(!S||e.texture.format!==RGBFormat||e.texture.type!==FloatType&&e.texture.type!==HalfFloatType||(e.texture.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),r){t.__webglFramebuffer=[];for(var o=0;o<6;o++)t.__webglFramebuffer[o]=_.createFramebuffer()}else if(t.__webglFramebuffer=_.createFramebuffer(),n)if(S){t.__webglMultisampledFramebuffer=_.createFramebuffer(),t.__webglColorRenderbuffer=_.createRenderbuffer(),_.bindRenderbuffer(36161,t.__webglColorRenderbuffer);var s=M.convert(e.texture.format),l=M.convert(e.texture.type),c=R(e.texture.internalFormat,s,l),h=V(e);_.renderbufferStorageMultisample(36161,h,c,e.width,e.height),_.bindFramebuffer(36160,t.__webglMultisampledFramebuffer),_.framebufferRenderbuffer(36160,36064,36161,t.__webglColorRenderbuffer),_.bindRenderbuffer(36161,null),e.depthBuffer&&(t.__webglDepthRenderbuffer=_.createRenderbuffer(),I(t.__webglDepthRenderbuffer,e,!0)),_.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(r){b.bindTexture(34067,i.__webglTexture),D(34067,e.texture,a);for(var u=0;u<6;u++)F(t.__webglFramebuffer[u],e,36064,34069+u);C(e.texture,a)&&L(34067,e.texture,e.width,e.height),b.bindTexture(34067,null)}else b.bindTexture(3553,i.__webglTexture),D(3553,e.texture,a),F(t.__webglFramebuffer,e,36064,3553),C(e.texture,a)&&L(3553,e.texture,e.width,e.height),b.bindTexture(3553,null);e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(C(t,E(e)||S)){var i=e.isWebGLCubeRenderTarget?34067:3553,r=w.get(t).__webglTexture;b.bindTexture(i,r),L(i,t,e.width,e.height),b.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(S){var t=w.get(e);_.bindFramebuffer(36008,t.__webglMultisampledFramebuffer),_.bindFramebuffer(36009,t.__webglFramebuffer);var i=e.width,r=e.height,n=16384;e.depthBuffer&&(n|=256),e.stencilBuffer&&(n|=1024),_.blitFramebuffer(0,0,i,r,0,0,i,r,n,9728),_.bindFramebuffer(36160,t.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),U=!0),e=e.texture),f(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===G&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),G=!0),e=e.texture),(e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?g:v)(e,t)}}function WebGLUtils(e,i,t){var r=t.isWebGL2;return{convert:function(e){var t;if(e===UnsignedByteType)return 5121;if(e===UnsignedShort4444Type)return 32819;if(e===UnsignedShort5551Type)return 32820;if(e===UnsignedShort565Type)return 33635;if(e===ByteType)return 5120;if(e===ShortType)return 5122;if(e===UnsignedShortType)return 5123;if(e===IntType)return 5124;if(e===UnsignedIntType)return 5125;if(e===FloatType)return 5126;if(e===HalfFloatType)return r?5131:null!==(t=i.get("OES_texture_half_float"))?t.HALF_FLOAT_OES:null;if(e===AlphaFormat)return 6406;if(e===RGBFormat)return 6407;if(e===RGBAFormat)return 6408;if(e===LuminanceFormat)return 6409;if(e===LuminanceAlphaFormat)return 6410;if(e===DepthFormat)return 6402;if(e===DepthStencilFormat)return 34041;if(e===RedFormat)return 6403;if(e===RedIntegerFormat)return 36244;if(e===RGFormat)return 33319;if(e===RGIntegerFormat)return 33320;if(e===RGBIntegerFormat)return 36248;if(e===RGBAIntegerFormat)return 36249;if(e===RGB_S3TC_DXT1_Format||e===RGBA_S3TC_DXT1_Format||e===RGBA_S3TC_DXT3_Format||e===RGBA_S3TC_DXT5_Format){if(null===(t=i.get("WEBGL_compressed_texture_s3tc")))return null;if(e===RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===RGB_PVRTC_4BPPV1_Format||e===RGB_PVRTC_2BPPV1_Format||e===RGBA_PVRTC_4BPPV1_Format||e===RGBA_PVRTC_2BPPV1_Format){if(null===(t=i.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===RGB_ETC1_Format)return null!==(t=i.get("WEBGL_compressed_texture_etc1"))?t.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===RGB_ETC2_Format||e===RGBA_ETC2_EAC_Format)&&null!==(t=i.get("WEBGL_compressed_texture_etc"))){if(e===RGB_ETC2_Format)return t.COMPRESSED_RGB8_ETC2;if(e===RGBA_ETC2_EAC_Format)return t.COMPRESSED_RGBA8_ETC2_EAC}return e===RGBA_ASTC_4x4_Format||e===RGBA_ASTC_5x4_Format||e===RGBA_ASTC_5x5_Format||e===RGBA_ASTC_6x5_Format||e===RGBA_ASTC_6x6_Format||e===RGBA_ASTC_8x5_Format||e===RGBA_ASTC_8x6_Format||e===RGBA_ASTC_8x8_Format||e===RGBA_ASTC_10x5_Format||e===RGBA_ASTC_10x6_Format||e===RGBA_ASTC_10x8_Format||e===RGBA_ASTC_10x10_Format||e===RGBA_ASTC_12x10_Format||e===RGBA_ASTC_12x12_Format||e===SRGB8_ALPHA8_ASTC_4x4_Format||e===SRGB8_ALPHA8_ASTC_5x4_Format||e===SRGB8_ALPHA8_ASTC_5x5_Format||e===SRGB8_ALPHA8_ASTC_6x5_Format||e===SRGB8_ALPHA8_ASTC_6x6_Format||e===SRGB8_ALPHA8_ASTC_8x5_Format||e===SRGB8_ALPHA8_ASTC_8x6_Format||e===SRGB8_ALPHA8_ASTC_8x8_Format||e===SRGB8_ALPHA8_ASTC_10x5_Format||e===SRGB8_ALPHA8_ASTC_10x6_Format||e===SRGB8_ALPHA8_ASTC_10x8_Format||e===SRGB8_ALPHA8_ASTC_10x10_Format||e===SRGB8_ALPHA8_ASTC_12x10_Format||e===SRGB8_ALPHA8_ASTC_12x12_Format?null!==(t=i.get("WEBGL_compressed_texture_astc"))?e:null:e===RGBA_BPTC_Format?null!==(t=i.get("EXT_texture_compression_bptc"))?e:null:e===UnsignedInt248Type?r?34042:null!==(t=i.get("WEBGL_depth_texture"))?t.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}function Group(){Object3D.call(this),this.type="Group"}function WebXRController(){this._targetRay=null,this._grip=null,this._hand=null}function WebXRManager(u,r){var t=this,d=null,n=1,p=null,a="local-floor",m=null,f=[],c=new Map,s=new PerspectiveCamera;s.layers.enable(1),s.viewport=new Vector4;var l=new PerspectiveCamera;l.layers.enable(2),l.viewport=new Vector4;var g=[s,l],v=new ArrayCamera;v.layers.enable(1),v.layers.enable(2);var h=null,y=null;function o(e){var t=c.get(e.inputSource);t&&t.dispatchEvent({type:e.type})}function x(){c.forEach(function(e,t){e.disconnect(t)}),c.clear(),u.setFramebuffer(null),u.setRenderTarget(u.getRenderTarget()),i.stop(),t.isPresenting=!1,t.dispatchEvent({type:"sessionend"})}function _(e){p=e,i.setContext(d),i.start(),t.isPresenting=!0,t.dispatchEvent({type:"sessionstart"})}function b(e){for(var t=d.inputSources,i=0;i<f.length;i++)c.set(t[i],f[i]);for(var r=0;r<e.removed.length;r++){var n=e.removed[r],a=c.get(n);a&&(a.dispatchEvent({type:"disconnected",data:n}),c.delete(n))}for(var o=0;o<e.added.length;o++){var s=e.added[o],l=c.get(s);l&&l.dispatchEvent({type:"connected",data:s})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=f[e];return void 0===t&&(t=new WebXRController,f[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){var t=f[e];return void 0===t&&(t=new WebXRController,f[e]=t),t.getGripSpace()},this.getHand=function(e){var t=f[e];return void 0===t&&(t=new WebXRController,f[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===t.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===t.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p},this.getSession=function(){return d},this.setSession=function(e){if(null!==(d=e)){d.addEventListener("select",o),d.addEventListener("selectstart",o),d.addEventListener("selectend",o),d.addEventListener("squeeze",o),d.addEventListener("squeezestart",o),d.addEventListener("squeezeend",o),d.addEventListener("end",x);var t=r.getContextAttributes();!0!==t.xrCompatible&&r.makeXRCompatible();var i=new XRWebGLLayer(d,r,{antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:n});d.updateRenderState({baseLayer:i}),d.requestReferenceSpace(a).then(_),d.addEventListener("inputsourceschange",b)}};var w=new Vector3,M=new Vector3;function S(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){v.near=l.near=s.near=e.near,v.far=l.far=s.far=e.far,h===v.near&&y===v.far||(d.updateRenderState({depthNear:v.near,depthFar:v.far}),h=v.near,y=v.far);var t=e.parent,i=v.cameras;S(v,t);for(var r=0;r<i.length;r++)S(i[r],t);e.matrixWorld.copy(v.matrixWorld);for(var n=e.children,a=0,o=n.length;a<o;a++)n[a].updateMatrixWorld(!0);return 2===i.length?function(e,t,i){w.setFromMatrixPosition(t.matrixWorld),M.setFromMatrixPosition(i.matrixWorld);var r=w.distanceTo(M),n=t.projectionMatrix.elements,a=i.projectionMatrix.elements,o=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],c=(n[9]-1)/n[5],h=(n[8]-1)/n[0],u=(a[8]+1)/a[0],d=o*h,p=o*u,m=r/(u-h),f=m*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var g=o+m,v=s+m;e.projectionMatrix.makePerspective(d-f,r-f+p,l*s/v*g,c*s/v*g,g,v)}(v,s,l):v.projectionMatrix.copy(s.projectionMatrix),v};var T=null;var i=new WebGLAnimation;i.setAnimationLoop(function(e,t){if(null!==(m=t.getViewerPose(p))){var i=m.views,r=d.renderState.baseLayer;u.setFramebuffer(r.framebuffer);var n=!1;i.length!==v.cameras.length&&(n=!(v.cameras.length=0));for(var a=0;a<i.length;a++){var o=i[a],s=r.getViewport(o),l=g[a];l.matrix.fromArray(o.transform.matrix),l.projectionMatrix.fromArray(o.projectionMatrix),l.viewport.set(s.x,s.y,s.width,s.height),0===a&&v.matrix.copy(l.matrix),!0===n&&v.cameras.push(l)}}for(var c=d.inputSources,h=0;h<f.length;h++){f[h].update(c[h],t,p)}T&&T(e,t)}),this.setAnimationLoop=function(e){T=e},this.dispose=function(){}}function WebGLMaterials(o){function d(e,t){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var i,r,n=o.get(t).envMap;if(n){e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio;var a=o.get(n).__maxMipLevel;void 0!==a&&(e.maxMipLevel.value=a)}t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap?i=t.emissiveMap:t.clearcoatMap?i=t.clearcoatMap:t.clearcoatNormalMap?i=t.clearcoatNormalMap:t.clearcoatRoughnessMap&&(i=t.clearcoatRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),t.aoMap?r=t.aoMap:t.lightMap&&(r=t.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uv2Transform.value.copy(r.matrix))}function p(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),o.get(t).envMap&&(e.envMapIntensity.value=t.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,i,r){var n,a,o,s,l,c,h,u;t.isMeshBasicMaterial?d(e,t):t.isMeshLambertMaterial?(d(e,t),h=e,(u=t).emissiveMap&&(h.emissiveMap.value=u.emissiveMap)):t.isMeshToonMaterial?(d(e,t),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshPhongMaterial?(d(e,t),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshStandardMaterial?(d(e,t),(t.isMeshPhysicalMaterial?function(e,t){p(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===BackSide&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}:p)(e,t)):t.isMeshMatcapMaterial?(d(e,t),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshDepthMaterial?(d(e,t),l=e,(c=t).displacementMap&&(l.displacementMap.value=c.displacementMap,l.displacementScale.value=c.displacementScale,l.displacementBias.value=c.displacementBias)):t.isMeshDistanceMaterial?(d(e,t),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,t)):t.isMeshNormalMaterial?(d(e,t),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isLineBasicMaterial?((o=e).diffuse.value.copy((s=t).color),o.opacity.value=s.opacity,t.isLineDashedMaterial&&((n=e).dashSize.value=(a=t).dashSize,n.totalSize.value=a.dashSize+a.gapSize,n.scale.value=a.scale)):t.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,t,i,r):t.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function WebGLRenderer(e){var n=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,y=null,M=null;this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var S=this,u=!1,d=null,p=0,m=0,T=null,f=null,A=-1,E=null,g=null,v=new Vector4,x=new Vector4,_=null,b=n.width,C=n.height,L=1,w=null,R=null,P=new Vector4(0,0,b,C),D=new Vector4(0,0,b,C),k=!1,B=new Frustum,F=!1,I=!1,O=new Matrix4,V=new Vector3,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return null===T?L:1}var N,z,H,j,W,q,$,X,Y,Z,Q,K,J,ee,te,ie,re,ne,ae,oe,se,le=t;function ce(e,t){for(var i=0;i<e.length;i++){var r=n.getContext(e[i],t);if(null!==r)return r}return null}try{var he={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(n.addEventListener("webglcontextlost",fe,!1),n.addEventListener("webglcontextrestored",ge,!1),null===le){var ue=["webgl2","webgl","experimental-webgl"];if(!0===S.isWebGL1Renderer&&ue.shift(),null===(le=ce(ue,he)))throw ce(ue)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===le.getShaderPrecisionFormat&&(le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function de(){N=new WebGLExtensions(le),!1===(z=new WebGLCapabilities(le,N,e)).isWebGL2&&(N.get("WEBGL_depth_texture"),N.get("OES_texture_float"),N.get("OES_texture_half_float"),N.get("OES_texture_half_float_linear"),N.get("OES_standard_derivatives"),N.get("OES_element_index_uint"),N.get("OES_vertex_array_object"),N.get("ANGLE_instanced_arrays")),N.get("OES_texture_float_linear"),oe=new WebGLUtils(le,N,z),(H=new WebGLState(le,N,z)).scissor(x.copy(D).multiplyScalar(L).floor()),H.viewport(v.copy(P).multiplyScalar(L).floor()),j=new WebGLInfo(le),W=new WebGLProperties,q=new WebGLTextures(le,N,H,W,z,oe,j),$=new WebGLCubeMaps(S),X=new WebGLAttributes(le,z),se=new WebGLBindingStates(le,N,X,z),Y=new WebGLGeometries(le,X,j,se),Z=new WebGLObjects(le,Y,X,j),re=new WebGLMorphtargets(le),te=new WebGLClipping(W),Q=new WebGLPrograms(S,$,N,z,se,te),K=new WebGLMaterials(W),J=new WebGLRenderLists(W),ee=new WebGLRenderStates,ie=new WebGLBackground(S,$,H,Z,s),ne=new WebGLBufferRenderer(le,N,j,z),ae=new WebGLIndexedBufferRenderer(le,N,j,z),j.programs=Q.programs,S.capabilities=z,S.extensions=N,S.properties=W,S.renderLists=J,S.state=H,S.info=j}de();var pe=new WebXRManager(S,le);this.xr=pe;var me=new WebGLShadowMap(S,Z,z.maxTextureSize);function fe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),u=!0}function ge(){console.log("THREE.WebGLRenderer: Context Restored."),u=!1,de()}function ve(e){var t,i=e.target;i.removeEventListener("dispose",ve),ye(t=i),W.remove(t)}function ye(e){var t=W.get(e).program;void 0!==t&&Q.releaseProgram(t)}this.shadowMap=me,this.getContext=function(){return le},this.getContextAttributes=function(){return le.getContextAttributes()},this.forceContextLoss=function(){var e=N.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=N.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(b,C,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Vector2),e.set(b,C)},this.setSize=function(e,t,i){pe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(b=e,C=t,n.width=Math.floor(e*L),n.height=Math.floor(t*L),!1!==i&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Vector2),e.set(b*L,C*L).floor()},this.setDrawingBufferSize=function(e,t,i){b=e,C=t,L=i,n.width=Math.floor(e*i),n.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Vector4),e.copy(v)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,i,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,i,r),H.viewport(v.copy(P).multiplyScalar(L).floor())},this.getScissor=function(e){return e.copy(D)},this.setScissor=function(e,t,i,r){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,i,r),H.scissor(x.copy(D).multiplyScalar(L).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){H.setScissorTest(k=e)},this.setOpaqueSort=function(e){w=e},this.setTransparentSort=function(e){R=e},this.getClearColor=function(){return ie.getClearColor()},this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)},this.clear=function(e,t,i){var r=0;void 0!==e&&!e||(r|=16384),void 0!==t&&!t||(r|=256),void 0!==i&&!i||(r|=1024),le.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",fe,!1),n.removeEventListener("webglcontextrestored",ge,!1),J.dispose(),ee.dispose(),W.dispose(),$.dispose(),Z.dispose(),se.dispose(),pe.dispose(),_e.stop()},this.renderBufferImmediate=function(e,t){se.initAttributes();var i=W.get(e);e.hasPositions&&!i.position&&(i.position=le.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=le.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=le.createBuffer()),e.hasColors&&!i.color&&(i.color=le.createBuffer());var r=t.getAttributes();e.hasPositions&&(le.bindBuffer(34962,i.position),le.bufferData(34962,e.positionArray,35048),se.enableAttribute(r.position),le.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(le.bindBuffer(34962,i.normal),le.bufferData(34962,e.normalArray,35048),se.enableAttribute(r.normal),le.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(le.bindBuffer(34962,i.uv),le.bufferData(34962,e.uvArray,35048),se.enableAttribute(r.uv),le.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(le.bindBuffer(34962,i.color),le.bufferData(34962,e.colorArray,35048),se.enableAttribute(r.color),le.vertexAttribPointer(r.color,3,5126,!1,0,0)),se.disableUnusedAttributes(),le.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,a){null===t&&(t=U);var o=n.isMesh&&n.matrixWorld.determinant()<0,s=Se(e,t,r,n);H.setMaterial(r,o);var l=i.index,c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;var h,u=1;!0===r.wireframe&&(l=Y.getWireframeAttribute(i),u=2),(r.morphTargets||r.morphNormals)&&re.update(n,i,r,s),se.setup(n,r,s,i,l);var d=ne;null!==l&&(h=X.get(l),(d=ae).setIndex(h));var p=null!==l?l.count:c.count,m=i.drawRange.start*u,f=i.drawRange.count*u,g=null!==a?a.start*u:0,v=null!==a?a.count*u:1/0,y=Math.max(m,g),x=Math.min(p,m+f,g+v)-1,_=Math.max(0,x-y+1);if(0!==_){if(n.isMesh)!0===r.wireframe?(H.setLineWidth(r.wireframeLinewidth*G()),d.setMode(1)):d.setMode(4);else if(n.isLine){var b=r.linewidth;void 0===b&&(b=1),H.setLineWidth(b*G()),d.setMode(n.isLineSegments?1:n.isLineLoop?2:3)}else n.isPoints?d.setMode(0):n.isSprite&&d.setMode(4);if(n.isInstancedMesh)d.renderInstances(y,_,n.count);else if(i.isInstancedBufferGeometry){var w=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(y,_,w)}else d.render(y,_)}},this.compile=function(n,e){(M=ee.get(n,e)).init(),n.traverse(function(e){e.isLight&&(M.pushLight(e),e.castShadow&&M.pushShadow(e))}),M.setupLights(e);var a=new WeakMap;n.traverse(function(e){var t=e.material;if(t)if(Array.isArray(t))for(var i=0;i<t.length;i++){var r=t[i];!1===a.has(r)&&(Me(r,n,e),a.set(r))}else!1===a.has(t)&&(Me(t,n,e),a.set(t))})};var xe=null;var _e=new WebGLAnimation;function be(e,t,i){for(var r=!0===t.isScene?t.overrideMaterial:null,n=0,a=e.length;n<a;n++){var o=e[n],s=o.object,l=o.geometry,c=null===r?o.material:r,h=o.group;if(i.isArrayCamera)for(var u=(g=i).cameras,d=0,p=u.length;d<p;d++){var m=u[d];s.layers.test(m.layers)&&(H.viewport(v.copy(m.viewport)),M.setupLights(m),we(s,t,m,l,c,h))}else g=null,we(s,t,i,l,c,h)}}function we(e,t,i,r,n,a){if(e.onBeforeRender(S,t,i,r,n,a),M=ee.get(t,g||i),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Se(i,t,n,e);H.setMaterial(n),se.reset(),s=o,e.render(function(e){S.renderBufferImmediate(e,s)})}else S.renderBufferDirect(i,t,r,n,e,a);var s;e.onAfterRender(S,t,i,r,n,a),M=ee.get(t,g||i)}function Me(e,t,i){!0!==t.isScene&&(t=U);var r=W.get(e),n=M.state.lights,a=n.state.version,o=Q.getParameters(e,n.state,M.state.shadowsArray,t,i),s=Q.getProgramCacheKey(o),l=r.program,c=!0;if(void 0===l)e.addEventListener("dispose",ve);else if(l.cacheKey!==s)ye(e);else if(r.lightsStateVersion!==a)c=!1;else{if(void 0!==o.shaderID)return void(r.envMap=$.get(e.envMap||(e.isMeshStandardMaterial?t.environment:null)));c=!1}c&&(o.uniforms=Q.getUniforms(e),e.onBeforeCompile(o,S),l=Q.acquireProgram(o,s),r.program=l,r.uniforms=o.uniforms,r.outputEncoding=o.outputEncoding);var h,u=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,u.clippingPlanes=te.uniform),r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=$.get(e.envMap||r.environment),r.needsLights=(h=e).isMeshLambertMaterial||h.isMeshToonMaterial||h.isMeshPhongMaterial||h.isMeshStandardMaterial||h.isShadowMaterial||h.isShaderMaterial&&!0===h.lights,r.lightsStateVersion=a,r.needsLights&&(u.ambientLightColor.value=n.state.ambient,u.lightProbe.value=n.state.probe,u.directionalLights.value=n.state.directional,u.directionalLightShadows.value=n.state.directionalShadow,u.spotLights.value=n.state.spot,u.spotLightShadows.value=n.state.spotShadow,u.rectAreaLights.value=n.state.rectArea,u.ltc_1.value=n.state.rectAreaLTC1,u.ltc_2.value=n.state.rectAreaLTC2,u.pointLights.value=n.state.point,u.pointLightShadows.value=n.state.pointShadow,u.hemisphereLights.value=n.state.hemi,u.directionalShadowMap.value=n.state.directionalShadowMap,u.directionalShadowMatrix.value=n.state.directionalShadowMatrix,u.spotShadowMap.value=n.state.spotShadowMap,u.spotShadowMatrix.value=n.state.spotShadowMatrix,u.pointShadowMap.value=n.state.pointShadowMap,u.pointShadowMatrix.value=n.state.pointShadowMatrix);var d=r.program.getUniforms(),p=WebGLUniforms.seqWithValue(d.seq,u);r.uniformsList=p}function Se(e,t,i,r){!0!==t.isScene&&(t=U),q.resetTextureUnits();var n=t.fog,a=i.isMeshStandardMaterial?t.environment:null,o=null===T?S.outputEncoding:T.texture.encoding,s=$.get(i.envMap||a),l=W.get(i),c=M.state.lights;!0===F&&(!0!==I&&e===E||te.setState(i,e,e===E&&i.id===A));i.version===l.__version?(i.fog&&l.fog!==n||l.environment!==a||l.needsLights&&l.lightsStateVersion!==c.state.version||void 0!==l.numClippingPlanes&&(l.numClippingPlanes!==te.numPlanes||l.numIntersection!==te.numIntersection)||l.outputEncoding!==o||l.envMap!==s)&&Me(i,t,r):(Me(i,t,r),l.__version=i.version);var h,u,d=!1,p=!1,m=!1,f=l.program,g=f.getUniforms(),v=l.uniforms;if(H.useProgram(f.program)&&(m=p=d=!0),i.id!==A&&(A=i.id,p=!0),d||E!==e){if(g.setValue(le,"projectionMatrix",e.projectionMatrix),z.logarithmicDepthBuffer&&g.setValue(le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),E!==e&&(E=e,m=p=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var y=g.map.cameraPosition;void 0!==y&&y.setValue(le,V.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&g.setValue(le,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&g.setValue(le,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){g.setOptional(le,r,"bindMatrix"),g.setOptional(le,r,"bindMatrixInverse");var x=r.skeleton;if(x)if(z.floatVertexTextures){if(void 0===x.boneTexture){var _=Math.sqrt(4*x.bones.length);_=MathUtils.ceilPowerOfTwo(_),_=Math.max(_,4);var b=new Float32Array(_*_*4);b.set(x.boneMatrices);var w=new DataTexture(b,_,_,RGBAFormat,FloatType);x.boneMatrices=b,x.boneTexture=w,x.boneTextureSize=_}g.setValue(le,"boneTexture",x.boneTexture,q),g.setValue(le,"boneTextureSize",x.boneTextureSize)}else g.setOptional(le,x,"boneMatrices")}return!p&&l.receiveShadow===r.receiveShadow||(l.receiveShadow=r.receiveShadow,g.setValue(le,"receiveShadow",r.receiveShadow)),p&&(g.setValue(le,"toneMappingExposure",S.toneMappingExposure),l.needsLights&&((h=v).ambientLightColor.needsUpdate=u=m,h.lightProbe.needsUpdate=u,h.directionalLights.needsUpdate=u,h.directionalLightShadows.needsUpdate=u,h.pointLights.needsUpdate=u,h.pointLightShadows.needsUpdate=u,h.spotLights.needsUpdate=u,h.spotLightShadows.needsUpdate=u,h.rectAreaLights.needsUpdate=u,h.hemisphereLights.needsUpdate=u),n&&i.fog&&K.refreshFogUniforms(v,n),K.refreshMaterialUniforms(v,i,L,C),WebGLUniforms.upload(le,l.uniformsList,v,q)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(WebGLUniforms.upload(le,l.uniformsList,v,q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&g.setValue(le,"center",r.center),g.setValue(le,"modelViewMatrix",r.modelViewMatrix),g.setValue(le,"normalMatrix",r.normalMatrix),g.setValue(le,"modelMatrix",r.matrixWorld),f}_e.setAnimationLoop(function(e){pe.isPresenting||xe&&xe(e)}),"undefined"!=typeof window&&_e.setContext(window),this.setAnimationLoop=function(e){pe.setAnimationLoop(xe=e),null===e?_e.stop():_e.start()},this.render=function(e,t){var i,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0===t||!0===t.isCamera){if(!0!==u){se.resetDefaultState(),A=-1,!(E=null)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===pe.enabled&&!0===pe.isPresenting&&(t=pe.getCamera(t)),!0===e.isScene&&e.onBeforeRender(S,e,t,i||T),(M=ee.get(e,t)).init(),O.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),B.setFromProjectionMatrix(O),F=te.init(this.clippingPlanes,I=this.localClippingEnabled,t),(y=J.get(e,t)).init(),function e(t,i,r,n){if(!1===t.visible)return;var a=t.layers.test(i.layers);if(a)if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(i);else if(t.isLight)M.pushLight(t),t.castShadow&&M.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(O);var o=Z.update(t),s=t.material;s.visible&&y.push(t,o,s,r,V.z,null)}}else if(t.isImmediateRenderObject)n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(O),y.push(t,null,t.material,r,V.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==j.render.frame&&(t.skeleton.update(),t.skeleton.frame=j.render.frame),!t.frustumCulled||B.intersectsObject(t))){n&&V.setFromMatrixPosition(t.matrixWorld).applyMatrix4(O);var l=Z.update(t),c=t.material;if(Array.isArray(c))for(var h=l.groups,u=0,d=h.length;u<d;u++){var p=h[u],m=c[p.materialIndex];m&&m.visible&&y.push(t,l,m,r,V.z,p)}else c.visible&&y.push(t,l,c,r,V.z,null)}var f=t.children;for(var g=0,v=f.length;g<v;g++)e(f[g],i,r,n)}(e,t,0,S.sortObjects),y.finish(),!0===S.sortObjects&&y.sort(w,R),!0===F&&te.beginShadows(),me.render(M.state.shadowsArray,e,t),M.setupLights(t),!0===F&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),ie.render(y,e,t,r);var n=y.opaque,a=y.transparent;0<n.length&&be(n,e,t),0<a.length&&be(a,e,t),!0===e.isScene&&e.onAfterRender(S,e,t),null!==T&&(q.updateRenderTargetMipmap(T),q.updateMultisampleRenderTarget(T)),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1),M=y=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){d!==e&&null===T&&le.bindFramebuffer(36160,e),d=e},this.getActiveCubeFace=function(){return p},this.getActiveMipmapLevel=function(){return m},this.getRenderList=function(){return y},this.setRenderList=function(e){y=e},this.getRenderState=function(){return M},this.setRenderState=function(e){M=e},this.getRenderTarget=function(){return T},this.setRenderTarget=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;p=t,m=i,(T=e)&&void 0===W.get(e).__webglFramebuffer&&q.setupRenderTarget(e);var r=d,n=!1;if(e){var a=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=a[t],n=!0):r=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:a,v.copy(e.viewport),x.copy(e.scissor),_=e.scissorTest}else v.copy(P).multiplyScalar(L).floor(),x.copy(D).multiplyScalar(L).floor(),_=k;if(f!==r&&(le.bindFramebuffer(36160,r),f=r),H.viewport(v),H.scissor(x),H.setScissorTest(_),n){var o=W.get(e.texture);le.framebufferTexture2D(36160,36064,34069+t,o.__webglTexture,i)}},this.readRenderTargetPixels=function(e,t,i,r,n,a,o){if(e&&e.isWebGLRenderTarget){var s=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){var l=!1;s!==f&&(le.bindFramebuffer(36160,s),l=!0);try{var c=e.texture,h=c.format,u=c.type;if(h!==RGBAFormat&&oe.convert(h)!==le.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===UnsignedByteType||oe.convert(u)===le.getParameter(35738)||u===FloatType&&(z.isWebGL2||N.get("OES_texture_float")||N.get("WEBGL_color_buffer_float"))||u===HalfFloatType&&N.get(z.isWebGL2?"EXT_color_buffer_float":"EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===le.checkFramebufferStatus(36160)?0<=t&&t<=e.width-r&&0<=i&&i<=e.height-n&&le.readPixels(t,i,r,n,oe.convert(h),oe.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&le.bindFramebuffer(36160,f)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){void 0===i&&(i=0);var r=Math.pow(2,-i),n=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r),o=oe.convert(t.format);q.setTexture2D(t,0),le.copyTexImage2D(3553,i,o,e.x,e.y,n,a,0),H.unbindTexture()},this.copyTextureToTexture=function(e,t,i,r){void 0===r&&(r=0);var n=t.image.width,a=t.image.height,o=oe.convert(i.format),s=oe.convert(i.type);q.setTexture2D(i,0),le.pixelStorei(37440,i.flipY),le.pixelStorei(37441,i.premultiplyAlpha),le.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?le.texSubImage2D(3553,r,e.x,e.y,n,a,o,s,t.image.data):t.isCompressedTexture?le.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):le.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&i.generateMipmaps&&le.generateMipmap(3553),H.unbindTexture()},this.initTexture=function(e){q.setTexture2D(e,0),H.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function WebGL1Renderer(e){WebGLRenderer.call(this,e)}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Object.assign(WebXRController.prototype,{constructor:WebXRController,getHandSpace:function(){if(null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(var e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){var t=new Group;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,i){var r=null,n=null,a=null,o=this._targetRay,s=this._grip,l=this._hand;if(e)if(l&&e.hand){a=!0;for(var c=0;c<=window.XRHand.LITTLE_PHALANX_TIP;c++)if(e.hand[c]){var h=t.getJointPose(e.hand[c],i),u=l.joints[c];null!==h&&(u.matrix.fromArray(h.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.jointRadius=h.radius),u.visible=null!==h;var d=l.joints[window.XRHand.INDEX_PHALANX_TIP],p=l.joints[window.XRHand.THUMB_PHALANX_TIP],m=d.position.distanceTo(p.position);l.inputState.pinching&&.025<m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&m<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==o&&null!==(r=t.getPose(e.targetRaySpace,i))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==s&&e.gripSpace&&null!==(n=t.getPose(e.gripSpace,i))&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale));return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==n),null!==l&&(l.visible=null!==a),this}}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype),WebGL1Renderer.prototype=Object.assign(Object.create(WebGLRenderer.prototype),{constructor:WebGL1Renderer,isWebGL1Renderer:!0});var FogExp2=function(){function i(e,t){_classCallCheck(this,i),Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}return _createClass(i,[{key:"clone",value:function(){return new i(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),i}(),Fog=function(){function r(e,t,i){_classCallCheck(this,r),Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}return _createClass(r,[{key:"clone",value:function(){return new r(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),r}(),Scene=function(){_inherits(i,Object3D);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),e=t.call(this),Object.defineProperty(_assertThisInitialized(e),"isScene",{value:!0}),e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:_assertThisInitialized(e)})),e}return _createClass(i,[{key:"copy",value:function(e,t){return _get(_getPrototypeOf(i.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=_get(_getPrototypeOf(i.prototype),"toJSON",this).call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),i}();function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=MathUtils.generateUUID()}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=MathUtils.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new InterleavedBuffer(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=MathUtils.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var _vector$6=new Vector3,_geometry;function InterleavedBufferAttribute(e,t,i,r){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function SpriteMaterial(e){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,i=this.data.count;t<i;t++)_vector$6.x=this.getX(t),_vector$6.y=this.getY(t),_vector$6.z=this.getZ(t),_vector$6.applyMatrix4(e),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this},clone:function(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)},toJSON:function(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2;function Sprite(e){if(Object3D.call(this),this.type="Sprite",void 0===_geometry){_geometry=new BufferGeometry;var t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=_geometry,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}function transformVertex(e,t,i,r,n,a){_alignedPosition.subVectors(e,i).addScalar(.5).multiply(r),void 0!==n?(_rotatedPosition.x=a*_alignedPosition.x-n*_alignedPosition.y,_rotatedPosition.y=n*_alignedPosition.x+a*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),e.copy(t),e.x+=_rotatedPosition.x,e.y+=_rotatedPosition.y,e.applyMatrix4(_viewWorldMatrix)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);var i,r,n=this.material.rotation;0!==n&&(r=Math.cos(n),i=Math.sin(n));var a=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,a,_worldScale,i,r),transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,a,_worldScale,i,r),transformVertex(_vC$1.set(.5,.5,0),_mvPosition,a,_worldScale,i,r),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);var o=e.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,!1,_intersectPoint);if(null!==o||(transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,a,_worldScale,i,r),_uvB$1.set(0,1),null!==(o=e.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,!1,_intersectPoint)))){var s=e.ray.origin.distanceTo(_intersectPoint);s<e.near||e.far<s||t.push({distance:s,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})}},copy:function(e){return Object3D.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});var _v1$4=new Vector3,_v2$2=new Vector3,fFa,gFa,hFa,iFa,jFa;function LOD(){Object3D.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function SkinnedMesh(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(e){Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);var i,r=this.levels;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(0<t.length){var i,r;for(i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(0<this.levels.length){_v1$4.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(_v1$4);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){var t=this.levels;if(1<t.length){_v1$4.setFromMatrixPosition(e.matrixWorld),_v2$2.setFromMatrixPosition(this.matrixWorld);var i,r,n=_v1$4.distanceTo(_v2$2)/e.zoom;for(t[0].object.visible=!0,i=1,r=t.length;i<r&&t[i].distance<=n;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var a=i[r];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,copy:function(e){return Mesh.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Vector4,t=this.geometry.attributes.skinWeight,i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var n=1/e.manhattanLength();n!=1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:(fFa=new Vector3,gFa=new Vector4,hFa=new Vector4,iFa=new Vector3,jFa=new Matrix4,function(e,t){var i=this.skeleton,r=this.geometry;gFa.fromBufferAttribute(r.attributes.skinIndex,e),hFa.fromBufferAttribute(r.attributes.skinWeight,e),fFa.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var n=0;n<4;n++){var a=hFa.getComponent(n);if(0!==a){var o=gFa.getComponent(n);jFa.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),t.addScaledVector(iFa.copy(fFa).applyMatrix4(jFa),a)}}return t.applyMatrix4(this.bindMatrixInverse)})});var _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;function Skeleton(e,t){if(this.bones=(e=e||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Matrix4)}}function Bone(){Object3D.call(this),this.type="Bone"}Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){for(var e=0,t=this.bones.length;e<t;e++){var i=this.bones[e];i&&i.matrixWorld.getInverse(this.boneInverses[e])}for(var r=0,n=this.bones.length;r<n;r++){var a=this.bones[r];a&&(a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}},update:function(){for(var e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture,n=0,a=e.length;n<a;n++){_offsetMatrix.multiplyMatrices(e[n]?e[n].matrixWorld:_identityMatrix,t[n]),_offsetMatrix.toArray(i,16*n)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t];if(r.name===e)return r}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});var _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;function InstancedMesh(e,t,i){Mesh.call(this,e,t),this.instanceMatrix=new BufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function LineBasicMaterial(e){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,copy:function(e){return Mesh.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new BufferAttribute(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var i=this.matrixWorld,r=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material)for(var n=0;n<r;n++){this.getMatrixAt(n,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(i,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(e,_instanceIntersects);for(var a=0,o=_instanceIntersects.length;a<o;a++){var s=_instanceIntersects[a];s.instanceId=n,s.object=this,t.push(s)}_instanceIntersects.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var _start=new Vector3,_end=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$2=new Sphere;function Line(e,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new LineBasicMaterial,this.updateMorphTargets()}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[0],r=1,n=t.count;r<n;r++)_start.fromBufferAttribute(t,r-1),_end.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices,o=e.lineDistances;o[0]=0;for(var s=1,l=a.length;s<l;s++)o[s]=o[s-1],o[s]+=a[s-1].distanceTo(a[s])}return this},raycast:function(e,t){var i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere$2.copy(i.boundingSphere),_sphere$2.applyMatrix4(r),_sphere$2.radius+=n,!1!==e.ray.intersectsSphere(_sphere$2)){_inverseMatrix$1.getInverse(r),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);var a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3,u=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var d=i.index,p=i.attributes.position.array;if(null!==d)for(var m=d.array,f=0,g=m.length-1;f<g;f+=u){var v=m[f+1];if(s.fromArray(p,3*m[f]),l.fromArray(p,3*v),!(o<_ray$1.distanceSqToSegment(s,l,h,c))){h.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(h);y<e.near||e.far<y||t.push({distance:y,point:c.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this})}}else for(var x=0,_=p.length/3-1;x<_;x+=u){if(s.fromArray(p,3*x),l.fromArray(p,3*x+3),!(o<_ray$1.distanceSqToSegment(s,l,h,c))){h.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(h);b<e.near||e.far<b||t.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else if(i.isGeometry)for(var w=i.vertices,M=w.length,S=0;S<M-1;S+=u){if(!(o<_ray$1.distanceSqToSegment(w[S],w[S+1],h,c))){h.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(h);T<e.near||e.far<T||t.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(0<i.length){var r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0,a=r.length;n<a;n++){var o=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}else{var s=e.morphTargets;void 0!==s&&0<s.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var _start$1=new Vector3,_end$1=new Vector3;function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}function LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}function PointsMaterial(e){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[],r=0,n=t.count;r<n;r+=2)_start$1.fromBufferAttribute(t,r),_end$1.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(var a=e.vertices,o=e.lineDistances,s=0,l=a.length;s<l;s+=2)_start$1.copy(a[s]),_end$1.copy(a[s+1]),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+_start$1.distanceTo(_end$1);return this}}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var _inverseMatrix$2=new Matrix4,_ray$2=new Ray,_sphere$3=new Sphere,_position$1=new Vector3;function Points(e,t){Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new PointsMaterial,this.updateMorphTargets()}function testPoint(e,t,i,r,n,a,o){var s=_ray$2.distanceSqToPoint(e);if(s<i){var l=new Vector3;_ray$2.closestPointToPoint(e,l),l.applyMatrix4(r);var c=n.ray.origin.distanceTo(l);if(c<n.near||n.far<c)return;a.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}function VideoTexture(t,e,i,r,n,a,o,s,l){Texture.call(this,t,e,i,r,n,a,o,s,l),this.format=void 0!==o?o:RGBFormat,this.minFilter=void 0!==a?a:LinearFilter,this.magFilter=void 0!==n?n:LinearFilter,this.generateMipmaps=!1;var c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)})}function CompressedTexture(e,t,i,r,n,a,o,s,l,c,h,u){Texture.call(this,null,a,o,s,l,c,r,n,h,u),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(e,t,i,r,n,a,o,s,l){Texture.call(this,e,t,i,r,n,a,o,s,l),this.needsUpdate=!0}function DepthTexture(e,t,i,r,n,a,o,s,l,c){if((c=void 0!==c?c:DepthFormat)!==DepthFormat&&c!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===DepthFormat&&(i=UnsignedShortType),void 0===i&&c===DepthStencilFormat&&(i=UnsignedInt248Type),Texture.call(this,null,r,n,a,o,s,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:NearestFilter,this.minFilter=void 0!==s?s:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){var i=this.geometry,r=this.matrixWorld,n=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),_sphere$3.copy(i.boundingSphere),_sphere$3.applyMatrix4(r),_sphere$3.radius+=n,!1!==e.ray.intersectsSphere(_sphere$3)){_inverseMatrix$2.getInverse(r),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2);var a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(i.isBufferGeometry){var s=i.index,l=i.attributes.position.array;if(null!==s)for(var c=s.array,h=0,u=c.length;h<u;h++){var d=c[h];_position$1.fromArray(l,3*d),testPoint(_position$1,d,o,r,e,t,this)}else for(var p=0,m=l.length/3;p<m;p++)_position$1.fromArray(l,3*p),testPoint(_position$1,p,o,r,e,t,this)}else for(var f=i.vertices,g=0,v=f.length;g<v;g++)testPoint(f[g],g,o,r,e,t,this)}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,i=Object.keys(t);if(0<i.length){var r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0,a=r.length;n<a;n++){var o=r[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}else{var s=e.morphTargets;void 0!==s&&0<s.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.HAVE_CURRENT_DATA<=e.readyState&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0;var WireframeGeometry=function(){_inherits(V,BufferGeometry);var O=_createSuper(V);function V(e){var t;_classCallCheck(this,V),(t=O.call(this)).type="WireframeGeometry";var i=[],r=[0,0],n={},a=["a","b","c"];if(e&&e.isGeometry){for(var o=e.faces,s=0,l=o.length;s<l;s++)for(var c=o[s],h=0;h<3;h++){var u=c[a[h]],d=c[a[(h+1)%3]];r[0]=Math.min(u,d),r[1]=Math.max(u,d);var p=r[0]+","+r[1];void 0===n[p]&&(n[p]={index1:r[0],index2:r[1]})}for(var m in n){var f=n[m],g=e.vertices[f.index1];i.push(g.x,g.y,g.z),i.push((g=e.vertices[f.index2]).x,g.y,g.z)}}else if(e&&e.isBufferGeometry){var v=new Vector3;if(null!==e.index){var y=e.attributes.position,x=e.index,_=e.groups;0===_.length&&(_=[{start:0,count:x.count,materialIndex:0}]);for(var b=0,w=_.length;b<w;++b)for(var M=_[b],S=M.start,T=S,A=S+M.count;T<A;T+=3)for(var E=0;E<3;E++){var C=x.getX(T+E),L=x.getX(T+(E+1)%3);r[0]=Math.min(C,L),r[1]=Math.max(C,L);var R=r[0]+","+r[1];void 0===n[R]&&(n[R]={index1:r[0],index2:r[1]})}for(var P in n){var D=n[P];v.fromBufferAttribute(y,D.index1),i.push(v.x,v.y,v.z),v.fromBufferAttribute(y,D.index2),i.push(v.x,v.y,v.z)}}else for(var k=e.attributes.position,B=0,F=k.count/3;B<F;B++)for(var I=0;I<3;I++){v.fromBufferAttribute(k,3*B+I),i.push(v.x,v.y,v.z),v.fromBufferAttribute(k,3*B+(I+1)%3),i.push(v.x,v.y,v.z)}}return t.setAttribute("position",new Float32BufferAttribute(i,3)),t}return V}();function ParametricGeometry(e,t,i){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,i)),this.mergeVertices()}function ParametricBufferGeometry(e,t,i){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r=[],n=[],a=[],o=[],s=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3,u=new Vector3;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var d=t+1,p=0;p<=i;p++)for(var m=p/i,f=0;f<=t;f++){var g=f/t;e(g,m,l),n.push(l.x,l.y,l.z),0<=g-1e-5?(e(g-1e-5,m,c),h.subVectors(l,c)):(e(1e-5+g,m,c),h.subVectors(c,l)),0<=m-1e-5?(e(g,m-1e-5,c),u.subVectors(l,c)):(e(g,1e-5+m,c),u.subVectors(c,l)),s.crossVectors(h,u).normalize(),a.push(s.x,s.y,s.z),o.push(g,m)}for(var v=0;v<i;v++)for(var y=0;y<t;y++){var x=v*d+y+1,_=(v+1)*d+y+1,b=(v+1)*d+y;r.push(v*d+y,x,b),r.push(x,_,b)}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2))}ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry;var PolyhedronGeometry=function(){_inherits(o,Geometry);var a=_createSuper(o);function o(e,t,i,r){var n;return _classCallCheck(this,o),(n=a.call(this)).type="PolyhedronGeometry",n.parameters={vertices:e,indices:t,radius:i,detail:r},n.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,i,r)),n.mergeVertices(),n}return o}(),PolyhedronBufferGeometry=function(){_inherits(l,BufferGeometry);var n=_createSuper(l);function l(r,a,e,t){var i;_classCallCheck(this,l),(i=n.call(this)).type="PolyhedronBufferGeometry",i.parameters={vertices:r,indices:a,radius:e,detail:t},e=e||1;var h=[],u=[];function o(e,t,i,r){for(var n=Math.pow(2,r),a=[],o=0;o<=n;o++){a[o]=[];for(var s=e.clone().lerp(i,o/n),l=t.clone().lerp(i,o/n),c=n-o,h=0;h<=c;h++)a[o][h]=0===h&&o===n?s:s.clone().lerp(l,h/c)}for(var u=0;u<n;u++)for(var d=0;d<2*(n-u)-1;d++){var p=Math.floor(d/2);d%2==0?(m(a[u][p+1]),m(a[u+1][p]),m(a[u][p])):(m(a[u][p+1]),m(a[u+1][p+1]),m(a[u+1][p]))}}function m(e){h.push(e.x,e.y,e.z)}function s(e,t){var i=3*e;t.x=r[0+i],t.y=r[1+i],t.z=r[2+i]}function d(e,t,i,r){r<0&&1===e.x&&(u[t]=e.x-1),0===i.x&&0===i.z&&(u[t]=r/2/Math.PI+.5)}function p(e){return Math.atan2(e.z,-e.x)}return function(e){for(var t=new Vector3,i=new Vector3,r=new Vector3,n=0;n<a.length;n+=3)s(a[n+0],t),s(a[n+1],i),s(a[n+2],r),o(t,i,r,e)}(t=t||0),function(e){for(var t=new Vector3,i=0;i<h.length;i+=3)t.x=h[i+0],t.y=h[i+1],t.z=h[i+2],t.normalize().multiplyScalar(e),h[i+0]=t.x,h[i+1]=t.y,h[i+2]=t.z}(e),function(){for(var e=new Vector3,t=0;t<h.length;t+=3){e.x=h[t+0],e.y=h[t+1],e.z=h[t+2];var i=p(e)/2/Math.PI+.5,r=(n=e,Math.atan2(-n.y,Math.sqrt(n.x*n.x+n.z*n.z))/Math.PI+.5);u.push(i,1-r)}var n;(function(){for(var e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector3,n=new Vector2,a=new Vector2,o=new Vector2,s=0,l=0;s<h.length;s+=9,l+=6){e.set(h[s+0],h[s+1],h[s+2]),t.set(h[s+3],h[s+4],h[s+5]),i.set(h[s+6],h[s+7],h[s+8]),n.set(u[l+0],u[l+1]),a.set(u[l+2],u[l+3]),o.set(u[l+4],u[l+5]),r.copy(e).add(t).add(i).divideScalar(3);var c=p(r);d(n,l+0,e,c),d(a,l+2,t,c),d(o,l+4,i,c)}})(),function(){for(var e=0;e<u.length;e+=6){var t=u[e+0],i=u[e+2],r=u[e+4],n=Math.max(t,i,r),a=Math.min(t,i,r);.9<n&&a<.1&&(t<.2&&(u[e+0]+=1),i<.2&&(u[e+2]+=1),r<.2&&(u[e+4]+=1))}}()}(),i.setAttribute("position",new Float32BufferAttribute(h,3)),i.setAttribute("normal",new Float32BufferAttribute(h.slice(),3)),i.setAttribute("uv",new Float32BufferAttribute(u,2)),0===t?i.computeVertexNormals():i.normalizeNormals(),i}return l}(),TetrahedronGeometry=function(){_inherits(n,Geometry);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=r.call(this)).type="TetrahedronGeometry",i.parameters={radius:e,detail:t},i.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),i.mergeVertices(),i}return n}(),TetrahedronBufferGeometry=function(){_inherits(n,PolyhedronBufferGeometry);var r=_createSuper(n);function n(e,t){var i;_classCallCheck(this,n);return(i=r.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t)).type="TetrahedronBufferGeometry",i.parameters={radius:e,detail:t},i}return n}(),OctahedronGeometry=function(){_inherits(n,Geometry);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=r.call(this)).type="OctahedronGeometry",i.parameters={radius:e,detail:t},i.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),i.mergeVertices(),i}return n}(),OctahedronBufferGeometry=function(){_inherits(n,PolyhedronBufferGeometry);var r=_createSuper(n);function n(e,t){var i;_classCallCheck(this,n);return(i=r.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t)).type="OctahedronBufferGeometry",i.parameters={radius:e,detail:t},i}return n}(),IcosahedronGeometry=function(){_inherits(n,Geometry);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=r.call(this)).type="IcosahedronGeometry",i.parameters={radius:e,detail:t},i.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),i.mergeVertices(),i}return n}(),IcosahedronBufferGeometry=function(){_inherits(a,PolyhedronBufferGeometry);var n=_createSuper(a);function a(e,t){var i;_classCallCheck(this,a);var r=(1+Math.sqrt(5))/2;return(i=n.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t)).type="IcosahedronBufferGeometry",i.parameters={radius:e,detail:t},i}return a}(),DodecahedronGeometry=function(){_inherits(n,Geometry);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=r.call(this)).type="DodecahedronGeometry",i.parameters={radius:e,detail:t},i.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),i.mergeVertices(),i}return n}(),DodecahedronBufferGeometry=function(){_inherits(o,PolyhedronBufferGeometry);var a=_createSuper(o);function o(e,t){var i;_classCallCheck(this,o);var r=(1+Math.sqrt(5))/2,n=1/r;return(i=a.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t)).type="DodecahedronBufferGeometry",i.parameters={radius:e,detail:t},i}return o}(),TubeGeometry=function(){_inherits(c,Geometry);var l=_createSuper(c);function c(e,t,i,r,n,a){var o;_classCallCheck(this,c),(o=l.call(this)).type="TubeGeometry",o.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new TubeBufferGeometry(e,t,i,r,n);return o.tangents=s.tangents,o.normals=s.normals,o.binormals=s.binormals,o.fromBufferGeometry(s),o.mergeVertices(),o}return c}(),TubeBufferGeometry=function(){_inherits(v,BufferGeometry);var o=_createSuper(v);function v(s,l,c,h,t){var e;_classCallCheck(this,v),(e=o.call(this)).type="TubeBufferGeometry",e.parameters={path:s,tubularSegments:l,radius:c,radialSegments:h,closed:t},c=c||1,h=h||8;var u=s.computeFrenetFrames(l=l||64,t=t||!1);e.tangents=u.tangents,e.normals=u.normals,e.binormals=u.binormals;var d=new Vector3,p=new Vector3,i=new Vector2,m=new Vector3,f=[],g=[],r=[],a=[];function n(e){m=s.getPointAt(e/l,m);for(var t=u.normals[e],i=u.binormals[e],r=0;r<=h;r++){var n=r/h*Math.PI*2,a=Math.sin(n),o=-Math.cos(n);p.x=o*t.x+a*i.x,p.y=o*t.y+a*i.y,p.z=o*t.z+a*i.z,p.normalize(),g.push(p.x,p.y,p.z),d.x=m.x+c*p.x,d.y=m.y+c*p.y,d.z=m.z+c*p.z,f.push(d.x,d.y,d.z)}}return function(){for(var e=0;e<l;e++)n(e);n(!1===t?l:0),function(){for(var e=0;e<=l;e++)for(var t=0;t<=h;t++)i.x=e/l,i.y=t/h,r.push(i.x,i.y)}(),function(){for(var e=1;e<=l;e++)for(var t=1;t<=h;t++){var i=(h+1)*e+(t-1),r=(h+1)*e+t,n=(h+1)*(e-1)+t;a.push((h+1)*(e-1)+(t-1),i,n),a.push(i,r,n)}}()}(),e.setIndex(a),e.setAttribute("position",new Float32BufferAttribute(f,3)),e.setAttribute("normal",new Float32BufferAttribute(g,3)),e.setAttribute("uv",new Float32BufferAttribute(r,2)),e}return _createClass(v,[{key:"toJSON",value:function(){var e=BufferGeometry.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}]),v}(),TorusKnotGeometry=function(){_inherits(c,Geometry);var l=_createSuper(c);function c(e,t,i,r,n,a,o){var s;return _classCallCheck(this,c),(s=l.call(this)).type="TorusKnotGeometry",s.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),s.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,i,r,n,a)),s.mergeVertices(),s}return c}(),TorusKnotBufferGeometry=function(){_inherits(P,BufferGeometry);var R=_createSuper(P);function P(e,t,i,r,n,a){var o;_classCallCheck(this,P),(o=R.call(this)).type="TorusKnotBufferGeometry",o.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:a},e=e||1,t=t||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,n=n||2,a=a||3;for(var s=[],l=[],c=[],h=[],u=new Vector3,d=new Vector3,p=new Vector3,m=new Vector3,f=new Vector3,g=new Vector3,v=new Vector3,y=0;y<=i;++y){var x=y/i*n*Math.PI*2;L(x,n,a,e,p),L(.01+x,n,a,e,m),g.subVectors(m,p),v.addVectors(m,p),f.crossVectors(g,v),v.crossVectors(f,g),f.normalize(),v.normalize();for(var _=0;_<=r;++_){var b=_/r*Math.PI*2,w=-t*Math.cos(b),M=t*Math.sin(b);u.x=p.x+(w*v.x+M*f.x),u.y=p.y+(w*v.y+M*f.y),u.z=p.z+(w*v.z+M*f.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),c.push(d.x,d.y,d.z),h.push(y/i),h.push(_/r)}}for(var S=1;S<=i;S++)for(var T=1;T<=r;T++){var A=(r+1)*S+(T-1),E=(r+1)*S+T,C=(r+1)*(S-1)+T;s.push((r+1)*(S-1)+(T-1),A,C),s.push(A,E,C)}function L(e,t,i,r,n){var a=Math.cos(e),o=Math.sin(e),s=i/t*e,l=Math.cos(s);n.x=r*(2+l)*.5*a,n.y=r*(2+l)*o*.5,n.z=r*Math.sin(s)*.5}return o.setIndex(s),o.setAttribute("position",new Float32BufferAttribute(l,3)),o.setAttribute("normal",new Float32BufferAttribute(c,3)),o.setAttribute("uv",new Float32BufferAttribute(h,2)),o}return P}(),TorusGeometry=function(){_inherits(s,Geometry);var o=_createSuper(s);function s(e,t,i,r,n){var a;return _classCallCheck(this,s),(a=o.call(this)).type="TorusGeometry",a.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},a.fromBufferGeometry(new TorusBufferGeometry(e,t,i,r,n)),a.mergeVertices(),a}return s}(),TorusBufferGeometry=function(){_inherits(M,BufferGeometry);var w=_createSuper(M);function M(e,t,i,r,n){var a;_classCallCheck(this,M),(a=w.call(this)).type="TorusBufferGeometry",a.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||1,t=t||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,n=n||2*Math.PI;for(var o=[],s=[],l=[],c=[],h=new Vector3,u=new Vector3,d=new Vector3,p=0;p<=i;p++)for(var m=0;m<=r;m++){var f=m/r*n,g=p/i*Math.PI*2;u.x=(e+t*Math.cos(g))*Math.cos(f),u.y=(e+t*Math.cos(g))*Math.sin(f),u.z=t*Math.sin(g),s.push(u.x,u.y,u.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(m/r),c.push(p/i)}for(var v=1;v<=i;v++)for(var y=1;y<=r;y++){var x=(r+1)*(v-1)+y-1,_=(r+1)*(v-1)+y,b=(r+1)*v+y;o.push((r+1)*v+y-1,x,b),o.push(x,_,b)}return a.setIndex(o),a.setAttribute("position",new Float32BufferAttribute(s,3)),a.setAttribute("normal",new Float32BufferAttribute(l,3)),a.setAttribute("uv",new Float32BufferAttribute(c,2)),a}return M}(),Earcut={triangulate:function(e,t,i){i=i||2;var r,n,a,o,s,l,c,h=t&&t.length,u=h?t[0]*i:e.length,d=linkedList(e,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=eliminateHoles(e,t,d,i)),80*i<e.length){r=a=e[0],n=o=e[1];for(var m=i;m<u;m+=i)(s=e[m])<r&&(r=s),(l=e[m+1])<n&&(n=l),a<s&&(a=s),o<l&&(o=l);c=0!==(c=Math.max(a-r,o-n))?1/c:0}return earcutLinked(d,p,i,r,n,c),p}};function linkedList(e,t,i,r,n){var a,o;if(n===0<signedArea(e,t,i,r))for(a=t;a<i;a+=r)o=insertNode(a,e[a],e[a+1],o);else for(a=i-r;t<=a;a-=r)o=insertNode(a,e[a],e[a+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(e,t){if(!e)return e;t=t||e;var i,r=e;do{if(i=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function earcutLinked(e,t,i,r,n,a,o){if(e){!o&&a&&indexCurve(e,r,n,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?isEarHashed(e,r,n,a):isEar(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),removeNode(e),c=e=l.next;else if((e=l)===c){o?1===o?earcutLinked(e=cureLocalIntersections(filterPoints(e),t,i),t,i,r,n,a,2):2===o&&splitEarcut(e,t,i,r,n,a):earcutLinked(filterPoints(e),t,i,r,n,a,1);break}}}function isEar(e){var t=e.prev,i=e,r=e.next;if(!(0<=area(t,i,r))){for(var n=e.next.next;n!==e.prev;){if(pointInTriangle(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=area(n.prev,n,n.next))return;n=n.next}return 1}}function isEarHashed(e,t,i,r){var n=e.prev,a=e,o=e.next;if(!(0<=area(n,a,o))){for(var s=a.x<n.x?o.x<n.x?n.x:o.x:o.x<a.x?a.x:o.x,l=a.y<n.y?o.y<n.y?n.y:o.y:o.y<a.y?a.y:o.y,c=zOrder(n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,t,i,r),h=zOrder(s,l,t,i,r),u=e.prevZ,d=e.nextZ;u&&c<=u.z&&d&&d.z<=h;){if(u!==e.prev&&u!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,u.x,u.y)&&0<=area(u.prev,u,u.next))return;if(u=u.prevZ,d!==e.prev&&d!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&0<=area(d.prev,d,d.next))return;d=d.nextZ}for(;u&&c<=u.z;){if(u!==e.prev&&u!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,u.x,u.y)&&0<=area(u.prev,u,u.next))return;u=u.prevZ}for(;d&&d.z<=h;){if(d!==e.prev&&d!==e.next&&pointInTriangle(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&0<=area(d.prev,d,d.next))return;d=d.nextZ}return 1}}function cureLocalIntersections(e,t,i){var r=e;do{var n=r.prev,a=r.next.next;!equals(n,a)&&intersects(n,r,r.next,a)&&locallyInside(n,a)&&locallyInside(a,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(a.i/i),removeNode(r),removeNode(r.next),r=e=a),r=r.next}while(r!==e);return filterPoints(r)}function splitEarcut(e,t,i,r,n,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&isValidDiagonal(o,s)){var l=splitPolygon(o,s);return o=filterPoints(o,o.next),l=filterPoints(l,l.next),earcutLinked(o,t,i,r,n,a),void earcutLinked(l,t,i,r,n,a)}s=s.next}o=o.next}while(o!==e)}function eliminateHoles(e,t,i,r){var n,a,o,s=[];for(n=0,a=t.length;n<a;n++)(o=linkedList(e,t[n]*r,n<a-1?t[n+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(getLeftmost(o));for(s.sort(compareX),n=0;n<s.length;n++)eliminateHole(s[n],i),i=filterPoints(i,i.next);return i}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t)){var i=splitPolygon(t,e);filterPoints(t,t.next),filterPoints(i,i.next)}}function findHoleBridge(e,t){var i,r=t,n=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&r.next.y<=a&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&o<s){if((o=s)===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===o)return i;var l,c=i,h=i.x,u=i.y,d=1/0;for(r=i;r.x<=n&&h<=r.x&&n!==r.x&&pointInTriangle(a<u?n:o,a,h,u,a<u?o:n,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(n-r.x),locallyInside(r,e)&&(l<d||l===d&&(i.x<r.x||r.x===i.x&&sectorContainsSector(i,r)))&&(i=r,d=l)),(r=r.next)!==c;);return i}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,i,r){for(var n=e;null===n.z&&(n.z=zOrder(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,(n=n.next)!==e;);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(e){var t,i,r,n,a,o,s,l,c=1;do{for(i=e,a=e=null,o=0;i;){for(o++,r=i,t=s=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;0<s||0<l&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(i=(n=i).nextZ,s--):(r=(n=r).nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,c*=2}while(1<o);return e}function zOrder(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){for(var t=e,i=e;(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),(t=t.next)!==e;);return i}function pointInTriangle(e,t,i,r,n,a,o,s){return 0<=(n-o)*(t-s)-(e-o)*(a-s)&&0<=(e-o)*(r-s)-(i-o)*(t-s)&&0<=(i-o)*(a-s)-(n-o)*(r-s)}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&0<area(e.prev,e,e.next)&&0<area(t.prev,t,t.next))}function area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,i,r){var n=sign(area(e,t,i)),a=sign(area(e,t,r)),o=sign(area(i,r,e)),s=sign(area(i,r,t));return n!==a&&o!==s||(0===n&&onSegment(e,i,t)||(0===a&&onSegment(e,r,t)||(0===o&&onSegment(i,e,r)||!(0!==s||!onSegment(i,t,r)))))}function onSegment(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function sign(e){return 0<e?1:e<0?-1:0}function intersectsPolygon(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&intersects(i,i.next,e,t))return 1;i=i.next}while(i!==e)}function locallyInside(e,t){return area(e.prev,e,e.next)<0?0<=area(e,t,e.next)&&0<=area(e,e.prev,t):area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){for(var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;a<i.y!=a<i.next.y&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==e;);return r}function splitPolygon(e,t){var i=new Node(e.i,e.x,e.y),r=new Node(t.i,t.x,t.y),n=e.next,a=t.prev;return(e.next=t).prev=e,(a.next=(r.next=(i.next=n).prev=i).prev=r).prev=a,r}function insertNode(e,t,i,r){var n=new Node(e,t,i);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,i,r){for(var n=0,a=t,o=i-r;a<i;a+=r)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}var ShapeUtils={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},isClockWise:function(e){return ShapeUtils.area(e)<0},triangulateShape:function(e,t){var i=[],r=[],n=[];removeDupEndPts(e),addContour(i,e);var a=e.length;t.forEach(removeDupEndPts);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,addContour(i,t[o]);for(var s=Earcut.triangulate(i,r),l=0;l<s.length;l+=3)n.push(s.slice(l,l+3));return n}};function removeDupEndPts(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var ExtrudeGeometry=function(){_inherits(n,Geometry);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=r.call(this)).type="ExtrudeGeometry",i.parameters={shapes:e,options:t},i.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),i.mergeVertices(),i}return _createClass(n,[{key:"toJSON",value:function(){var e=_get(_getPrototypeOf(n.prototype),"toJSON",this).call(this);return _toJSON(this.parameters.shapes,this.parameters.options,e)}}]),n}(),ExtrudeBufferGeometry=function(){_inherits(o,BufferGeometry);var a=_createSuper(o);function o(e,Pe){var t;_classCallCheck(this,o),(t=a.call(this)).type="ExtrudeBufferGeometry",t.parameters={shapes:e,options:Pe},e=Array.isArray(e)?e:[e];for(var De=_assertThisInitialized(t),ke=[],Be=[],i=0,r=e.length;i<r;i++){n(e[i])}function n(e){var r=[],t=void 0!==Pe.curveSegments?Pe.curveSegments:12,u=void 0!==Pe.steps?Pe.steps:1,i=void 0!==Pe.depth?Pe.depth:100,d=void 0===Pe.bevelEnabled||Pe.bevelEnabled,n=void 0!==Pe.bevelThickness?Pe.bevelThickness:6,a=void 0!==Pe.bevelSize?Pe.bevelSize:n-2,o=void 0!==Pe.bevelOffset?Pe.bevelOffset:0,p=void 0!==Pe.bevelSegments?Pe.bevelSegments:3,s=Pe.extrudePath,l=void 0!==Pe.UVGenerator?Pe.UVGenerator:WorldUVGenerator;void 0!==Pe.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),i=Pe.amount);var c,h,m,f,g,v=!1;s&&(c=s.getSpacedPoints(u),h=s.computeFrenetFrames(u,d=!(v=!0)),m=new Vector3,f=new Vector3,g=new Vector3),d||(o=a=n=p=0);var y=e.extractPoints(t),x=y.shape,_=y.holes;if(!ShapeUtils.isClockWise(x)){x=x.reverse();for(var b=0,w=_.length;b<w;b++){var M=_[b];ShapeUtils.isClockWise(M)&&(_[b]=M.reverse())}}for(var S=ShapeUtils.triangulateShape(x,_),T=x,A=0,E=_.length;A<E;A++){x=x.concat(_[A])}function C(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var L=x.length,R=S.length;function P(e,t,i){var r,n,a,o=e.x-t.x,s=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=o*o+s*s;if(Math.abs(o*c-s*l)>Number.EPSILON){var u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=t.x-s/u,m=t.y+o/u,f=((i.x-c/d-p)*c-(i.y+l/d-m)*l)/(o*c-s*l),g=(r=p+o*f-e.x)*r+(n=m+s*f-e.y)*n;if(g<=2)return new Vector2(r,n);a=Math.sqrt(g/2)}else{var v=!1;o>Number.EPSILON?l>Number.EPSILON&&(v=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(v=!0):Math.sign(s)===Math.sign(c)&&(v=!0),a=v?(r=-s,n=o,Math.sqrt(h)):(r=o,n=s,Math.sqrt(h/2))}return new Vector2(r/a,n/a)}for(var D=[],k=0,B=T.length,F=B-1,I=k+1;k<B;k++,F++,I++)F===B&&(F=0),I===B&&(I=0),D[k]=P(T[k],T[F],T[I]);for(var O,V=[],U=D.concat(),G=0,N=_.length;G<N;G++){var z=_[G];O=[];for(var H=0,j=z.length,W=j-1,q=H+1;H<j;H++,W++,q++)W===j&&(W=0),q===j&&(q=0),O[H]=P(z[H],z[W],z[q]);V.push(O),U=U.concat(O)}for(var $=0;$<p;$++){for(var X=$/p,Y=n*Math.cos(X*Math.PI/2),Z=a*Math.sin(X*Math.PI/2)+o,Q=0,K=T.length;Q<K;Q++){var J=C(T[Q],D[Q],Z);Ae(J.x,J.y,-Y)}for(var ee=0,te=_.length;ee<te;ee++){var ie=_[ee];O=V[ee];for(var re=0,ne=ie.length;re<ne;re++){var ae=C(ie[re],O[re],Z);Ae(ae.x,ae.y,-Y)}}}for(var oe=a+o,se=0;se<L;se++){var le=d?C(x[se],U[se],oe):x[se];v?(f.copy(h.normals[0]).multiplyScalar(le.x),m.copy(h.binormals[0]).multiplyScalar(le.y),g.copy(c[0]).add(f).add(m),Ae(g.x,g.y,g.z)):Ae(le.x,le.y,0)}for(var ce=1;ce<=u;ce++)for(var he=0;he<L;he++){var ue=d?C(x[he],U[he],oe):x[he];v?(f.copy(h.normals[ce]).multiplyScalar(ue.x),m.copy(h.binormals[ce]).multiplyScalar(ue.y),g.copy(c[ce]).add(f).add(m),Ae(g.x,g.y,g.z)):Ae(ue.x,ue.y,i/u*ce)}for(var de=p-1;0<=de;de--){for(var pe=de/p,me=n*Math.cos(pe*Math.PI/2),fe=a*Math.sin(pe*Math.PI/2)+o,ge=0,ve=T.length;ge<ve;ge++){var ye=C(T[ge],D[ge],fe);Ae(ye.x,ye.y,i+me)}for(var xe=0,_e=_.length;xe<_e;xe++){var be=_[xe];O=V[xe];for(var we=0,Me=be.length;we<Me;we++){var Se=C(be[we],O[we],fe);v?Ae(Se.x,Se.y+c[u-1].y,c[u-1].x+me):Ae(Se.x,Se.y,i+me)}}}function Te(e,t){for(var i=e.length;0<=--i;){var r=i,n=i-1;n<0&&(n=e.length-1);for(var a=0,o=u+2*p;a<o;a++){var s=L*a,l=L*(a+1);Ce(t+r+s,t+n+s,t+n+l,t+r+l)}}}function Ae(e,t,i){r.push(e),r.push(t),r.push(i)}function Ee(e,t,i){Le(e),Le(t),Le(i);var r=ke.length/3,n=l.generateTopUV(De,ke,r-3,r-2,r-1);Re(n[0]),Re(n[1]),Re(n[2])}function Ce(e,t,i,r){Le(e),Le(t),Le(r),Le(t),Le(i),Le(r);var n=ke.length/3,a=l.generateSideWallUV(De,ke,n-6,n-3,n-2,n-1);Re(a[0]),Re(a[1]),Re(a[3]),Re(a[1]),Re(a[2]),Re(a[3])}function Le(e){ke.push(r[3*e+0]),ke.push(r[3*e+1]),ke.push(r[3*e+2])}function Re(e){Be.push(e.x),Be.push(e.y)}!function(){var e=ke.length/3;if(d){for(var t=0,i=L*t,r=0;r<R;r++){var n=S[r];Ee(n[2]+i,n[1]+i,n[0]+i)}i=L*(t=u+2*p);for(var a=0;a<R;a++){var o=S[a];Ee(o[0]+i,o[1]+i,o[2]+i)}}else{for(var s=0;s<R;s++){var l=S[s];Ee(l[2],l[1],l[0])}for(var c=0;c<R;c++){var h=S[c];Ee(h[0]+L*u,h[1]+L*u,h[2]+L*u)}}De.addGroup(e,ke.length/3-e,0)}(),function(){var e=ke.length/3,t=0;Te(T,t),t+=T.length;for(var i=0,r=_.length;i<r;i++){var n=_[i];Te(n,t),t+=n.length}De.addGroup(e,ke.length/3-e,1)}()}return t.setAttribute("position",new Float32BufferAttribute(ke,3)),t.setAttribute("uv",new Float32BufferAttribute(Be,2)),t.computeVertexNormals(),t}return _createClass(o,[{key:"toJSON",value:function(){var e=BufferGeometry.prototype.toJSON.call(this);return _toJSON(this.parameters.shapes,this.parameters.options,e)}}]),o}(),WorldUVGenerator={generateTopUV:function(e,t,i,r,n){var a=t[3*r],o=t[3*r+1],s=t[3*n],l=t[3*n+1];return[new Vector2(t[3*i],t[3*i+1]),new Vector2(a,o),new Vector2(s,l)]},generateSideWallUV:function(e,t,i,r,n,a){var o=t[3*i],s=t[3*i+1],l=t[3*i+2],c=t[3*r],h=t[3*r+1],u=t[3*r+2],d=t[3*n],p=t[3*n+1],m=t[3*n+2],f=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-h)<.01?[new Vector2(o,1-l),new Vector2(c,1-u),new Vector2(d,1-m),new Vector2(f,1-v)]:[new Vector2(s,1-l),new Vector2(h,1-u),new Vector2(p,1-m),new Vector2(g,1-v)]}};function _toJSON(e,t,i){if(i.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){i.shapes.push(e[r].uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}var TextGeometry=function(){_inherits(n,Geometry);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=r.call(this)).type="TextGeometry",i.parameters={text:e,parameters:t},i.fromBufferGeometry(new TextBufferGeometry(e,t)),i.mergeVertices(),i}return n}(),TextBufferGeometry=function(){_inherits(o,ExtrudeBufferGeometry);var a=_createSuper(o);function o(e,t){var i;_classCallCheck(this,o);var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),_possibleConstructorReturn(i,new Geometry);var n=r.generateShapes(e,t.size);return t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),(i=a.call(this,n,t)).type="TextBufferGeometry",i}return o}(),SphereGeometry=function(){_inherits(c,Geometry);var l=_createSuper(c);function c(e,t,i,r,n,a,o){var s;return _classCallCheck(this,c),(s=l.call(this)).type="SphereGeometry",s.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o},s.fromBufferGeometry(new SphereBufferGeometry(e,t,i,r,n,a,o)),s.mergeVertices(),s}return c}(),SphereBufferGeometry=function(){_inherits(L,BufferGeometry);var C=_createSuper(L);function L(e,t,i,r,n,a,o){var s;_classCallCheck(this,L),(s=C.call(this)).type="SphereBufferGeometry",s.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;for(var l=Math.min(a+o,Math.PI),c=0,h=[],u=new Vector3,d=new Vector3,p=[],m=[],f=[],g=[],v=0;v<=i;v++){var y=[],x=v/i,_=0;0==v&&0==a?_=.5/t:v==i&&l==Math.PI&&(_=-.5/t);for(var b=0;b<=t;b++){var w=b/t;u.x=-e*Math.cos(r+w*n)*Math.sin(a+x*o),u.y=e*Math.cos(a+x*o),u.z=e*Math.sin(r+w*n)*Math.sin(a+x*o),m.push(u.x,u.y,u.z),d.copy(u).normalize(),f.push(d.x,d.y,d.z),g.push(w+_,1-x),y.push(c++)}h.push(y)}for(var M=0;M<i;M++)for(var S=0;S<t;S++){var T=h[M][S],A=h[M+1][S],E=h[M+1][S+1];(0!==M||0<a)&&p.push(h[M][S+1],T,E),(M!==i-1||l<Math.PI)&&p.push(T,A,E)}return s.setIndex(p),s.setAttribute("position",new Float32BufferAttribute(m,3)),s.setAttribute("normal",new Float32BufferAttribute(f,3)),s.setAttribute("uv",new Float32BufferAttribute(g,2)),s}return L}(),RingGeometry=function(){_inherits(l,Geometry);var s=_createSuper(l);function l(e,t,i,r,n,a){var o;return _classCallCheck(this,l),(o=s.call(this)).type="RingGeometry",o.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a},o.fromBufferGeometry(new RingBufferGeometry(e,t,i,r,n,a)),o.mergeVertices(),o}return l}(),RingBufferGeometry=function(){_inherits(A,BufferGeometry);var T=_createSuper(A);function A(e,t,i,r,n,a){var o;_classCallCheck(this,A),(o=T.call(this)).type="RingBufferGeometry",o.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a},e=e||.5,t=t||1,n=void 0!==n?n:0,a=void 0!==a?a:2*Math.PI,i=void 0!==i?Math.max(3,i):8;for(var s=[],l=[],c=[],h=[],u=e,d=(t-e)/(r=void 0!==r?Math.max(1,r):1),p=new Vector3,m=new Vector2,f=0;f<=r;f++){for(var g=0;g<=i;g++){var v=n+g/i*a;p.x=u*Math.cos(v),p.y=u*Math.sin(v),l.push(p.x,p.y,p.z),c.push(0,0,1),m.x=(p.x/t+1)/2,m.y=(p.y/t+1)/2,h.push(m.x,m.y)}u+=d}for(var y=0;y<r;y++)for(var x=y*(i+1),_=0;_<i;_++){var b=_+x,w=b+i+1,M=b+i+2,S=b+1;s.push(b,w,S),s.push(w,M,S)}return o.setIndex(s),o.setAttribute("position",new Float32BufferAttribute(l,3)),o.setAttribute("normal",new Float32BufferAttribute(c,3)),o.setAttribute("uv",new Float32BufferAttribute(h,2)),o}return A}(),LatheGeometry=function(){_inherits(o,Geometry);var a=_createSuper(o);function o(e,t,i,r){var n;return _classCallCheck(this,o),(n=a.call(this)).type="LatheGeometry",n.parameters={points:e,segments:t,phiStart:i,phiLength:r},n.fromBufferGeometry(new LatheBufferGeometry(e,t,i,r)),n.mergeVertices(),n}return o}(),LatheBufferGeometry=function(){_inherits(R,BufferGeometry);var L=_createSuper(R);function R(e,t,i,r){var n;_classCallCheck(this,R),(n=L.call(this)).type="LatheBufferGeometry",n.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t)||12,i=i||0,r=r||2*Math.PI,r=MathUtils.clamp(r,0,2*Math.PI);for(var a=[],o=[],s=[],l=1/t,c=new Vector3,h=new Vector2,u=0;u<=t;u++)for(var d=i+u*l*r,p=Math.sin(d),m=Math.cos(d),f=0;f<=e.length-1;f++)c.x=e[f].x*p,c.y=e[f].y,c.z=e[f].x*m,o.push(c.x,c.y,c.z),h.x=u/t,h.y=f/(e.length-1),s.push(h.x,h.y);for(var g=0;g<t;g++)for(var v=0;v<e.length-1;v++){var y=v+g*e.length,x=y+e.length,_=y+e.length+1,b=y+1;a.push(y,x,b),a.push(x,_,b)}if(n.setIndex(a),n.setAttribute("position",new Float32BufferAttribute(o,3)),n.setAttribute("uv",new Float32BufferAttribute(s,2)),n.computeVertexNormals(),r===2*Math.PI)for(var w=n.attributes.normal.array,M=new Vector3,S=new Vector3,T=new Vector3,A=t*e.length*3,E=0,C=0;E<e.length;E++,C+=3)M.x=w[C+0],M.y=w[C+1],M.z=w[C+2],S.x=w[A+C+0],S.y=w[A+C+1],S.z=w[A+C+2],T.addVectors(M,S).normalize(),w[C+0]=w[A+C+0]=T.x,w[C+1]=w[A+C+1]=T.y,w[C+2]=w[A+C+2]=T.z;return n}return R}(),ShapeGeometry=function(){_inherits(n,Geometry);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=r.call(this)).type="ShapeGeometry","object"===_typeof(t)&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),i.parameters={shapes:e,curveSegments:t},i.fromBufferGeometry(new ShapeBufferGeometry(e,t)),i.mergeVertices(),i}return _createClass(n,[{key:"toJSON",value:function(){var e=Geometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,e)}}]),n}(),ShapeBufferGeometry=function(){_inherits(o,BufferGeometry);var a=_createSuper(o);function o(e,v){var t;_classCallCheck(this,o),(t=a.call(this)).type="ShapeBufferGeometry",t.parameters={shapes:e,curveSegments:v},v=v||12;var y=[],x=[],_=[],b=[],i=0,w=0;if(!1===Array.isArray(e))n(e);else for(var r=0;r<e.length;r++)n(e[r]),t.addGroup(i,w,r),i+=w,w=0;function n(e){var t=x.length/3,i=e.extractPoints(v),r=i.shape,n=i.holes;!1===ShapeUtils.isClockWise(r)&&(r=r.reverse());for(var a=0,o=n.length;a<o;a++){var s=n[a];!0===ShapeUtils.isClockWise(s)&&(n[a]=s.reverse())}for(var l=ShapeUtils.triangulateShape(r,n),c=0,h=n.length;c<h;c++){r=r.concat(n[c])}for(var u=0,d=r.length;u<d;u++){var p=r[u];x.push(p.x,p.y,0),_.push(0,0,1),b.push(p.x,p.y)}for(var m=0,f=l.length;m<f;m++){var g=l[m];y.push(g[0]+t,g[1]+t,g[2]+t),w+=3}}return t.setIndex(y),t.setAttribute("position",new Float32BufferAttribute(x,3)),t.setAttribute("normal",new Float32BufferAttribute(_,3)),t.setAttribute("uv",new Float32BufferAttribute(b,2)),t}return _createClass(o,[{key:"toJSON",value:function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,e)}}]),o}();function toJSON$1(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){t.shapes.push(e[i].uuid)}else t.shapes.push(e.uuid);return t}var EdgesGeometry=function(){_inherits(b,BufferGeometry);var _=_createSuper(b);function b(e,t){var i;_classCallCheck(this,b),(i=_.call(this)).type="EdgesGeometry",i.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,n,a,o,s=[],l=Math.cos(MathUtils.DEG2RAD*t),c=[0,0],h={},u=["a","b","c"];e.isBufferGeometry?(o=new Geometry).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var d=o.vertices,p=o.faces,m=0,f=p.length;m<f;m++)for(var g=p[m],v=0;v<3;v++)r=g[u[v]],n=g[u[(v+1)%3]],c[0]=Math.min(r,n),c[1]=Math.max(r,n),void 0===h[a=c[0]+","+c[1]]?h[a]={index1:c[0],index2:c[1],face1:m,face2:void 0}:h[a].face2=m;for(a in h){var y=h[a];if(void 0===y.face2||p[y.face1].normal.dot(p[y.face2].normal)<=l){var x=d[y.index1];s.push(x.x,x.y,x.z),s.push((x=d[y.index2]).x,x.y,x.z)}}return i.setAttribute("position",new Float32BufferAttribute(s,3)),i}return b}(),CylinderGeometry=function(){_inherits(h,Geometry);var c=_createSuper(h);function h(e,t,i,r,n,a,o,s){var l;return _classCallCheck(this,h),(l=c.call(this)).type="CylinderGeometry",l.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s},l.fromBufferGeometry(new CylinderBufferGeometry(e,t,i,r,n,a,o,s)),l.mergeVertices(),l}return h}(),CylinderBufferGeometry=function(){_inherits(n,BufferGeometry);var r=_createSuper(n);function n(y,x,_,b,w,e,M,S){var t;_classCallCheck(this,n),(t=r.call(this)).type="CylinderBufferGeometry",t.parameters={radiusTop:y,radiusBottom:x,height:_,radialSegments:b,heightSegments:w,openEnded:e,thetaStart:M,thetaLength:S};var T=_assertThisInitialized(t);y=void 0!==y?y:1,x=void 0!==x?x:1,_=_||1,b=Math.floor(b)||8,w=Math.floor(w)||1,e=void 0!==e&&e,M=void 0!==M?M:0,S=void 0!==S?S:2*Math.PI;var A=[],E=[],C=[],L=[],R=0,P=[],D=_/2,k=0;function i(e){for(var t=R,i=new Vector2,r=new Vector3,n=0,a=!0===e?y:x,o=!0===e?1:-1,s=1;s<=b;s++)E.push(0,D*o,0),C.push(0,o,0),L.push(.5,.5),R++;for(var l=R,c=0;c<=b;c++){var h=c/b*S+M,u=Math.cos(h),d=Math.sin(h);r.x=a*d,r.y=D*o,r.z=a*u,E.push(r.x,r.y,r.z),C.push(0,o,0),i.x=.5*u+.5,i.y=.5*d*o+.5,L.push(i.x,i.y),R++}for(var p=0;p<b;p++){var m=t+p,f=l+p;!0===e?A.push(f,f+1,m):A.push(f+1,f,m),n+=3}T.addGroup(k,n,!0===e?1:2),k+=n}return function(){for(var e=new Vector3,t=new Vector3,i=0,r=(x-y)/_,n=0;n<=w;n++){for(var a=[],o=n/w,s=o*(x-y)+y,l=0;l<=b;l++){var c=l/b,h=c*S+M,u=Math.sin(h),d=Math.cos(h);t.x=s*u,t.y=-o*_+D,t.z=s*d,E.push(t.x,t.y,t.z),e.set(u,r,d).normalize(),C.push(e.x,e.y,e.z),L.push(c,1-o),a.push(R++)}P.push(a)}for(var p=0;p<b;p++)for(var m=0;m<w;m++){var f=P[m+1][p],g=P[m+1][p+1],v=P[m][p+1];A.push(P[m][p],f,v),A.push(f,g,v),i+=6}T.addGroup(k,i,0),k+=i}(),!1===e&&(0<y&&i(!0),0<x&&i(!1)),t.setIndex(A),t.setAttribute("position",new Float32BufferAttribute(E,3)),t.setAttribute("normal",new Float32BufferAttribute(C,3)),t.setAttribute("uv",new Float32BufferAttribute(L,2)),t}return n}(),ConeGeometry=function(){_inherits(c,CylinderGeometry);var l=_createSuper(c);function c(e,t,i,r,n,a,o){var s;return _classCallCheck(this,c),(s=l.call(this,0,e,t,i,r,n,a,o)).type="ConeGeometry",s.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o},s}return c}(),ConeBufferGeometry=function(){_inherits(c,CylinderBufferGeometry);var l=_createSuper(c);function c(e,t,i,r,n,a,o){var s;return _classCallCheck(this,c),(s=l.call(this,0,e,t,i,r,n,a,o)).type="ConeBufferGeometry",s.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:a,thetaLength:o},s}return c}(),CircleGeometry=function(){_inherits(o,Geometry);var a=_createSuper(o);function o(e,t,i,r){var n;return _classCallCheck(this,o),(n=a.call(this)).type="CircleGeometry",n.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},n.fromBufferGeometry(new CircleBufferGeometry(e,t,i,r)),n.mergeVertices(),n}return o}(),CircleBufferGeometry=function(){_inherits(g,BufferGeometry);var f=_createSuper(g);function g(e,t,i,r){var n;_classCallCheck(this,g),(n=f.call(this)).type="CircleBufferGeometry",n.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var a=[],o=[],s=[],l=[],c=new Vector3,h=new Vector2;o.push(0,0,0),s.push(0,0,1),l.push(.5,.5);for(var u=0,d=3;u<=t;u++,d+=3){var p=i+u/t*r;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),s.push(0,0,1),h.x=(o[d]/e+1)/2,h.y=(o[d+1]/e+1)/2,l.push(h.x,h.y)}for(var m=1;m<=t;m++)a.push(m,m+1,0);return n.setIndex(a),n.setAttribute("position",new Float32BufferAttribute(o,3)),n.setAttribute("normal",new Float32BufferAttribute(s,3)),n.setAttribute("uv",new Float32BufferAttribute(l,2)),n}return g}(),Geometries=Object.freeze({__proto__:null,WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});function ShadowMaterial(e){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}function MeshStandardMaterial(e){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function MeshPhongMaterial(e){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshToonMaterial(e){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshNormalMaterial(e){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshLambertMaterial(e){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshMatcapMaterial(e){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,this.sheen=e.sheen?(this.sheen||new Color).copy(e.sheen):null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshToonMaterial.prototype=Object.create(Material.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(e){return Material.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(e){return LineBasicMaterial.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Materials=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),AnimationUtils={arraySlice:function(e,t,i){return AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(i){for(var e=i.length,t=new Array(e),r=0;r!==e;++r)t[r]=r;return t.sort(function(e,t){return i[e]-i[t]}),t},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=i[a]*t,l=0;l!==t;++l)n[o++]=e[s+l];return n},flattenJSON:function(e,t,i,r){for(var n=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[n++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))for(;void 0!==(o=a[r])&&(t.push(a.time),i.push.apply(i,o)),void 0!==(a=e[n++]););else if(void 0!==o.toArray)for(;void 0!==(o=a[r])&&(t.push(a.time),o.toArray(i,i.length)),void 0!==(a=e[n++]););else for(;void 0!==(o=a[r])&&(t.push(a.time),i.push(o)),void 0!==(a=e[n++]););}},subclip:function(e,t,i,r,n){n=n||30;var a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var l=a.tracks[s],c=l.getValueSize(),h=[],u=[],d=0;d<l.times.length;++d){var p=l.times[d]*n;if(!(p<i||r<=p)){h.push(l.times[d]);for(var m=0;m<c;++m)u.push(l.values[d*c+m])}}0!==h.length&&(l.times=AnimationUtils.convertArray(h,l.times.constructor),l.values=AnimationUtils.convertArray(u,l.values.constructor),o.push(l))}a.tracks=o;for(var f=1/0,g=0;g<a.tracks.length;++g)a.tracks[g].times[0]<f&&(f=a.tracks[g].times[0]);for(var v=0;v<a.tracks.length;++v)a.tracks[v].shift(-1*f);return a.resetDuration(),a},makeClipAdditive:function(x,e,_,t){void 0===e&&(e=0),void 0===_&&(_=x),(void 0===t||t<=0)&&(t=30);for(var i=x.tracks.length,b=e/t,r=function(e){var t=_.tracks[e],i=t.ValueTypeName;if("bool"===i||"string"===i)return"continue";var r=x.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===i});if(void 0===r)return"continue";var n=0,a=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(n=a/3);var o=0,s=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=s/3);var l=t.times.length-1,c=void 0;if(b<=t.times[0])c=AnimationUtils.arraySlice(t.values,n,a-n);else if(t.times[l]<=b){var h=l*a+n;c=AnimationUtils.arraySlice(t.values,h,h+a-n)}else{var u=t.createInterpolant(),d=n,p=a-n;u.evaluate(b),c=AnimationUtils.arraySlice(u.resultBuffer,d,p)}"quaternion"===i&&(new Quaternion).fromArray(c).normalize().conjugate().toArray(c);for(var m=r.times.length,f=0;f<m;++f){var g=f*s+o;if("quaternion"===i)Quaternion.multiplyQuaternionsFlat(r.values,g,c,0,r.values,g);else for(var v=s-2*o,y=0;y<v;++y)r.values[g+y]-=c[y]}},n=0;n<i;++n)r(n);return x.blendMode=AdditiveAnimationBlendMode,x}};function Interpolant(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function CubicInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function DiscreteInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function KeyframeTrack(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function BooleanKeyframeTrack(e,t,i){KeyframeTrack.call(this,e,t,i)}function ColorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function NumberKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function QuaternionLinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function QuaternionKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function StringKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function VectorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function AnimationClip(e,t,i,r){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==r?r:NormalAnimationBlendMode,this.uuid=MathUtils.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var i=[],r=[];AnimationUtils.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Interpolant.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var a;i:{r:if(!(e<r)){for(var o=i+2;;){if(void 0===r){if(e<n)break r;return this._cachedIndex=i=t.length,this.afterEnd_(i-1,e,n)}if(i===o)break;if(n=r,e<(r=t[++i]))break t}a=t.length;break i}if(n<=e)break e;var s=t[1];e<s&&(i=2,n=s);for(var l=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===l)break;if(r=n,(n=t[--i-1])<=e)break t}a=i,i=0}for(;i<a;){var c=i+a>>>1;e<t[c]?a=c:i=1+c}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return this._cachedIndex=i=t.length,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,a=0;a!==r;++a)t[a]=i[n+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,a=e+1,o=r[n],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:n=e,o=2*t-i;break;case WrapAroundEnding:o=t+r[n=r.length-2]-r[n+1];break;default:n=e,o=i}if(void 0===s)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:a=e,s=2*i-t;break;case WrapAroundEnding:s=i+r[a=1]-r[0];break;default:a=e-1,s=t}var l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-i),this._offsetPrev=n*c,this._offsetNext=a*c},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,y=(-1-d)*f+(1.5+d)*m+.5*p,x=d*f-d*m,_=0;_!==o;++_)n[_]=g*a[c+_]+v*a[l+_]+y*a[s+_]+x*a[h+_];return n}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(i-t)/(r-t),h=1-c,u=0;u!==o;++u)n[u]=a[l+u]*h+a[s+u]*c;return n}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(KeyframeTrack,{toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:AnimationUtils.convertArray(e.times,Array),values:AnimationUtils.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,a=r-1;n!==r&&i[n]<e;)++n;for(;-1!==a&&t<i[a];)--a;if(++a,0!==n||a!==r){a<=n&&(n=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=AnimationUtils.arraySlice(i,n,a),this.values=AnimationUtils.arraySlice(this.values,n*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==n;o++){var s=i[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&s<a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&AnimationUtils.isTypedArray(r))for(var l=0,c=r.length;l!==c;++l){var h=r[l];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,h),e=!1;break}}return e},optimize:function(){for(var e=AnimationUtils.arraySlice(this.times),t=AnimationUtils.arraySlice(this.values),i=this.getValueSize(),r=this.getInterpolation()===InterpolateSmooth,n=e.length-1,a=1,o=1;o<n;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==l[0]))if(r)s=!0;else for(var c=o*i,h=c-i,u=c+i,d=0;d!==i;++d){var p=t[c+d];if(p!==t[h+d]||p!==t[u+d]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var m=o*i,f=a*i,g=0;g!==i;++g)t[f+g]=t[m+g]}++a}}if(0<n){e[a]=e[n];for(var v=n*i,y=a*i,x=0;x!==i;++x)t[y+x]=t[v+x];++a}return a!==e.length?(this.times=AnimationUtils.arraySlice(e,0,a),this.values=AnimationUtils.arraySlice(t,0,a*i)):(this.times=e,this.values=t),this},clone:function(){var e=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0),i=new this.constructor(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(i-t)/(r-t),l=e*o,c=l+o;l!==c;l+=4)Quaternion.slerpFlat(n,0,a,l-o,a,l,s);return n}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,a=i.length;n!==a;++n)t.push(parseKeyframeTrack(i[n]).scale(r));return new AnimationClip(e.name,e.duration,t,e.blendMode)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},n=0,a=i.length;n!==a;++n)t.push(KeyframeTrack.toJSON(i[n]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,a=[],o=0;o<n;o++){var s=[],l=[];s.push((o+n-1)%n,o,(o+1)%n),l.push(0,1,0);var c=AnimationUtils.getKeyframeOrder(s);s=AnimationUtils.sortedArray(s,1,c),l=AnimationUtils.sortedArray(l,1,c),r||0!==s[0]||(s.push(n),l.push(l[0])),a.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/i))}return new AnimationClip(e,-1,a)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){i=e.geometry&&e.geometry.animations||e.animations}for(var r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(n);if(l&&1<l.length){var c=l[1],h=r[c];h||(r[c]=h=[]),h.push(s)}}var u=[];for(var d in r)u.push(AnimationClip.CreateFromMorphTargetSequence(d,r[d],t,i));return u},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,r,n){if(0!==i.length){var a=[],o=[];AnimationUtils.flattenJSON(i,a,o,r),0!==a.length&&n.push(new e(t,a,o))}},r=[],n=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],c=0;c<l.length;c++){var h=l[c].keys;if(h&&0!==h.length)if(h[0].morphTargets){var u={},d=void 0;for(d=0;d<h.length;d++)if(h[d].morphTargets)for(var p=0;p<h[d].morphTargets.length;p++)u[h[d].morphTargets[p]]=-1;for(var m in u){for(var f=[],g=[],v=0;v!==h[d].morphTargets.length;++v){var y=h[d];f.push(y.time),g.push(y.morphTarget===m?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+m+"]",f,g))}s=u.length*(a||1)}else{var x=".bones["+t[c].name+"]";i(VectorKeyframeTrack,x+".position",h,"pos",r),i(QuaternionKeyframeTrack,x+".quaternion",h,"rot",r),i(VectorKeyframeTrack,x+".scale",h,"scl",r)}}return 0===r.length?null:new AnimationClip(n,s,r,o)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new AnimationClip(this.name,this.duration,e,this.blendMode)}});var Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function LoadingManager(e,t,i){var r=this,n=!1,a=0,o=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===n&&void 0!==r.onStart&&r.onStart(e,a,o),n=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,i=l.length;t<i;t+=2){var r=l[t],n=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return n}return null}}var DefaultLoadingManager=new LoadingManager;function Loader(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Loader.prototype,{load:function(){},loadAsync:function(i,r){var n=this;return new Promise(function(e,t){n.load(i,e,r,t)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var loading={};function FileLoader(e){Loader.call(this,e)}function AnimationLoader(e){Loader.call(this,e)}function CompressedTextureLoader(e){Loader.call(this,e)}function ImageLoader(e){Loader.call(this,e)}function CubeTextureLoader(e){Loader.call(this,e)}function DataTextureLoader(e){Loader.call(this,e)}function TextureLoader(e){Loader.call(this,e)}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(e,t,i,r,n,a,o,s){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function ArcCurve(e,t,i,r,n,a){EllipseCurve.call(this,e,t,i,i,r,n,a),this.type="ArcCurve"}function CubicPoly(){var n=0,a=0,o=0,s=0;function c(e,t,i,r){o=-3*(n=e)+3*t-2*(a=i)-r,s=2*e-2*t+i+r}return{initCatmullRom:function(e,t,i,r,n){c(t,i,n*(i-e),n*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,n,a,o){var s=(t-e)/n-(i-e)/(n+a)+(i-t)/a,l=(i-t)/a-(r-t)/(a+o)+(r-i)/o;c(t,i,s*=a,l*=a)},calc:function(e){var t=e*e;return n+a*e+o*t+s*(t*e)}}}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(c,e,t,i){void 0===c&&(c=""),void 0!==this.path&&(c=this.path+c),c=this.manager.resolveURL(c);var h=this,r=Cache.get(c);if(void 0!==r)return h.manager.itemStart(c),setTimeout(function(){e&&e(r),h.manager.itemEnd(c)},0),r;if(void 0===loading[c]){var n,a=c.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var o=a[1],s=!!a[2],l=a[3];l=decodeURIComponent(l),s&&(l=atob(l));try{var u,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var p=new Uint8Array(l.length),m=0;m<l.length;m++)p[m]=l.charCodeAt(m);u="blob"===d?new Blob([p.buffer],{type:o}):p.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(l,o);break;case"json":u=JSON.parse(l);break;default:u=l}setTimeout(function(){e&&e(u),h.manager.itemEnd(c)},0)}catch(e){setTimeout(function(){i&&i(e),h.manager.itemError(c),h.manager.itemEnd(c)},0)}}else{for(var g in loading[c]=[],loading[c].push({onLoad:e,onProgress:t,onError:i}),(n=new XMLHttpRequest).open("GET",c,!0),n.addEventListener("load",function(e){var t=this.response,i=loading[c];if(delete loading[c],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(c,t);for(var r=0,n=i.length;r<n;r++){var a=i[r];a.onLoad&&a.onLoad(t)}h.manager.itemEnd(c)}else{for(var o=0,s=i.length;o<s;o++){var l=i[o];l.onError&&l.onError(e)}h.manager.itemError(c),h.manager.itemEnd(c)}},!1),n.addEventListener("progress",function(e){for(var t=loading[c],i=0,r=t.length;i<r;i++){var n=t[i];n.onProgress&&n.onProgress(e)}},!1),n.addEventListener("error",function(e){var t=loading[c];delete loading[c];for(var i=0,r=t.length;i<r;i++){var n=t[i];n.onError&&n.onError(e)}h.manager.itemError(c),h.manager.itemEnd(c)},!1),n.addEventListener("abort",function(e){var t=loading[c];delete loading[c];for(var i=0,r=t.length;i<r;i++){var n=t[i];n.onError&&n.onError(e)}h.manager.itemError(c),h.manager.itemEnd(c)},!1),void 0!==this.responseType&&(n.responseType=this.responseType),void 0!==this.withCredentials&&(n.withCredentials=this.withCredentials),n.overrideMimeType&&n.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)n.setRequestHeader(g,this.requestHeader[g]);n.send(null)}return h.manager.itemStart(c),n}loading[c].push({onLoad:e,onProgress:t,onError:i})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}}),AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(t,i,e,r){var n=this,a=new FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.load(t,function(e){try{i(n.parse(JSON.parse(e)))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}},e,r)},parse:function(e){for(var t=[],i=0;i<e.length;i++){var r=AnimationClip.parse(e[i]);t.push(r)}return t}}),CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(e,a,t,r){var o=this,s=[],l=new CompressedTexture;l.image=s;var n=new FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader);var c=0;function i(i){n.load(e[i],function(e){var t=o.parse(e,!0);s[i]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},6===(c+=1)&&(1===t.mipmapCount&&(l.minFilter=LinearFilter),l.format=t.format,l.needsUpdate=!0,a&&a(l))},t,r)}if(Array.isArray(e))for(var h=0,u=e.length;h<u;++h)i(h);else n.load(e,function(e){var t=o.parse(e,!0);if(t.isCubemap)for(var i=t.mipmaps.length/t.mipmapCount,r=0;r<i;r++){s[r]={mipmaps:[]};for(var n=0;n<t.mipmapCount;n++)s[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+n]),s[r].format=t.format,s[r].width=t.width,s[r].height=t.height}else l.image.width=t.width,l.image.height=t.height,l.mipmaps=t.mipmaps;1===t.mipmapCount&&(l.minFilter=LinearFilter),l.format=t.format,l.needsUpdate=!0,a&&a(l)},t,r);return l}}),ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(t,e,i,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=Cache.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),Cache.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(e){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),r&&r(e),n.manager.itemError(t),n.manager.itemEnd(t)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),n.manager.itemStart(t),o.src=t,o}}),CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(e,i,t,r){var n=new CubeTexture,a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(t){a.load(e[t],function(e){n.images[t]=e,6===++o&&(n.needsUpdate=!0,i&&i(n))},void 0,r)}for(var l=0;l<e.length;++l)s(l);return n}}),DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(e,i,t,r){var n=this,a=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.load(e,function(e){var t=n.parse(e);t&&(void 0!==t.image?a.image=t.image:void 0!==t.data&&(a.image.width=t.width,a.image.height=t.height,a.image.data=t.data),a.wrapS=void 0!==t.wrapS?t.wrapS:ClampToEdgeWrapping,a.wrapT=void 0!==t.wrapT?t.wrapT:ClampToEdgeWrapping,a.magFilter=void 0!==t.magFilter?t.magFilter:LinearFilter,a.minFilter=void 0!==t.minFilter?t.minFilter:LinearFilter,a.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(a.format=t.format),void 0!==t.type&&(a.type=t.type),void 0!==t.mipmaps&&(a.mipmaps=t.mipmaps,a.minFilter=LinearMipmapLinearFilter),1===t.mipmapCount&&(a.minFilter=LinearFilter),a.needsUpdate=!0,i&&i(a,t))},t,r),a}}),TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(i,r,e,t){var n=new Texture,a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(i,function(e){n.image=e;var t=0<i.search(/\.jpe?g($|\?)/i)||0===i.search(/^data\:image\/jpeg/);n.format=t?RGBFormat:RGBAFormat,n.needsUpdate=!0,void 0!==r&&r(n)},e,t),n}}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i=[],r=this.getPoint(0),n=0;i.push(0);for(var a=1;a<=e;a++)n+=(t=this.getPoint(a/e)).distanceTo(r),i.push(n),r=t;return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,a=r.length;i=t||e*r[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=r[n=Math.floor(s+(l-s)/2)]-i)<0)s=n+1;else{if(!(0<o)){l=n;break}l=n-1}if(r[n=l]===i)return n/(a-1);var c=r[n];return(n+(i-c)/(r[n+1]-c))/(a-1)},getTangent:function(e,t){var i=e-1e-4,r=e+1e-4;i<0&&(i=0),1<r&&(r=1);var n=this.getPoint(i),a=this.getPoint(r),o=t||new(n.isVector2?Vector2:Vector3);return o.copy(a).sub(n).normalize(),o},getTangentAt:function(e,t){var i=this.getUtoTmapping(e);return this.getTangent(i,t)},computeFrenetFrames:function(e,t){for(var i=new Vector3,r=[],n=[],a=[],o=new Vector3,s=new Matrix4,l=0;l<=e;l++){r[l]=this.getTangentAt(l/e,new Vector3),r[l].normalize()}n[0]=new Vector3,a[0]=new Vector3;var c=Number.MAX_VALUE,h=Math.abs(r[0].x),u=Math.abs(r[0].y),d=Math.abs(r[0].z);h<=c&&(c=h,i.set(1,0,0)),u<=c&&(c=u,i.set(0,1,0)),d<=c&&i.set(0,0,1),o.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],o),a[0].crossVectors(r[0],n[0]);for(var p=1;p<=e;p++){if(n[p]=n[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();var m=Math.acos(MathUtils.clamp(r[p-1].dot(r[p]),-1,1));n[p].applyMatrix4(s.makeRotationAxis(o,m))}a[p].crossVectors(r[p],n[p])}if(!0===t){var f=Math.acos(MathUtils.clamp(n[0].dot(n[e]),-1,1));f/=e,0<r[0].dot(o.crossVectors(n[0],n[e]))&&(f=-f);for(var g=1;g<=e;g++)n[g].applyMatrix4(s.makeRotationAxis(r[g],f*g)),a[g].crossVectors(r[g],n[g])}return{tangents:r,normals:n,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(e,t){for(var i=t||new Vector2,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;r<n;)n-=r;n<Number.EPSILON&&(n=a?0:r),!0!==this.aClockwise||a||(n===r?n=-r:n-=r);var o=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=s-this.aX,d=l-this.aY;s=u*c-d*h+this.aX,l=u*h+d*c+this.aY}return i.set(s,l)},EllipseCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},EllipseCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(e,t,i,r){Curve.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=void 0!==r?r:.5}function CatmullRom(e,t,i,r,n){var a=.5*(r-t),o=.5*(n-i),s=e*e;return(2*i-2*r+a+o)*(e*s)+(-3*i+3*r-2*a-o)*s+a*e+i}function QuadraticBezierP0(e,t){var i=1-e;return i*i*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,i,r){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,i)+QuadraticBezierP2(e,r)}function CubicBezierP0(e,t){var i=1-e;return i*i*i*t}function CubicBezierP1(e,t){var i=1-e;return 3*i*i*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,i,r,n){return CubicBezierP0(e,t)+CubicBezierP1(e,i)+CubicBezierP2(e,r)+CubicBezierP3(e,n)}function CubicBezierCurve(e,t,i,r){Curve.call(this),this.type="CubicBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=i||new Vector2,this.v3=r||new Vector2}function CubicBezierCurve3(e,t,i,r){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=i||new Vector3,this.v3=r||new Vector3}function LineCurve(e,t){Curve.call(this),this.type="LineCurve",this.v1=e||new Vector2,this.v2=t||new Vector2}function LineCurve3(e,t){Curve.call(this),this.type="LineCurve3",this.v1=e||new Vector3,this.v2=t||new Vector3}function QuadraticBezierCurve(e,t,i){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=i||new Vector2}function QuadraticBezierCurve3(e,t,i){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=i||new Vector3}function SplineCurve(e){Curve.call(this),this.type="SplineCurve",this.points=e||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(e,t){var i,r,n=t||new Vector3,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,l=Math.floor(s),c=s-l;this.closed?l+=0<l?0:(Math.floor(Math.abs(l)/o)+1)*o:0===c&&l===o-1&&(l=o-2,c=1),i=this.closed||0<l?a[(l-1)%o]:(tmp.subVectors(a[0],a[1]).add(a[0]),tmp);var h=a[l%o],u=a[(l+1)%o];if(r=this.closed||l+2<o?a[(l+2)%o]:(tmp.subVectors(a[o-1],a[o-2]).add(a[o-1]),tmp),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(i.distanceToSquared(h),d),m=Math.pow(h.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(r),d);m<1e-4&&(m=1),p<1e-4&&(p=m),f<1e-4&&(f=m),px.initNonuniformCatmullRom(i.x,h.x,u.x,r.x,p,m,f),py.initNonuniformCatmullRom(i.y,h.y,u.y,r.y,p,m,f),pz.initNonuniformCatmullRom(i.z,h.z,u.z,r.z,p,m,f)}else"catmullrom"===this.curveType&&(px.initCatmullRom(i.x,h.x,u.x,r.x,this.tension),py.initCatmullRom(i.y,h.y,u.y,r.y,this.tension),pz.initCatmullRom(i.z,h.z,u.z,r.z,this.tension));return n.set(px.calc(c),py.calc(c),pz.calc(c)),n},CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){this.points.push(e.points[t].clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){e.points.push(this.points[t].toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Vector3).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(e,t){var i=t||new Vector2,r=this.v0,n=this.v1,a=this.v2,o=this.v3;return i.set(CubicBezier(e,r.x,n.x,a.x,o.x),CubicBezier(e,r.y,n.y,a.y,o.y)),i},CubicBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3,r=this.v0,n=this.v1,a=this.v2,o=this.v3;return i.set(CubicBezier(e,r.x,n.x,a.x,o.x),CubicBezier(e,r.y,n.y,a.y,o.y),CubicBezier(e,r.z,n.z,a.z,o.z)),i},CubicBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(e,t){var i=t||new Vector2;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},LineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve.prototype.getTangent=function(e,t){var i=t||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i},LineCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},LineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(e,t){var i=t||new Vector2,r=this.v0,n=this.v1,a=this.v2;return i.set(QuadraticBezier(e,r.x,n.x,a.x),QuadraticBezier(e,r.y,n.y,a.y)),i},QuadraticBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3,r=this.v0,n=this.v1,a=this.v2;return i.set(QuadraticBezier(e,r.x,n.x,a.x),QuadraticBezier(e,r.y,n.y,a.y),QuadraticBezier(e,r.z,n.z,a.z)),i},QuadraticBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(e,t){var i=t||new Vector2,r=this.points,n=(r.length-1)*e,a=Math.floor(n),o=n-a,s=r[0===a?a:a-1],l=r[a],c=r[r.length-2<a?r.length-1:a+1],h=r[r.length-3<a?r.length-1:a+2];return i.set(CatmullRom(o,s.x,l.x,c.x,h.x),CatmullRom(o,s.y,l.y,c.y,h.y)),i},SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){this.points.push(e.points[t].clone())}return this},SplineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){e.points.push(this.points[t].toArray())}return e},SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Vector2).fromArray(r))}return this};var Curves=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}function Shape(e){Path.call(this,e),this.uuid=MathUtils.generateUUID(),this.type="Shape",this.holes=[]}function Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function HemisphereLight(e,t,i){Light.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}function LightShadow(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(e,t,i,r,n,a){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==a?a:1,this.shadow=new SpotLightShadow}function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}function PointLight(e,t,i,r){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new PointLightShadow}function OrthographicCamera(e,t,i,r,n,a){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function RectAreaLight(e,t,i,r){Light.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(t<=i[r]){var n=i[r]-t,a=this.curves[r],o=a.getLength();return a.getPointAt(0===o?0:1-n/o)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++)for(var a=n[r],o=a.getPoints(a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e),s=0;s<o.length;s++){var l=o[s];t&&t.equals(l)||(i.push(l),t=l)}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){Curve.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){this.curves.push(e.curves[t].clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){e.curves.push(this.curves[t].toJSON())}return e},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Curves[r.type]).fromJSON(r))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var i=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,r){var n=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this},bezierCurveTo:function(e,t,i,r,n,a){var o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r),new Vector2(n,a));return this.curves.push(o),this.currentPoint.set(n,a),this},splineThru:function(e){var t=new SplineCurve([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,r,n,a){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,r,n,a),this},absarc:function(e,t,i,r,n,a){return this.absellipse(e,t,i,i,r,n,a),this},ellipse:function(e,t,i,r,n,a,o,s){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,r,n,a,o,s),this},absellipse:function(e,t,i,r,n,a,o,s){var l=new EllipseCurve(e,t,i,r,n,a,o,s);if(0<this.curves.length){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var h=l.getPoint(1);return this.currentPoint.copy(h),this},copy:function(e){return CurvePath.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=CurvePath.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Path.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){this.holes.push(e.holes[t].clone())}return this},toJSON:function(){var e=Path.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){e.holes.push(this.holes[t].toJSON())}return e},fromJSON:function(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Path).fromJSON(r))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,i=this.matrix,r=this._projScreenMatrix,n=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),n.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(n),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,i=2*MathUtils.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,e)}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var i=this.camera,r=this.matrix,n=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld),i.position.copy(n),a.copy(i.position),a.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(a),i.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),o.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,a=i+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(n+=l*this.view.offsetX)+l*this.view.width,s=(o-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(n,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(e){LightShadow.prototype.updateMatrices.call(this,e)}}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var SphericalHarmonics3=function(){function t(){_classCallCheck(this,t),Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Vector3)}return _createClass(t,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var i=e.x,r=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*n),t.addScaledVector(a[3],.488603*i),t.addScaledVector(a[4],i*r*1.092548),t.addScaledVector(a[5],r*n*1.092548),t.addScaledVector(a[6],.315392*(3*n*n-1)),t.addScaledVector(a[7],i*n*1.092548),t.addScaledVector(a[8],.546274*(i*i-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var i=e.x,r=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*n),t.addScaledVector(a[3],1.023328*i),t.addScaledVector(a[4],.858086*i*r),t.addScaledVector(a[5],.858086*r*n),t.addScaledVector(a[6],.743125*n*n-.247708),t.addScaledVector(a[7],.858086*i*n),t.addScaledVector(a[8],.429043*(i*i-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e,t){void 0===t&&(t=0);for(var i=this.coefficients,r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var i=this.coefficients,r=0;r<9;r++)i[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var i=e.x,r=e.y,n=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*n,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*i*n,t[8]=.546274*(i*i-r*r)}}]),t}();function LightProbe(e,t){Light.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new SphericalHarmonics3}function MaterialLoader(e){Loader.call(this,e),this.textures={}}LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(t,i,e,r){var n=this,a=new FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.load(t,function(e){try{i(n.parse(JSON.parse(e)))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}},e,r)},parse:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Materials[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new Color).setHex(e.sheen)),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&(r.vertexColors="number"==typeof e.vertexColors?0<e.vertexColors:e.vertexColors),void 0!==e.uniforms)for(var n in e.uniforms){var a=e.uniforms[n];switch(r.uniforms[n]={},a.type){case"t":r.uniforms[n].value=i(a.value);break;case"c":r.uniforms[n].value=(new Color).setHex(a.value);break;case"v2":r.uniforms[n].value=(new Vector2).fromArray(a.value);break;case"v3":r.uniforms[n].value=(new Vector3).fromArray(a.value);break;case"v4":r.uniforms[n].value=(new Vector4).fromArray(a.value);break;case"m3":r.uniforms[n].value=(new Matrix3).fromArray(a.value);break;case"m4":r.uniforms[n].value=(new Matrix4).fromArray(a.value);break;default:r.uniforms[n].value=a.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)r.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Vector2).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Vector2).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=i(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});var LoaderUtils={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function InstancedBufferAttribute(e,t,i,r){"number"==typeof i&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,i),this.meshPerAttribute=r||1}function BufferGeometryLoader(e){Loader.call(this,e)}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(e){return BufferGeometry.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=BufferGeometry.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=BufferAttribute.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(t,i,e,r){var n=this,a=new FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.load(t,function(e){try{i(n.parse(JSON.parse(e)))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}},e,r)},parse:function(e){var a={},o={};function t(e,t){if(void 0!==a[t])return a[t];var i=e.interleavedBuffers[t],r=function(e,t){if(void 0!==o[t])return o[t];var i=new Uint32Array(e.arrayBuffers[t]).buffer;return o[t]=i}(e,i.buffer),n=new InterleavedBuffer(new TYPED_ARRAYS[i.type](r),i.stride);return n.uuid=i.uuid,a[t]=n}var i=new(e.isInstancedBufferGeometry?InstancedBufferGeometry:BufferGeometry),r=e.data.index;if(void 0!==r){var n=new TYPED_ARRAYS[r.type](r.array);i.setIndex(new BufferAttribute(n,1))}var s=e.data.attributes;for(var l in s){var c=s[l],h=void 0;if(c.isInterleavedBufferAttribute){h=new InterleavedBufferAttribute(t(e.data,c.data),c.itemSize,c.offset,c.normalized)}else{var u=new TYPED_ARRAYS[c.type](c.array);h=new(c.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(u,c.itemSize,c.normalized)}void 0!==c.name&&(h.name=c.name),i.setAttribute(l,h)}var d=e.data.morphAttributes;if(d)for(var p in d){for(var m=d[p],f=[],g=0,v=m.length;g<v;g++){var y=m[g],x=void 0;if(y.isInterleavedBufferAttribute)x=new InterleavedBufferAttribute(t(e.data,y.data),y.itemSize,y.offset,y.normalized);else x=new BufferAttribute(new TYPED_ARRAYS[y.type](y.array),y.itemSize,y.normalized);void 0!==y.name&&(x.name=y.name),f.push(x)}i.morphAttributes[p]=f}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var _=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==_)for(var b=0,w=_.length;b!==w;++b){var M=_[b];i.addGroup(M.start,M.count,M.materialIndex)}var S=e.data.boundingSphere;if(void 0!==S){var T=new Vector3;void 0!==S.center&&T.fromArray(S.center),i.boundingSphere=new Sphere(T,S.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ObjectLoader(e){Loader.call(this,e)}ObjectLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ObjectLoader,load:function(r,n,e,a){var o=this,t=""===this.path?LoaderUtils.extractUrlBase(r):this.path;this.resourcePath=this.resourcePath||t;var i=new FileLoader(o.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.load(r,function(e){var t=null;try{t=JSON.parse(e)}catch(e){return void 0!==a&&a(e),void console.error("THREE:ObjectLoader: Can't parse "+r+".",e.message)}var i=t.metadata;void 0!==i&&void 0!==i.type&&"geometry"!==i.type.toLowerCase()?o.parse(t,n):console.error("THREE.ObjectLoader: Can't load "+r)},e,a)},parse:function(e,t){var i=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,i),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),a=this.parseTextures(e.textures,n),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,r,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new Shape).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var i,r={};if(void 0!==e)for(var n=new BufferGeometryLoader,a=0,o=e.length;a<o;a++){var s=void 0,l=e[a];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Geometries[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Geometries[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Geometries[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Geometries[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Geometries[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Geometries[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Geometries[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Geometries[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Geometries[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Geometries[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Geometries[l.type]((new Curves[l.path.type]).fromJSON(l.path),l.tubularSegments,l.radius,l.radialSegments,l.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Geometries[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Geometries[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(var c=0,h=l.shapes.length;c<h;c++){i.push(t[l.shapes[c]])}s=new Geometries[l.type](i,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(var u=0,d=l.shapes.length;u<d;u++){i.push(t[l.shapes[u]])}var p=l.options.extrudePath;void 0!==p&&(l.options.extrudePath=(new Curves[p.type]).fromJSON(p)),s=new Geometries[l.type](i,l.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(l);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}s.uuid=l.uuid,void 0!==l.name&&(s.name=l.name),!0===s.isBufferGeometry&&void 0!==l.userData&&(s.userData=l.userData),r[l.uuid]=s}return r},parseMaterials:function(e,t){var i={},r={};if(void 0!==e){var n=new MaterialLoader;n.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var h=s.materials[c];void 0===i[h.uuid]&&(i[h.uuid]=n.parse(h)),l.push(i[h.uuid])}r[s.uuid]=l}else void 0===i[s.uuid]&&(i[s.uuid]=n.parse(s)),r[s.uuid]=i[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=AnimationClip.parse(r);void 0!==r.uuid&&(n.uuid=r.uuid),t.push(n)}return t},parseImages:function(e,t){var i,r=this,n={};function a(e){return r.manager.itemStart(e),i.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemError(e),r.manager.itemEnd(e)})}if(void 0!==e&&0<e.length){var o=new LoadingManager(t);(i=new ImageLoader(o)).setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var c=e[s],h=c.url;if(Array.isArray(h)){n[c.uuid]=[];for(var u=0,d=h.length;u<d;u++){var p=h[u],m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:r.resourcePath+p;n[c.uuid].push(a(m))}}else{var f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:r.resourcePath+c.url;n[c.uuid]=a(f)}}}return n},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var n=0,a=e.length;n<a;n++){var o=e[n];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=void 0;(s=new(Array.isArray(t[o.image])?CubeTexture:Texture)(t[o.image])).needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=i(o.mapping,TEXTURE_MAPPING)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=i(o.wrap[0],TEXTURE_WRAPPING),s.wrapT=i(o.wrap[1],TEXTURE_WRAPPING)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=i(o.minFilter,TEXTURE_FILTER)),void 0!==o.magFilter&&(s.magFilter=i(o.magFilter,TEXTURE_FILTER)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),r[o.uuid]=s}return r},parseObject:function(e,t,a){var i,r,n;function o(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function s(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];void 0===a[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(a[n])}return t}return void 0===a[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),a[e]}}switch(e.type){case"Scene":i=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":i=new DirectionalLight(e.color,e.intensity);break;case"PointLight":i=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new LightProbe).fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=new Mesh(r=o(e.geometry),n=s(e.material));break;case"InstancedMesh":r=o(e.geometry),n=s(e.material);var l=e.instanceMatrix;(i=new InstancedMesh(r,n,e.count)).instanceMatrix=new BufferAttribute(new Float32Array(l.array),16);break;case"LOD":i=new LOD;break;case"Line":i=new Line(o(e.geometry),s(e.material),e.mode);break;case"LineLoop":i=new LineLoop(o(e.geometry),s(e.material));break;case"LineSegments":i=new LineSegments(o(e.geometry),s(e.material));break;case"PointCloud":case"Points":i=new Points(o(e.geometry),s(e.material));break;case"Sprite":i=new Sprite(s(e.material));break;case"Group":i=new Group;break;default:i=new Object3D}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var c=e.children,h=0;h<c.length;h++)i.add(this.parseObject(c[h],t,a));if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var u=e.levels,d=0;d<u.length;d++){var p=u[d],m=i.getObjectByProperty("uuid",p.object);void 0!==m&&i.addLevel(m,p.distance)}}return i}});var TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter},_context;function ImageBitmapLoader(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,e),this.options={premultiplyAlpha:"none"}}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}function Font(e){this.type="Font",this.data=e}function createPaths(e,t,i){for(var r=Array.from?Array.from(e):String(e).split(""),n=t/i.resolution,a=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n,o=[],s=0,l=0,c=0;c<r.length;c++){var h=r[c];if("\n"===h)s=0,l-=a;else{var u=createPath(h,n,s,l,i);s+=u.offsetX,o.push(u.path)}}return o}function createPath(e,t,i,r,n){var a=n.glyphs[e]||n.glyphs["?"];if(a){var o,s,l,c,h,u,d,p,m=new ShapePath;if(a.o)for(var f=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),g=0,v=f.length;g<v;){switch(f[g++]){case"m":o=f[g++]*t+i,s=f[g++]*t+r,m.moveTo(o,s);break;case"l":o=f[g++]*t+i,s=f[g++]*t+r,m.lineTo(o,s);break;case"q":l=f[g++]*t+i,c=f[g++]*t+r,h=f[g++]*t+i,u=f[g++]*t+r,m.quadraticCurveTo(h,u,l,c);break;case"b":l=f[g++]*t+i,c=f[g++]*t+r,h=f[g++]*t+i,u=f[g++]*t+r,d=f[g++]*t+i,p=f[g++]*t+r,m.bezierCurveTo(h,u,d,p,l,c)}}return{offsetX:a.ha*t,path:m}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".")}function FontLoader(e){Loader.call(this,e)}ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(t,i,e,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var n=this,a=Cache.get(t);if(void 0!==a)return n.manager.itemStart(t),setTimeout(function(){i&&i(a),n.manager.itemEnd(t)},0),a;fetch(t).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,n.options)}).then(function(e){Cache.add(t,e),i&&i(e),n.manager.itemEnd(t)}).catch(function(e){r&&r(e),n.manager.itemError(t),n.manager.itemEnd(t)}),n.manager.itemStart(t)}}),Object.assign(ShapePath.prototype,{moveTo:function(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this},bezierCurveTo:function(e,t,i,r,n,a){return this.currentPath.bezierCurveTo(e,t,i,r,n,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],a=new Shape;a.curves=n.curves,t.push(a)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,a=0;a<i;n=a++){var o=t[n],s=t[a],l=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(o=t[a],l=-l,s=t[n],c=-c),e.y<o.y||s.y<e.y)continue;if(e.y===o.y){if(e.x===o.x)return 1}else{var h=c*(e.x-o.x)-l*(e.y-o.y);if(0==h)return 1;if(h<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return 1}}return r}var n,a,o,s=ShapeUtils.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return i(l);var c=[];if(1===l.length)return a=l[0],(o=new Shape).curves=a.curves,c.push(o),c;var h=!s(l[0].getPoints());h=e?!h:h;var u,d,p=[],m=[],f=[],g=0;m[g]=void 0,f[g]=[];for(var v=0,y=l.length;v<y;v++)n=s(u=(a=l[v]).getPoints()),(n=e?!n:n)?(!h&&m[g]&&g++,m[g]={s:new Shape,p:u},m[g].s.curves=a.curves,h&&g++,f[g]=[]):f[g].push({h:a,p:u[0]});if(!m[0])return i(l);if(1<m.length){for(var x=!1,_=[],b=0,w=m.length;b<w;b++)p[b]=[];for(var M=0,S=m.length;M<S;M++)for(var T=f[M],A=0;A<T.length;A++){for(var E=T[A],C=!0,L=0;L<m.length;L++)r(E.p,m[L].p)&&(M!==L&&_.push({froms:M,tos:L,hole:A}),C?(C=!1,p[L].push(E)):x=!0);C&&p[M].push(E)}0<_.length&&(x||(f=p))}for(var R=0,P=m.length;R<P;R++){c.push(o=m[R].s);for(var D=0,k=(d=f[R]).length;D<k;D++)o.holes.push(d[D].h)}return c}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var i=[],r=createPaths(e,t,this.data),n=0,a=r.length;n<a;n++)Array.prototype.push.apply(i,r[n].toShapes());return i}}),FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(e,r,t,i){var n=this,a=new FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.load(e,function(t){var i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}var e=n.parse(i);r&&r(e)},t,i)},parse:function(e){return new Font(e)}});var AudioContext={getContext:function(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(e){_context=e}};function AudioLoader(e){Loader.call(this,e)}function HemisphereLightProbe(e,t,i){LightProbe.call(this,void 0,i);var r=(new Color).set(e),n=(new Color).set(t),a=new Vector3(r.r,r.g,r.b),o=new Vector3(n.r,n.g,n.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function AmbientLightProbe(e,t){LightProbe.call(this,void 0,t);var i=(new Color).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(i,r,e,n){var a=this,t=new FileLoader(a.manager);t.setResponseType("arraybuffer"),t.setPath(a.path),t.setRequestHeader(a.requestHeader),t.load(i,function(e){try{var t=e.slice(0);AudioContext.getContext().decodeAudioData(t,function(e){r(e)})}catch(e){n?n(e):console.error(e),a.manager.itemError(i)}},e,n)}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(e){return LightProbe.prototype.copy.call(this,e),this},toJSON:function(e){return LightProbe.prototype.toJSON.call(this,e)}}),AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(e){return LightProbe.prototype.copy.call(this,e),this},toJSON:function(e){return LightProbe.prototype.toJSON.call(this,e)}});var _eyeRight=new Matrix4,_eyeLeft=new Matrix4;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(StereoCamera.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var i,r,n=e.projectionMatrix.clone(),a=t.eyeSep/2,o=a*t.near/t.focus,s=t.near*Math.tan(MathUtils.DEG2RAD*t.fov*.5)/t.zoom;_eyeLeft.elements[12]=-a,_eyeRight.elements[12]=a,n.elements[0]=2*t.near/((r=s*t.aspect+o)-(i=-s*t.aspect+o)),n.elements[8]=(r+i)/(r-i),this.cameraL.projectionMatrix.copy(n),n.elements[0]=2*t.near/((r=s*t.aspect-o)-(i=-s*t.aspect-o)),n.elements[8]=(r+i)/(r-i),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}});var Clock=function(){function t(e){_classCallCheck(this,t),this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return _createClass(t,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),t}(),_position$2=new Vector3,_quaternion$3=new Quaternion,_scale$1=new Vector3,_orientation=new Vector3,AudioListener=function(){_inherits(n,Object3D);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).type="AudioListener",e.context=AudioContext.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new Clock,e}return _createClass(n,[{key:"getInput",value:function(){return this.gain}},{key:"removeFilter",value:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}},{key:"getMasterVolume",value:function(){return this.gain.gain.value}},{key:"setMasterVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"updateMatrixWorld",value:function(e){_get(_getPrototypeOf(n.prototype),"updateMatrixWorld",this).call(this,e);var t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$2,_quaternion$3,_scale$1),_orientation.set(0,0,-1).applyQuaternion(_quaternion$3),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(_position$2.x,r),t.positionY.linearRampToValueAtTime(_position$2.y,r),t.positionZ.linearRampToValueAtTime(_position$2.z,r),t.forwardX.linearRampToValueAtTime(_orientation.x,r),t.forwardY.linearRampToValueAtTime(_orientation.y,r),t.forwardZ.linearRampToValueAtTime(_orientation.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(_position$2.x,_position$2.y,_position$2.z),t.setOrientation(_orientation.x,_orientation.y,_orientation.z,i.x,i.y,i.z)}}]),n}(),Audio=function(){_inherits(r,Object3D);var i=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=i.call(this)).type="Audio",t.listener=e,t.context=e.context,t.gain=t.context.createGain(),t.gain.connect(e.getInput()),t.autoplay=!1,t.buffer=null,t.detune=0,t.loop=!1,t.loopStart=0,t.loopEnd=0,t.offset=0,t.duration=void 0,t.playbackRate=1,t.isPlaying=!1,t.hasPlaybackControl=!0,t.source=null,t.sourceType="empty",t._startedAt=0,t._progress=0,t._connected=!1,t.filters=[],t}return _createClass(r,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e=e||[],!0===this._connected?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),r}(),_position$3=new Vector3,_quaternion$4=new Quaternion,_scale$2=new Vector3,_orientation$1=new Vector3,PositionalAudio=function(){_inherits(r,Audio);var i=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=i.call(this,e)).panner=t.context.createPanner(),t.panner.panningModel="HRTF",t.panner.connect(t.gain),t}return _createClass(r,[{key:"getOutput",value:function(){return this.panner}},{key:"getRefDistance",value:function(){return this.panner.refDistance}},{key:"setRefDistance",value:function(e){return this.panner.refDistance=e,this}},{key:"getRolloffFactor",value:function(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function(e){return this.panner.rolloffFactor=e,this}},{key:"getDistanceModel",value:function(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function(e){return this.panner.distanceModel=e,this}},{key:"getMaxDistance",value:function(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function(e){return this.panner.maxDistance=e,this}},{key:"setDirectionalCone",value:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}},{key:"updateMatrixWorld",value:function(e){if(_get(_getPrototypeOf(r.prototype),"updateMatrixWorld",this).call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(_position$3,_quaternion$4,_scale$2),_orientation$1.set(0,0,1).applyQuaternion(_quaternion$4);var t=this.panner;if(t.positionX){var i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(_position$3.x,i),t.positionY.linearRampToValueAtTime(_position$3.y,i),t.positionZ.linearRampToValueAtTime(_position$3.z,i),t.orientationX.linearRampToValueAtTime(_orientation$1.x,i),t.orientationY.linearRampToValueAtTime(_orientation$1.y,i),t.orientationZ.linearRampToValueAtTime(_orientation$1.z,i)}else t.setPosition(_position$3.x,_position$3.y,_position$3.z),t.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z)}}}]),r}(),AudioAnalyser=function(){function i(e,t){_classCallCheck(this,i),this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}return _createClass(i,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}]),i}();function PropertyMixer(e,t,i){var r,n,a;switch(this.binding=e,this.valueSize=i,t){case"quaternion":r=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==r;++o)i[n+o]=i[o];a=t}else{this._mixBufferRegion(i,n,0,t/(a+=t),r)}this.cumulativeWeight=a},accumulateAdditive:function(e){var t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1&&this._mixBufferRegion(i,r,t*this._origIndex,1-n,t);0<a&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(var s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,r);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,i=t*this._origIndex;this.binding.getValue(e,i);for(var r=t,n=i;r!==n;++r)e[r]=e[i+r%t];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,i=e;i<t;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]},_select:function(e,t,i,r,n){if(.5<=r)for(var a=0;a!==n;++a)e[t+a]=e[i+a]},_slerp:function(e,t,i,r){Quaternion.slerpFlat(e,t,e,t,e,i,r)},_slerpAdditive:function(e,t,i,r,n){var a=this._workIndex*n;Quaternion.multiplyQuaternionsFlat(e,a,e,t,e,i),Quaternion.slerpFlat(e,t,e,t,e,a,r)},_lerp:function(e,t,i,r,n){for(var a=1-r,o=0;o!==n;++o){var s=t+o;e[s]=e[s]*a+e[i+o]*r}},_lerpAdditive:function(e,t,i,r,n){for(var a=0;a!==n;++a){var o=t+a;e[o]=e[o]+e[i+a]*r}}});var _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];function Composite(e,t,i){var r=i||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function PropertyBinding(e,t,i){this.path=t,this.parsedPath=i||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function AnimationObjectGroup(){this.uuid=MathUtils.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();var i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,i):new PropertyBinding(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(e){var t=_trackRe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=i.nodeName.substring(r+1);-1!==_supportedObjectNames.indexOf(n)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,a){if(!a||""===a||"."===a||-1===a||a===e.name||a===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(a);if(void 0!==t)return t}if(e.children){var i=function e(t){for(var i=0;i<t.length;i++){var r=t[i];if(r.name===a||r.uuid===a)return r;var n=e(r.children);if(n)return n}return null}(e.children);if(i)return i}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var a=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;void 0!==(this.targetObject=e).needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,n=this._bindings,a=n.length,o=void 0,s=e.length,l=this.nCachedObjects_,c=0,h=arguments.length;c!==h;++c){var u=arguments[c],d=u.uuid,p=t[d];if(void 0===p){p=s++,t[d]=p,e.push(u);for(var m=0,f=a;m!==f;++m)n[m].push(new PropertyBinding(u,i[m],r[m]))}else if(p<l){o=e[p];var g=--l,v=e[g];e[t[v.uuid]=p]=v,e[t[d]=g]=u;for(var y=0,x=a;y!==x;++y){var _=n[y],b=_[p];_[p]=_[g],void 0===b&&(b=new PropertyBinding(u,i[y],r[y])),_[g]=b}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){for(var e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length,n=this.nCachedObjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,c=t[l];if(void 0!==c&&n<=c){var h=n++,u=e[h];e[t[u.uuid]=c]=u,e[t[l]=h]=s;for(var d=0,p=r;d!==p;++d){var m=i[d],f=m[c];m[c]=m[h],m[h]=f}}}this.nCachedObjects_=n},uncache:function(){for(var e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length,n=this.nCachedObjects_,a=e.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,c=t[l];if(void 0!==c)if(delete t[l],c<n){var h=--n,u=e[h],d=--a,p=e[d];e[t[u.uuid]=c]=u,e[t[p.uuid]=h]=p,e.pop();for(var m=0,f=r;m!==f;++m){var g=i[m],v=g[d];g[c]=g[h],g[h]=v,g.pop()}}else{var y=--a,x=e[y];e[t[x.uuid]=c]=x,e.pop();for(var _=0,b=r;_!==b;++_){var w=i[_];w[c]=w[y],w.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var a=this._paths,o=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,c=new Array(s.length);i[e]=r=n.length,a.push(e),o.push(t),n.push(c);for(var h=l,u=s.length;h!==u;++h){c[h]=new PropertyBinding(s[h],e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];a[t[e[o]]=i]=s,a.pop(),n[i]=n[o],n.pop(),r[i]=r[o],r.pop()}}});var AnimationAction=function(){function h(e,t,i,r){_classCallCheck(this,h),this._mixer=e,this._clip=t,this._localRoot=i||null,this.blendMode=r||t.blendMode;for(var n=t.tracks,a=n.length,o=new Array(a),s={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},l=0;l!==a;++l){var c=n[l].createInterpolant(null);(o[l]=c).settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return _createClass(h,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,a=r/n;e.warp(1,n/r,t),this.warp(a,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,i){return e.crossFadeFrom(this,t,i)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,i){var r=this._mixer,n=r.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/a,l[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,i,r){if(this.enabled){var n=this._startTime;if(null!==n){var a=(e-n)*i;if(a<0||0===i)return;this._startTime=null,t=i*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(0<s){var l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(var h=0,u=l.length;h!==u;++h)l[h].evaluate(o),c[h].accumulateAdditive(s);break;case NormalAnimationBlendMode:default:for(var d=0,p=l.length;d!==p;++d)l[d].evaluate(o),c[d].accumulate(r,s)}}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,i.parameterPositions[1]<e&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)t*=i.evaluate(e)[0],i.parameterPositions[1]<e&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,a=i===LoopPingPong;if(0===e)return-1!==n&&a&&1==(1&n)?t-r:r;if(i===LoopOnce){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t<=r)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(0<=e?this._setEndings(!(n=0),0===this.repetitions,a):this._setEndings(0===this.repetitions,!0,a)),t<=r||r<0){var o=Math.floor(r/t);r-=t*o,n+=Math.abs(o);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r=0<e?t:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1});else{if(1==s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&1==(1&n))return t-r}return r}},{key:"_setEndings",value:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=ZeroSlopeEnding,r.endingEnd=ZeroSlopeEnding):(r.endingStart=e?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,r.endingEnd=t?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)}},{key:"_scheduleFading",value:function(e,t,i){var r=this._mixer,n=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=n,s[0]=t,o[1]=n+e,s[1]=i,this}}]),h}();function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,a=e._propertyBindings,o=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(l[s]=c={});for(var h=0;h!==n;++h){var u=r[h],d=u.name,p=c[d];if(void 0!==p)a[h]=p;else{if(void 0!==(p=a[h])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}++(p=new PropertyMixer(PropertyBinding.create(i,d,t&&t._propertyBindings[h].binding.parsedPath),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),a[h]=p}o[h].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,a=0,o=n.length;a!==o;++a){var s=n[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;t[i._cacheIndex=r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,a=this._actionsByClip,o=a[n],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;s[l._byClipCacheIndex=c]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];t[e._cacheIndex=r]=e,t[n._cacheIndex=i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];t[e._cacheIndex=r]=e,t[n._cacheIndex=i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=this._bindings,a=r[t];void 0===a&&(r[t]=a={}),(a[i]=e)._cacheIndex=n.length,n.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;t[s._cacheIndex=l]=s,t.pop(),delete o[n],0===Object.keys(o).length&&delete a[r]},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];t[e._cacheIndex=r]=e,t[n._cacheIndex=i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];t[e._cacheIndex=r]=e,t[n._cacheIndex=i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&(e[(i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];t[e.__cacheIndex=r]=e,t[n.__cacheIndex=i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){var r=t||this._root,n=r.uuid,a="string"==typeof e?AnimationClip.findByName(r,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],l=null;if(void 0===i&&(i=null!==a?a.blendMode:NormalAnimationBlendMode),void 0!==s){var c=s.actionByRoot[n];if(void 0!==c&&c.blendMode===i)return c;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;var h=new AnimationAction(this,a,t,i);return this._bindAction(h,l),this._addInactiveAction(h,o,n),h},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?AnimationClip.findByName(i,e):e,a=this._actionsByClip[n?n.uuid:e];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions-1;0<=t;--t)e[t].stop();return this},update:function(e){for(var t=this._actions,i=this._nActiveActions,r=this.time+=e*=this.timeScale,n=Math.sign(e),a=this._accuIndex^=1,o=0;o!==i;++o){t[o]._update(r,e,n,a)}for(var s=this._bindings,l=this._nActiveBindings,c=0;c!==l;++c)s[c].apply(a);return this},setTime:function(e){for(var t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var a=n.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var c=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,t[h._cacheIndex=c]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});var Uniform=function(){function t(e){_classCallCheck(this,t),"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}return _createClass(t,[{key:"clone",value:function(){return new t(void 0===this.value.clone?this.value:this.value.clone())}}]),t}();function InstancedInterleavedBuffer(e,t,i){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=i||1}function GLBufferAttribute(e,t,i,r,n){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=n,this.version=0}function Raycaster(e,t,i,r){this.ray=new Ray(e,t),this.near=i||0,this.far=r||1/0,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function _intersectObject(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===r)for(var n=e.children,a=0,o=n.length;a<o;a++)_intersectObject(n[a],t,i,!0)}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){var t=InterleavedBuffer.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){var t=InterleavedBuffer.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(GLBufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(GLBufferAttribute.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(Raycaster.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){var r=i||[];return _intersectObject(e,this,r,t),r.sort(ascSort),r},intersectObjects:function(e,t,i){var r=i||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,a=e.length;n<a;n++)_intersectObject(e[n],this,r,t);return r.sort(ascSort),r}});var Spherical=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return _classCallCheck(this,r),this.radius=e,this.phi=t,this.theta=i,this}return _createClass(r,[{key:"set",value:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(MathUtils.clamp(t/this.radius,-1,1))),this}}]),r}(),Cylindrical=function(){function r(e,t,i){return _classCallCheck(this,r),this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}return _createClass(r,[{key:"set",value:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}}]),r}(),_vector$7=new Vector2,Box2=function(){function i(e,t){_classCallCheck(this,i),Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}return _createClass(i,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var i=_vector$7.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||this.max.x<e.x||e.y<this.min.y||this.max.y<e.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||this.max.x<e.min.x||e.max.y<this.min.y||this.max.y<e.min.y)}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return _vector$7.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),i}(),_startP=new Vector3,_startEnd=new Vector3,Line3=function(){function i(e,t){_classCallCheck(this,i),this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}return _createClass(i,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){_startP.subVectors(e,this.start),_startEnd.subVectors(this.end,this.start);var i=_startEnd.dot(_startEnd),r=_startEnd.dot(_startP)/i;return t&&(r=MathUtils.clamp(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,i){var r=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Vector3),this.delta(i).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),i}();function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;var _vector$8=new Vector3,SpotLightHelper=function(){_inherits(u,Object3D);var h=_createSuper(u);function u(e,t){var i;_classCallCheck(this,u),(i=h.call(this)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=t;for(var r=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],a=0,o=1;a<32;a++,o++){var s=a/32*Math.PI*2,l=o/32*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(l),Math.sin(l),1)}r.setAttribute("position",new Float32BufferAttribute(n,3));var c=new LineBasicMaterial({fog:!1,toneMapped:!1});return i.cone=new LineSegments(r,c),i.add(i.cone),i.update(),i}return _createClass(u,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),_vector$8.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$8),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}]),u}(),_vector$9=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4,SkeletonHelper=function(){_inherits(d,LineSegments);var u=_createSuper(d);function d(e){var t;_classCallCheck(this,d);for(var i=getBoneList(e),r=new BufferGeometry,n=[],a=[],o=new Color(0,0,1),s=new Color(0,1,0),l=0;l<i.length;l++){var c=i[l];c.parent&&c.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),a.push(o.r,o.g,o.b),a.push(s.r,s.g,s.b))}r.setAttribute("position",new Float32BufferAttribute(n,3)),r.setAttribute("color",new Float32BufferAttribute(a,3));var h=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(t=u.call(this,r,h)).type="SkeletonHelper",t.isSkeletonHelper=!0,t.root=e,t.bones=i,t.matrix=e.matrixWorld,t.matrixAutoUpdate=!1,t}return _createClass(d,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");_matrixWorldInv.getInverse(this.root.matrixWorld);for(var n=0,a=0;n<t.length;n++){var o=t[n];o.parent&&o.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,o.matrixWorld),_vector$9.setFromMatrixPosition(_boneMatrix),r.setXYZ(a,_vector$9.x,_vector$9.y,_vector$9.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,o.parent.matrixWorld),_vector$9.setFromMatrixPosition(_boneMatrix),r.setXYZ(a+1,_vector$9.x,_vector$9.y,_vector$9.z),a+=2)}i.getAttribute("position").needsUpdate=!0,_get(_getPrototypeOf(d.prototype),"updateMatrixWorld",this).call(this,e)}}]),d}();function getBoneList(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,getBoneList(e.children[i]));return t}var PointLightHelper=function(){_inherits(s,Mesh);var o=_createSuper(s);function s(e,t,i){var r;_classCallCheck(this,s);var n=new SphereBufferGeometry(t,4,2),a=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});return(r=o.call(this,n,a)).light=e,r.light.updateMatrixWorld(),r.color=i,r.type="PointLightHelper",r.matrix=r.light.matrixWorld,r.matrixAutoUpdate=!1,r.update(),r}return _createClass(s,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}]),s}(),_vector$a=new Vector3,_color1=new Color,_color2=new Color,HemisphereLightHelper=function(){_inherits(l,Object3D);var s=_createSuper(l);function l(e,t,i){var r;_classCallCheck(this,l),(r=s.call(this)).light=e,r.light.updateMatrixWorld(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.color=i;var n=new OctahedronBufferGeometry(t);n.rotateY(.5*Math.PI),r.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===r.color&&(r.material.vertexColors=!0);var a=n.getAttribute("position"),o=new Float32Array(3*a.count);return n.setAttribute("color",new BufferAttribute(o,3)),r.add(new Mesh(n,r.material)),r.update(),r}return _createClass(l,[{key:"dispose",value:function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}},{key:"update",value:function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(var i=0,r=t.count;i<r;i++){var n=i<r/2?_color1:_color2;t.setXYZ(i,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(_vector$a.setFromMatrixPosition(this.light.matrixWorld).negate())}}]),l}(),GridHelper=function(){_inherits(v,LineSegments);var g=_createSuper(v);function v(e,t,i,r){var n;_classCallCheck(this,v),e=e||10,t=t||10,i=new Color(void 0!==i?i:4473924),r=new Color(void 0!==r?r:8947848);for(var a=t/2,o=e/t,s=e/2,l=[],c=[],h=0,u=0,d=-s;h<=t;h++,d+=o){l.push(-s,0,d,s,0,d),l.push(d,0,-s,d,0,s);var p=h===a?i:r;p.toArray(c,u),p.toArray(c,u+=3),p.toArray(c,u+=3),p.toArray(c,u+=3),u+=3}var m=new BufferGeometry;m.setAttribute("position",new Float32BufferAttribute(l,3)),m.setAttribute("color",new Float32BufferAttribute(c,3));var f=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});return(n=g.call(this,m,f)).type="GridHelper",n}return v}(),PolarGridHelper=function(){_inherits(S,LineSegments);var M=_createSuper(S);function S(e,t,i,r,n,a){var o;_classCallCheck(this,S),e=e||10,t=t||16,i=i||8,r=r||64,n=new Color(void 0!==n?n:4473924),a=new Color(void 0!==a?a:8947848);for(var s=[],l=[],c=0;c<=t;c++){var h=c/t*(2*Math.PI),u=Math.sin(h)*e,d=Math.cos(h)*e;s.push(0,0,0),s.push(u,0,d);var p=1&c?n:a;l.push(p.r,p.g,p.b),l.push(p.r,p.g,p.b)}for(var m=0;m<=i;m++)for(var f=1&m?n:a,g=e-e/i*m,v=0;v<r;v++){var y=v/r*(2*Math.PI),x=Math.sin(y)*g,_=Math.cos(y)*g;s.push(x,0,_),l.push(f.r,f.g,f.b),y=(v+1)/r*(2*Math.PI),x=Math.sin(y)*g,_=Math.cos(y)*g,s.push(x,0,_),l.push(f.r,f.g,f.b)}var b=new BufferGeometry;b.setAttribute("position",new Float32BufferAttribute(s,3)),b.setAttribute("color",new Float32BufferAttribute(l,3));var w=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});return(o=M.call(this,b,w)).type="PolarGridHelper",o}return S}(),_v1$5=new Vector3,_v2$3=new Vector3,_v3$1=new Vector3,DirectionalLightHelper=function(){_inherits(s,Object3D);var o=_createSuper(s);function s(e,t,i){var r;_classCallCheck(this,s),(r=o.call(this)).light=e,r.light.updateMatrixWorld(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.color=i,void 0===t&&(t=1);var n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var a=new LineBasicMaterial({fog:!1,toneMapped:!1});return r.lightPlane=new Line(n,a),r.add(r.lightPlane),(n=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),r.targetLine=new Line(n,a),r.add(r.targetLine),r.update(),r}return _createClass(s,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){_v1$5.setFromMatrixPosition(this.light.matrixWorld),_v2$3.setFromMatrixPosition(this.light.target.matrixWorld),_v3$1.subVectors(_v2$3,_v1$5),this.lightPlane.lookAt(_v2$3),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$3),this.targetLine.scale.z=_v3$1.length()}}]),s}(),_vector$b=new Vector3,_camera=new Camera,CameraHelper=function(){_inherits(f,LineSegments);var m=_createSuper(f);function f(e){var t;_classCallCheck(this,f);var i=new BufferGeometry,r=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],a=[],o={},s=new Color(16755200),l=new Color(16711680),c=new Color(43775),h=new Color(16777215),u=new Color(3355443);function d(e,t,i){p(e,i),p(t,i)}function p(e,t){n.push(0,0,0),a.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}return d("n1","n2",s),d("n2","n4",s),d("n4","n3",s),d("n3","n1",s),d("f1","f2",s),d("f2","f4",s),d("f4","f3",s),d("f3","f1",s),d("n1","f1",s),d("n2","f2",s),d("n3","f3",s),d("n4","f4",s),d("p","n1",l),d("p","n2",l),d("p","n3",l),d("p","n4",l),d("u1","u2",c),d("u2","u3",c),d("u3","u1",c),d("c","t",h),d("p","c",u),d("cn1","cn2",u),d("cn3","cn4",u),d("cf1","cf2",u),d("cf3","cf4",u),i.setAttribute("position",new Float32BufferAttribute(n,3)),i.setAttribute("color",new Float32BufferAttribute(a,3)),(t=m.call(this,i,r)).type="CameraHelper",t.camera=e,t.camera.updateProjectionMatrix&&t.camera.updateProjectionMatrix(),t.matrix=e.matrixWorld,t.matrixAutoUpdate=!1,t.pointMap=o,t.update(),t}return _createClass(f,[{key:"update",value:function(){var e=this.geometry,t=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",t,e,_camera,0,0,-1),setPoint("t",t,e,_camera,0,0,1),setPoint("n1",t,e,_camera,-1,-1,-1),setPoint("n2",t,e,_camera,1,-1,-1),setPoint("n3",t,e,_camera,-1,1,-1),setPoint("n4",t,e,_camera,1,1,-1),setPoint("f1",t,e,_camera,-1,-1,1),setPoint("f2",t,e,_camera,1,-1,1),setPoint("f3",t,e,_camera,-1,1,1),setPoint("f4",t,e,_camera,1,1,1),setPoint("u1",t,e,_camera,.7,1.1,-1),setPoint("u2",t,e,_camera,-.7,1.1,-1),setPoint("u3",t,e,_camera,0,2,-1),setPoint("cf1",t,e,_camera,-1,0,1),setPoint("cf2",t,e,_camera,1,0,1),setPoint("cf3",t,e,_camera,0,-1,1),setPoint("cf4",t,e,_camera,0,1,1),setPoint("cn1",t,e,_camera,-1,0,-1),setPoint("cn2",t,e,_camera,1,0,-1),setPoint("cn3",t,e,_camera,0,-1,-1),setPoint("cn4",t,e,_camera,0,1,-1),e.getAttribute("position").needsUpdate=!0}}]),f}();function setPoint(e,t,i,r,n,a,o){_vector$b.set(n,a,o).unproject(r);var s=t[e];if(void 0!==s)for(var l=i.getAttribute("position"),c=0,h=s.length;c<h;c++)l.setXYZ(s[c],_vector$b.x,_vector$b.y,_vector$b.z)}var _box$3=new Box3,BoxHelper=function(){_inherits(s,LineSegments);var o=_createSuper(s);function s(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:16776960;_classCallCheck(this,s);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),a=new BufferGeometry;return a.setIndex(new BufferAttribute(r,1)),a.setAttribute("position",new BufferAttribute(n,3)),(t=o.call(this,a,new LineBasicMaterial({color:i,toneMapped:!1}))).object=e,t.type="BoxHelper",t.matrixAutoUpdate=!1,t.update(),t}return _createClass(s,[{key:"update",value:function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box$3.setFromObject(this.object),!_box$3.isEmpty()){var t=_box$3.min,i=_box$3.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=t.x,n[4]=i.y,n[5]=i.z,n[6]=t.x,n[7]=t.y,n[8]=i.z,n[9]=i.x,n[10]=t.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=t.z,n[15]=t.x,n[16]=i.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=i.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}},{key:"setFromObject",value:function(e){return this.object=e,this.update(),this}},{key:"copy",value:function(e){return LineSegments.prototype.copy.call(this,e),this.object=e.object,this}}]),s}(),Box3Helper=function(){_inherits(o,LineSegments);var a=_createSuper(o);function o(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:16776960;_classCallCheck(this,o);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry;return n.setIndex(new BufferAttribute(r,1)),n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(t=a.call(this,n,new LineBasicMaterial({color:i,toneMapped:!1}))).box=e,t.type="Box3Helper",t.geometry.computeBoundingSphere(),t}return _createClass(o,[{key:"updateMatrixWorld",value:function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),_get(_getPrototypeOf(o.prototype),"updateMatrixWorld",this).call(this,e))}}]),o}(),PlaneHelper=function(){_inherits(l,Line);var s=_createSuper(l);function l(e,t,i){var r;_classCallCheck(this,l);var n=void 0!==i?i:16776960,a=new BufferGeometry;a.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),a.computeBoundingSphere(),(r=s.call(this,a,new LineBasicMaterial({color:n,toneMapped:!1}))).type="PlaneHelper",r.plane=e,r.size=void 0===t?1:t;var o=new BufferGeometry;return o.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),r.add(new Mesh(o,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),r}return _createClass(l,[{key:"updateMatrixWorld",value:function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?BackSide:FrontSide,this.lookAt(this.plane.normal),_get(_getPrototypeOf(l.prototype),"updateMatrixWorld",this).call(this,e)}}]),l}(),_axis=new Vector3,_lineGeometry,_coneGeometry,ArrowHelper=function(){_inherits(l,Object3D);var s=_createSuper(l);function l(e,t,i,r,n,a){var o;return _classCallCheck(this,l),(o=s.call(this)).type="ArrowHelper",void 0===e&&(e=new Vector3(0,0,1)),void 0===t&&(t=new Vector3(0,0,0)),void 0===i&&(i=1),void 0===r&&(r=16776960),void 0===n&&(n=.2*i),void 0===a&&(a=.2*n),void 0===_lineGeometry&&((_lineGeometry=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(_coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),o.position.copy(t),o.line=new Line(_lineGeometry,new LineBasicMaterial({color:r,toneMapped:!1})),o.line.matrixAutoUpdate=!1,o.add(o.line),o.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:r,toneMapped:!1})),o.cone.matrixAutoUpdate=!1,o.add(o.cone),o.setDirection(e),o.setLength(i,n,a),o}return _createClass(l,[{key:"setDirection",value:function(e){if(.99999<e.y)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(_axis,t)}}},{key:"setLength",value:function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}},{key:"setColor",value:function(e){this.line.material.color.set(e),this.cone.material.color.set(e)}},{key:"copy",value:function(e){return _get(_getPrototypeOf(l.prototype),"copy",this).call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}]),l}(),AxesHelper=function(){_inherits(o,LineSegments);var a=_createSuper(o);function o(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;_classCallCheck(this,o);var i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute(i,3)),r.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});return(e=a.call(this,r,n)).type="AxesHelper",e}return o}(),LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS=(_ENCODINGS={},_defineProperty(_ENCODINGS,LinearEncoding,0),_defineProperty(_ENCODINGS,sRGBEncoding,1),_defineProperty(_ENCODINGS,RGBEEncoding,2),_defineProperty(_ENCODINGS,RGBM7Encoding,3),_defineProperty(_ENCODINGS,RGBM16Encoding,4),_defineProperty(_ENCODINGS,RGBDEncoding,5),_defineProperty(_ENCODINGS,GammaEncoding,6),_ENCODINGS),_flatCamera=new OrthographicCamera,_createPlanes2=_createPlanes(),_lodPlanes=_createPlanes2._lodPlanes,_sizeLods=_createPlanes2._sizeLods,_sigmas=_createPlanes2._sigmas,_oldTarget=null,PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)],PMREMGenerator=function(){function t(e){_classCallCheck(this,t),this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=_getBlurShader(MAX_SAMPLES),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}return _createClass(t,[{key:"fromScene",value:function(e,t,i,r){var n=1<arguments.length&&void 0!==t?t:0,a=2<arguments.length&&void 0!==i?i:.1,o=3<arguments.length&&void 0!==r?r:100;_oldTarget=this._renderer.getRenderTarget();var s=this._allocateTargets();return this._sceneToCubeUV(e,a,o,s),0<n&&this._blur(s,0,0,n),this._applyPMREM(s),this._cleanup(s),s}},{key:"fromEquirectangular",value:function(e){return this._fromTexture(e)}},{key:"fromCubemap",value:function(e){return this._fromTexture(e)}},{key:"compileCubemapShader",value:function(){null===this._cubemapShader&&(this._cubemapShader=_getCubemapShader(),this._compileMaterial(this._cubemapShader))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectShader&&(this._equirectShader=_getEquirectShader(),this._compileMaterial(this._equirectShader))}},{key:"dispose",value:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<_lodPlanes.length;e++)_lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(_oldTarget),e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e){_oldTarget=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}},{key:"_allocateTargets",value:function(e){var t={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:UnsignedByteType,format:RGBEFormat,encoding:_isLDR(e)?e.encoding:RGBEEncoding,depthBuffer:!1},i=_createRenderTarget(t);return i.depthBuffer=!e,this._pingPongRenderTarget=_createRenderTarget(t),i}},{key:"_compileMaterial",value:function(e){var t=new Mesh(_lodPlanes[0],e);this._renderer.compile(t,_flatCamera)}},{key:"_sceneToCubeUV",value:function(e,t,i,r){var n=new PerspectiveCamera(90,1,t,i),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.outputEncoding,c=s.toneMapping,h=s.getClearColor(),u=s.getClearAlpha();s.toneMapping=NoToneMapping,s.outputEncoding=LinearEncoding;var d=e.background;if(d&&d.isColor){d.convertSRGBToLinear();var p=Math.max(d.r,d.g,d.b),m=Math.min(Math.max(Math.ceil(Math.log2(p)),-128),127);d=d.multiplyScalar(Math.pow(2,-m)),s.setClearColor(d,(m+128)/255),e.background=null}for(var f=0;f<6;f++){var g=f%3;0==g?(n.up.set(0,a[f],0),n.lookAt(o[f],0,0)):1==g?(n.up.set(0,0,a[f]),n.lookAt(0,o[f],0)):(n.up.set(0,a[f],0),n.lookAt(0,0,o[f])),_setViewport(r,g*SIZE_MAX,2<f?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),s.setRenderTarget(r),s.render(e,n)}s.toneMapping=c,s.outputEncoding=l,s.setClearColor(h,u)}},{key:"_textureToCubeUV",value:function(e,t){var i=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=_getCubemapShader()):null==this._equirectShader&&(this._equirectShader=_getEquirectShader());var r=e.isCubeTexture?this._cubemapShader:this._equirectShader,n=new Mesh(_lodPlanes[0],r),a=r.uniforms;(a.envMap.value=e).isCubeTexture||a.texelSize.value.set(1/e.image.width,1/e.image.height),a.inputEncoding.value=ENCODINGS[e.encoding],a.outputEncoding.value=ENCODINGS[t.texture.encoding],_setViewport(t,0,0,3*SIZE_MAX,2*SIZE_MAX),i.setRenderTarget(t),i.render(n,_flatCamera)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,i=t.autoClear;t.autoClear=!1;for(var r=1;r<TOTAL_LODS;r++){var n=Math.sqrt(_sigmas[r]*_sigmas[r]-_sigmas[r-1]*_sigmas[r-1]);this._blur(e,r-1,r,n,_axisDirections[(r-1)%_axisDirections.length])}t.autoClear=i}},{key:"_blur",value:function(e,t,i,r,n){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",n),this._halfBlur(a,e,i,i,r,"longitudinal",n)}},{key:"_halfBlur",value:function(e,t,i,r,n,a,o){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Mesh(_lodPlanes[r],l),h=l.uniforms,u=_sizeLods[i]-1,d=isFinite(n)?Math.PI/(2*u):2*Math.PI/(2*MAX_SAMPLES-1),p=n/d,m=isFinite(n)?1+Math.floor(3*p):MAX_SAMPLES;MAX_SAMPLES<m&&console.warn("sigmaRadians, ".concat(n,", is too large and will clip, as it requested ").concat(m," samples when the maximum is set to ").concat(MAX_SAMPLES));for(var f=[],g=0,v=0;v<MAX_SAMPLES;++v){var y=v/p,x=Math.exp(-y*y/2);f.push(x),0==v?g+=x:v<m&&(g+=2*x)}for(var _=0;_<f.length;_++)f[_]=f[_]/g;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=f,h.latitudinal.value="latitudinal"===a,o&&(h.poleAxis.value=o),h.dTheta.value=d,h.mipInt.value=LOD_MAX-i,h.inputEncoding.value=ENCODINGS[e.texture.encoding],h.outputEncoding.value=ENCODINGS[e.texture.encoding];var b=_sizeLods[r];_setViewport(t,3*Math.max(0,SIZE_MAX-2*b),(0===r?0:2*SIZE_MAX)+2*b*(LOD_MAX-LOD_MIN<r?r-LOD_MAX+LOD_MIN:0),3*b,2*b),s.setRenderTarget(t),s.render(c,_flatCamera)}}]),t}();function _isLDR(e){return void 0!==e&&e.type===UnsignedByteType&&(e.encoding===LinearEncoding||e.encoding===sRGBEncoding||e.encoding===GammaEncoding)}function _createPlanes(){for(var e=[],t=[],i=[],r=LOD_MAX,n=0;n<TOTAL_LODS;n++){var a=Math.pow(2,r);t.push(a);var o=1/a;LOD_MAX-LOD_MIN<n?o=EXTRA_LOD_SIGMA[n-LOD_MAX+LOD_MIN-1]:0==n&&(o=0),i.push(o);for(var s=1/(a-1),l=-s/2,c=1+s/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],u=new Float32Array(108),d=new Float32Array(72),p=new Float32Array(36),m=0;m<6;m++){var f=m%3*2/3-1,g=2<m?0:-1;u.set([f,g,0,f+2/3,g,0,f+2/3,1+g,0,f,g,0,f+2/3,1+g,0,f,1+g,0],18*m),d.set(h,12*m),p.set([m,m,m,m,m,m],6*m)}var v=new BufferGeometry;v.setAttribute("position",new BufferAttribute(u,3)),v.setAttribute("uv",new BufferAttribute(d,2)),v.setAttribute("faceIndex",new BufferAttribute(p,1)),e.push(v),LOD_MIN<r&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function _createRenderTarget(e){var t=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,e);return t.texture.mapping=CubeUVReflectionMapping,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function _setViewport(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function _getBlurShader(e){return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(e)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Vector3(0,1,0)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t".concat(_getEncodings(),"\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectShader(){return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Vector2(1,1)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t".concat(_getEncodings(),"\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapShader(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t".concat(_getEncodings(),"\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function _getEncodings(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Face4(e,t,i,r,n,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(e,t,i,n,a,o)}var LineStrip=0,LinePieces=1,NoColors=0,FaceColors=1,VertexColors=2;function MeshFaceMaterial(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function MultiMaterial(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e}function PointCloud(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(e,t)}function Particle(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(e)}function ParticleSystem(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(e,t)}function PointCloudMaterial(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleBasicMaterial(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function ParticleSystemMaterial(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function Vertex(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,i)}function DynamicBufferAttribute(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(e,t).setUsage(DynamicDrawUsage)}function Int8Attribute(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(e,t)}function Uint8Attribute(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(e,t)}function Uint8ClampedAttribute(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(e,t)}function Int16Attribute(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(e,t)}function Uint16Attribute(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(e,t)}function Int32Attribute(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(e,t)}function Uint32Attribute(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(e,t)}function Float32Attribute(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(e,t)}function Float64Attribute(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(e,t)}function ClosedSplineCurve3(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom",this.closed=!0}function SplineCurve3(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}function Spline(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,e),this.type="catmullrom"}function AxisHelper(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(e)}function BoundingBoxHelper(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)}function EdgesHelper(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function WireframeHelper(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function XHRLoader(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(e)}function BinaryTextureLoader(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(e)}function WebGLRenderTargetCube(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(e,i)}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Object.assign(CurvePath.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Geometry,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new Vector3(n.x,n.y,n.z||0))}return t}}),Object.assign(Path.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(e)}}),Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ObjectLoader.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Box2.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Box3.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Sphere.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(MathUtils,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),MathUtils.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),MathUtils.ceilPowerOfTwo(e)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,n,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,n,a)}}),Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Triangle,{barycoordFromPoint:function(e,t,i,r,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,i,r,n)},normal:function(e,t,i,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,i,r)}}),Object.assign(Shape.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}}),Object.assign(Vector2.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(Object3D.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}}),Object.assign(BufferAttribute.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?DynamicDrawUsage:StaticDrawUsage),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(BufferGeometry.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t,i){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(t,i)))},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(InstancedBufferGeometry.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(Raycaster.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(InterleavedBuffer.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?DynamicDrawUsage:StaticDrawUsage),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Scene.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(MeshPhysicalMaterial.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(WebGLRenderer.prototype,{clearTarget:function(e,t,i,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?sRGBEncoding:LinearEncoding}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Audio.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new AudioLoader).load(e,function(e){t.setBuffer(e)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var GeometryUtils={merge:function(e,t,i){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new TextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,i,void 0,r);return t&&(a.mapping=t),a},ImageUtils.loadTextureCube=function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var a=n.load(e,i,void 0,r);return t&&(a.mapping=t),a},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));var THREE$1=Object.freeze({__proto__:null,ACESFilmicToneMapping:ACESFilmicToneMapping,AddEquation:AddEquation,AddOperation:AddOperation,AdditiveAnimationBlendMode:AdditiveAnimationBlendMode,AdditiveBlending:AdditiveBlending,AlphaFormat:AlphaFormat,AlwaysDepth:AlwaysDepth,AlwaysStencilFunc:AlwaysStencilFunc,AmbientLight:AmbientLight,AmbientLightProbe:AmbientLightProbe,AnimationClip:AnimationClip,AnimationLoader:AnimationLoader,AnimationMixer:AnimationMixer,AnimationObjectGroup:AnimationObjectGroup,AnimationUtils:AnimationUtils,ArcCurve:ArcCurve,ArrayCamera:ArrayCamera,ArrowHelper:ArrowHelper,Audio:Audio,AudioAnalyser:AudioAnalyser,AudioContext:AudioContext,AudioListener:AudioListener,AudioLoader:AudioLoader,AxesHelper:AxesHelper,AxisHelper:AxisHelper,BackSide:BackSide,BasicDepthPacking:BasicDepthPacking,BasicShadowMap:BasicShadowMap,BinaryTextureLoader:BinaryTextureLoader,Bone:Bone,BooleanKeyframeTrack:BooleanKeyframeTrack,BoundingBoxHelper:BoundingBoxHelper,Box2:Box2,Box3:Box3,Box3Helper:Box3Helper,BoxBufferGeometry:BoxBufferGeometry,BoxGeometry:BoxGeometry,BoxHelper:BoxHelper,BufferAttribute:BufferAttribute,BufferGeometry:BufferGeometry,BufferGeometryLoader:BufferGeometryLoader,ByteType:ByteType,Cache:Cache,Camera:Camera,CameraHelper:CameraHelper,CanvasRenderer:CanvasRenderer,CanvasTexture:CanvasTexture,CatmullRomCurve3:CatmullRomCurve3,CineonToneMapping:CineonToneMapping,CircleBufferGeometry:CircleBufferGeometry,CircleGeometry:CircleGeometry,ClampToEdgeWrapping:ClampToEdgeWrapping,Clock:Clock,ClosedSplineCurve3:ClosedSplineCurve3,Color:Color,ColorKeyframeTrack:ColorKeyframeTrack,CompressedTexture:CompressedTexture,CompressedTextureLoader:CompressedTextureLoader,ConeBufferGeometry:ConeBufferGeometry,ConeGeometry:ConeGeometry,CubeCamera:CubeCamera,CubeGeometry:BoxGeometry,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,CubeTexture:CubeTexture,CubeTextureLoader:CubeTextureLoader,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,CubicInterpolant:CubicInterpolant,CullFaceBack:CullFaceBack,CullFaceFront:CullFaceFront,CullFaceFrontBack:CullFaceFrontBack,CullFaceNone:CullFaceNone,Curve:Curve,CurvePath:CurvePath,CustomBlending:CustomBlending,CustomToneMapping:CustomToneMapping,CylinderBufferGeometry:CylinderBufferGeometry,CylinderGeometry:CylinderGeometry,Cylindrical:Cylindrical,DataTexture:DataTexture,DataTexture2DArray:DataTexture2DArray,DataTexture3D:DataTexture3D,DataTextureLoader:DataTextureLoader,DecrementStencilOp:DecrementStencilOp,DecrementWrapStencilOp:DecrementWrapStencilOp,DefaultLoadingManager:DefaultLoadingManager,DepthFormat:DepthFormat,DepthStencilFormat:DepthStencilFormat,DepthTexture:DepthTexture,DirectionalLight:DirectionalLight,DirectionalLightHelper:DirectionalLightHelper,DiscreteInterpolant:DiscreteInterpolant,DodecahedronBufferGeometry:DodecahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DoubleSide:DoubleSide,DstAlphaFactor:DstAlphaFactor,DstColorFactor:DstColorFactor,DynamicBufferAttribute:DynamicBufferAttribute,DynamicCopyUsage:DynamicCopyUsage,DynamicDrawUsage:DynamicDrawUsage,DynamicReadUsage:DynamicReadUsage,EdgesGeometry:EdgesGeometry,EdgesHelper:EdgesHelper,EllipseCurve:EllipseCurve,EqualDepth:EqualDepth,EqualStencilFunc:EqualStencilFunc,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,Euler:Euler,EventDispatcher:EventDispatcher,ExtrudeBufferGeometry:ExtrudeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,Face3:Face3,Face4:Face4,FaceColors:FaceColors,FileLoader:FileLoader,FlatShading:FlatShading,Float32Attribute:Float32Attribute,Float32BufferAttribute:Float32BufferAttribute,Float64Attribute:Float64Attribute,Float64BufferAttribute:Float64BufferAttribute,FloatType:FloatType,Fog:Fog,FogExp2:FogExp2,Font:Font,FontLoader:FontLoader,FrontSide:FrontSide,Frustum:Frustum,GLBufferAttribute:GLBufferAttribute,GLSL1:GLSL1,GLSL3:GLSL3,GammaEncoding:GammaEncoding,Geometry:Geometry,GeometryUtils:GeometryUtils,GreaterDepth:GreaterDepth,GreaterEqualDepth:GreaterEqualDepth,GreaterEqualStencilFunc:GreaterEqualStencilFunc,GreaterStencilFunc:GreaterStencilFunc,GridHelper:GridHelper,Group:Group,HalfFloatType:HalfFloatType,HemisphereLight:HemisphereLight,HemisphereLightHelper:HemisphereLightHelper,HemisphereLightProbe:HemisphereLightProbe,IcosahedronBufferGeometry:IcosahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,ImageBitmapLoader:ImageBitmapLoader,ImageLoader:ImageLoader,ImageUtils:ImageUtils,ImmediateRenderObject:ImmediateRenderObject,IncrementStencilOp:IncrementStencilOp,IncrementWrapStencilOp:IncrementWrapStencilOp,InstancedBufferAttribute:InstancedBufferAttribute,InstancedBufferGeometry:InstancedBufferGeometry,InstancedInterleavedBuffer:InstancedInterleavedBuffer,InstancedMesh:InstancedMesh,Int16Attribute:Int16Attribute,Int16BufferAttribute:Int16BufferAttribute,Int32Attribute:Int32Attribute,Int32BufferAttribute:Int32BufferAttribute,Int8Attribute:Int8Attribute,Int8BufferAttribute:Int8BufferAttribute,IntType:IntType,InterleavedBuffer:InterleavedBuffer,InterleavedBufferAttribute:InterleavedBufferAttribute,Interpolant:Interpolant,InterpolateDiscrete:InterpolateDiscrete,InterpolateLinear:InterpolateLinear,InterpolateSmooth:InterpolateSmooth,InvertStencilOp:InvertStencilOp,JSONLoader:JSONLoader,KeepStencilOp:KeepStencilOp,KeyframeTrack:KeyframeTrack,LOD:LOD,LatheBufferGeometry:LatheBufferGeometry,LatheGeometry:LatheGeometry,Layers:Layers,LensFlare:LensFlare,LessDepth:LessDepth,LessEqualDepth:LessEqualDepth,LessEqualStencilFunc:LessEqualStencilFunc,LessStencilFunc:LessStencilFunc,Light:Light,LightProbe:LightProbe,LightShadow:LightShadow,Line:Line,Line3:Line3,LineBasicMaterial:LineBasicMaterial,LineCurve:LineCurve,LineCurve3:LineCurve3,LineDashedMaterial:LineDashedMaterial,LineLoop:LineLoop,LinePieces:LinePieces,LineSegments:LineSegments,LineStrip:LineStrip,LinearEncoding:LinearEncoding,LinearFilter:LinearFilter,LinearInterpolant:LinearInterpolant,LinearMipMapLinearFilter:LinearMipMapLinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearToneMapping:LinearToneMapping,Loader:Loader,LoaderUtils:LoaderUtils,LoadingManager:LoadingManager,LogLuvEncoding:LogLuvEncoding,LoopOnce:LoopOnce,LoopPingPong:LoopPingPong,LoopRepeat:LoopRepeat,LuminanceAlphaFormat:LuminanceAlphaFormat,LuminanceFormat:LuminanceFormat,MOUSE:MOUSE,Material:Material,MaterialLoader:MaterialLoader,Math:MathUtils,MathUtils:MathUtils,Matrix3:Matrix3,Matrix4:Matrix4,MaxEquation:MaxEquation,Mesh:Mesh,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshFaceMaterial:MeshFaceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,MinEquation:MinEquation,MirroredRepeatWrapping:MirroredRepeatWrapping,MixOperation:MixOperation,MultiMaterial:MultiMaterial,MultiplyBlending:MultiplyBlending,MultiplyOperation:MultiplyOperation,NearestFilter:NearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NeverDepth:NeverDepth,NeverStencilFunc:NeverStencilFunc,NoBlending:NoBlending,NoColors:NoColors,NoToneMapping:NoToneMapping,NormalAnimationBlendMode:NormalAnimationBlendMode,NormalBlending:NormalBlending,NotEqualDepth:NotEqualDepth,NotEqualStencilFunc:NotEqualStencilFunc,NumberKeyframeTrack:NumberKeyframeTrack,Object3D:Object3D,ObjectLoader:ObjectLoader,ObjectSpaceNormalMap:ObjectSpaceNormalMap,OctahedronBufferGeometry:OctahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OneFactor:OneFactor,OneMinusDstAlphaFactor:OneMinusDstAlphaFactor,OneMinusDstColorFactor:OneMinusDstColorFactor,OneMinusSrcAlphaFactor:OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:OneMinusSrcColorFactor,OrthographicCamera:OrthographicCamera,PCFShadowMap:PCFShadowMap,PCFSoftShadowMap:PCFSoftShadowMap,PMREMGenerator:PMREMGenerator,ParametricBufferGeometry:ParametricBufferGeometry,ParametricGeometry:ParametricGeometry,Particle:Particle,ParticleBasicMaterial:ParticleBasicMaterial,ParticleSystem:ParticleSystem,ParticleSystemMaterial:ParticleSystemMaterial,Path:Path,PerspectiveCamera:PerspectiveCamera,Plane:Plane,PlaneBufferGeometry:PlaneBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneHelper:PlaneHelper,PointCloud:PointCloud,PointCloudMaterial:PointCloudMaterial,PointLight:PointLight,PointLightHelper:PointLightHelper,Points:Points,PointsMaterial:PointsMaterial,PolarGridHelper:PolarGridHelper,PolyhedronBufferGeometry:PolyhedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PositionalAudio:PositionalAudio,PropertyBinding:PropertyBinding,PropertyMixer:PropertyMixer,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,Quaternion:Quaternion,QuaternionKeyframeTrack:QuaternionKeyframeTrack,QuaternionLinearInterpolant:QuaternionLinearInterpolant,REVISION:REVISION,RGBADepthPacking:RGBADepthPacking,RGBAFormat:RGBAFormat,RGBAIntegerFormat:RGBAIntegerFormat,RGBA_ASTC_10x10_Format:RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:RGBA_ASTC_8x8_Format,RGBA_BPTC_Format:RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format:RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format,RGBDEncoding:RGBDEncoding,RGBEEncoding:RGBEEncoding,RGBEFormat:RGBEFormat,RGBFormat:RGBFormat,RGBIntegerFormat:RGBIntegerFormat,RGBM16Encoding:RGBM16Encoding,RGBM7Encoding:RGBM7Encoding,RGB_ETC1_Format:RGB_ETC1_Format,RGB_ETC2_Format:RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:RGB_S3TC_DXT1_Format,RGFormat:RGFormat,RGIntegerFormat:RGIntegerFormat,RawShaderMaterial:RawShaderMaterial,Ray:Ray,Raycaster:Raycaster,RectAreaLight:RectAreaLight,RedFormat:RedFormat,RedIntegerFormat:RedIntegerFormat,ReinhardToneMapping:ReinhardToneMapping,RepeatWrapping:RepeatWrapping,ReplaceStencilOp:ReplaceStencilOp,ReverseSubtractEquation:ReverseSubtractEquation,RingBufferGeometry:RingBufferGeometry,RingGeometry:RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format:SRGB8_ALPHA8_ASTC_10x10_Format,SRGB8_ALPHA8_ASTC_10x5_Format:SRGB8_ALPHA8_ASTC_10x5_Format,SRGB8_ALPHA8_ASTC_10x6_Format:SRGB8_ALPHA8_ASTC_10x6_Format,SRGB8_ALPHA8_ASTC_10x8_Format:SRGB8_ALPHA8_ASTC_10x8_Format,SRGB8_ALPHA8_ASTC_12x10_Format:SRGB8_ALPHA8_ASTC_12x10_Format,SRGB8_ALPHA8_ASTC_12x12_Format:SRGB8_ALPHA8_ASTC_12x12_Format,SRGB8_ALPHA8_ASTC_4x4_Format:SRGB8_ALPHA8_ASTC_4x4_Format,SRGB8_ALPHA8_ASTC_5x4_Format:SRGB8_ALPHA8_ASTC_5x4_Format,SRGB8_ALPHA8_ASTC_5x5_Format:SRGB8_ALPHA8_ASTC_5x5_Format,SRGB8_ALPHA8_ASTC_6x5_Format:SRGB8_ALPHA8_ASTC_6x5_Format,SRGB8_ALPHA8_ASTC_6x6_Format:SRGB8_ALPHA8_ASTC_6x6_Format,SRGB8_ALPHA8_ASTC_8x5_Format:SRGB8_ALPHA8_ASTC_8x5_Format,SRGB8_ALPHA8_ASTC_8x6_Format:SRGB8_ALPHA8_ASTC_8x6_Format,SRGB8_ALPHA8_ASTC_8x8_Format:SRGB8_ALPHA8_ASTC_8x8_Format,Scene:Scene,SceneUtils:SceneUtils,ShaderChunk:ShaderChunk,ShaderLib:ShaderLib,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,Shape:Shape,ShapeBufferGeometry:ShapeBufferGeometry,ShapeGeometry:ShapeGeometry,ShapePath:ShapePath,ShapeUtils:ShapeUtils,ShortType:ShortType,Skeleton:Skeleton,SkeletonHelper:SkeletonHelper,SkinnedMesh:SkinnedMesh,SmoothShading:SmoothShading,Sphere:Sphere,SphereBufferGeometry:SphereBufferGeometry,SphereGeometry:SphereGeometry,Spherical:Spherical,SphericalHarmonics3:SphericalHarmonics3,Spline:Spline,SplineCurve:SplineCurve,SplineCurve3:SplineCurve3,SpotLight:SpotLight,SpotLightHelper:SpotLightHelper,Sprite:Sprite,SpriteMaterial:SpriteMaterial,SrcAlphaFactor:SrcAlphaFactor,SrcAlphaSaturateFactor:SrcAlphaSaturateFactor,SrcColorFactor:SrcColorFactor,StaticCopyUsage:StaticCopyUsage,StaticDrawUsage:StaticDrawUsage,StaticReadUsage:StaticReadUsage,StereoCamera:StereoCamera,StreamCopyUsage:StreamCopyUsage,StreamDrawUsage:StreamDrawUsage,StreamReadUsage:StreamReadUsage,StringKeyframeTrack:StringKeyframeTrack,SubtractEquation:SubtractEquation,SubtractiveBlending:SubtractiveBlending,TOUCH:TOUCH,TangentSpaceNormalMap:TangentSpaceNormalMap,TetrahedronBufferGeometry:TetrahedronBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TextBufferGeometry:TextBufferGeometry,TextGeometry:TextGeometry,Texture:Texture,TextureLoader:TextureLoader,TorusBufferGeometry:TorusBufferGeometry,TorusGeometry:TorusGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,Triangle:Triangle,TriangleFanDrawMode:TriangleFanDrawMode,TriangleStripDrawMode:TriangleStripDrawMode,TrianglesDrawMode:TrianglesDrawMode,TubeBufferGeometry:TubeBufferGeometry,TubeGeometry:TubeGeometry,UVMapping:UVMapping,Uint16Attribute:Uint16Attribute,Uint16BufferAttribute:Uint16BufferAttribute,Uint32Attribute:Uint32Attribute,Uint32BufferAttribute:Uint32BufferAttribute,Uint8Attribute:Uint8Attribute,Uint8BufferAttribute:Uint8BufferAttribute,Uint8ClampedAttribute:Uint8ClampedAttribute,Uint8ClampedBufferAttribute:Uint8ClampedBufferAttribute,Uniform:Uniform,UniformsLib:UniformsLib,UniformsUtils:UniformsUtils,UnsignedByteType:UnsignedByteType,UnsignedInt248Type:UnsignedInt248Type,UnsignedIntType:UnsignedIntType,UnsignedShort4444Type:UnsignedShort4444Type,UnsignedShort5551Type:UnsignedShort5551Type,UnsignedShort565Type:UnsignedShort565Type,UnsignedShortType:UnsignedShortType,VSMShadowMap:VSMShadowMap,Vector2:Vector2,Vector3:Vector3,Vector4:Vector4,VectorKeyframeTrack:VectorKeyframeTrack,Vertex:Vertex,VertexColors:VertexColors,VideoTexture:VideoTexture,WebGL1Renderer:WebGL1Renderer,WebGLCubeRenderTarget:WebGLCubeRenderTarget,WebGLMultisampleRenderTarget:WebGLMultisampleRenderTarget,WebGLRenderTarget:WebGLRenderTarget,WebGLRenderTargetCube:WebGLRenderTargetCube,WebGLRenderer:WebGLRenderer,WebGLUtils:WebGLUtils,WireframeGeometry:WireframeGeometry,WireframeHelper:WireframeHelper,WrapAroundEnding:WrapAroundEnding,XHRLoader:XHRLoader,ZeroCurvatureEnding:ZeroCurvatureEnding,ZeroFactor:ZeroFactor,ZeroSlopeEnding:ZeroSlopeEnding,ZeroStencilOp:ZeroStencilOp,sRGBEncoding:sRGBEncoding}),Lensflare=function e(){Mesh.call(this,e.Geometry,new MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var d=new Vector3,p=new Vector3,m=new DataTexture(new Uint8Array(768),16,16,RGBFormat);m.minFilter=NearestFilter,m.magFilter=NearestFilter,m.wrapS=ClampToEdgeWrapping,m.wrapT=ClampToEdgeWrapping;var f=new DataTexture(new Uint8Array(768),16,16,RGBFormat);f.minFilter=NearestFilter,f.magFilter=NearestFilter,f.wrapS=ClampToEdgeWrapping,f.wrapT=ClampToEdgeWrapping;var g=e.Geometry,v=new RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),y=new RawShaderMaterial({uniforms:{map:{value:m},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),x=new Mesh(g,v),_=[],t=LensflareElement.Shader,b=new RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:f},color:{value:new Color(16777215)},scale:{value:new Vector2},screenPosition:{value:new Vector3}},vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:AdditiveBlending,transparent:!0,depthWrite:!1}),w=new Mesh(g,b);this.addElement=function(e){_.push(e)};var M=new Vector2,S=new Vector2,T=new Box2,A=new Vector4;this.onBeforeRender=function(e,t,i){e.getCurrentViewport(A);var r=A.z/2,n=A.w/2;if(M.set((h=16/A.w)*(A.w/A.z),h),T.min.set(A.x,A.y),T.max.set(A.x+(A.z-16),A.y+(A.w-16)),p.setFromMatrixPosition(this.matrixWorld),p.applyMatrix4(i.matrixWorldInverse),!(0<p.z)&&(d.copy(p).applyMatrix4(i.projectionMatrix),S.x=A.x+d.x*r+r-8,S.y=A.y+d.y*n+n-8,T.containsPoint(S))){e.copyFramebufferToTexture(S,m),(c=v.uniforms).scale.value=M,c.screenPosition.value=d,e.renderBufferDirect(i,null,g,v,x,null),e.copyFramebufferToTexture(S,f),(c=y.uniforms).scale.value=M,c.screenPosition.value=d,e.renderBufferDirect(i,null,g,y,x,null);for(var a=2*-d.x,o=2*-d.y,s=0,l=_.length;s<l;s++){var c,h,u=_[s];(c=b.uniforms).color.value.copy(u.color),c.map.value=u.texture,c.screenPosition.value.x=d.x+a*u.distance,c.screenPosition.value.y=d.y+o*u.distance,c.scale.value.set((h=u.size/A.w)*(A.w/A.z),h),b.uniformsNeedUpdate=!0,e.renderBufferDirect(i,null,g,b,w,null)}}},this.dispose=function(){v.dispose(),y.dispose(),b.dispose(),m.dispose(),f.dispose();for(var e=0,t=_.length;e<t;e++)_[e].texture.dispose()}};Lensflare.prototype=Object.create(Mesh.prototype),Lensflare.prototype.constructor=Lensflare,Lensflare.prototype.isLensflare=!0;var LensflareElement=function(e,t,i,r){this.texture=e,this.size=t||1,this.distance=i||0,this.color=r||new Color(16777215)},z0b,B0b;LensflareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},Lensflare.Geometry=(z0b=new BufferGeometry,B0b=new InterleavedBuffer(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5),z0b.setIndex([0,1,2,0,2,3]),z0b.setAttribute("position",new InterleavedBufferAttribute(B0b,3,0,!1)),z0b.setAttribute("uv",new InterleavedBufferAttribute(B0b,2,3,!1)),z0b);var DDSLoader=function(e){CompressedTextureLoader.call(this,e)};DDSLoader.prototype=Object.assign(Object.create(CompressedTextureLoader.prototype),{constructor:DDSLoader,parse:function(e,t){var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e,t,i,r){for(var n=i*r*4,a=new Uint8Array(e,t,n),o=new Uint8Array(n),s=0,l=0,c=0;c<r;c++)for(var h=0;h<i;h++){var u=a[l],d=a[++l],p=a[++l],m=a[++l];l++,o[s]=p,o[++s]=d,o[++s]=u,o[++s]=m,s++}return o}var a,o=r("DXT1"),s=r("DXT3"),l=r("DXT5"),c=r("ETC1"),h=new Int32Array(e,0,31);if(542327876!==h[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),i;if(4&!h[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),i;var u,d=h[21],p=!1;switch(d){case o:a=8,i.format=RGB_S3TC_DXT1_Format;break;case s:a=16,i.format=RGBA_S3TC_DXT3_Format;break;case l:a=16,i.format=RGBA_S3TC_DXT5_Format;break;case c:a=8,i.format=RGB_ETC1_Format;break;default:if(!(32===h[22]&&16711680&h[23]&&65280&h[24]&&255&h[25]&&4278190080&h[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(u=d,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),i;p=!0,a=64,i.format=RGBAFormat}i.mipmapCount=1,131072&h[2]&&!1!==t&&(i.mipmapCount=Math.max(1,h[7]));var m=h[28];if(i.isCubemap=!!(512&m),i.isCubemap&&(!(1024&m)||!(2048&m)||!(4096&m)||!(8192&m)||!(16384&m)||!(32768&m)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),i;i.width=h[4],i.height=h[3];for(var f=h[1]+4,g=i.isCubemap?6:1,v=0;v<g;v++)for(var y=i.width,x=i.height,_=0;_<i.mipmapCount;_++){if(p)var b=(w=n(e,f,y,x)).length;else{b=Math.max(4,y)/4*Math.max(4,x)/4*a;var w=new Uint8Array(e,f,b)}i.mipmaps.push({data:w,width:y,height:x}),f+=b,y=Math.max(y>>1,1),x=Math.max(x>>1,1)}return i}});var WTextures=(R1b=new Map,S1b="./assets/textures/",T1b=new TextureLoader,U1b=new DDSLoader,V1b=0,{get:function(e){return R1b.has(e)?R1b.get(e):null},reset:function(){R1b.forEach(function(e,t){e.isTmp&&(e.dispose(),R1b.delete(t))})},clear:function(){V1b=0,R1b.forEach(function(e,t){e.dispose()}),R1b.clear()},add:function(e,t,i){t.isTmp=void 0===i||i,R1b.set(e,t)},make:function(e){var t;t=-1!=e.url.indexOf("dds")?U1b:T1b;var i,r=null;return i=void 0!==e.url?e.url.substring(e.url.lastIndexOf("/")+1,e.url.lastIndexOf(".")):void 0!==e.name?e.name:"txt"+V1b++,R1b.has(i)?(e.onLoad&&e.onLoad(R1b.get(i)),R1b.get(i)):void 0!==e.url?((r=e.onLoad?t.load(S1b+e.url,e.onLoad):t.load(S1b+e.url)).flipY=void 0===e.flip||e.flip,void 0!==e.repeat&&(r.repeat.fromArray(e.repeat),1<e.repeat[0]&&(r.wrapS=RepeatWrapping),1<e.repeat[1]&&(r.wrapT=RepeatWrapping)),1==e.wrap?r.wrapS=r.wrapT=RepeatWrapping:2==e.wrap?r.wrapS=r.wrapT=ClampToEdgeWrapping:3==e&&(r.wrapS=r.wrapT=MirroredRepeatWrapping),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),r.isTmp=void 0===e.isTmp||e.isTmp,r.encoding=sRGBEncoding,this.add(r.name=i,r),r):void 0}}),R1b,S1b,T1b,U1b,V1b,ConvexHull=(o2b=new Vector3,Object.assign(p2b.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.vertices.push(new s2b(e[t]));return this.compute(),this},setFromObject:function(e){var s=[];return e.updateMatrixWorld(!0),e.traverse(function(e){var t,i,r,n=e.geometry;if(void 0!==n)if(n.isGeometry){var a=n.vertices;for(t=0,i=a.length;t<i;t++)(r=a[t].clone()).applyMatrix4(e.matrixWorld),s.push(r)}else if(n.isBufferGeometry){var o=n.attributes.position;if(void 0!==o)for(t=0,i=o.count;t<i;t++)(r=new Vector3).fromBufferAttribute(o,t).applyMatrix4(e.matrixWorld),s.push(r)}}),this.setFromPoints(s)},containsPoint:function(e){for(var t=this.faces,i=0,r=t.length;i<r;i++)if(t[i].distanceToPoint(e)>this.tolerance)return!1;return!0},intersectRay:function(e,t){for(var i=this.faces,r=-1/0,n=1/0,a=0,o=i.length;a<o;a++){var s=i[a],l=s.distanceToPoint(e.origin),c=s.normal.dot(e.direction);if(0<l&&0<=c)return null;var h=0!==c?-l/c:0;if(!(h<=0)&&(0<c?n=Math.min(h,n):r=Math.max(h,r),n<r))return null}return e.at(r!==-1/0?r:n,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,o2b)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return null===(e.face=t).outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(t.outside=null!==e.next&&e.next.face===t?e.next:null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,i=e.outside;null!==i.next&&i.next.face===e;)i=i.next;return this.assigned.removeSubList(t,i),t.prev=i.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var i=this.removeAllVerticesFromFace(e);if(void 0!==i)if(void 0===t)this.unassigned.appendChain(i);else{var r=i;do{var n=r.next,a=t.distanceToPoint(r.point);this.tolerance<a?this.addVertexToFace(r,t):this.unassigned.append(r),r=n}while(null!==r)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var i=t.next,r=this.tolerance,n=null,a=0;a<e.length;a++){var o=e[a];if(0===o.mark){var s=o.distanceToPoint(t.point);if(r<s&&(r=s,n=o),1e3*this.tolerance<r)break}}null!==n&&this.addVertexToFace(t,n),t=i}while(null!==t)}return this},computeExtremes:function(){var e,t,i,r=new Vector3,n=new Vector3,a=[],o=[];for(e=0;e<3;e++)a[e]=o[e]=this.vertices[0];for(r.copy(this.vertices[0].point),n.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var s=this.vertices[e],l=s.point;for(i=0;i<3;i++)l.getComponent(i)<r.getComponent(i)&&(r.setComponent(i,l.getComponent(i)),a[i]=s);for(i=0;i<3;i++)l.getComponent(i)>n.getComponent(i)&&(n.setComponent(i,l.getComponent(i)),o[i]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(n.x))+Math.max(Math.abs(r.y),Math.abs(n.y))+Math.max(Math.abs(r.z),Math.abs(n.z))),{min:a,max:o}},computeInitialHull:function(){void 0===L3b&&(L3b=new Line3,M3b=new Plane,N3b=new Vector3);var e,t,i,r,n,a,o,s,l,c=this.vertices,h=this.computeExtremes(),u=h.min,d=h.max,p=0,m=0;for(a=0;a<3;a++)p<(l=d[a].point.getComponent(a)-u[a].point.getComponent(a))&&(p=l,m=a);for(p=0,L3b.set((t=u[m]).point,(i=d[m]).point),a=0,o=this.vertices.length;a<o;a++)(e=c[a])!==t&&e!==i&&(L3b.closestPointToPoint(e.point,!0,N3b),p<(l=N3b.distanceToSquared(e.point))&&(p=l,r=e));for(p=-1,M3b.setFromCoplanarPoints(t.point,i.point,r.point),a=0,o=this.vertices.length;a<o;a++)(e=c[a])!==t&&e!==i&&e!==r&&p<(l=Math.abs(M3b.distanceToPoint(e.point)))&&(p=l,n=e);var f=[];if(M3b.distanceToPoint(n.point)<0)for(f.push(q2b.create(t,i,r),q2b.create(n,i,t),q2b.create(n,r,i),q2b.create(n,t,r)),a=0;a<3;a++)s=(a+1)%3,f[a+1].getEdge(2).setTwin(f[0].getEdge(s)),f[a+1].getEdge(1).setTwin(f[s+1].getEdge(0));else for(f.push(q2b.create(t,r,i),q2b.create(n,t,i),q2b.create(n,i,r),q2b.create(n,r,t)),a=0;a<3;a++)s=(a+1)%3,f[a+1].getEdge(2).setTwin(f[0].getEdge((3-a)%3)),f[a+1].getEdge(0).setTwin(f[s+1].getEdge(1));for(a=0;a<4;a++)this.faces.push(f[a]);for(a=0,o=c.length;a<o;a++)if((e=c[a])!==t&&e!==i&&e!==r&&e!==n){p=this.tolerance;var g=null;for(s=0;s<4;s++)p<(l=this.faces[s].distanceToPoint(e.point))&&(p=l,g=this.faces[s]);null!==g&&this.addVertexToFace(e,g)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var i=this.faces[t];0===i.mark&&e.push(i)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,i=this.assigned.first().face,r=i.outside;do{var n=i.distanceToPoint(r.point);t<n&&(t=n,e=r),r=r.next}while(null!==r&&r.face===i);return e}},computeHorizon:function(e,t,i,r){var n;this.deleteFaceVertices(i),i.mark=1,n=null===t?t=i.getEdge(0):t.next;do{var a=n.twin,o=a.face;0===o.mark&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,a,o,r):r.push(n)),n=n.next}while(n!==t);return this},addAdjoiningFace:function(e,t){var i=q2b.create(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setTwin(t.twin),i.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var i=null,r=null,n=0;n<t.length;n++){var a=this.addAdjoiningFace(e,t[n]);null===i?i=a:a.next.setTwin(r),this.newFaces.push(a.face),r=a}return i.next.setTwin(r),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(q2b,{create:function(e,t,i){var r=new q2b,n=new r2b(e,r),a=new r2b(t,r),o=new r2b(i,r);return n.next=o.prev=a,a.next=n.prev=o,o.next=a.prev=n,r.edge=n,r.compute()}}),Object.assign(q2b.prototype,{getEdge:function(e){for(var t=this.edge;0<e;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===Z4b&&(Z4b=new Triangle);var e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return Z4b.set(e.point,t.point,i.point),Z4b.getNormal(this.normal),Z4b.getMidpoint(this.midpoint),this.area=Z4b.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(r2b.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return(this.twin=e).twin=this}}),Object.assign(t2b.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),p2b),L3b,M3b,N3b,Z4b,o2b;function p2b(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new t2b,this.unassigned=new t2b,this.vertices=[]}function q2b(){this.normal=new Vector3,this.midpoint=new Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function r2b(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function s2b(e){this.point=e,this.prev=null,this.next=null,this.face=null}function t2b(){this.head=null,this.tail=null}var ConvexGeometry=function(e){Geometry.call(this),this.fromBufferGeometry(new ConvexBufferGeometry(e)),this.mergeVertices()};ConvexGeometry.prototype=Object.create(Geometry.prototype),ConvexGeometry.prototype.constructor=ConvexGeometry;var ConvexBufferGeometry=function(e){BufferGeometry.call(this);var t=[],i=[];void 0===ConvexHull&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");for(var r=(new ConvexHull).setFromPoints(e).faces,n=0;n<r.length;n++){var a=r[n],o=a.edge;do{var s=o.head().point;t.push(s.x,s.y,s.z),i.push(a.normal.x,a.normal.y,a.normal.z),o=o.next}while(o!==a.edge)}this.setAttribute("position",new Float32BufferAttribute(t,3)),this.setAttribute("normal",new Float32BufferAttribute(i,3))};ConvexBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ConvexBufferGeometry.prototype.constructor=ConvexBufferGeometry;var ThreeBSP=((W5b=function(e){var t,i,r,n,a,o,s,l=[];if(e instanceof Geometry)this.matrix=new Matrix4;else{if(!(e instanceof Mesh)){if(e instanceof W5b.Node)return this.tree=e,this.matrix=new Matrix4,this;throw"ThreeBSP: Given geometry is unsupported"}e.updateMatrix(),this.matrix=e.matrix.clone(),e=e.geometry}for(t=0,i=e.faces.length;t<i;t++){if(r=e.faces[t],a=e.faceVertexUvs[0][t],s=new W5b.Polygon,r instanceof Face3)n=e.vertices[r.a],o=a?new Vector2(a[0].x,a[0].y):null,(n=new W5b.Vertex(n.x,n.y,n.z,r.vertexNormals[0],o)).applyMatrix4(this.matrix),s.vertices.push(n),n=e.vertices[r.b],o=a?new Vector2(a[1].x,a[1].y):null,(n=new W5b.Vertex(n.x,n.y,n.z,r.vertexNormals[1],o)).applyMatrix4(this.matrix),s.vertices.push(n),n=e.vertices[r.c],o=a?new Vector2(a[2].x,a[2].y):null,(n=new W5b.Vertex(n.x,n.y,n.z,r.vertexNormals[2],o)).applyMatrix4(this.matrix),s.vertices.push(n);else{if(!_typeof(Face4))throw"Invalid face type at index "+t;n=e.vertices[r.a],o=a?new Vector2(a[0].x,a[0].y):null,(n=new W5b.Vertex(n.x,n.y,n.z,r.vertexNormals[0],o)).applyMatrix4(this.matrix),s.vertices.push(n),n=e.vertices[r.b],o=a?new Vector2(a[1].x,a[1].y):null,(n=new W5b.Vertex(n.x,n.y,n.z,r.vertexNormals[1],o)).applyMatrix4(this.matrix),s.vertices.push(n),n=e.vertices[r.c],o=a?new Vector2(a[2].x,a[2].y):null,(n=new W5b.Vertex(n.x,n.y,n.z,r.vertexNormals[2],o)).applyMatrix4(this.matrix),s.vertices.push(n),n=e.vertices[r.d],o=a?new Vector2(a[3].x,a[3].y):null,(n=new W5b.Vertex(n.x,n.y,n.z,r.vertexNormals[3],o)).applyMatrix4(this.matrix),s.vertices.push(n)}s.calculateProperties(),l.push(s)}this.tree=new W5b.Node(l)}).prototype.subtract=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),(t=new W5b(t)).matrix=this.matrix,t},W5b.prototype.union=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),(t=new W5b(t)).matrix=this.matrix,t},W5b.prototype.intersect=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),(t=new W5b(t)).matrix=this.matrix,t},W5b.prototype.toGeometry=function(){var e,t,i,r,n,a,o,s,l,c,h=(new Matrix4).getInverse(this.matrix),u=new Geometry,d=this.tree.allPolygons(),p=d.length,m={};for(e=0;e<p;e++)for(r=(i=d[e]).vertices.length,t=2;t<r;t++)(c=[]).push(new Vector2((s=i.vertices[0]).uv.x,s.uv.y)),(s=new Vector3(s.x,s.y,s.z)).applyMatrix4(h),n=void 0!==m[s.x+","+s.y+","+s.z]?m[s.x+","+s.y+","+s.z]:(u.vertices.push(s),m[s.x+","+s.y+","+s.z]=u.vertices.length-1),c.push(new Vector2((s=i.vertices[t-1]).uv.x,s.uv.y)),(s=new Vector3(s.x,s.y,s.z)).applyMatrix4(h),a=void 0!==m[s.x+","+s.y+","+s.z]?m[s.x+","+s.y+","+s.z]:(u.vertices.push(s),m[s.x+","+s.y+","+s.z]=u.vertices.length-1),c.push(new Vector2((s=i.vertices[t]).uv.x,s.uv.y)),(s=new Vector3(s.x,s.y,s.z)).applyMatrix4(h),o=void 0!==m[s.x+","+s.y+","+s.z]?m[s.x+","+s.y+","+s.z]:(u.vertices.push(s),m[s.x+","+s.y+","+s.z]=u.vertices.length-1),l=new Face3(n,a,o,new Vector3(i.normal.x,i.normal.y,i.normal.z)),u.faces.push(l),u.faceVertexUvs[0].push(c);return u},W5b.prototype.toMesh=function(e){var t=new Mesh(this.toGeometry(),e);return t.position.setFromMatrixPosition(this.matrix),t.rotation.setFromRotationMatrix(this.matrix),t},W5b.Polygon=function(e,t,i){e instanceof Array||(e=[]),0<(this.vertices=e).length?this.calculateProperties():this.normal=this.w=void 0},W5b.Polygon.prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[2];return this.normal=this.vertices[1].clone().subtract(e).cross(t.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this},W5b.Polygon.prototype.clone=function(){var e,t,i=new W5b.Polygon;for(e=0,t=this.vertices.length;e<t;e++)i.vertices.push(this.vertices[e].clone());return i.calculateProperties(),i},W5b.Polygon.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;0<=e;e--)t.push(this.vertices[e]);return this.vertices=t,this},W5b.Polygon.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:1e-5<t?1:0},W5b.Polygon.prototype.classifySide=function(e){var t,i,r=0,n=0,a=e.vertices.length;for(t=0;t<a;t++)1===(i=this.classifyVertex(e.vertices[t]))?r++:2===i&&n++;return 0<r&&0===n?1:0===r&&0<n?2:0===r&&0===n?0:3},W5b.Polygon.prototype.splitPolygon=function(e,t,i,r,n){var a=this.classifySide(e);if(0===a)(0<this.normal.dot(e.normal)?t:i).push(e);else if(1===a)r.push(e);else if(2===a)n.push(e);else{var o,s,l,c,h,u,d,p,m=[],f=[];for(s=0,o=e.vertices.length;s<o;s++)u=e.vertices[(s+1)%o],l=this.classifyVertex(h=e.vertices[s]),c=this.classifyVertex(u),2!=l&&m.push(h),1!=l&&f.push(h),3==(l|c)&&(d=(this.w-this.normal.dot(h))/this.normal.dot(u.clone().subtract(h)),p=h.interpolate(u,d),m.push(p),f.push(p));3<=m.length&&r.push(new W5b.Polygon(m).calculateProperties()),3<=f.length&&n.push(new W5b.Polygon(f).calculateProperties())}},W5b.Vertex=function(e,t,i,r,n){this.x=e,this.y=t,this.z=i,this.normal=r||new Vector3,this.uv=n||new Vector2},W5b.Vertex.prototype.clone=function(){return new W5b.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},W5b.Vertex.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},W5b.Vertex.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},W5b.Vertex.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},W5b.Vertex.prototype.cross=function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},W5b.Vertex.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},W5b.Vertex.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},W5b.Vertex.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this},W5b.Vertex.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},W5b.Vertex.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},W5b.Node=function(e){var t,i,r=[],n=[];if(this.polygons=[],this.front=this.back=void 0,e instanceof Array&&0!==e.length){for(this.divider=e[0].clone(),t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,r,n);0<r.length&&(this.front=new W5b.Node(r)),0<n.length&&(this.back=new W5b.Node(n))}},W5b.Node.isConvex=function(e){var t,i;for(t=0;t<e.length;t++)for(i=0;i<e.length;i++)if(t!==i&&2!==e[t].classifySide(e[i]))return!1;return!0},W5b.Node.prototype.build=function(e){var t,i,r=[],n=[];for(this.divider||(this.divider=e[0].clone()),t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,r,n);0<r.length&&(this.front||(this.front=new W5b.Node),this.front.build(r)),0<n.length&&(this.back||(this.back=new W5b.Node),this.back.build(n))},W5b.Node.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},W5b.Node.prototype.clone=function(){var e=new W5b.Node;return e.divider=this.divider.clone(),e.polygons=this.polygons.map(function(e){return e.clone()}),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e},W5b.Node.prototype.invert=function(){var e,t,i;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),i=this.front,this.front=this.back,this.back=i,this},W5b.Node.prototype.clipPolygons=function(e){var t,i,r,n;if(!this.divider)return e.slice();for(r=[],n=[],t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],r,n,r,n);return this.front&&(r=this.front.clipPolygons(r)),n=this.back?this.back.clipPolygons(n):[],r.concat(n)},W5b.Node.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},W5b),W5b,BufferGeometryUtils={computeTangents:function(e){var t=e.index,i=e.attributes;if(null!==t&&void 0!==i.position&&void 0!==i.normal&&void 0!==i.uv){var r=t.array,n=i.position.array,a=i.normal.array,o=i.uv.array,s=n.length/3;void 0===i.tangent&&e.setAttribute("tangent",new BufferAttribute(new Float32Array(4*s),4));for(var l=i.tangent.array,c=[],h=[],u=0;u<s;u++)c[u]=new Vector3,h[u]=new Vector3;var d=new Vector3,p=new Vector3,m=new Vector3,f=new Vector2,g=new Vector2,v=new Vector2,y=new Vector3,x=new Vector3,_=e.groups;0===_.length&&(_=[{start:0,count:r.length}]);u=0;for(var b=_.length;u<b;++u)for(var w=D=(P=_[u]).start,M=D+P.count;w<M;w+=3)k(r[w+0],r[w+1],r[w+2]);var S,T,A,E=new Vector3,C=new Vector3,L=new Vector3,R=new Vector3;for(u=0,b=_.length;u<b;++u){var P,D;for(w=D=(P=_[u]).start,M=D+P.count;w<M;w+=3)B(r[w+0]),B(r[w+1]),B(r[w+2])}}else console.error("THREE.BufferGeometryUtils: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function k(e,t,i){d.fromArray(n,3*e),p.fromArray(n,3*t),m.fromArray(n,3*i),f.fromArray(o,2*e),g.fromArray(o,2*t),v.fromArray(o,2*i),p.sub(d),m.sub(d),g.sub(f),v.sub(f);var r=1/(g.x*v.y-v.x*g.y);isFinite(r)&&(y.copy(p).multiplyScalar(v.y).addScaledVector(m,-g.y).multiplyScalar(r),x.copy(m).multiplyScalar(g.x).addScaledVector(p,-v.x).multiplyScalar(r),c[e].add(y),c[t].add(y),c[i].add(y),h[e].add(x),h[t].add(x),h[i].add(x))}function B(e){L.fromArray(a,3*e),R.copy(L),E.copy(T=c[e]),E.sub(L.multiplyScalar(L.dot(T))).normalize(),C.crossVectors(R,T),A=C.dot(h[e]),S=A<0?-1:1,l[4*e]=E.x,l[4*e+1]=E.y,l[4*e+2]=E.z,l[4*e+3]=S}},mergeBufferGeometries:function(e,t){for(var i=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),a={},o={},s=e[0].morphTargetsRelative,l=new BufferGeometry,c=0,h=0;h<e.length;++h){var u=e[h],d=0;if(i!=(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var p in u.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[p]&&(a[p]=[]),a[p].push(u.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(s!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var p in u.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[p]&&(o[p]=[]),o[p].push(u.morphAttributes[p])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(u.userData),t){var m;if(i)m=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;m=u.attributes.position.count}l.addGroup(c,m,h),c+=m}}if(i){var f=0,g=[];for(h=0;h<e.length;++h){for(var v=e[h].index,y=0;y<v.count;++y)g.push(v.getX(y)+f);f+=e[h].attributes.position.count}l.setIndex(g)}for(var p in a){var x=this.mergeBufferAttributes(a[p]);if(!x)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+p+" attribute."),null;l.setAttribute(p,x)}for(var p in o){var _=o[p][0].length;if(0===_)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[p]=[];for(h=0;h<_;++h){var b=[];for(y=0;y<o[p].length;++y)b.push(o[p][y][h]);var w=this.mergeBufferAttributes(b);if(!w)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+p+" morphAttribute."),null;l.morphAttributes[p].push(w)}}return l},mergeBufferAttributes:function(e){for(var t,i,r,n=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=o.itemSize),i!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=o.array.length}var s=new t(n),l=0;for(a=0;a<e.length;++a)s.set(e[a].array,l),l+=e[a].array.length;return new BufferAttribute(s,i,r)},interleaveAttributes:function(e){for(var t,i=0,r=0,n=0,a=e.length;n<a;++n){var o=e[n];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=o.array.length,r+=o.itemSize}var s=new InterleavedBuffer(new t(i),r),l=0,c=[],h=["getX","getY","getZ","getW"],u=["setX","setY","setZ","setW"],d=0;for(a=e.length;d<a;d++){var p=(o=e[d]).itemSize,m=o.count,f=new InterleavedBufferAttribute(s,p,l,o.normalized);c.push(f),l+=p;for(var g=0;g<m;g++)for(var v=0;v<p;v++)f[u[v]](g,o[h[v]](g))}return c},estimateBytesUsed:function(e){var t=0;for(var i in e.attributes){var r=e.getAttribute(i);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t){var i=1<arguments.length&&void 0!==t?t:1e-4;i=Math.max(i,Number.EPSILON);for(var r={},n=e.getIndex(),a=e.getAttribute("position"),o=n?n.count:a.count,s=0,l=Object.keys(e.attributes),c={},h={},u=[],d=["getX","getY","getZ","getW"],p=0,m=l.length;p<m;p++){c[R=l[p]]=[],(M=e.morphAttributes[R])&&(h[R]=new Array(M.length).fill().map(function(){return[]}))}var f=Math.log10(1/i),g=Math.pow(10,f);for(p=0;p<o;p++){var v=n?n.getX(p):p,y="",x=0;for(m=l.length;x<m;x++)for(var _=(w=e.getAttribute(R=l[x])).itemSize,b=0;b<_;b++)y+="".concat(~~(w[d[b]](v)*g),",");if(y in r)u.push(r[y]);else{for(x=0,m=l.length;x<m;x++){var w=e.getAttribute(R=l[x]),M=e.morphAttributes[R],S=(_=w.itemSize,c[R]),T=h[R];for(b=0;b<_;b++){var A=d[b];if(S.push(w[A](v)),M)for(var E=0,C=M.length;E<C;E++)T[E].push(M[E][A](v))}}u.push(r[y]=s),s++}}var L=e.clone();for(p=0,m=l.length;p<m;p++){var R,P=e.getAttribute(R=l[p]);w=new BufferAttribute(new P.array.constructor(c[R]),P.itemSize,P.normalized);if(L.setAttribute(R,w),R in h)for(x=0;x<h[R].length;x++){var D=e.morphAttributes[R][x],k=new BufferAttribute(new D.array.constructor(h[R][x]),D.itemSize,D.normalized);L.morphAttributes[R][x]=k}}return L.setIndex(u),L},toTrianglesDrawMode:function(e,t){if(t===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==TriangleFanDrawMode&&t!==TriangleStripDrawMode)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;var i=e.getIndex();if(null===i){var r=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<n.count;a++)r.push(a);e.setIndex(r),i=e.getIndex()}var o=i.count-2,s=[];if(t===TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(i.getX(0)),s.push(i.getX(a)),s.push(i.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(i.getX(a)),s.push(i.getX(a+1)),s.push(i.getX(a+2))):(s.push(i.getX(a+2)),s.push(i.getX(a+1)),s.push(i.getX(a)));s.length/3!=o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l.clearGroups(),l}},TerrainData=function e(t,i,r,n,a,o,s,l){this.position=t,this.width=i,this.height=r,this.altitude=n,this.scale={x:1,y:1,z:1},this._min={x:0,z:0},this._max={x:0,z:0};var c={setHeight:function(e,t,i,r){this._fromArray("hmap"==e.type?this._loadImage(e.data,i):e.data,t,i||1,r||1)},getHeightAt:function(e,t){if(t-=this.position.z,(e-=this.position.x)<=this._min.x*this.scale.x||this._max.x*this.scale.x<=e||t<=this._min.z*this.scale.z||this._max.z*this.scale.z<=t)return null;var i=this._min.z*this.scale.z,r=Math.floor((e-this._min.x*this.scale.x)/(this._quadWidth*this.scale.x)),n=Math.floor((t-i)/(this._quadHeight*this.scale.z));return 0<=n||n<this.rows||0<=r&&r<this.col?this.getQuadHeightAt(e/this.scale.x,t/this.scale.z,this._quadGrid[n*this.cols+r])*this.scale.y+this.position.y:this.position.y},getAngleAt:function(e,t,i,r){var n=e+Math.sin(r)*i,a=t+Math.cos(r)*i,o=e-Math.sin(r)*i,s=t-Math.cos(r)*i,l=this.getHeightAt(n,a)||0,c=((this.getHeightAt(o,s)||0)-l)/Math.sqrt(Math.pow(o-n,2)+Math.pow(s-a,2));return Math.atan(c)},generateLightMap:function(e,t,i){var r=new Uint8Array(this.cols*this.rows);return this._createLightMap(this._heightData,r,this.cols,this.rows,e,t,i)},getQuadHeightAt:function(e,t,i){var r,n,a,o=this._quadList[i],s=e-o[0].x,l=t-o[0].z;a=1===o[4]?l<s?(r=o[0],n=o[2],o[3]):(r=o[0],n=o[1],o[2]):(n=1-s<l?(r=o[1],o[2]):(r=o[0],o[1]),o[3]);var c=(n.z-a.z)*(r.x-a.x)+(a.x-n.x)*(r.z-a.z),h=((n.z-a.z)*(e-a.x)+(a.x-n.x)*(t-a.z))/c,u=((a.z-r.z)*(e-a.x)+(r.x-a.x)*(t-a.z))/c;return h*r.y+u*n.y+(1-h-u)*a.y},_fromArray:function(e,t,i,r){this.cols=i,this.rows=r,this._min.x=-this.width/2,this._min.z=-this.height/2,this._max.x=this.width/2,this._max.z=this.height/2,this._quadWidth=this.width/this.cols,this._quadHeight=this.height/this.rows,this._quadGrid=null,this._quadList=null,this._heightData=e,this._createGeometry(this._getRectangles(this._parseHeight(e,t))),this._vertexHeight=null},_loadImage:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=e.width,n=e.height,a=r*n;t.width=r,t.height=n,i.drawImage(e,0,0);for(var o=i.getImageData(0,0,r,n).data,s=new Uint8Array(a),l=0,c=0;l<a;l++){s[l]=(o[c]+o[c+1]+o[c+2])/3/255*this.altitude,c+=4}return s},_parseHeight:function(e,t){var i,r,n=this.cols+1,a=this.rows+1;for(this._vertexHeight=new Float32Array(a*n),r=0;r<a;r++)for(i=0;i<n;i++){for(var o=0,s=0,l=r-1;l<=r;l++)if(0<=l&&l<this.rows)for(var c=i-1;c<=i;c++)0<=c&&c<this.cols&&(s+=e[l*this.cols+c],o++);0!==o&&(s/=o),this._vertexHeight[r*n+i]=s/=t}var h=new Float32Array(this.rows*this.cols);this._quadGrid=new Array(this.rows*this.cols);var u=this._vertexHeight;for(r=0;r<this.rows;r++)for(i=0;i<this.cols;i++){h[r*this.cols+i]=13*u[i+n*r]+47*u[i+n*(r+1)]+179*u[i+1+n*(r+1)]+509*u[i+1+n*r]}return h},_getRectAt:function(e,t,i,r){var n,a,o,s,l=null,c=1,h=0;e:for(;;){for(h=c,a=r;a<r+c;a++){if(this.rows<=a)break e;for(n=i;n<i+c;n++)if(n<this.cols?(o=e[s=a*this.cols+n],null===l&&(l=o)):o=null,o!==l||t[s])break e}c++}for(h--,a=r;a<r+h;a++)for(n=i;n<i+h;n++)t[a*this.cols+n]=1;return[i,r,h,h]},_getRectangles:function(e){var t,i,r,n,a=[],o=new Uint8Array(this.rows*this.cols);for(r=0,n=this.rows;r<n;r++)for(t=0,i=this.cols;t<i;t++)0===o[r*i+t]&&a.push(this._getRectAt(e,o,t,r));return a},_createGeometry:function(e){var t=e.length,i=(new Vector3(0,1,0),this.width/2),r=this.height/2,n=this._quadWidth,a=this._quadHeight,o=0,s=0,l=0;this.vertices=new Array(4*t),this.faces=new Array(2*t),this._quadList=new Array(t);var c={};function h(e,t,i){var r=13*e+179*t+509*i;return c[r]?c[r]:new Vector3(e,t,i)}for(var u=this.cols+1,d=0;d<t;d++){var p=e[d],m=p[0],f=p[1],g=p[2],v=p[3],y=this._vertexHeight[f*u+m],x=this._vertexHeight[(f+v)*u+m],_=this._vertexHeight[(f+v)*u+(m+g)],b=this._vertexHeight[f*u+(m+g)],w=y-_<b-x?1:0;this.faces[l++]=void 0,this.faces[l++]=void 0;var M=h(m*n-i,y,f*a-r),S=h(m*n-i,x,(f+v)*a-r),T=h((m+g)*n-i,_,(f+v)*a-r),A=h((m+g)*n-i,b,f*a-r);if(this.vertices[s++]=M,this.vertices[s++]=S,this.vertices[s++]=T,this.vertices[s++]=A,1===g&&1===v)this._quadGrid[f*this.cols+m]=o;else for(var E=f;E<f+v;E++)for(var C=m;C<m+g;C++)this._quadGrid[E*this.cols+C]=o;this._quadList[o++]=[M,S,T,A,w]}this.dynamic=!1},_createLightMap:function(e,t,i,r,n,a,o){for(var s=0,l=0,c=0,h=0,u=0,d=0,p=0,m=0;m<r;m++)for(var f=0;f<i;f++){var g=m*i+f;for(h=n-(s=f),u=a-(l=e[g]),d=o-(c=m),p=Math.sqrt(h*h+u*u+d*d),t[g]=255;0<=s&&s<i&&0<=c&&c<r&&l<255&&(s!==n||l!==a||c!==o);)if(s+=h/p,c+=d/p,(l+=u/p)<=e[Math.round(c)*i+Math.round(s)]){t[g]=0;break}}return t}};for(var h in c)c.hasOwnProperty(h)&&(e.prototype[h]=c[h]);this.setHeight(a,o,s,l)},SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};SimplexNoise.prototype.dot=function(e,t,i){return e[0]*t+e[1]*i},SimplexNoise.prototype.dot3=function(e,t,i,r){return e[0]*t+e[1]*i+e[2]*r},SimplexNoise.prototype.dot4=function(e,t,i,r,n){return e[0]*t+e[1]*i+e[2]*r+e[3]*n},SimplexNoise.prototype.noise=function(e,t){var i,r,n=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+n),o=Math.floor(t+n),s=(3-Math.sqrt(3))/6,l=(a+o)*s,c=e-(a-l),h=t-(o-l);r=h<c?(i=1,0):(i=0,1);var u=c-i+s,d=h-r+s,p=c-1+2*s,m=h-1+2*s,f=255&a,g=255&o,v=this.perm[f+i+this.perm[g+r]]%12,y=this.perm[1+f+this.perm[1+g]]%12,x=.5-c*c-h*h,_=.5-u*u-d*d,b=.5-p*p-m*m;return 70*((x<0?0:(x*=x)*x*this.dot(this.grad3[this.perm[f+this.perm[g]]%12],c,h))+(_<0?0:(_*=_)*_*this.dot(this.grad3[v],u,d))+(b<0?0:(b*=b)*b*this.dot(this.grad3[y],p,m)))},SimplexNoise.prototype.noise3d=function(e,t,i){var r,n,a,o,s,l,c=(e+t+i)*(1/3),h=Math.floor(e+c),u=Math.floor(t+c),d=Math.floor(i+c),p=(h+u+d)*(1/6),m=e-(h-p),f=t-(u-p),g=i-(d-p);l=f<=m?g<=f?(s=o=r=1,a=n=0):o=g<=m?(s=a=n=0,r=1):(s=n=r=0,a=1):f<g?(o=n=r=0,s=a=1):m<g?(o=a=r=0,s=n=1):(s=o=n=1,a=r=0);var v=m-r+1/6,y=f-n+1/6,x=g-a+1/6,_=m-o+1/6*2,b=f-s+1/6*2,w=g-l+1/6*2,M=m-1+.5,S=f-1+.5,T=g-1+.5,A=255&h,E=255&u,C=255&d,L=this.perm[A+r+this.perm[E+n+this.perm[C+a]]]%12,R=this.perm[A+o+this.perm[E+s+this.perm[C+l]]]%12,P=this.perm[1+A+this.perm[1+E+this.perm[1+C]]]%12,D=.6-m*m-f*f-g*g,k=.6-v*v-y*y-x*x,B=.6-_*_-b*b-w*w,F=.6-M*M-S*S-T*T;return 32*((D<0?0:(D*=D)*D*this.dot3(this.grad3[this.perm[A+this.perm[E+this.perm[C]]]%12],m,f,g))+(k<0?0:(k*=k)*k*this.dot3(this.grad3[L],v,y,x))+(B<0?0:(B*=B)*B*this.dot3(this.grad3[R],_,b,w))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[P],M,S,T)))},SimplexNoise.prototype.noise4d=function(e,t,i,r){var n,a,o,s,l,c,h,u,d,p,m,f,g=this.grad4,v=this.simplex,y=this.perm,x=(Math.sqrt(5)-1)/4,_=(5-Math.sqrt(5))/20,b=(e+t+i+r)*x,w=Math.floor(e+b),M=Math.floor(t+b),S=Math.floor(i+b),T=Math.floor(r+b),A=(w+M+S+T)*_,E=e-(w-A),C=t-(M-A),L=i-(S-A),R=r-(T-A),P=(C<E?32:0)+(L<E?16:0)+(L<C?8:0)+(R<E?4:0)+(R<C?2:0)+(R<L?1:0),D=E-(n=3<=v[P][0]?1:0)+_,k=C-(a=3<=v[P][1]?1:0)+_,B=L-(o=3<=v[P][2]?1:0)+_,F=R-(s=3<=v[P][3]?1:0)+_,I=E-(l=2<=v[P][0]?1:0)+2*_,O=C-(c=2<=v[P][1]?1:0)+2*_,V=L-(h=2<=v[P][2]?1:0)+2*_,U=R-(u=2<=v[P][3]?1:0)+2*_,G=E-(d=1<=v[P][0]?1:0)+3*_,N=C-(p=1<=v[P][1]?1:0)+3*_,z=L-(m=1<=v[P][2]?1:0)+3*_,H=R-(f=1<=v[P][3]?1:0)+3*_,j=E-1+4*_,W=C-1+4*_,q=L-1+4*_,$=R-1+4*_,X=255&w,Y=255&M,Z=255&S,Q=255&T,K=y[X+n+y[Y+a+y[Z+o+y[Q+s]]]]%32,J=y[X+l+y[Y+c+y[Z+h+y[Q+u]]]]%32,ee=y[X+d+y[Y+p+y[Z+m+y[Q+f]]]]%32,te=y[1+X+y[1+Y+y[1+Z+y[1+Q]]]]%32,ie=.6-E*E-C*C-L*L-R*R,re=.6-D*D-k*k-B*B-F*F,ne=.6-I*I-O*O-V*V-U*U,ae=.6-G*G-N*N-z*z-H*H,oe=.6-j*j-W*W-q*q-$*$;return 27*((ie<0?0:(ie*=ie)*ie*this.dot4(g[y[X+y[Y+y[Z+y[Q]]]]%32],E,C,L,R))+(re<0?0:(re*=re)*re*this.dot4(g[K],D,k,B,F))+(ne<0?0:(ne*=ne)*ne*this.dot4(g[J],I,O,V,U))+(ae<0?0:(ae*=ae)*ae*this.dot4(g[ee],G,N,z,H))+(oe<0?0:(oe*=oe)*oe*this.dot4(g[te],j,W,q,$)))};var ShaderExtras={png:{vertexShader:["varying vec2 vUV;","void main() {","vUV =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["#include <packing>","uniform sampler2D texture;","varying vec2 vUV;","void main() {","vec4 pixel = texture2D( texture, vUV );","if ( pixel.a < 0.5 ) discard;","gl_FragData[ 0 ] = packDepthToRGBA( gl_FragCoord.z );","}"].join("\n")},screen:{uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},convolution:{uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n")},film:{uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},bokeh:{uniforms:{tColor:{type:"t",value:null},tDepth:{type:"t",value:null},focus:{type:"f",value:1},aspect:{type:"f",value:1},aperture:{type:"f",value:.025},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float focus;","uniform float aspect;","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","vec4 depth1 = texture2D( tDepth, vUv );","float factor = depth1.x - focus;","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},dofmipmap:{uniforms:{tColor:{type:"t",value:null},tDepth:{type:"t",value:null},focus:{type:"f",value:1},maxblur:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n")},sepia:{uniforms:{tDiffuse:{type:"t",value:null},amount:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},dotscreen:{uniforms:{tDiffuse:{type:"t",value:null},tSize:{type:"v2",value:new Vector2(256,256)},center:{type:"v2",value:new Vector2(.5,.5)},angle:{type:"f",value:1.57},scale:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},vignette:{uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},bleachbypass:{uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},focus:{uniforms:{tDiffuse:{type:"t",value:null},screenWidth:{type:"f",value:1024},screenHeight:{type:"f",value:1024},sampleDistance:{type:"f",value:.94},waveFactor:{type:"f",value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")},triangleBlur:{uniforms:{texture:{type:"t",value:null},delta:{type:"v2",value:new Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","float random( vec3 scale, float seed ) {","return fract( sin( dot( gl_FragCoord.xyz + seed, scale ) ) * 43758.5453 + seed );","}","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = random( vec3( 12.9898, 78.233, 151.7182 ), 0.0 );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n")},basic:{uniforms:{},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")},horizontalBlur:{uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \tvUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},verticalBlur:{uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t  ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},horizontalTiltShift:{uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512},r:{type:"f",value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, \t\t  \t vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},verticalTiltShift:{uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512},r:{type:"f",value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y\t\t\t   ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},blend:{uniforms:{tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},mixRatio:{type:"f",value:.5},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},fxaa:{uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","void main() {","vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;","vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );","vec3 rgbM  = rgbaM.xyz;","float opacity  = rgbaM.w;","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float lumaNW = dot( rgbNW, luma );","float lumaNE = dot( rgbNE, luma );","float lumaSW = dot( rgbSW, luma );","float lumaSE = dot( rgbSE, luma );","float lumaM  = dot( rgbM,  luma );","float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),","max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","dir * rcpDirMin)) * resolution;","vec3 rgbA = 0.5 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","vec3 rgbB = rgbA * 0.5 + 0.25 * (","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz +","texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz );","float lumaB = dot( rgbB, luma );","if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {","gl_FragColor = vec4( rgbA, opacity );","} else {","gl_FragColor = vec4( rgbB, opacity );","}","}"].join("\n")},luminosity:{uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v, v, v, texel.w );","}"].join("\n")},colorCorrection:{uniforms:{tDiffuse:{type:"t",value:null},powRGB:{type:"v3",value:new Vector3(2,2,2)},mulRGB:{type:"v3",value:new Vector3(1,1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( gl_FragColor.rgb, powRGB );","}"].join("\n")},normalmap:{uniforms:{heightMap:{type:"t",value:null},resolution:{type:"v2",value:new Vector2(512,512)},scale:{type:"v2",value:new Vector2(1,1)},height:{type:"f",value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},ssao:{uniforms:{tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},size:{type:"v2",value:new Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},fogNear:{type:"f",value:5},fogFar:{type:"f",value:100},fogEnabled:{type:"i",value:0},onlyAO:{type:"i",value:0},aoClamp:{type:"f",value:.3},lumInfluence:{type:"f",value:.9}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cameraNear;","uniform float cameraFar;","uniform float fogNear;","uniform float fogFar;","uniform bool fogEnabled;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 8;","const float radius = 5.0;","const bool useNoise = false;","const float noiseAmount = 0.0003;","const float diffArea = 0.4;","const float gDisplace = 0.4;","const vec3 onlyAOColor = vec3( 1.0, 0.7, 0.5 );","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float doFog() {","float zdepth = unpackDepth( texture2D( tDepth, vUv ) );","float depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );","return smoothstep( fogNear, fogFar, depth );","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float pw;","float ph;","float ao;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","pw = cos( l ) * r;","ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","if ( fogEnabled ) {","ao = mix( ao, 1.0, doFog() );","}","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},colorify:{uniforms:{tDiffuse:{type:"t",value:null},color:{type:"c",value:new Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")},unpackDepthRGBA:{uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","void main() {","float depth = 1.0 - unpackDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = opacity * vec4( vec3( depth ), 1.0 );","}"].join("\n")},buildKernel:function(e){var t,i,r,n,a,o,s=2*Math.ceil(3*e)+1;for(25<s&&(s=25),n=.5*(s-1),i=new Array(s),t=r=0;t<s;++t)i[t]=(a=t-n,o=e,Math.exp(-a*a/(2*o*o))),r+=i[t];for(t=0;t<s;++t)i[t]/=r;return i}};function SuperSky(e){this.skyResolution=512,this.size=e.size||1e4,this.callback=e.callback||function(){},this.setting={t:0,fog:0,cloud_size:.45,cloud_covr:.3,cloud_dens:40,inclination:45,azimuth:90,hour:12},this.scene=e.scene,this.renderer=e.renderer,this.sceneSky=new Scene,this.urls=["./glsl/base_vs.glsl","./glsl/dome_fs.glsl","./glsl/sky_fs.glsl"],this.shaders={},this.textureLoader=new TextureLoader,this.geometry=new SphereBufferGeometry(this.size,30,15),this.material=new ShaderMaterial,Mesh.call(this,this.geometry,this.material),this.visible=!1,this.castShadow=!1,this.receiveShadow=!1,this.needsUpdate=!1,this.torad=.017453292519943295,this.addLight(),this.load()}SuperSky.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SuperSky,load:function(){0===this.urls.length?this.noiseMap=this.textureLoader.load("./assets/textures/sky/noise.png",function(e){e.wrapS=e.wrapT=RepeatWrapping,e.flipY=!1,this.init()}.bind(this)):this.loadShader(this.urls.shift())},loadShader:function(e){var t=e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")),i=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=function(){2===i.readyState||3===i.readyState||4===i.readyState&&(200===i.status||0===i.status?(this.shaders[t]=i.response,this.load()):console.error("Couldn't load ["+t+"] ["+i.status+"]"))}.bind(this),i.send(null)},addLight:function(){this.sunMaterial=new SpriteMaterial({map:this.textureLoader.load("./assets/textures/sky/lensflare1.png"),blending:AdditiveBlending,opacity:.5});var e=new Sprite(this.sunMaterial);e.scale.set(40,40,1),this.sun=new DirectionalLight(16777215,.8),this.sun.add(e);var t=new OrthographicCamera(20,-20,20,-20,900,1200);this.sun.shadow=new LightShadow(t),this.sun.shadow.mapSize.width=512,this.sun.shadow.mapSize.height=512,this.sun.shadow.bias=.001,this.sun.castShadow=!0,this.moonMaterial=new SpriteMaterial({map:this.textureLoader.load("./assets/textures/sky/lensflare2.png"),opacity:.3});var i=new Sprite(this.moonMaterial);i.scale.set(70,70,1),this.moon=new DirectionalLight(16777215,.8),this.moon.add(i);var r=new HemisphereLight(0,3886170,.1);this.scene.add(this.sun),this.scene.add(this.moon),this.scene.add(r),this.sunSph=new Spherical(this.size-.1*this.size),this.moonSph=new Spherical(this.size-.1*this.size),this.sunPosition=new Vector3,this.moonPosition=new Vector3;var n=this.textureLoader.load("./assets/textures/sky/lensflare3.png");this.lensflare=new Lensflare,this.lensflare.addElement(new LensflareElement(this.textureLoader.load("./assets/textures/sky/lensflare0.png"),.1*this.size,0,this.sun.color)),this.lensflare.addElement(new LensflareElement(n,60,.6,this.sun.color)),this.lensflare.addElement(new LensflareElement(n,70,.7,this.sun.color)),this.lensflare.addElement(new LensflareElement(n,120,.9,this.sun.color)),this.lensflare.addElement(new LensflareElement(n,70,1,this.sun.color)),this.sun.add(this.lensflare)},init:function(){this.materialSky=new ShaderMaterial({uniforms:{lightdir:{value:this.sunPosition},noiseMap:{value:this.noiseMap},cloud_size:{value:this.setting.cloud_size},cloud_covr:{value:this.setting.cloud_covr},cloud_dens:{value:this.setting.cloud_dens},cloudColor:{value:new Color(16777215)},groundColor:{value:new Color(3886170)},fogColor:{value:new Color(16711680)},fog:{value:this.setting.fog},t:{value:this.setting.t}},vertexShader:this.shaders.base_vs,fragmentShader:this.shaders.sky_fs,depthWrite:!1,depthTest:!1,side:BackSide});var e=new Mesh(new IcosahedronGeometry(1,1),this.materialSky);this.sceneSky.add(e),this.cubeCamera=new CubeCamera(.5,2,this.skyResolution),this.sceneSky.add(this.cubeCamera),this.envMap=this.cubeCamera.renderTarget.texture,this.envMap.minFilter=LinearMipMapLinearFilter,this.envMap.format=RGBAFormat,this.material=new ShaderMaterial({uniforms:{lightdir:{value:this.sunPosition},lunardir:{value:new Vector3(0,-.2,1)},tCube:{value:this.envMap},tDome:{value:this.textureLoader.load("./assets/textures/sky/milkyway.png")}},vertexShader:this.shaders.base_vs,fragmentShader:this.shaders.dome_fs,side:BackSide}),this.material.needsUpdate=!0,this.update(),this.callback()},k:function(e,t){var i=t.dot(t),r=2*t.dot(e),n=e.dot(e)-1;return n/((-r-Math.sqrt(r*r-4*i*n))/2)},z:function(e,t,i,r){var n=new Vector3(.188,.458,.682),a=0<=r.y?1:0;return this.r=(t.x-t.x*Math.pow(n.x,i/e))*a,this.g=(t.y-t.y*Math.pow(n.y,i/e))*a,this.b=(t.z-t.z*Math.pow(n.z,i/e))*a,this},setData:function(e){this.setting=e,this.update()},update:function(){var e=this.setting;e.inclination=15*e.hour-90,this.sunSph.phi=(e.inclination-90)*this.torad,this.sunSph.theta=(e.azimuth-90)*this.torad,this.sun.position.setFromSpherical(this.sunSph),this.moonSph.phi=(e.inclination+90)*this.torad,this.moonSph.theta=(e.azimuth-90)*this.torad,this.moon.position.setFromSpherical(this.moonSph),this.sunPosition=this.sun.position.clone().normalize(),this.moonPosition=this.sun.position.clone().normalize();var t=this.k(new Vector3(0,.99,0),this.sunPosition),i=this.z(t,new Vector3(1.8,1.8,1.8),.028,this.sunPosition);i.r=1<i.r?1:i.r,i.g=1<i.g?1:i.g,i.b=1<i.b?1:i.b,this.day=i.r,this.sun.color.setRGB(i.r,i.g,i.b),this.sunMaterial.color.copy(this.sun.color);var r=(this.sun.intensity=1)-i.r,n=1-i.g,a=1-i.b;this.moon.intensity=.35*r,this.moon.color.setRGB(r,n,a),this.moonMaterial.color.copy(this.moon.color),this.materialSky.uniforms.t.value=e.t,this.materialSky.uniforms.fog.value=e.fog,this.materialSky.uniforms.cloud_size.value=e.cloud_size,this.materialSky.uniforms.cloud_covr.value=e.cloud_covr,this.materialSky.uniforms.cloud_dens.value=e.cloud_dens,this.materialSky.uniforms.lightdir.value=this.sunPosition,this.material.uniforms.lightdir.value=this.sunPosition,this.needsUpdate=!0,this.visible||(this.visible=!0),console.log("sun position---"+this.sun.position.x+"    "+this.sun.position.y+"  "+this.sun.position.z),console.log("moon position---"+this.moon.position.x+"    "+this.moon.position.y+"  "+this.moon.position.z)},render:function(){this.cubeCamera.update(this.renderer,this.sceneSky),this.needsUpdate=!1}});var Sky=function e(){var t=e.SkyShader,i=new ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:UniformsUtils.clone(t.uniforms),side:BackSide,depthWrite:!1});Mesh.call(this,new BoxBufferGeometry(1,1,1),i)};Sky.prototype=Object.create(Mesh.prototype),Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Vector3},up:{value:new Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var Terrain=function(e){this.ttype=(e=void 0===e?{}:e).terrainType||"terrain",this.name=e.name||"terrain0",this.needsUpdate=!1,this.callback=null,this.physicsUpdate=e.physicsUpdate||function(){},this.uvx=[e.uv||18,e.uv||18],this.sample=null==e.sample?[64,64]:e.sample,this.size=void 0===e.size?[100,10,100]:e.size,this.data={level:e.level||[1,.2,.05],frequency:e.frequency||[.016,.05,.2],expo:e.expo||1},this.isWater=e.water||!1,this.isBorder=!1,this.wantBorder=e.border||!1,this.isBottom=!1,this.wantBottom=e.bottom||!1,this.colorBase=this.isWater?{r:0,g:.7,b:1}:{r:1,g:.7,b:0},this.maxspeed=e.maxSpeed||.1,this.acc=null==e.acc?.01:e.acc,this.dec=null==e.dec?.01:e.dec,this.deep=null==e.deep?0:e.deep,this.ease=new Vector2,this.complexity=null==e.complexity?30:e.complexity,this.complexity2=null==e.complexity2?null:e.complexity2,this.local=new Vector3,e.local&&this.local.fromArray(e.local),this.pp=new Vector3,this.lng=this.sample[0]*this.sample[1];var t=this.sample[1]-1;this.rx=(this.sample[0]-1)/this.size[0],this.rz=t/this.size[2],this.ratio=1/this.sample[0],this.ruvx=1/(this.size[0]/this.uvx[0]),this.ruvy=-1/(this.size[2]/this.uvx[1]),this.is64=e.is64||!1,this.heightData=new(this.is64?Float64Array:Float32Array)(this.lng),this.height=[],this.isAbsolute=e.isAbsolute||!1,this.isReverse=e.isReverse||!1,this.isReverse&&this.getReverseID(),this.colors=new Float32Array(3*this.lng),this.geometry=new PlaneBufferGeometry(this.size[0],this.size[2],this.sample[0]-1,this.sample[1]-1),this.geometry.rotateX(-Math.PI90),this.geometry.computeBoundingSphere(),this.geometry.setAttribute("color",new BufferAttribute(this.colors,3)),this.vertices=this.geometry.attributes.position.array,this.waterNormal=this.isWater?window.WEngine.three.texture({url:"terrain/water_n.jpg",name:"water_n",repeat:[e.uv||3,e.uv||3]}):null,this.hasHeightMap=!!e.heightMapUrl,this.heightMapUrl=e.heightMapUrl;var i={name:"terrain_"+Math.generateUUID(),vertexColors:VertexColors,metalness:this.isWater?.8:.2,roughness:this.isWater?.2:.6,normalScale:e.normalScale||(this.isWater?[.25,.25]:[2,2]),transparent:!!this.isWater,opacity:this.isWater?e.opacity||.8:1,premultipliedAlpha:this.isWater};if(this.isWater)i.normalMap=this.waterNormal;else{this.maps=e.maps||["sand","grass","rock","sand_n","grass_n","rock_n"];var r,a={};for(var n in this.maps)a[r=this.maps[n]]=window.WEngine.view.texture({url:"terrain/"+r+".jpg",name:r,repeat:this.uvx});i.map=a[this.maps[0]],i.normalMap=a[this.maps[0]+"_n"],this.isORM=!1,this.isDIS=!1,6<this.maps.length&&(this.isORM=!0,i.aoMapIntensity=e.ao||1,i.metalness=1,i.roughness=1,i.roughnessMap=a[this.maps[0]+"_orm"],i.aoMap=a[this.maps[0]+"_orm"]),9<this.maps.length&&(this.isDIS=!0,i.displacementBias=0,i.displacementScale=e.displacementScale||1,i.displacementMap=a[this.maps[0]+"_d"]);var o=this;i.extraCompile=function(e){var t=e.uniforms;t.map1={value:a[o.maps[1]]},t.map2={value:a[o.maps[2]]},t.normalMap1={value:a[o.maps[1]+"_n"]},t.normalMap2={value:a[o.maps[2]+"_n"]},o.isORM&&(t.roughnessMap1={value:a[o.maps[1]+"_orm"]},t.roughnessMap2={value:a[o.maps[2]+"_orm"]}),o.isDIS&&(t.displacementMap1={value:a[o.maps[1]+"_d"]},t.displacementMap2={value:a[o.maps[2]+"_d"]}),e.uniforms=t;var i=e.vertexShader,r=e.fragmentShader,n=TerrainShader;return r=(r=(r=(r=(r=r.replace("#include <map_pars_fragment>",n.map_pars)).replace("#include <normalmap_pars_fragment>",n.normal_pars)).replace("#include <map_fragment>",n.map)).replace("#include <normal_fragment_maps>",n.normal)).replace("#include <color_fragment>",""),o.isORM&&(r=(r=(r=(r=(r=(r=r.replace("#include <roughnessmap_pars_fragment>",n.rough_pars)).replace("#include <metalnessmap_pars_fragment>","")).replace("#include <aomap_pars_fragment>","")).replace("#include <roughnessmap_fragment>",n.rough)).replace("#include <metalnessmap_fragment>","")).replace("#include <aomap_fragment>",n.ao)),o.isDIS&&(i=(i=i.replace("#include <displacementmap_pars_vertex>",n.displacement_part)).replace("#include <displacementmap_vertex>",n.displacement)),e.fragmentShader=r,e.vertexShader=i,e}}this.material=window.WEngine.view.material(i),Mesh.call(this,this.geometry,this.material),this.wantBorder&&this.addBorder(e),this.wantBottom&&this.addBottom(e),this.hasHeightMap?this.update_hmap():this.update_noise(),this.name=void 0===e.name?"terrain":e.name,e.pos&&this.position.fromArray(e.pos),this.castShadow=!1,this.receiveShadow=!0};Terrain.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:Terrain,addBottom:function(){var e=new PlaneBufferGeometry(this.size[0],this.size[2],1,1);e.rotateX(Math.PI90),this.bottomMesh=new Mesh(e,this.material),this.add(this.bottomMesh),this.isBottom=!0},addBorder:function(e){this.borderMaterial=window.WEngine.view.material({vertexColors:VertexColors,metalness:this.isWater?.8:.4,roughness:this.isWater?.2:.6,normalScale:this.isWater?[.25,.25]:[-1,-1],transparent:!!this.isWater,opacity:this.isWater?e.opacity||.8:1});var t=new PlaneGeometry(this.size[0],2,this.sample[0]-1,1),i=new PlaneGeometry(this.size[0],2,this.sample[0]-1,1),r=new PlaneGeometry(this.size[2],2,this.sample[1]-1,1),n=new PlaneGeometry(this.size[2],2,this.sample[1]-1,1);t.translate(0,1,.5*this.size[2]),i.rotateY(-Math.PI),i.translate(0,1,.5*-this.size[2]),r.rotateY(-Math.PI90),r.translate(.5*-this.size[0],1,0),n.rotateY(Math.PI90),n.translate(.5*this.size[0],1,0);var a=new Geometry;a.merge(t),a.merge(i),a.merge(r),a.merge(n),a.mergeVertices(),this.borderGeometry=(new BufferGeometry).fromGeometry(a),this.borderVertices=this.borderGeometry.attributes.position.array,this.lng2=this.borderVertices.length/3,this.list=new Array(this.lng2),this.borderColors=new Float32Array(3*this.lng),this.borderGeometry.setAttribute("color",new BufferAttribute(this.borderColors,3)),this.borderMesh=new Mesh(this.borderGeometry,this.borderMaterial);for(var o,s,l=this.lng2;l--;)s=0<this.borderVertices[1+(o=3*l)]?this.findPoint(this.borderVertices[o],this.borderVertices[2+o]):-1,this.list[l]=s;this.add(this.borderMesh),this.isBorder=!0},dispose:function(){this.geometry.dispose(),this.material.dispose()},easing:function(e){var t=window.user.key;if(t[0]&&t[1]){var i=window.view.getAzimuthal();this.maxspeed=t[7]?1.5:.25,this.ease.y+=t[1]*this.acc,this.ease.x+=t[0]*this.acc,this.ease.x=this.maxspeed<this.ease.x?this.maxspeed:this.ease.x,this.ease.x=this.ease.x<-this.maxspeed?-this.maxspeed:this.ease.x,this.ease.y=this.maxspeed<this.ease.y?this.maxspeed:this.ease.y,this.ease.y=this.ease.y<-this.maxspeed?-this.maxspeed:this.ease.y,t[1]||(this.dec<this.ease.y?this.ease.y-=this.dec:this.ease.y<-this.dec?this.ease.y+=this.dec:this.ease.y=0),t[0]||(this.dec<this.ease.x?this.ease.x-=this.dec:this.ease.x<-this.dec?this.ease.x+=this.dec:this.ease.x=0),(this.ease.x||this.ease.y)&&(this.local.z+=Math.sin(i)*this.ease.x+Math.cos(i)*this.ease.y,this.local.x+=Math.cos(i)*this.ease.x-Math.sin(i)*this.ease.y,this.update(e))}},getHeight:function(e,t){return e*=this.rx,t*=this.rz,e+=.5*this.sample[0],t+=.5*this.sample[1],e=Math.floor(e),t=Math.floor(t),(this.height[this.findId(e,t)]||1)*this.size[1]+this.position.y},findId:function(e,t){return e+t*this.sample[1]},findPoint:function(e,t){for(var i,r=this.lng;r--;)if(this.vertices[i=3*r]===e&&this.vertices[2+i]===t)return r;return-1},getReverseID:function(){this.invId=[];for(var e,t,i=this.lng,r=this.sample[1]-1;i--;)e=i%this.sample[0],t=Math.floor(i*this.ratio),this.invId[i]=this.findId(e,r-t)},update_noise:function(e){this.isWater?(this.waterNormal.offset.x+=.002,this.waterNormal.offset.y+=.001):(this.material.map.offset.x=this.local.x*this.ruvx,this.material.map.offset.y=this.local.z*this.ruvy);for(var t,i,r,n,a,o,s=this.pp,l=[1,1,1],c=this.lng;c--;)t=3*c,i=c%this.sample[0],r=Math.floor(c*this.ratio),s.set(i+this.local.x*this.rx,this.local.y,r+this.local.z*this.rz),n=Math.noise(s,this.data),n=(n=1<(n=Math.pow(n,this.data.expo))?1:n)<0?0:n,"road"===this.ttype&&(a===r?n=1==i||2==i||29==i||30==i?o+.1:o:(a=r,o=n)),this.height[c]=n,this.heightData[this.isReverse?this.invId[c]:c]=this.isAbsolute?n:n*this.size[1],this.vertices[t+1]=n*this.size[1]+this.deep,this.colors[t]=(l=this.isWater?[n*this.colorBase.r,n*this.colorBase.g,n*this.colorBase.b]:[n,0,0])[0],this.colors[t+1]=l[1],this.colors[t+2]=l[2];if(this.isBorder)for(var h,u=this.lng2;u--;)t=3*u,-1!==this.list[u]?(this.borderVertices[t+1]=(h=this.height[this.list[u]])*this.size[1]+this.deep,this.borderColors[t]=h*this.colorBase.r,this.borderColors[t+1]=h*this.colorBase.g,this.borderColors[t+2]=h*this.colorBase.b):(this.borderColors[t]=this.colorBase.r,this.borderColors[t+1]=this.colorBase.g,this.borderColors[t+2]=this.colorBase.b);this.physicsUpdate(this.name,this.heightData),this.needsUpdate=!0,void 0===e&&this.updateGeometry()},update_hmap:function(){this.isWater?(this.waterNormal.offset.x+=.002,this.waterNormal.offset.y+=.001):(this.material.map.offset.x=this.local.x*this.ruvx,this.material.map.offset.y=this.local.z*this.ruvy);new TextureLoader;var d=this;window.WEngine.view.texture({url:d.heightMapUrl,name:d.name+"_hmap",onLoad:function(e){var t=e.image,i=document.createElement("canvas");i.width=t.width,i.height=t.height;var r=i.getContext("2d");r.drawImage(t,0,0);for(var n=r.getImageData(0,0,t.width,t.height).data,a=[1,1,1],o=0,s=0,l=0,c=n.length;o<c;o+=4,s++,l+=3){var h=d.height[s]=(n[o]+n[o+1]+n[o+2])/3/255;d.heightData[d.isReverse?d.invId[s]:s]=d.isAbsolute?h:h*d.size[1],d.vertices[l+1]=h*d.size[1]+d.deep,d.colors[l]=(a=d.isWater?[h*d.colorBase.r,h*d.colorBase.g,h*d.colorBase.b]:[h,0,0])[0],d.colors[l+1]=a[1],d.colors[l+2]=a[2]}if(d.isBorder){var u;for(s=d.lng2;s--;)c=3*s,-1!==d.list[s]?(d.borderVertices[c+1]=(u=d.height[d.list[s]])*d.size[1]+d.deep,d.borderColors[c]=u*d.colorBase.r,d.borderColors[c+1]=u*d.colorBase.g,d.borderColors[c+2]=u*d.colorBase.b):(d.borderColors[c]=d.colorBase.r,d.borderColors[c+1]=d.colorBase.g,d.borderColors[c+2]=d.colorBase.b)}d.physicsUpdate(d.name,d.heightData,d),d.needsUpdate=!0,d.updateGeometry()}})},updateGeometry:function(){this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.geometry.computeVertexNormals(),this.isBorder&&(this.borderGeometry.attributes.position.needsUpdate=!0,this.borderGeometry.attributes.color.needsUpdate=!0)}});var TerrainShader={rough_pars:["#ifdef USE_ROUGHNESSMAP","    uniform sampler2D roughnessMap;","    uniform sampler2D roughnessMap1;","    uniform sampler2D roughnessMap2;","    uniform float aoMapIntensity;","#endif"].join("\n"),rough:["float roughnessFactor = roughness;","float metalnessFactor = metalness;","#ifdef USE_ROUGHNESSMAP","float slopeR = vColor.r;","vec4 baseColorR = vec4(0.0);","vec4 sandR = texture2D( roughnessMap, vUv );","vec4 grassR = texture2D( roughnessMap1, vUv );","vec4 rockR = texture2D( roughnessMap2, vUv );","if (slopeR < .5) baseColorR = grassR;","if (slopeR > .8) baseColorR = rockR;","if ((slopeR<.8) && (slopeR >= .5)) baseColorR = mix( grassR , rockR, (slopeR - .5) * (1. / (.8 - .5)));","if (slopeR < .2) baseColorR = mix( sandR, grassR, slopeR * (1.0/0.2) );","float ambientOcclusion =( baseColorR.r - 1.0 ) * aoMapIntensity + 1.0;","roughnessFactor *= baseColorR.g;","metalnessFactor *= baseColorR.b;","#endif"].join("\n"),ao:["reflectedLight.indirectDiffuse *= ambientOcclusion;","#if defined( USE_ENVMAP ) && defined( STANDARD )","    float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","    reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );","#endif"].join("\n"),map_pars:["#ifdef USE_MAP","    uniform sampler2D map;","    uniform sampler2D map1;","    uniform sampler2D map2;","#endif"].join("\n"),map:["#ifdef USE_MAP","float slope = vColor.r;","vec4 baseColor = vec4(1.0);","vec4 sand = texture2D( map, vUv );","vec4 grass = texture2D( map1, vUv );","vec4 rock = texture2D( map2, vUv );","if (slope < .5) baseColor = grass;","if (slope > .8) baseColor = rock;","if ((slope<.8) && (slope >= .5)) baseColor = mix( grass , rock, (slope - .5) * (1. / (.8 - .5)));","if (slope < .2) baseColor = mix( sand, grass, slope * (1.0/0.2) );","diffuseColor *= mapTexelToLinear( baseColor );","#endif"].join("\n"),displacement_part:["#ifdef USE_DISPLACEMENTMAP","    uniform sampler2D displacementMap;","    uniform sampler2D displacementMap1;","    uniform sampler2D displacementMap2;","    uniform float displacementScale;","    uniform float displacementBias;","#endif"].join("\n"),displacement:["#ifdef USE_MAP","float slope = vColor.r;","vec4 baseColor = vec4(1.0);","vec4 sand = texture2D( displacementMap, vUv );","vec4 grass = texture2D( displacementMap1, vUv );","vec4 rock = texture2D( displacementMap2, vUv );","if (slope < .5) baseColor = grass;","if (slope > .8) baseColor = rock;","if ((slope<.8) && (slope >= .5)) baseColor = mix( grass , rock, (slope - .5) * (1. / (.8 - .5)));","if (slope < .2) baseColor = mix( sand, grass, slope * (1.0/0.2) );","transformed += normalize( objectNormal ) * ( baseColor.x * displacementScale + displacementBias );","#endif"].join("\n"),normal_pars:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform sampler2D normalMap1;","uniform sampler2D normalMap2;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 n_color ) {","vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );","vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize( q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = n_color.xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),normal:["#ifdef USE_NORMALMAP","vec4 extraNormal = vec4(1.0);","vec4 sandN =  texture2D( normalMap, vUv );","vec4 grassN = texture2D( normalMap1, vUv );","vec4 rockN = texture2D( normalMap2, vUv );","float slopeN = vColor.r;","if (slopeN < .5) extraNormal = grassN;","if (slopeN > .8) extraNormal = rockN;","if ((slopeN<.8) && (slopeN >= .5)) extraNormal = mix( grassN , rockN, (slopeN - .5) * (1. / (.8 - .5)));","if (slopeN < .2) extraNormal = mix( sandN, grassN, slopeN * (1.0/0.2) );","normal = perturbNormal2Arb( -vViewPosition.xyz, normal.xyz, extraNormal.xyz );","#endif"].join("\n")},Water=function(e,t){Mesh.call(this,e);var l=this,i=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,r=void 0!==t.textureHeight?t.textureHeight:512,c=void 0!==t.clipBias?t.clipBias:0,n=void 0!==t.alpha?t.alpha:1,a=void 0!==t.time?t.time:0,o=void 0!==t.waterNormals?t.waterNormals:null,s=void 0!==t.sunDirection?t.sunDirection:new Vector3(.70707,.70707,0),h=new Color(void 0!==t.sunColor?t.sunColor:16777215),u=new Color(void 0!==t.waterColor?t.waterColor:8355711),d=void 0!==t.eye?t.eye:new Vector3(0,0,0),p=void 0!==t.distortionScale?t.distortionScale:20,m=void 0!==t.side?t.side:FrontSide,f=void 0!==t.fog&&t.fog,g=new Plane,v=new Vector3,y=new Vector3,x=new Vector3,_=new Matrix4,b=new Vector3(0,0,-1),w=new Vector4,M=new Vector3,S=new Vector3,T=new Vector4,A=new Matrix4,E=new PerspectiveCamera,C=new WebGLRenderTarget(i,r,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1});MathUtils.isPowerOfTwo(i)&&MathUtils.isPowerOfTwo(r)||(C.texture.generateMipmaps=!1);var L={uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Matrix4},sunColor:{value:new Color(8355711)},sunDirection:{value:new Vector3(.70707,.70707,0)},eye:{value:new Vector3},waterColor:{value:new Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","#include <common>","#include <fog_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_vertex>","#include <fog_vertex>","#include <shadowmap_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}","#include <common>","#include <packing>","#include <bsdfs>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <lights_pars_begin>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","void main() {","#include <logdepthbuf_fragment>","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );","#include <tonemapping_fragment>","#include <fog_fragment>","}"].join("\n")},R=new ShaderMaterial({fragmentShader:L.fragmentShader,vertexShader:L.vertexShader,uniforms:UniformsUtils.clone(L.uniforms),lights:!0,side:m,fog:f});R.uniforms.mirrorSampler.value=C.texture,R.uniforms.textureMatrix.value=A,R.uniforms.alpha.value=n,R.uniforms.time.value=a,R.uniforms.normalSampler.value=o,R.uniforms.sunColor.value=h,R.uniforms.waterColor.value=u,R.uniforms.sunDirection.value=s,R.uniforms.distortionScale.value=p,R.uniforms.eye.value=d,l.material=R,l.onBeforeRender=function(e,t,i){if(y.setFromMatrixPosition(l.matrixWorld),x.setFromMatrixPosition(i.matrixWorld),_.extractRotation(l.matrixWorld),v.set(0,0,1),v.applyMatrix4(_),M.subVectors(y,x),!(0<M.dot(v))){M.reflect(v).negate(),M.add(y),_.extractRotation(i.matrixWorld),b.set(0,0,-1),b.applyMatrix4(_),b.add(x),S.subVectors(y,b),S.reflect(v).negate(),S.add(y),E.position.copy(M),E.up.set(0,1,0),E.up.applyMatrix4(_),E.up.reflect(v),E.lookAt(S),E.far=i.far,E.updateMatrixWorld(),E.projectionMatrix.copy(i.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(E.projectionMatrix),A.multiply(E.matrixWorldInverse),g.setFromNormalAndCoplanarPoint(v,y),g.applyMatrix4(E.matrixWorldInverse),w.set(g.normal.x,g.normal.y,g.normal.z,g.constant);var r=E.projectionMatrix;if(T.x=(Math.sign(w.x)+r.elements[8])/r.elements[0],T.y=(Math.sign(w.y)+r.elements[9])/r.elements[5],T.z=-1,T.w=(1+r.elements[10])/r.elements[14],w.multiplyScalar(2/w.dot(T)),r.elements[2]=w.x,r.elements[6]=w.y,r.elements[10]=w.z+1-c,r.elements[14]=w.w,d.setFromMatrixPosition(i.matrixWorld),e.outputEncoding!==LinearEncoding)return console.warn("THREE.Water: WebGLRenderer must use LinearEncoding as outputEncoding."),void(l.onBeforeRender=function(){});if(e.toneMapping!==NoToneMapping)return console.warn("THREE.Water: WebGLRenderer must use NoToneMapping as toneMapping."),void(l.onBeforeRender=function(){});var n=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;e.xr.enabled=l.visible=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(C),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,E),l.visible=!0,e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(n);var s=i.viewport;void 0!==s&&e.state.viewport(s)}}};Water.prototype=Object.create(Mesh.prototype),Water.prototype.constructor=Water;var Reflector=function e(t,i){Mesh.call(this,t),this.type="Reflector";var l=this,r=new Color(void 0!==(i=i||{}).color?i.color:8355711),n=i.textureWidth||512,a=i.textureHeight||512,c=i.clipBias||0,o=i.shader||e.ReflectorShader,h=void 0!==i.recursion?i.recursion:0,s=void 0!==i.encoding?i.encoding:LinearEncoding,u=new Plane,d=new Vector3,p=new Vector3,m=new Vector3,f=new Matrix4,g=new Vector3(0,0,-1),v=new Vector4,y=new Vector3,x=new Vector3,_=new Vector4,b=new Matrix4,w=new PerspectiveCamera,M=new WebGLRenderTarget(n,a,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1,encoding:s});MathUtils.isPowerOfTwo(n)&&MathUtils.isPowerOfTwo(a)||(M.texture.generateMipmaps=!1);var S=new ShaderMaterial({uniforms:UniformsUtils.clone(o.uniforms),fragmentShader:o.fragmentShader,vertexShader:o.vertexShader});S.uniforms.tDiffuse.value=M.texture,S.uniforms.color.value=r,S.uniforms.textureMatrix.value=b,this.material=S,this.onBeforeRender=function(e,t,i){if("recursion"in i.userData){if(i.userData.recursion===h)return;i.userData.recursion++}if(p.setFromMatrixPosition(l.matrixWorld),m.setFromMatrixPosition(i.matrixWorld),f.extractRotation(l.matrixWorld),d.set(0,0,1),d.applyMatrix4(f),y.subVectors(p,m),!(0<y.dot(d))){y.reflect(d).negate(),y.add(p),f.extractRotation(i.matrixWorld),g.set(0,0,-1),g.applyMatrix4(f),g.add(m),x.subVectors(p,g),x.reflect(d).negate(),x.add(p),w.position.copy(y),w.up.set(0,1,0),w.up.applyMatrix4(f),w.up.reflect(d),w.lookAt(x),w.far=i.far,w.updateMatrixWorld(),w.projectionMatrix.copy(i.projectionMatrix),b.set(.5,w.userData.recursion=0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(w.projectionMatrix),b.multiply(w.matrixWorldInverse),b.multiply(l.matrixWorld),u.setFromNormalAndCoplanarPoint(d,p),u.applyMatrix4(w.matrixWorldInverse),v.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var r=w.projectionMatrix;_.x=(Math.sign(v.x)+r.elements[8])/r.elements[0],_.y=(Math.sign(v.y)+r.elements[9])/r.elements[5],_.z=-1,_.w=(1+r.elements[10])/r.elements[14],v.multiplyScalar(2/v.dot(_)),r.elements[2]=v.x,r.elements[6]=v.y,r.elements[10]=v.z+1-c,r.elements[14]=v.w,l.visible=!1;var n=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(M),!1===e.autoClear&&e.clear(),e.render(t,w),e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(n);var s=i.viewport;void 0!==s&&e.state.viewport(s),l.visible=!0}},this.getRenderTarget=function(){return M}};Reflector.prototype=Object.create(Mesh.prototype),Reflector.prototype.constructor=Reflector,Reflector.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Refractor=function e(t,i){Mesh.call(this,t),this.type="Refractor";var s=this,r=new Color(void 0!==(i=i||{}).color?i.color:8355711),n=i.textureWidth||512,a=i.textureHeight||512,o=i.clipBias||0,l=i.shader||e.RefractorShader,c=void 0!==i.encoding?i.encoding:LinearEncoding,h=new PerspectiveCamera;h.matrixAutoUpdate=!1,h.userData.refractor=!0;var u=new Plane,d=new Matrix4,p=new WebGLRenderTarget(n,a,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1,encoding:c});MathUtils.isPowerOfTwo(n)&&MathUtils.isPowerOfTwo(a)||(p.texture.generateMipmaps=!1),this.material=new ShaderMaterial({uniforms:UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=p.texture,this.material.uniforms.textureMatrix.value=d;var m,f,g,v,y,x,_,b,w,M,S,T,A=(m=new Vector3,f=new Vector3,g=new Matrix4,v=new Vector3,y=new Vector3,function(e){return m.setFromMatrixPosition(s.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),v.subVectors(m,f),g.extractRotation(s.matrixWorld),y.set(0,0,1),y.applyMatrix4(g),v.dot(y)<0}),E=(x=new Vector3,_=new Vector3,b=new Quaternion,w=new Vector3,function(){s.matrixWorld.decompose(_,b,w),x.set(0,0,1).applyQuaternion(b).normalize(),x.negate(),u.setFromNormalAndCoplanarPoint(x,_)}),C=(M=new Plane,S=new Vector4,T=new Vector4,function(e){h.matrixWorld.copy(e.matrixWorld),h.matrixWorldInverse.getInverse(h.matrixWorld),h.projectionMatrix.copy(e.projectionMatrix),h.far=e.far,M.copy(u),M.applyMatrix4(h.matrixWorldInverse),S.set(M.normal.x,M.normal.y,M.normal.z,M.constant);var t=h.projectionMatrix;T.x=(Math.sign(S.x)+t.elements[8])/t.elements[0],T.y=(Math.sign(S.y)+t.elements[9])/t.elements[5],T.z=-1,T.w=(1+t.elements[10])/t.elements[14],S.multiplyScalar(2/S.dot(T)),t.elements[2]=S.x,t.elements[6]=S.y,t.elements[10]=S.z+1-o,t.elements[14]=S.w});this.onBeforeRender=function(e,t,i){var r;!0!==i.userData.refractor&&!0!=!A(i)&&(E(),r=i,d.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),d.multiply(r.projectionMatrix),d.multiply(r.matrixWorldInverse),d.multiply(s.matrixWorld),C(i),function(e,t,i){s.visible=!1;var r=e.getRenderTarget(),n=e.xr.enabled,a=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(p),!1===e.autoClear&&e.clear(),e.render(t,h),e.xr.enabled=n,e.shadowMap.autoUpdate=a,e.setRenderTarget(r);var o=i.viewport;void 0!==o&&e.state.viewport(o),s.visible=!0}(e,t,i))},this.getRenderTarget=function(){return p}};Refractor.prototype=Object.create(Mesh.prototype),Refractor.prototype.constructor=Refractor,Refractor.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Water$1=function e(t,i){Mesh.call(this,t),this.type="Water";var o=this,r=new Color(void 0!==(i=i||{}).color?i.color:16777215),n=i.textureWidth||512,a=i.textureHeight||512,s=i.clipBias||0,l=i.flowDirection||new Vector2(1,0),c=i.flowSpeed||.03,h=i.reflectivity||.02,u=i.scale||1,d=i.shader||e.WaterShader,p=void 0!==i.encoding?i.encoding:LinearEncoding,m=new TextureLoader,f=i.flowMap||void 0,g=i.normalMap0||m.load("assets/textures/water/Water_1_M_Normal.jpg"),v=i.normalMap1||m.load("assets/textures/water/Water_2_M_Normal.jpg"),y=.15,x=.5*y,_=new Matrix4,b=new Clock;if(void 0!==Reflector)if(void 0!==Refractor){var w=new Reflector(t,{textureWidth:n,textureHeight:a,clipBias:s,encoding:p}),M=new Refractor(t,{textureWidth:n,textureHeight:a,clipBias:s,encoding:p});M.matrixAutoUpdate=w.matrixAutoUpdate=!1,this.material=new ShaderMaterial({uniforms:UniformsUtils.merge([UniformsLib.fog,d.uniforms]),vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,transparent:!0,fog:!0}),void 0!==f?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:f}):this.material.uniforms.flowDirection={type:"v2",value:l},g.wrapS=g.wrapT=RepeatWrapping,v.wrapS=v.wrapT=RepeatWrapping,this.material.uniforms.tReflectionMap.value=w.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=M.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=g,this.material.uniforms.tNormalMap1.value=v,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=h,this.material.uniforms.textureMatrix.value=_,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=x,this.material.uniforms.config.value.z=x,this.material.uniforms.config.value.w=u,this.onBeforeRender=function(e,t,i){var r,n,a;r=i,_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(r.projectionMatrix),_.multiply(r.matrixWorldInverse),_.multiply(o.matrixWorld),n=b.getDelta(),(a=o.material.uniforms.config).value.x+=c*n,a.value.y=a.value.x+x,y<=a.value.x?(a.value.x=0,a.value.y=x):y<=a.value.y&&(a.value.y=a.value.y-y),o.visible=!1,w.matrixWorld.copy(o.matrixWorld),M.matrixWorld.copy(o.matrixWorld),w.onBeforeRender(e,t,i),M.onBeforeRender(e,t,i),o.visible=!0}}else console.error("THREE.Water: Required component Refractor not found.");else console.error("THREE.Water: Required component Reflector not found.")};Water$1.prototype=Object.create(Mesh.prototype),Water$1.prototype.constructor=Water$1,Water$1.WaterShader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new Vector4}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <logdepthbuf_vertex>","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\t#include <logdepthbuf_fragment>","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")};var PlantTufts={create:function(e,t,i){var r=new PlaneGeometry(t[0],t[1]);r.faces.forEach(function(e){e.vertexNormals.forEach(function(e){e.set(0,1,0).normalize()})});for(var n=new Geometry,a=0;a<e.length;a++)for(var o=e[a],s=2*Math.PI*Math.random(),l=0;l<2;l++){var c=s+l*Math.PI/2,h=r.clone();h.applyMatrix4((new Matrix4).makeRotationAxis(new Vector3(0,1,0),c)),h.applyMatrix4((new Matrix4).makeTranslation(o.x,o.y+t[1]/2,o.z)),n.merge(h);var u=r.clone();u.applyMatrix4((new Matrix4).makeRotationAxis(new Vector3(0,1,0),c+Math.PI)),u.applyMatrix4((new Matrix4).makeTranslation(o.x,o.y+t[1]/2,o.z)),n.merge(u)}return new Mesh((new BufferGeometry).fromGeometry(n),i)}},CCDIKSolver=(anc.prototype={constructor:anc,update:(enc=new Quaternion,fnc=new Vector3,gnc=new Vector3,hnc=new Vector3,inc=new Vector3,jnc=new Vector3,knc=new Quaternion,lnc=new Vector3,mnc=new Vector3,nnc=new Vector3,function(){for(var e=this.mesh.skeleton.bones,t=this.iks,i=Math,r=0,n=t.length;r<n;r++){var a=t[r],o=e[a.effector];fnc.setFromMatrixPosition(e[a.target].matrixWorld);for(var s=a.links,l=void 0!==a.iteration?a.iteration:1,c=0;c<l;c++){for(var h=!1,u=0,d=s.length;u<d;u++){var p=e[s[u].index];if(!1===s[u].enabled)break;var m=s[u].limitation,f=s[u].rotationMin,g=s[u].rotationMax;p.matrixWorld.decompose(jnc,knc,lnc),knc.inverse(),hnc.setFromMatrixPosition(o.matrixWorld),inc.subVectors(hnc,jnc),inc.applyQuaternion(knc),inc.normalize(),gnc.subVectors(fnc,jnc),gnc.applyQuaternion(knc),gnc.normalize();var v=gnc.dot(inc);if(1<v?v=1:v<-1&&(v=-1),!((v=i.acos(v))<1e-5)){if(void 0!==a.minAngle&&v<a.minAngle&&(v=a.minAngle),void 0!==a.maxAngle&&a.maxAngle<v&&(v=a.maxAngle),mnc.crossVectors(inc,gnc),mnc.normalize(),enc.setFromAxisAngle(mnc,v),p.quaternion.multiply(enc),void 0!==m){var y=p.quaternion.w;1<y&&(y=1);var x=i.sqrt(1-y*y);p.quaternion.set(m.x*x,m.y*x,m.z*x,y)}void 0!==f&&p.rotation.setFromVector3(p.rotation.toVector3(nnc).max(f)),void 0!==g&&p.rotation.setFromVector3(p.rotation.toVector3(nnc).min(g)),p.updateMatrixWorld(!0),h=!0}}if(!h)break}}return this}),createHelper:function(){return new bnc(this.mesh,this.mesh.geometry.userData.MMD.iks)},_valid:function(){for(var e=this.iks,t=this.mesh.skeleton.bones,i=0,r=e.length;i<r;i++){var n,a,o=e[i],s=o.links;n=t[o.effector];for(var l=0,c=s.length;l<c;l++)n.parent!==(a=t[s[l].index])&&console.warn("THREE.CCDIKSolver: bone "+n.name+" is not the child of bone "+a.name),n=a}}},bnc.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:bnc,updateMatrixWorld:(Znc=new Matrix4,$nc=new Vector3,function(e){var t=this.root;if(this.visible){var i=0,r=this.iks,n=t.skeleton.bones;Znc.getInverse(t.matrixWorld);for(var a=0,o=r.length;a<o;a++){var s=r[a],l=n[s.target],c=n[s.effector],h=this.children[i++],u=this.children[i++];h.position.copy(_nc(l,Znc)),u.position.copy(_nc(c,Znc));for(var d=0,p=s.links.length;d<p;d++)this.children[i++].position.copy(_nc(n[s.links[d].index],Znc));var m=this.children[i++],f=m.geometry.attributes.position.array;for(aoc(f,0,l,Znc),aoc(f,1,c,Znc),d=0,p=s.links.length;d<p;d++)aoc(f,d+2,n[s.links[d].index],Znc);m.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(t.matrixWorld),Object3D.prototype.updateMatrixWorld.call(this,e)}),_init:function(){var n=this,e=this.iks;function t(e){return new Line((t=e,i=new BufferGeometry,r=new Float32Array(3*(2+t.links.length)),i.setAttribute("position",new BufferAttribute(r,3)),i),n.lineMaterial);var t,i,r}for(var i=0,r=e.length;i<r;i++){var a=e[i];this.add(new Mesh(n.sphereGeometry,n.targetSphereMaterial)),this.add(new Mesh(n.sphereGeometry,n.effectorSphereMaterial));for(var o=0,s=a.links.length;o<s;o++)this.add(new Mesh(n.sphereGeometry,n.linkSphereMaterial));this.add(t(a))}}}),anc),enc,fnc,gnc,hnc,inc,jnc,knc,lnc,mnc,nnc,Znc,$nc;function anc(e,t){this.mesh=e,this.iks=t||[],this._valid()}function bnc(e,t){Object3D.call(this),this.root=e,this.iks=t||[],this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new SphereBufferGeometry(.25,16,8),this.targetSphereMaterial=new MeshBasicMaterial({color:new Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new MeshBasicMaterial({color:new Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new MeshBasicMaterial({color:new Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new LineBasicMaterial({color:new Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}function _nc(e,t){return $nc.setFromMatrixPosition(e.matrixWorld).applyMatrix4(t)}function aoc(e,t,i,r){var n=_nc(i,r);e[3*t+0]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z}var MMDPhysics=(Toc.prototype={constructor:Toc,update:function(e){var t,i=this.manager,r=this.mesh,n=!1,a=i.allocThreeVector3(),o=i.allocThreeQuaternion(),s=i.allocThreeVector3();return r.matrixWorld.decompose(a,o,s),1===s.x&&1===s.y&&1===s.z||(n=!0),n&&(null!==(t=r.parent)&&(r.parent=null),s.copy(this.mesh.scale),r.scale.set(1,1,1),r.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(e),this._updateBones(),n&&(null!==t&&(r.parent=t),r.scale.copy(s)),i.freeThreeVector3(s),i.freeThreeQuaternion(o),i.freeThreeVector3(a),this},reset:function(){for(var e=0,t=this.bodies.length;e<t;e++)this.bodies[e].reset();return this},warmup:function(e){for(var t=0;t<e;t++)this.update(1/60);return this},setGravity:function(e){return this.world.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),this.gravity.copy(e),this},createHelper:function(){return new Xoc(this.mesh,this)},_init:function(e,t,i){var r=this.manager,n=e.parent;null!==n&&(n=null);var a=r.allocThreeVector3(),o=r.allocThreeQuaternion(),s=r.allocThreeVector3();a.copy(e.position),o.copy(e.quaternion),s.copy(e.scale),e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.updateMatrixWorld(!0),null===this.world&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(t),this._initConstraints(i),null!==n&&(e.parent=n),e.position.copy(a),e.quaternion.copy(o),e.scale.copy(s),e.updateMatrixWorld(!0),this.reset(),r.freeThreeVector3(a),r.freeThreeQuaternion(o),r.freeThreeVector3(s)},_createWorld:function(){var e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),i=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver;return new Ammo.btDiscreteDynamicsWorld(t,i,r,e)},_initRigidBodies:function(e){for(var t=0,i=e.length;t<i;t++)this.bodies.push(new Voc(this.mesh,this.world,e[t],this.manager))},_initConstraints:function(e){for(var t=0,i=e.length;t<i;t++){var r=e[t];this.constraints.push(new Woc(this.mesh,this.world,this.bodies[r.rigidBodyIndex1],this.bodies[r.rigidBodyIndex2],r,this.manager))}},_stepSimulation:function(e){var t=this.unitStep,i=e,r=1+(e/t|0);i<t&&(i=t,r=1),this.maxStepNum<r&&(r=this.maxStepNum),this.world.stepSimulation(i,r,t)},_updateRigidBodies:function(){for(var e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateFromBone()},_updateBones:function(){for(var e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateBone()}},Uoc.prototype={constructor:Uoc,allocThreeVector3:function(){return 0<this.threeVector3s.length?this.threeVector3s.pop():new Vector3},freeThreeVector3:function(e){this.threeVector3s.push(e)},allocThreeMatrix4:function(){return 0<this.threeMatrix4s.length?this.threeMatrix4s.pop():new Matrix4},freeThreeMatrix4:function(e){this.threeMatrix4s.push(e)},allocThreeQuaternion:function(){return 0<this.threeQuaternions.length?this.threeQuaternions.pop():new Quaternion},freeThreeQuaternion:function(e){this.threeQuaternions.push(e)},allocThreeEuler:function(){return 0<this.threeEulers.length?this.threeEulers.pop():new Euler},freeThreeEuler:function(e){this.threeEulers.push(e)},allocTransform:function(){return 0<this.transforms.length?this.transforms.pop():new Ammo.btTransform},freeTransform:function(e){this.transforms.push(e)},allocQuaternion:function(){return 0<this.quaternions.length?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(e){this.quaternions.push(e)},allocVector3:function(){return 0<this.vector3s.length?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(e){this.vector3s.push(e)},setIdentity:function(e){e.setIdentity()},getBasis:function(e){var t=this.allocQuaternion();return e.getBasis().getRotation(t),t},getBasisAsMatrix3:function(e){var t=this.getBasis(e),i=this.quaternionToMatrix3(t);return this.freeQuaternion(t),i},getOrigin:function(e){return e.getOrigin()},setOrigin:function(e,t){e.getOrigin().setValue(t.x(),t.y(),t.z())},copyOrigin:function(e,t){var i=t.getOrigin();this.setOrigin(e,i)},setBasis:function(e,t){e.setRotation(t)},setBasisFromMatrix3:function(e,t){var i=this.matrix3ToQuaternion(t);this.setBasis(e,i),this.freeQuaternion(i)},setOriginFromArray3:function(e,t){e.getOrigin().setValue(t[0],t[1],t[2])},setOriginFromThreeVector3:function(e,t){e.getOrigin().setValue(t.x,t.y,t.z)},setBasisFromArray3:function(e,t){var i=this.allocThreeQuaternion(),r=this.allocThreeEuler();r.set(t[0],t[1],t[2]),this.setBasisFromThreeQuaternion(e,i.setFromEuler(r)),this.freeThreeEuler(r),this.freeThreeQuaternion(i)},setBasisFromThreeQuaternion:function(e,t){var i=this.allocQuaternion();i.setX(t.x),i.setY(t.y),i.setZ(t.z),i.setW(t.w),this.setBasis(e,i),this.freeQuaternion(i)},multiplyTransforms:function(e,t){var i=this.allocTransform();this.setIdentity(i);var r=this.getBasisAsMatrix3(e),n=this.getBasisAsMatrix3(t),a=this.getOrigin(e),o=this.getOrigin(t),s=this.multiplyMatrix3ByVector3(r,o),l=this.addVector3(s,a);this.setOrigin(i,l);var c=this.multiplyMatrices3(r,n);return this.setBasisFromMatrix3(i,c),this.freeVector3(s),this.freeVector3(l),i},inverseTransform:function(e){var t=this.allocTransform(),i=this.getBasisAsMatrix3(e),r=this.getOrigin(e),n=this.transposeMatrix3(i),a=this.negativeVector3(r),o=this.multiplyMatrix3ByVector3(n,a);return this.setOrigin(t,o),this.setBasisFromMatrix3(t,n),this.freeVector3(a),this.freeVector3(o),t},multiplyMatrices3:function(e,t){var i=[],r=this.rowOfMatrix3(e,0),n=this.rowOfMatrix3(e,1),a=this.rowOfMatrix3(e,2),o=this.columnOfMatrix3(t,0),s=this.columnOfMatrix3(t,1),l=this.columnOfMatrix3(t,2);return i[0]=this.dotVectors3(r,o),i[1]=this.dotVectors3(r,s),i[2]=this.dotVectors3(r,l),i[3]=this.dotVectors3(n,o),i[4]=this.dotVectors3(n,s),i[5]=this.dotVectors3(n,l),i[6]=this.dotVectors3(a,o),i[7]=this.dotVectors3(a,s),i[8]=this.dotVectors3(a,l),this.freeVector3(r),this.freeVector3(n),this.freeVector3(a),this.freeVector3(o),this.freeVector3(s),this.freeVector3(l),i},addVector3:function(e,t){var i=this.allocVector3();return i.setValue(e.x()+t.x(),e.y()+t.y(),e.z()+t.z()),i},dotVectors3:function(e,t){return e.x()*t.x()+e.y()*t.y()+e.z()*t.z()},rowOfMatrix3:function(e,t){var i=this.allocVector3();return i.setValue(e[3*t+0],e[3*t+1],e[3*t+2]),i},columnOfMatrix3:function(e,t){var i=this.allocVector3();return i.setValue(e[t+0],e[t+3],e[t+6]),i},negativeVector3:function(e){var t=this.allocVector3();return t.setValue(-e.x(),-e.y(),-e.z()),t},multiplyMatrix3ByVector3:function(e,t){var i=this.allocVector3(),r=this.rowOfMatrix3(e,0),n=this.rowOfMatrix3(e,1),a=this.rowOfMatrix3(e,2),o=this.dotVectors3(r,t),s=this.dotVectors3(n,t),l=this.dotVectors3(a,t);return i.setValue(o,s,l),this.freeVector3(r),this.freeVector3(n),this.freeVector3(a),i},transposeMatrix3:function(e){var t=[];return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},quaternionToMatrix3:function(e){var t=[],i=e.x(),r=e.y(),n=e.z(),a=e.w(),o=i*i,s=r*r,l=n*n,c=i*r,h=r*n,u=n*i,d=i*a,p=r*a,m=n*a;return t[0]=1-2*(s+l),t[1]=2*(c-m),t[2]=2*(u+p),t[3]=2*(c+m),t[4]=1-2*(l+o),t[5]=2*(h-d),t[6]=2*(u-p),t[7]=2*(h+d),t[8]=1-2*(o+s),t},matrix3ToQuaternion:function(e){var t,i,r,n,a,o=e[0]+e[4]+e[8];n=0<o?(a=.25*(t=2*Math.sqrt(o+1)),i=(e[7]-e[5])/t,r=(e[2]-e[6])/t,(e[3]-e[1])/t):e[4]<e[0]&&e[8]<e[0]?(t=2*Math.sqrt(1+e[0]-e[4]-e[8]),a=(e[7]-e[5])/t,i=.25*t,r=(e[1]+e[3])/t,(e[2]+e[6])/t):e[8]<e[4]?(t=2*Math.sqrt(1+e[4]-e[0]-e[8]),a=(e[2]-e[6])/t,i=(e[1]+e[3])/t,r=.25*t,(e[5]+e[7])/t):(t=2*Math.sqrt(1+e[8]-e[0]-e[4]),a=(e[3]-e[1])/t,i=(e[2]+e[6])/t,r=(e[5]+e[7])/t,.25*t);var s=this.allocQuaternion();return s.setX(i),s.setY(r),s.setZ(n),s.setW(a),s}},Voc.prototype={constructor:Toc.RigidBody,reset:function(){return this._setTransformFromBone(),this},updateFromBone:function(){return-1!==this.params.boneIndex&&0===this.params.type&&this._setTransformFromBone(),this},updateBone:function(){return 0===this.params.type||-1===this.params.boneIndex||(this._updateBoneRotation(),1===this.params.type&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this._setPositionFromBone()),this},_init:function(){var e=this.manager,t=this.params,i=this.mesh.skeleton.bones,r=-1===t.boneIndex?new Bone:i[t.boneIndex],n=function(e){switch(e.shapeType){case 0:return new Ammo.btSphereShape(e.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(e.width,e.height,e.depth));case 2:return new Ammo.btCapsuleShape(e.width,e.height);default:throw"unknown shape type "+e.shapeType}}(t),a=0===t.type?0:t.weight,o=e.allocVector3();o.setValue(0,0,0),0!==a&&n.calculateLocalInertia(a,o);var s=e.allocTransform();e.setIdentity(s),e.setOriginFromArray3(s,t.position),e.setBasisFromArray3(s,t.rotation);var l=e.allocThreeVector3(),c=e.allocTransform();e.setIdentity(c),e.setOriginFromThreeVector3(c,r.getWorldPosition(l));var h=e.multiplyTransforms(c,s),u=new Ammo.btDefaultMotionState(h),d=new Ammo.btRigidBodyConstructionInfo(a,u,n,o);d.set_m_friction(t.friction),d.set_m_restitution(t.restitution);var p=new Ammo.btRigidBody(d);0===t.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(t.positionDamping,t.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<t.groupIndex,t.groupTarget),this.body=p,this.bone=r,this.boneOffsetForm=s,this.boneOffsetFormInverse=e.inverseTransform(s),e.freeVector3(o),e.freeTransform(h),e.freeTransform(c),e.freeThreeVector3(l)},_getBoneTransform:function(){var e=this.manager,t=e.allocThreeVector3(),i=e.allocThreeQuaternion(),r=e.allocThreeVector3();this.bone.matrixWorld.decompose(t,i,r);var n=e.allocTransform();e.setOriginFromThreeVector3(n,t),e.setBasisFromThreeQuaternion(n,i);var a=e.multiplyTransforms(n,this.boneOffsetForm);return e.freeTransform(n),e.freeThreeVector3(r),e.freeThreeQuaternion(i),e.freeThreeVector3(t),a},_getWorldTransformForBone:function(){var e=this.manager,t=this.body.getCenterOfMassTransform();return e.multiplyTransforms(t,this.boneOffsetFormInverse)},_setTransformFromBone:function(){var e=this.manager,t=this._getBoneTransform();this.body.setCenterOfMassTransform(t),this.body.getMotionState().setWorldTransform(t),e.freeTransform(t)},_setPositionFromBone:function(){var e=this.manager,t=this._getBoneTransform(),i=e.allocTransform();this.body.getMotionState().getWorldTransform(i),e.copyOrigin(i,t),this.body.setCenterOfMassTransform(i),this.body.getMotionState().setWorldTransform(i),e.freeTransform(i),e.freeTransform(t)},_updateBoneRotation:function(){var e=this.manager,t=this._getWorldTransformForBone(),i=e.getBasis(t),r=e.allocThreeQuaternion(),n=e.allocThreeQuaternion(),a=e.allocThreeQuaternion();r.set(i.x(),i.y(),i.z(),i.w()),n.setFromRotationMatrix(this.bone.matrixWorld),n.conjugate(),n.multiply(r),a.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(n.multiply(a).normalize()),e.freeThreeQuaternion(r),e.freeThreeQuaternion(n),e.freeThreeQuaternion(a),e.freeQuaternion(i),e.freeTransform(t)},_updateBonePosition:function(){var e=this.manager,t=this._getWorldTransformForBone(),i=e.allocThreeVector3(),r=e.getOrigin(t);i.set(r.x(),r.y(),r.z()),this.bone.parent&&this.bone.parent.worldToLocal(i),this.bone.position.copy(i),e.freeThreeVector3(i),e.freeTransform(t)}},Woc.prototype={constructor:Woc,_init:function(){var e=this.manager,t=this.params,i=this.bodyA,r=this.bodyB,n=e.allocTransform();e.setIdentity(n),e.setOriginFromArray3(n,t.position),e.setBasisFromArray3(n,t.rotation);var a=e.allocTransform(),o=e.allocTransform();i.body.getMotionState().getWorldTransform(a),r.body.getMotionState().getWorldTransform(o);var s=e.inverseTransform(a),l=e.inverseTransform(o),c=e.multiplyTransforms(s,n),h=e.multiplyTransforms(l,n),u=new Ammo.btGeneric6DofSpringConstraint(i.body,r.body,c,h,!0),d=e.allocVector3(),p=e.allocVector3(),m=e.allocVector3(),f=e.allocVector3();d.setValue(t.translationLimitation1[0],t.translationLimitation1[1],t.translationLimitation1[2]),p.setValue(t.translationLimitation2[0],t.translationLimitation2[1],t.translationLimitation2[2]),m.setValue(t.rotationLimitation1[0],t.rotationLimitation1[1],t.rotationLimitation1[2]),f.setValue(t.rotationLimitation2[0],t.rotationLimitation2[1],t.rotationLimitation2[2]),u.setLinearLowerLimit(d),u.setLinearUpperLimit(p),u.setAngularLowerLimit(m),u.setAngularUpperLimit(f);for(var g=0;g<3;g++)0!==t.springPosition[g]&&(u.enableSpring(g,!0),u.setStiffness(g,t.springPosition[g]));for(g=0;g<3;g++)0!==t.springRotation[g]&&(u.enableSpring(g+3,!0),u.setStiffness(g+3,t.springRotation[g]));if(void 0!==u.setParam)for(g=0;g<6;g++)u.setParam(2,.475,g);this.world.addConstraint(u,!0),this.constraint=u,e.freeTransform(n),e.freeTransform(a),e.freeTransform(o),e.freeTransform(s),e.freeTransform(l),e.freeTransform(c),e.freeTransform(h),e.freeVector3(d),e.freeVector3(p),e.freeVector3(m),e.freeVector3(f)}},Xoc.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Xoc,updateMatrixWorld:(kuc=new Vector3,luc=new Quaternion,muc=new Vector3,nuc=new Matrix4,function(e){var t=this.root;if(this.visible){var i=this.physics.bodies;nuc.copy(t.matrixWorld).decompose(kuc,luc,muc).compose(kuc,luc,muc.set(1,1,1)).getInverse(nuc);for(var r=0,n=i.length;r<n;r++){var a=this.children[r],o=i[r].body.getCenterOfMassTransform(),s=o.getOrigin(),l=o.getRotation();a.position.set(s.x(),s.y(),s.z()).applyMatrix4(nuc),a.quaternion.setFromRotationMatrix(nuc).multiply(luc.set(l.x(),l.y(),l.z(),l.w()))}}this.matrix.copy(t.matrixWorld).decompose(kuc,luc,muc).compose(kuc,luc,muc.set(1,1,1)),Object3D.prototype.updateMatrixWorld.call(this,e)}),_init:function(){var e=this.physics.bodies;function t(e){switch(e.shapeType){case 0:return new SphereBufferGeometry(e.width,16,8);case 1:return new BoxBufferGeometry(2*e.width,2*e.height,2*e.depth,8,8,8);case 2:return new i(e.width,e.height,16,8);default:return null}}function i(e,t,i,r){var n=new CylinderBufferGeometry(e,e,t,i,r,!0),a=new Mesh(new SphereBufferGeometry(e,i,r,0,2*Math.PI,0,Math.PI/2)),o=new Mesh(new SphereBufferGeometry(e,i,r,0,2*Math.PI,Math.PI/2,Math.PI/2));return a.position.set(0,t/2,0),o.position.set(0,-t/2,0),a.updateMatrix(),o.updateMatrix(),n.merge(a.geometry,a.matrix),n.merge(o.geometry,o.matrix),n}for(var r=0,n=e.length;r<n;r++){var a=e[r].params;this.add(new Mesh(t(a),this.materials[a.type]))}}}),Toc),kuc,luc,muc,nuc;function Toc(e,t,i,r){if("undefined"==typeof Ammo)throw new Error("THREE.MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");i=i||[],r=r||{},this.manager=new Uoc,this.mesh=e,this.unitStep=void 0!==r.unitStep?r.unitStep:1/65,this.maxStepNum=void 0!==r.maxStepNum?r.maxStepNum:3,this.gravity=new Vector3(0,-98,0),void 0!==r.gravity&&this.gravity.copy(r.gravity),this.world=void 0!==r.world?r.world:null,this.bodies=[],this.constraints=[],this._init(e,t,i)}function Uoc(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]}function Voc(e,t,i,r){this.mesh=e,this.world=t,this.params=i,this.manager=r,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}function Woc(e,t,i,r,n,a){this.mesh=e,this.world=t,this.bodyA=i,this.bodyB=r,this.params=n,this.manager=a,this.constraint=null,this._init()}function Xoc(e,t){Object3D.call(this),this.root=e,this.physics=t,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new MeshBasicMaterial({color:new Color(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init()}var MMDAnimationHelper=(Ouc.prototype={constructor:Ouc,add:function(e,t){if(t=t||{},e.isSkinnedMesh)this._addMesh(e,t);else if(e.isCamera)this._setupCamera(e,t);else{if("Audio"!==e.type)throw new Error("THREE.MMDAnimationHelper.add: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");this._setupAudio(e,t)}return this.configuration.sync&&this._syncDuration(),this},remove:function(e){if(e.isSkinnedMesh)this._removeMesh(e);else if(e.isCamera)this._clearCamera(e);else{if("Audio"!==e.type)throw new Error("THREE.MMDAnimationHelper.remove: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");this._clearAudio(e)}return this.configuration.sync&&this._syncDuration(),this},update:function(e){null!==this.audioManager&&this.audioManager.control(e);for(var t=0;t<this.meshes.length;t++)this._animateMesh(this.meshes[t],e);return this.sharedPhysics&&this._updateSharedPhysics(e),null!==this.camera&&this._animateCamera(this.camera,e),this},pose:function(e,t,i){!1!==(i=i||{}).resetPose&&e.pose();for(var r=e.skeleton.bones,n=t.bones,a={},o=0,s=r.length;o<s;o++)a[r[o].name]=o;var l=new Vector3,c=new Quaternion;for(o=0,s=n.length;o<s;o++){var h=n[o],u=a[h.name];if(void 0!==u){var d=r[u];d.position.add(l.fromArray(h.translation)),d.quaternion.multiply(c.fromArray(h.quaternion))}}return e.updateMatrixWorld(!0),!1!==i.ik&&this._createCCDIKSolver(e).update(i.saveOriginalBonesBeforeIK),!1!==i.grant&&this.createGrantSolver(e).update(),this},enable:function(e,t){if(void 0===this.enabled[e])throw new Error("THREE.MMDAnimationHelper.enable: unknown key "+e);if(this.enabled[e]=t,"physics"===e)for(var i=0,r=this.meshes.length;i<r;i++)this._optimizeIK(this.meshes[i],t);return this},createGrantSolver:function(e){return new Quc(e,e.geometry.userData.MMD.grants)},_addMesh:function(e,t){if(0<=this.meshes.indexOf(e))throw new Error("THREE.MMDAnimationHelper._addMesh: SkinnedMesh '"+e.name+"' has already been added.");return this.meshes.push(e),this.objects.set(e,{looped:!1}),this._setupMeshAnimation(e,t.animation),!1!==t.physics&&this._setupMeshPhysics(e,t),this},_setupCamera:function(e,t){if(this.camera===e)throw new Error("THREE.MMDAnimationHelper._setupCamera: Camera '"+e.name+"' has already been set.");return this.camera&&this.clearCamera(this.camera),(this.camera=e).add(this.cameraTarget),this.objects.set(e,{}),void 0!==t.animation&&this._setupCameraAnimation(e,t.animation),this},_setupAudio:function(e,t){if(this.audio===e)throw new Error("THREE.MMDAnimationHelper._setupAudio: Audio '"+e.name+"' has already been set.");return this.audio&&this.clearAudio(this.audio),this.audio=e,this.audioManager=new Puc(e,t),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this},_removeMesh:function(e){for(var t=!1,i=0,r=0,n=this.meshes.length;r<n;r++)this.meshes[r]!==e?this.meshes[i++]=this.meshes[r]:(this.objects.delete(e),t=!0);if(!t)throw new Error("THREE.MMDAnimationHelper._removeMesh: SkinnedMesh '"+e.name+"' has not been added yet.");return this.meshes.length=i,this},_clearCamera:function(e){if(e!==this.camera)throw new Error("THREE.MMDAnimationHelper._clearCamera: Camera '"+e.name+"' has not been set yet.");return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this},_clearAudio:function(e){if(e!==this.audio)throw new Error("THREE.MMDAnimationHelper._clearAudio: Audio '"+e.name+"' has not been set yet.");return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this},_setupMeshAnimation:function(e,t){var i=this.objects.get(e);if(void 0!==t){var r=Array.isArray(t)?t:[t];i.mixer=new AnimationMixer(e);for(var n=0,a=r.length;n<a;n++)i.mixer.clipAction(r[n]).play();i.mixer.addEventListener("loop",function(e){var t=e.action._clip.tracks;0<t.length&&".bones"!==t[0].name.slice(0,6)||(i.looped=!0)})}return i.ikSolver=this._createCCDIKSolver(e),i.grantSolver=this.createGrantSolver(e),this},_setupCameraAnimation:function(e,t){var i=Array.isArray(t)?t:[t],r=this.objects.get(e);r.mixer=new AnimationMixer(e);for(var n=0,a=i.length;n<a;n++)r.mixer.clipAction(i[n]).play()},_setupMeshPhysics:function(e,t){var i=this.objects.get(e);if(void 0===t.world&&this.sharedPhysics){var r=this._getMasterPhysics();null!==r&&(world=r.world)}i.physics=this._createMMDPhysics(e,t),i.mixer&&!1!==t.animationWarmup&&(this._animateMesh(e,0),i.physics.reset()),i.physics.warmup(void 0!==t.warmup?t.warmup:60),this._optimizeIK(e,!0)},_animateMesh:function(e,t){var i=this.objects.get(e),r=i.mixer,n=i.ikSolver,a=i.grantSolver,o=i.physics,s=i.looped;r&&this.enabled.animation&&(this._restoreBones(e),r.update(t),this._saveBones(e),n&&this.enabled.ik&&(e.updateMatrixWorld(!0),n.update()),a&&this.enabled.grant&&a.update()),!0===s&&this.enabled.physics&&(o&&this.configuration.resetPhysicsOnLoop&&o.reset(),i.looped=!1),o&&this.enabled.physics&&!this.sharedPhysics&&(this.onBeforePhysics(e),o.update(t))},_animateCamera:function(e,t){var i=this.objects.get(e).mixer;i&&this.enabled.cameraAnimation&&(i.update(t),e.updateProjectionMatrix(),e.up.set(0,1,0),e.up.applyQuaternion(e.quaternion),e.lookAt(this.cameraTarget.position))},_optimizeIK:function(e,t){for(var i=e.geometry.userData.MMD.iks,r=e.geometry.userData.MMD.bones,n=0,a=i.length;n<a;n++)for(var o=i[n].links,s=0,l=o.length;s<l;s++){var c=o[s];c.enabled=!0!==t||!(0<r[c.index].rigidBodyType)}},_createCCDIKSolver:function(e){if(void 0===CCDIKSolver)throw new Error("THREE.MMDAnimationHelper: Import CCDIKSolver.");return new CCDIKSolver(e,e.geometry.userData.MMD.iks)},_createMMDPhysics:function(e,t){if(void 0===MMDPhysics)throw new Error("THREE.MMDPhysics: Import MMDPhysics.");return new MMDPhysics(e,e.geometry.userData.MMD.rigidBodies,e.geometry.userData.MMD.constraints,t)},_syncDuration:function(){for(var e=0,t=this.objects,i=this.meshes,r=this.camera,n=this.audioManager,a=0,o=i.length;a<o;a++)if(void 0!==(c=this.objects.get(i[a]).mixer))for(var s=0;s<c._actions.length;s++)t.has(l=c._actions[s]._clip)||t.set(l,{duration:l.duration}),e=Math.max(e,t.get(l).duration);if(null!==r&&void 0!==(c=this.objects.get(r).mixer))for(a=0,o=c._actions.length;a<o;a++){var l;t.has(l=c._actions[a]._clip)||t.set(l,{duration:l.duration}),e=Math.max(e,t.get(l).duration)}for(null!==n&&(e=Math.max(e,t.get(n).duration)),e+=this.configuration.afterglow,a=0,o=this.meshes.length;a<o;a++){var c;if(void 0!==(c=this.objects.get(this.meshes[a]).mixer)){s=0;for(var h=c._actions.length;s<h;s++)c._actions[s]._clip.duration=e}}if(null!==r&&void 0!==(c=this.objects.get(r).mixer))for(a=0,o=c._actions.length;a<o;a++)c._actions[a]._clip.duration=e;null!==n&&(n.duration=e)},_updatePropertyMixersBuffer:function(e){for(var t=this.objects.get(e).mixer,i=t._bindings,r=t._accuIndex,n=0,a=i.length;n<a;n++){var o=i[n];o.binding.getValue(o.buffer,(r+1)*o.valueSize)}},_saveBones:function(e){var t=this.objects.get(e),i=e.skeleton.bones,r=t.backupBones;void 0===r&&(r=new Float32Array(7*i.length),t.backupBones=r);for(var n=0,a=i.length;n<a;n++){var o=i[n];o.position.toArray(r,7*n),o.quaternion.toArray(r,7*n+3)}},_restoreBones:function(e){var t=this.objects.get(e).backupBones;if(void 0!==t)for(var i=e.skeleton.bones,r=0,n=i.length;r<n;r++){var a=i[r];a.position.fromArray(t,7*r),a.quaternion.fromArray(t,7*r+3)}},_getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var e=0,t=this.meshes.length;e<t;e++){var i=this.meshes[e].physics;if(null!=i)return this.masterPhysics=i,this.masterPhysics}return null},_updateSharedPhysics:function(e){if(0!==this.meshes.length&&this.enabled.physics&&this.sharedPhysics){var t=this._getMasterPhysics();if(null!==t){for(var i=0,r=this.meshes.length;i<r;i++)null!=(n=this.meshes[i].physics)&&n.updateRigidBodies();for(t.stepSimulation(e),i=0,r=this.meshes.length;i<r;i++){var n;null!=(n=this.meshes[i].physics)&&n.updateBones()}}}}},Puc.prototype={constructor:Puc,control:function(e){return this.elapsed+=e,this.currentTime+=e,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this},_shouldStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.duration<=this.currentTime;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime||this.audioDuration<this.currentTime-this.delayTime||(this.audio.startTime=this.currentTime-this.delayTime,0))},_shouldStopAudio:function(){return this.audio.isPlaying&&this.duration<=this.currentTime}},Quc.prototype={constructor:Quc,update:(Mxc=new Quaternion,function(){for(var e=this.mesh.skeleton.bones,t=this.grants,i=0,r=t.length;i<r;i++){var n=t[i],a=e[n.index],o=e[n.parentIndex];n.isLocal||n.affectRotation&&(Mxc.set(0,0,0,1),Mxc.slerp(o.quaternion,n.ratio),a.quaternion.multiply(Mxc))}return this})},Ouc),Mxc;function Ouc(e){e=e||{},this.meshes=[],this.camera=null,this.cameraTarget=new Object3D,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:void 0===e.sync||e.sync,afterglow:void 0!==e.afterglow?e.afterglow:0,resetPhysicsOnLoop:void 0===e.resetPhysicsOnLoop||e.resetPhysicsOnLoop},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=function(){},this.sharedPhysics=!1,this.masterPhysics=null}function Puc(e,t){t=t||{},this.audio=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==t.delayTime?t.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}function Quc(e,t){this.mesh=e,this.grants=t||[]}var CSS2DObject=function(e){Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})})};CSS2DObject.prototype=Object.create(Object3D.prototype),CSS2DObject.prototype.constructor=CSS2DObject;var CSS2DRenderer=function(){var i,r,c,h,u=this,d=new Vector3,n=new Matrix4,p=new Matrix4,m={objects:new WeakMap},f=document.createElement("div");f.style.overflow="hidden",this.domElement=f,this.getSize=function(){return{width:i,height:r}},this.setSize=function(e,t){c=(i=e)/2,h=(r=t)/2,f.style.width=e+"px",f.style.height=t+"px"};function a(e){for(var t,i=(t=[],e.traverse(function(e){e instanceof CSS2DObject&&t.push(e)}),t.sort(function(e,t){return m.objects.get(e).distanceToCameraSquared-m.objects.get(t).distanceToCameraSquared})),r=i.length,n=0,a=i.length;n<a;n++)i[n].element.style.zIndex=r-n}var o,s,g=(o=new Vector3,s=new Vector3,function(e,t){return o.setFromMatrixPosition(e.matrixWorld),s.setFromMatrixPosition(t.matrixWorld),o.distanceToSquared(s)});this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),n.copy(t.matrixWorldInverse),p.multiplyMatrices(t.projectionMatrix,n),function e(t,i,r){if(t instanceof CSS2DObject){t.onBeforeRender(u,i,r),d.setFromMatrixPosition(t.matrixWorld),d.applyMatrix4(p);var n=t.element,a="translate(-50%,-50%) translate("+(d.x*c+c)+"px,"+(-d.y*h+h)+"px)";n.style.WebkitTransform=a,n.style.MozTransform=a,n.style.oTransform=a,n.style.transform=a,n.style.display=t.visible&&-1<=d.z&&d.z<=1?"":"none";var o={distanceToCameraSquared:g(r,t)};m.objects.set(t,o),n.parentNode!==f&&f.appendChild(n),t.onAfterRender(u,i,r)}for(var s=0,l=t.children.length;s<l;s++)e(t.children[s],i,r)}(e,e,t),a(e)}},RollerCoasterGeometry=function(e,t){BufferGeometry.call(this);var s=[],l=[],c=[],i=[1,1,1],r=[1,1,0],n=new Vector3(0,1,0),a=new Vector3,o=new Vector3,h=new Quaternion,u=new Quaternion;u.setFromAxisAngle(n,Math.PI/2);var d=new Vector3,p=new Vector3;p.copy(e.getPointAt(0));for(var m=[new Vector3(-.225,0,0),new Vector3(0,-.05,0),new Vector3(0,-.175,0),new Vector3(0,-.05,0),new Vector3(.225,0,0),new Vector3(0,-.175,0)],f=2*Math.PI,g=5,v=[],y=0;y<g;y++){var x=y/g*f;v.push(new Vector3(.06*Math.sin(x),.06*Math.cos(x),0))}g=6;var _=[];for(y=0;y<g;y++){x=y/g*f;_.push(new Vector3(.025*Math.sin(x),.025*Math.cos(x),0))}var b=new Vector3,w=new Vector3;function M(e,t){w.set(0,0,-1).applyQuaternion(h);for(var i=0;i<e.length;i++)b.copy(e[i]),b.applyQuaternion(h),b.add(d),s.push(b.x,b.y,b.z),l.push(w.x,w.y,w.z),c.push(t[0],t[1],t[2]);w.set(0,0,1).applyQuaternion(h);for(i=e.length-1;0<=i;i--)b.copy(e[i]),b.applyQuaternion(h),b.add(d),s.push(b.x,b.y,b.z),l.push(w.x,w.y,w.z),c.push(t[0],t[1],t[2])}var S=new Vector3,T=new Vector3,A=new Vector3,E=new Vector3,C=new Vector3,L=new Vector3,R=new Vector3,P=new Vector3;function D(e,t,i){for(var r=0,n=e.length;r<n;r++){var a=e[r],o=e[(r+1)%n];S.copy(a).add(t),S.applyQuaternion(h),S.add(d),T.copy(o).add(t),T.applyQuaternion(h),T.add(d),A.copy(o).add(t),A.applyQuaternion(u),A.add(p),E.copy(a).add(t),E.applyQuaternion(u),E.add(p),s.push(S.x,S.y,S.z),s.push(T.x,T.y,T.z),s.push(E.x,E.y,E.z),s.push(T.x,T.y,T.z),s.push(A.x,A.y,A.z),s.push(E.x,E.y,E.z),C.copy(a),C.applyQuaternion(h),C.normalize(),L.copy(o),L.applyQuaternion(h),L.normalize(),R.copy(o),R.applyQuaternion(u),R.normalize(),P.copy(a),P.applyQuaternion(u),P.normalize(),l.push(C.x,C.y,C.z),l.push(L.x,L.y,L.z),l.push(P.x,P.y,P.z),l.push(L.x,L.y,L.z),l.push(R.x,R.y,R.z),l.push(P.x,P.y,P.z),c.push(i[0],i[1],i[2]),c.push(i[0],i[1],i[2]),c.push(i[0],i[1],i[2]),c.push(i[0],i[1],i[2]),c.push(i[0],i[1],i[2]),c.push(i[0],i[1],i[2])}}var k=new Vector3;for(y=1;y<=t;y++){d.copy(e.getPointAt(y/t)),n.set(0,1,0),a.subVectors(d,p).normalize(),o.crossVectors(n,a).normalize(),n.crossVectors(a,o);x=Math.atan2(a.x,a.z);h.setFromAxisAngle(n,x),y%2==0&&M(m,r),D(v,k.set(0,-.125,0),r),D(_,k.set(.2,0,0),i),D(_,k.set(-.2,0,0),i),p.copy(d),u.copy(h)}this.setAttribute("position",new BufferAttribute(new Float32Array(s),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(l),3)),this.setAttribute("color",new BufferAttribute(new Float32Array(c),3))};RollerCoasterGeometry.prototype=Object.create(BufferGeometry.prototype);var RollerCoasterLiftersGeometry=function(e,t){BufferGeometry.call(this);var s=[],l=[],c=new Quaternion,i=new Vector3(0,1,0),r=new Vector3,n=new Vector3,a=[new Vector3(0,.05,-.05),new Vector3(0,.05,.05),new Vector3(0,-.05,0)],o=[new Vector3(-.05,0,.05),new Vector3(-.05,0,-.05),new Vector3(.05,0,0)],h=[new Vector3(.05,0,-.05),new Vector3(.05,0,.05),new Vector3(-.05,0,0)],u=new Vector3,d=new Vector3,p=new Vector3,m=new Vector3,f=new Vector3,g=new Vector3,v=new Vector3,y=new Vector3;function x(e,t,i){for(var r=0,n=e.length;r<n;r++){var a=e[r],o=e[(r+1)%n];u.copy(a),u.applyQuaternion(c),u.add(t),d.copy(o),d.applyQuaternion(c),d.add(t),p.copy(o),p.applyQuaternion(c),p.add(i),m.copy(a),m.applyQuaternion(c),m.add(i),s.push(u.x,u.y,u.z),s.push(d.x,d.y,d.z),s.push(m.x,m.y,m.z),s.push(d.x,d.y,d.z),s.push(p.x,p.y,p.z),s.push(m.x,m.y,m.z),f.copy(a),f.applyQuaternion(c),f.normalize(),g.copy(o),g.applyQuaternion(c),g.normalize(),v.copy(o),v.applyQuaternion(c),v.normalize(),y.copy(a),y.applyQuaternion(c),y.normalize(),l.push(f.x,f.y,f.z),l.push(g.x,g.y,g.z),l.push(y.x,y.y,y.z),l.push(g.x,g.y,g.z),l.push(v.x,v.y,v.z),l.push(y.x,y.y,y.z)}}for(var _=new Vector3,b=new Vector3,w=1;w<=t;w++){r.copy(e.getPointAt(w/t)),n.copy(e.getTangentAt(w/t));var M=Math.atan2(n.x,n.z);c.setFromAxisAngle(i,M),10<r.y?(_.set(-.75,-.35,0),_.applyQuaternion(c),_.add(r),b.set(.75,-.35,0),b.applyQuaternion(c),b.add(r),x(a,_,b),_.set(-.7,-.3,0),_.applyQuaternion(c),_.add(r),b.set(-.7,-r.y,0),b.applyQuaternion(c),b.add(r),x(o,_,b),_.set(.7,-.3,0),_.applyQuaternion(c),_.add(r),b.set(.7,-r.y,0)):(_.set(0,-.2,0),_.applyQuaternion(c),_.add(r),b.set(0,-r.y,0)),b.applyQuaternion(c),b.add(r),x(h,_,b)}this.setAttribute("position",new BufferAttribute(new Float32Array(s),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(l),3))};RollerCoasterLiftersGeometry.prototype=Object.create(BufferGeometry.prototype);var _Group=function(){this._tweens={},this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function(){return Object.keys(this._tweens).map(function(e){return this._tweens[e]}.bind(this))},removeAll:function(){this._tweens={}},add:function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},remove:function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},update:function(e,t){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(e=void 0!==e?e:TWEEN.now();0<i.length;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var n=this._tweens[i[r]];n&&!1===n.update(e)&&(n._isPlaying=!1,t||delete this._tweens[i[r]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group,tDc,gDc;TWEEN.Group=_Group,TWEEN._nextId=0,TWEEN.nextId=function(){return TWEEN._nextId++},"undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?TWEEN.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?TWEEN.now=self.performance.now.bind(self.performance):void 0!==Date.now?TWEEN.now=Date.now:TWEEN.now=function(){return(new Date).getTime()},TWEEN.Tween=function(e,t){this._object=e,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=TWEEN.Easing.Linear.None,this._interpolationFunction=TWEEN.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=t||TWEEN,this._id=TWEEN.nextId()},TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},duration:function(e){return this._duration=e,this},start:function(e){for(var t in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==e?"string"==typeof e?TWEEN.now()+parseFloat(e):e:TWEEN.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}void 0!==this._object[t]&&(this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(1/0),this},stopChainedTweens:function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop()},group:function(e){return this._group=e,this},delay:function(e){return this._delayTime=e,this},repeat:function(e){return this._repeat=e,this},repeatDelay:function(e){return this._repeatDelayTime=e,this},yoyo:function(e){return this._yoyo=e,this},easing:function(e){return this._easingFunction=e,this},interpolation:function(e){return this._interpolationFunction=e,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(e){return this._onStartCallback=e,this},onUpdate:function(e){return this._onUpdateCallback=e,this},onComplete:function(e){return this._onCompleteCallback=e,this},onStop:function(e){return this._onStopCallback=e,this},update:function(e){var t,i,r;if(e<this._startTime)return!0;for(t in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,r=this._easingFunction(i=0===this._duration||1<i?1:i),this._valuesEnd)if(void 0!==this._valuesStart[t]){var n=this._valuesStart[t]||0,a=this._valuesEnd[t];a instanceof Array?this._object[t]=this._interpolationFunction(a,r):("string"==typeof a&&(a="+"===a.charAt(0)||"-"===a.charAt(0)?n+parseFloat(a):parseFloat(a)),"number"==typeof a&&(this._object[t]=n+(a-n)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object),1!==i)return!0;if(0<this._repeat){for(t in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[t]&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t])),this._yoyo){var o=this._valuesStartRepeat[t];this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o}this._valuesStart[t]=this._valuesStartRepeat[t]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=void 0!==this._repeatDelayTime?e+this._repeatDelayTime:e+this._delayTime,!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return!1}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),a=TWEEN.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):1<t?a(e[i],e[i-1],i-r):a(e[n],e[i<n+1?i:n+1],r-n)},Bezier:function(e,t){for(var i=0,r=e.length-1,n=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein,o=0;o<=r;o++)i+=n(1-t,r-o)*n(t,o)*e[o]*a(r,o);return i},CatmullRom:function(e,t){var i=e.length-1,r=i*t,n=Math.floor(r),a=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(n=Math.floor(r=i*(1+t))),a(e[(n-1+i)%i],e[n],e[(n+1)%i],e[(n+2)%i],r-n)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):1<t?e[i]-(a(e[i],e[i],e[i-1],e[i-1],r-i)-e[i]):a(e[n?n-1:0],e[n],e[i<n+1?i:n+1],e[i<n+2?i:n+2],r-n)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=TWEEN.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:(gDc=[1],function(e){var t=1;if(gDc[e])return gDc[e];for(var i=e;1<i;i--)t*=i;return gDc[e]=t}),CatmullRom:function(e,t,i,r,n){var a=.5*(i-e),o=.5*(r-t),s=n*n;return n*s*(2*t-2*i+a+o)+(-3*t+3*i-2*a-o)*s+a*n+t}}},tDc=void 0,"function"==typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!=typeof module&&"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=TWEEN:void 0!==tDc&&(tDc.TWEEN=TWEEN);var sqrt=Math.sqrt,cos=Math.cos,sin=Math.sin,atan2=Math.atan2,round=Math.round,pow=Math.pow,max=Math.max,min=Math.min,_int=function(e){return parseInt(e)},fix=function(e,t){return+e.toFixed(t||3)},Log=function(e){console.log(e)},Squared=function(e,t){return e*e+t*t},SquaredSqrt=function(e,t){return sqrt(e*e+t*t)},Point=function(e,t){return this.x=e||0,this.y=t||0,this};Point.prototype={constructor:Point,transform:function(e){return e.tranform(this),this},set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clone:function(){return new Point(this.x,this.y)},sub:function(e){return this.x-=e.x,this.y-=e.y,this},mul:function(e){return this.x*=e,this.y*=e,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},div:function(e){return this.x*=e=1/e,this.y*=e,this},negate:function(){return new Point(-this.x,-this.y)},transformMat2D:function(e){var t=this.x,i=this.y;return this.x=(e=e.n)[0]*t+e[2]*i+e[4],this.y=e[1]*t+e[3]*i+e[5],this},get_length:function(){return sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var e=this.get_length();return this.x/=e,this.y/=e,e},distanceTo:function(e){var t=this.x-e.x;return sqrt(t*t+(e=this.y-e.y)*e)},distanceSquaredTo:function(e){var t=this.x-e.x;return t*t+(e=this.y-e.y)*e},equals:function(e){return this.x===e.x&&this.y===e.y}};var VERTEX=0,EDGE=1,FACE=2,NULL=3,EPSILON=.01,EPSILON_SQUARED=1e-4,TwoPI=6.283185307179586,NEGATIVE_INFINITY=-1/0,POSITIVE_INFINITY=1/0,DDLS_ARRAY_TYPE;DDLS_ARRAY_TYPE=DDLS_ARRAY_TYPE||("undefined"!=typeof Float32Array?Float32Array:Array);var Matrix2D=function(e,t,i,r,n,a){this.n=new DDLS_ARRAY_TYPE(6),this.n[0]=e||1,this.n[1]=t||0,this.n[2]=i||0,this.n[3]=r||1,this.n[4]=n||0,this.n[5]=a||0};Matrix2D.prototype={constructor:Matrix2D,identity:function(){return this.n[0]=1,this.n[1]=0,this.n[2]=0,this.n[3]=1,this.n[4]=0,this.n[5]=0,this},translate:function(e){return this.n[4]+=e.x,this.n[5]+=e.y,this},scale:function(e){return this.n[0]*=e.x,this.n[1]*=e.y,this.n[2]*=e.x,this.n[3]*=e.y,this.n[4]*=e.x,this.n[5]*=e.y,this},rotate:function(e){var t=this.n[0],i=this.n[1],r=this.n[2],n=this.n[3],a=this.n[4],o=this.n[5],s=Math.sin(e);return e=Math.cos(e),this.n[0]=t*e+i*s,this.n[1]=-t*s+i*e,this.n[2]=r*e+n*s,this.n[3]=-r*s+e*n,this.n[4]=e*a+s*o,this.n[5]=e*o-s*a,this},clone:function(){return new Matrix2D(this.n[0],this.n[1],this.n[2],this.n[3],this.n[4],this.n[5])},tranform:function(e){var t=this.n[1]*e.x+this.n[3]*e.y+this.n[5];e.x=this.n[0]*e.x+this.n[2]*e.y+this.n[4],e.y=t},transformX:function(e,t){return this.n[0]*e+this.n[2]*t+this.n[4]},transformY:function(e,t){return this.n[1]*e+this.n[3]*t+this.n[5]},concat:function(e){var t=this.n[0]*e.n[1]+this.n[1]*e.n[3],i=this.n[2]*e.n[0]+this.n[3]*e.n[2],r=this.n[2]*e.n[1]+this.n[3]*e.n[3],n=this.n[4]*e.n[0]+this.n[5]*e.n[2]+e.n[4],a=this.n[4]*e.n[1]+this.n[5]*e.n[3]+e.n[5];return this.n[0]=this.n[0]*e.n[0]+this.n[1]*e.n[2],this.n[1]=t,this.n[2]=i,this.n[3]=r,this.n[4]=n,this.n[5]=a,this}};var ObjectID=0,DDLSObject=function(){this.id=ObjectID,ObjectID++,this._pivot=new Point,this._position=new Point,this._scale=new Point(1,1),this._matrix=new Matrix2D,this._rotation=0,this._constraintShape=null,this._coordinates=[],this.hasChanged=!1,Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!=e&&(this._rotation=e,this.hasChanged=!0)}}),Object.defineProperty(this,"matrix",{get:function(){return this._matrix},set:function(e){this._matrix=e,this.hasChanged=!0}}),Object.defineProperty(this,"coordinates",{get:function(){return this._coordinates},set:function(e){this._coordinates=e,this.hasChanged=!0}}),Object.defineProperty(this,"constraintShape",{get:function(){return this._constraintShape},set:function(e){this._constraintShape=e,this.hasChanged=!0}}),Object.defineProperty(this,"edges",{get:function(){for(var e,t=[],i=this._constraintShape.segments,r=i.length,n=0,a=0,o=0,s=0;n<r;)for(a=0,e=i[o=n++].edges.length;a<e;)s=a++,t.push(i[o].edges[s]);return t}})};DDLSObject.prototype={constructor:DDLSObject,position:function(e,t){this._position.set(e,t),this.hasChanged=!0},scale:function(e,t){this._scale.set(e,t),this.hasChanged=!0},pivot:function(e,t){this._pivot.set(e,t),this.hasChanged=!0},dispose:function(){this._constraintShape=this._coordinates=this._matrix=null},updateValuesFromMatrix:function(){},updateMatrixFromValues:function(){this._matrix.identity().translate(this._pivot.negate()).scale(this._scale).rotate(this._rotation).translate(this._position)}};var VertexID=0,Vertex$1=function(){this.type=VERTEX,this.id=VertexID,VertexID++,this.pos=new Point,this.fromConstraintSegments=[],this.edge=null,this.isReal=!1};Vertex$1.prototype={constructor:Vertex$1,setDatas:function(e,t){this.isReal=void 0===t||t,this.edge=e},addFromConstraintSegment:function(e){-1==this.fromConstraintSegments.indexOf(e)&&this.fromConstraintSegments.push(e)},removeFromConstraintSegment:function(e){-1!=(e=this.fromConstraintSegments.indexOf(e))&&this.fromConstraintSegments.splice(e,1)},dispose:function(){this.fromConstraintSegments=this.edge=this.pos=null},toString:function(){return"ver_id "+this.id}};var FaceID=0,Face=function(){this.type=FACE,this.id=FaceID,FaceID++,this.isReal=!1,this.edge=null};Face.prototype={constructor:Face,setDatas:function(e,t){this.isReal=void 0===t||t,this.edge=e},dispose:function(){this.edge=null}};var SegmentID=0,Segment=function(){this.id=SegmentID,SegmentID++,this.edges=[],this.fromShape=null};Segment.prototype={constructor:Segment,addEdge:function(e){-1==this.edges.indexOf(e)&&-1==this.edges.indexOf(e.oppositeEdge)&&this.edges.push(e)},removeEdge:function(e){var t=this.edges.indexOf(e);-1==t&&(t=this.edges.indexOf(e.oppositeEdge)),-1!=t&&this.edges.splice(t,1)},dispose:function(){this.fromShape=this.edges=null},toString:function(){return"seg_id "+this.id}};var EdgeID=0,Edge=function(){this.type=EDGE,this.id=EdgeID,EdgeID++,this.fromConstraintSegments=[],this.isReal=this.isConstrained=!1,this.leftFace=this.nextLeftEdge=this.oppositeEdge=this.originVertex=null,Object.defineProperty(this,"destinationVertex",{get:function(){return this.oppositeEdge.originVertex}}),Object.defineProperty(this,"nextRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge.nextLeftEdge.oppositeEdge}}),Object.defineProperty(this,"prevRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge.oppositeEdge}}),Object.defineProperty(this,"prevLeftEdge",{get:function(){return this.nextLeftEdge.nextLeftEdge}}),Object.defineProperty(this,"rotLeftEdge",{get:function(){return this.nextLeftEdge.nextLeftEdge.oppositeEdge}}),Object.defineProperty(this,"rotRightEdge",{get:function(){return this.oppositeEdge.nextLeftEdge}}),Object.defineProperty(this,"rightFace",{get:function(){return this.oppositeEdge.leftFace}})};Edge.prototype={constructor:Edge,setDatas:function(e,t,i,r,n,a){this.isConstrained=void 0!==n&&a,this.isReal=void 0===n||n,this.originVertex=e,this.oppositeEdge=t,this.nextLeftEdge=i,this.leftFace=r},getDatas:function(){return[this.originVertex.pos.x,this.originVertex.pos.y,this.destinationVertex.pos.x,this.destinationVertex.pos.y,this.isConstrained?1:0]},addFromConstraintSegment:function(e){-1==this.fromConstraintSegments.indexOf(e)&&this.fromConstraintSegments.push(e)},removeFromConstraintSegment:function(e){-1!=(e=this.fromConstraintSegments.indexOf(e))&&this.fromConstraintSegments.splice(e,1)},dispose:function(){this.fromConstraintSegments=this.leftFace=this.nextLeftEdge=this.oppositeEdge=this.originVertex=null},toString:function(){return"edge "+this.originVertex.id+" - "+this.destinationVertex.id}};var ShapeID=0,Shape$1=function(){this.id=ShapeID,ShapeID++,this.segments=[]};Shape$1.prototype={constructor:Shape$1,dispose:function(){for(;0<this.segments.length;)this.segments.pop().dispose();this.segments=null}};var RandGenerator=function(e,t,i){this.rangeMin=t||0,this.rangeMax=i||1,this._originalSeed=this._currSeed=e||1234,this._numIter=0,Object.defineProperty(this,"seed",{get:function(){return this._originalSeed},set:function(e){this._originalSeed=this._currSeed=e}})};RandGenerator.prototype={constructor:RandGenerator,reset:function(){this._currSeed=this._originalSeed,this._numIter=0},next:function(){var e=+this._currSeed;for(this._tempString=(e*e).toString();this._tempString.length<8;)this._tempString="0"+this._tempString;return this._currSeed=parseInt(this._tempString.substr(1,5)),e=round(this.rangeMin+this._currSeed/99999*(this.rangeMax-this.rangeMin)),0==this._currSeed&&(this._currSeed=this._originalSeed+this._numIter),this._numIter++,200==this._numIter&&this.reset(),e},nextInRange:function(e,t){return this.rangeMin=e,this.rangeMax=t,this.next()},shuffle:function(e){for(var t=e.length;0<t;){var i=this.nextInRange(0,t-1),r=e[--t];e[t]=e[i],e[i]=r}}};var FromVertexToHoldingFaces=function(){Object.defineProperty(this,"fromVertex",{set:function(e){this._fromVertex=e,this._nextEdge=this._fromVertex.edge}})};FromVertexToHoldingFaces.prototype={next:function(){if(null!=this._nextEdge){do{if(this._resultFace=this._nextEdge.leftFace,this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null,this._resultFace.isReal||(this._resultFace=null);break}}while(!this._resultFace.isReal)}else this._resultFace=null;return this._resultFace}};var FromVertexToIncomingEdges=function(){Object.defineProperty(this,"fromVertex",{set:function(e){for(this._fromVertex=e,this._nextEdge=this._fromVertex.edge;!this._nextEdge.isReal;)this._nextEdge=this._nextEdge.rotLeftEdge}})};FromVertexToIncomingEdges.prototype={next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge.oppositeEdge;do{if(this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;break}}while(!this._nextEdge.isReal)}else this._resultEdge=null;return this._resultEdge}};var FromVertexToOutgoingEdges=function(){this.realEdgesOnly=!0,Object.defineProperty(this,"fromVertex",{set:function(e){if(this._fromVertex=e,this._nextEdge=this._fromVertex.edge,null!=this._nextEdge)for(;this.realEdgesOnly&&!this._nextEdge.isReal;)this._nextEdge=this._nextEdge.rotLeftEdge}})};FromVertexToOutgoingEdges.prototype={next:function(){if(null!=this._nextEdge){this._resultEdge=this._nextEdge;do{if(this._nextEdge=this._nextEdge.rotLeftEdge,this._nextEdge==this._fromVertex.edge){this._nextEdge=null;break}}while(this.realEdgesOnly&&!this._nextEdge.isReal)}else this._resultEdge=null;return this._resultEdge}};var FromFaceToInnerEdges=function(){Object.defineProperty(this,"fromFace",{set:function(e){this._fromFace=e,this._nextEdge=this._fromFace.edge}})};FromFaceToInnerEdges.prototype={next:function(){return null!=this._nextEdge?(this._resultEdge=this._nextEdge,this._nextEdge=this._nextEdge.nextLeftEdge,this._nextEdge==this._fromFace.edge&&(this._nextEdge=null)):this._resultEdge=null,this._resultEdge}};var Dictionary=function(e){this.type=e||0,0==this.type?(this.k=[],this.v=[]):this.h={}};Dictionary.prototype={set:function(e,t){2==this.type?this.h[e]=t:1==this.type?this.h[e.id]=t:(this.k.push(e),this.v.push(t))},get:function(e){return 2==this.type?this.h[e]:1==this.type?this.h[e.id]:-1!=(e=this.k.indexOf(e))?this.v[e]:void 0},dispose:function(){if(0==this.type){for(;0<this.k.length;)this.k.pop();for(;0<this.v.length;)this.v.pop();this.v=this.k=null}else this.h=null}};var Geom2D={__samples:[]};Geom2D.__circumcenter=new Point,Geom2D.locatePosition=function(e,t){var i;null==Geom2D._randGen&&(Geom2D._randGen=new RandGenerator),Geom2D._randGen.seed=_int(10*e.x+4*e.y),Geom2D.__samples.splice(0,Geom2D.__samples.length);var r=_int(pow(t._vertices.length,.3333333333333333));for(Geom2D._randGen.rangeMin=0,Geom2D._randGen.rangeMax=t._vertices.length-1,i=r;i--;)Geom2D.__samples.push(t._vertices[Geom2D._randGen.next()]);for(var n,a=POSITIVE_INFINITY,o=null,s=0;s<r;)i=s++,(n=Squared((n=(i=Geom2D.__samples[i]).pos).x-e.x,n.y-e.y))<a&&(a=n,o=i);for((r=new FromVertexToHoldingFaces).fromVertex=o,s=r.next(),o=new Dictionary(1),r=new FromFaceToInnerEdges,a=0,i=Geom2D.isInFace(e,s);o.get(s)||3===i.type;){if(o.set(s,!0),50==++a&&Log("WALK TAKE MORE THAN 50 LOOP"),1e3==a){Log("WALK TAKE MORE THAN 1000 LOOP -> WE ESCAPE"),i={type:NULL};break}r.fromFace=s;do{if(null==(s=r.next()))return Log("KILL PATH"),null;i=Geom2D.getRelativePosition(e,s)}while(1==i||0==i);i=Geom2D.isInFace(e,s=s.rightFace)}return o.dispose(),i},Geom2D.isCircleIntersectingAnyConstraint=function(e,t,i){if(e.x<=0||i.width<=e.x||e.y<=0||i.height<=e.y)return!0;var r,n;switch((i=Geom2D.locatePosition(e,i)).type){case 0:r=i.edge.leftFace;break;case 1:r=i.leftFace;break;case 2:r=i;break;case 3:r=null}if(i=t*t,(n=Squared((n=r.edge.originVertex.pos).x-e.x,n.y-e.y))<=i)return!0;if((n=Squared((n=r.edge.nextLeftEdge.originVertex.pos).x-e.x,n.y-e.y))<=i)return!0;if((n=Squared((n=r.edge.nextLeftEdge.nextLeftEdge.originVertex.pos).x-e.x,n.y-e.y))<=i)return!0;for((i=[]).push(r.edge),i.push(r.edge.nextLeftEdge),i.push(r.edge.nextLeftEdge.nextLeftEdge),n=new Dictionary(0);0<i.length;)if(r=i.pop(),n.set(r,!0),Geom2D.intersectionsSegmentCircle(r.originVertex.pos,r.destinationVertex.pos,e,t)){if(r.isConstrained)return!0;n.get(r=r.oppositeEdge.nextLeftEdge)||n.get(r.oppositeEdge)||-1!=i.indexOf(r)||-1!=i.indexOf(r.oppositeEdge)||i.push(r),n.get(r=r.nextLeftEdge)||n.get(r.oppositeEdge)||-1!=i.indexOf(r)||-1!=i.indexOf(r.oppositeEdge)||i.push(r)}return!1},Geom2D.getDirection=function(e,t,i){return 0==(e=(i.x-e.x)*(t.y-e.y)+(i.y-e.y)*(-t.x+e.x))?0:0<e?1:-1},Geom2D.Orient2d=function(e,t,i){return-EPSILON_SQUARED<(e=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x))&&e<EPSILON_SQUARED?0:0<e?-1:1},Geom2D.getRelativePosition=function(e,t){return Geom2D.getDirection(t.originVertex.pos,t.destinationVertex.pos,e)},Geom2D.getRelativePosition2=function(e,t){return Geom2D.Orient2d(t.originVertex.pos,t.destinationVertex.pos,e)},Geom2D.isInFace=function(e,t){var i={type:NULL},r=t.edge,n=r.nextLeftEdge,a=n.nextLeftEdge;if(0<=Geom2D.getRelativePosition(e,r)&&0<=Geom2D.getRelativePosition(e,n)&&0<=Geom2D.getRelativePosition(e,a)){var o,s=n.originVertex,l=a.originVertex,c=(i=r.originVertex).pos.y,h=s.pos.x,u=s.pos.y,d=l.pos.x,p=l.pos.y,m=Squared((o=i.pos.x)-e.x,c-e.y),f=Squared(h-e.x,u-e.y),g=Squared(d-e.x,p-e.y),v=1/Squared(h-o,u-c),y=1/Squared(d-h,p-u),x=1/Squared(o-d,c-p),_=(e.x-o)*(h-o)+(e.y-c)*(u-c);f=f-(h=(e.x-h)*(d-h)+(e.y-u)*(p-u))*h*y<=EPSILON_SQUARED,g=g-(o=(e.x-d)*(o-d)+(e.y-p)*(c-p))*o*x<=EPSILON_SQUARED,i=m-_*_*v<=EPSILON_SQUARED?g?i:f?s:r:f?g?l:n:g?a:t}return i},Geom2D.clipSegmentByTriangle=function(e,t,i,r,n,a,o){var s=Geom2D.getDirection(i,r,e),l=Geom2D.getDirection(i,r,t);if(s<=0&&l<=0)return!1;var c=Geom2D.getDirection(r,n,e),h=Geom2D.getDirection(r,n,t);if(c<=0&&h<=0)return!1;var u=Geom2D.getDirection(n,i,e),d=Geom2D.getDirection(n,i,t);if(u<=0&&d<=0)return!1;if(0<=s&&0<=c&&0<=u&&0<=l&&0<=h&&0<=d)return e.clone(),t.clone(),!0;var p=0;return Geom2D.intersections2segments(e,t,i,r,a,null)&&p++,0==p?Geom2D.intersections2segments(e,t,r,n,a,null)&&p++:Geom2D.intersections2segments(e,t,r,n,o,null)&&(a.x-o.x<-.01||EPSILON<a.x-o.x||a.y-o.y<-EPSILON||EPSILON<a.y-o.y)&&p++,0==p?Geom2D.intersections2segments(e,t,n,i,a,null)&&p++:1==p&&Geom2D.intersections2segments(e,t,n,i,o,null)&&(a.x-o.x<-EPSILON||EPSILON<a.x-o.x||a.y-o.y<-EPSILON||EPSILON<a.y-o.y)&&p++,1==p&&(0<=s&&0<=c&&0<=u?e.clone():0<=l&&0<=h&&0<=d?t.clone():p=0),0<p},Geom2D.isDelaunay=function(e){var t=e.nextLeftEdge.destinationVertex,i=e.nextRightEdge.destinationVertex;return Geom2D.getCircumcenter(t.pos,e.originVertex.pos,e.destinationVertex.pos,Geom2D.__circumcenter),(t.pos.x-Geom2D.__circumcenter.x)*(t.pos.x-Geom2D.__circumcenter.x)+(t.pos.y-Geom2D.__circumcenter.y)*(t.pos.y-Geom2D.__circumcenter.y)<=(i.pos.x-Geom2D.__circumcenter.x)*(i.pos.x-Geom2D.__circumcenter.x)+(i.pos.y-Geom2D.__circumcenter.y)*(i.pos.y-Geom2D.__circumcenter.y)},Geom2D.getCircumcenter=function(e,t,i,r){null==r&&(r=new Point);var n=.5*(e.x+t.x),a=.5*(e.y+t.y);return r.x=n+(i=(n*(e.x-i.x)+(a-.5*(e.y+i.y))*(e.y-i.y)+.5*(e.x+i.x)*(i.x-e.x))/(e.x*(i.y-t.y)+t.x*(e.y-i.y)+i.x*(t.y-e.y)))*(t.y-e.y),r.y=a-i*(t.x-e.x),r},Geom2D.intersections2segments=function(e,t,i,r,n,a,o){null==o&&(o=!1);var s,l=0,c=0,h=(e.x-t.x)*(i.y-r.y)+(t.y-e.y)*(i.x-r.x);return 0==h?s=!1:(s=!0,h=1/h,o&&null==n&&null==a||(l=(e.x*(i.y-r.y)+e.y*(r.x-i.x)+i.x*r.y-i.y*r.x)*h,c=(e.x*(i.y-t.y)+e.y*(t.x-i.x)-t.x*i.y+t.y*i.x)*h,o||0<=l&&l<=1&&0<=c&&c<=1||(s=!1))),s&&(null!=n&&(n.x=e.x+l*(t.x-e.x),n.y=e.y+l*(t.y-e.y)),null!=a&&a.push(l,c)),s},Geom2D.intersections2edges=function(e,t,i,r,n){return null==n&&(n=!1),Geom2D.intersections2segments(e.originVertex.pos,e.destinationVertex.pos,t.originVertex.pos,t.destinationVertex.pos,i,r,n)},Geom2D.isConvex=function(e){var t=!0;return-1!=Geom2D.getRelativePosition(e.nextRightEdge.destinationVertex.pos,e.nextLeftEdge.oppositeEdge)?t=!1:-1!=Geom2D.getRelativePosition(e.prevLeftEdge.originVertex.pos,e.prevRightEdge)&&(t=!1),t},Geom2D.projectOrthogonaly=function(e,t){var i,r=t.originVertex.pos.x,n=t.originVertex.pos.y,a=t.destinationVertex.pos.x,o=t.destinationVertex.pos.y,s=e.y;e.x=r+(i=(r*r-r*a-r*(i=e.x)+n*n-n*o-n*s+a*i+o*s)/(r*r-2*r*a+n*n-2*n*o+a*a+o*o))*(a-r),e.y=n+i*(o-n)},Geom2D.intersections2Circles=function(e,t,i,r,n){var a,o;return a=1/(2*(o=Squared(i.x-e.x,i.y-e.y))),(e.x!=i.x||e.y!=i.y)&&o<=(t+r)*(t+r)&&(t-r)*(t-r)<=o&&(o=sqrt(((t+r)*(t+r)-o)*(o-(r-t)*(r-t))),a=i.clone().sub(e).mul(a),e=e.clone().add(i).mul(.5),t=a.clone().mul(t*t-r*r),t=e.clone().add(t),null!=n&&n.push(t.x+a.y*o,t.y-a.x*o,t.x-a.y*o,t.y+a.x*o),!0)},Geom2D.intersectionsSegmentCircle=function(e,t,i,r,n){var a=e.x*e.x,o=e.y*e.y,s=t.y*t.y-2*t.y*e.y+o+t.x*t.x-2*t.x*e.x+a,l=2*e.y*i.y-2*a+2*t.y*e.y-2*o+2*t.x*e.x-2*t.x*i.x+2*e.x*i.x-2*t.y*i.y;return!((i=l*l-4*s*(o+i.y*i.y+i.x*i.x-2*e.y*i.y-2*e.x*i.x+a-r*r))<0)&&(0==i?!((i=-l/(2*s))<0||1<i)&&(null!=n&&n.push(e.x+i*(t.x-e.x),e.y+i*(t.y-e.y),i),!0):(i=(-l+(r=sqrt(i)))/(2*s),s=(-l-r)/(2*s),l=!1,0<=i&&i<=1&&(null!=n&&n.push(e.x+i*(t.x-e.x),e.y+i*(t.y-e.y),i),l=!0),0<=s&&s<=1&&(null!=n&&n.push(e.x+s*(t.x-e.x),e.y+s*(t.y-e.y),s),l=!0),l))},Geom2D.tangentsPointToCircle=function(e,t,i,r){var n=e.clone().add(t).mul(.5);return e=.5*SquaredSqrt(e.x-t.x,e.y-t.y),Geom2D.intersections2Circles(n,e,t,i,r)},Geom2D.tangentsCrossCircleToCircle=function(e,t,i,r){var n=.25*(o=SquaredSqrt(t.x-i.x,t.y-i.y)),a=i.clone().sub(t).mul(.25).add(t);if(Geom2D.intersections2Circles(t,e,a,n,r)){e=r[0];n=r[1],a=r[2];var o,s=r[3],l=t.clone().add(i).mul(.5),c=((e-l.x)*(i.y-t.y)+(n-l.y)*(-i.x+t.x))/(o*o);return r.push((o=2*(l.x+c*(i.y-t.y))-e)+a-e,s+(t=2*(l.y-c*(i.x-t.x))-n)-n,o,t),!0}return!1},Geom2D.tangentsParalCircleToCircle=function(e,t,i,r){var n=1/SquaredSqrt(t.x-i.x,t.y-i.y),a=t.x+e*(i.y-t.y)*n,o=2*t.y-(e=t.y+e*(-i.x+t.x)*n);r.push(a,e,n=2*t.x-a,o,n+i.x-t.x,o+i.y-t.y,a+i.x-t.x,e+i.y-t.y)},Geom2D.distanceSquaredPointToSegment=function(e,t,i){var r=Squared(i.x-t.x,i.y-t.y),n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return n<0?Squared(e.x-t.x,e.y-t.y):n<=1?Squared(t.x-e.x,t.y-e.y)-n*n*r:Squared(e.x-i.x,e.y-i.y)},Geom2D.distanceSquaredVertexToEdge=function(e,t){return Geom2D.distanceSquaredPointToSegment(e.pos,t.originVertex.pos,t.destinationVertex.pos)},Geom2D.pathLength=function(e){for(var t,i,r=0,n=e[0],a=e[1],o=2;o<e.length;)r+=a=SquaredSqrt(n=(t=e[o])-n,a=(i=e[o+1])-a),n=t,a=i,o+=2;return r};var FromMeshToVertices=function(){Object.defineProperty(this,"fromMesh",{set:function(e){this._fromMesh=e,this._currIndex=0}})};FromMeshToVertices.prototype={next:function(){do{if(!(this._currIndex<this._fromMesh._vertices.length)){this._resultVertex=null;break}this._resultVertex=this._fromMesh._vertices[this._currIndex],this._currIndex++}while(!this._resultVertex.isReal);return this._resultVertex}};var MeshID=0,Mesh$1=function(e,t){this.id=MeshID,MeshID++,this.__objectsUpdateInProgress=!1,this.__centerVertex=null,this.width=e,this.height=t,this.clipping=!0,this._edges=[],this._faces=[],this._objects=[],this._vertices=[],this._constraintShapes=[],this.__edgesToCheck=[],this.AR_edge=this.AR_vertex=null,this.isRedraw=!0};Mesh$1.prototype={constructor:Mesh$1,clear:function(e){for(;0<this._vertices.length;)this._vertices.pop().dispose();for(this._vertices=[];0<this._edges.length;)this._edges.pop().dispose();for(this._edges=[];0<this._faces.length;)this._faces.pop().dispose();for(this._faces=[];0<this._constraintShapes.length;)this._constraintShapes.pop().dispose();if(this._constraintShapes=[],!e)for(;0<this._objects.length;)this._objects.pop().dispose();this._objects=[],this.__edgesToCheck=[],this.__centerVertex=[],this.AR_edge=this.AR_vertex=null},dispose:function(){for(;0<this._vertices.length;)this._vertices.pop().dispose();for(this._vertices=null;0<this._edges.length;)this._edges.pop().dispose();for(this._edges=null;0<this._faces.length;)this._faces.pop().dispose();for(this._faces=null;0<this._constraintShapes.length;)this._constraintShapes.pop().dispose();for(this._constraintShapes=null;0<this._objects.length;)this._objects.pop().dispose();this.AR_edge=this.AR_vertex=this.__centerVertex=this.__edgesToCheck=this._objects=null},get___constraintShapes:function(){return this._constraintShapes},buildFromRecord:function(e){for(var t=(e=e.split(";")).length,i=0;i<t;)this.insertConstraintSegment(parseFloat(e[i]),parseFloat(e[i+1]),parseFloat(e[i+2]),parseFloat(e[i+3])),i+=4},insertObject:function(e){null!=e.constraintShape&&this.deleteObject(e);var t,i=new Shape$1,r=e.coordinates;e.updateMatrixFromValues();for(var n=e.matrix,a=new Point,o=new Point,s=r.length,l=0;l<s;)a.set(r[l],r[l+1]).transformMat2D(n),o.set(r[l+2],r[l+3]).transformMat2D(n),null!=(t=this.insertConstraintSegment(a.x,a.y,o.x,o.y))&&(t.fromShape=i).segments.push(t),l+=4;this._constraintShapes.push(i),e.constraintShape=i,this.__objectsUpdateInProgress||this._objects.push(e)},deleteObject:function(e){null!=e.constraintShape&&(this.deleteConstraintShape(e.constraintShape),e.constraintShape=null,this.__objectsUpdateInProgress||(e=this._objects.indexOf(e),this._objects.splice(e,1)))},updateObjects:function(){this.__objectsUpdateInProgress=!0;for(var e=this._objects.length,t=0,i=0;t<e;)i=t++,(i=this._objects[i]).hasChanged&&(this.deleteObject(i),this.insertObject(i),this.isRedraw=!(i.hasChanged=!1));this.__objectsUpdateInProgress=!1},insertConstraintShape:function(e){for(var t=new Shape$1,i=null,r=e.length,n=0;n<r;)null!=(i=this.insertConstraintSegment(e[n],e[n+1],e[n+2],e[n+3]))&&(i.fromShape=t).segments.push(i),n+=4;return this._constraintShapes.push(t),t},deleteConstraintShape:function(e){for(var t=0,i=0,r=e.segments.length;t<r;)i=t++,this.deleteConstraintSegment(e.segments[i]);this._constraintShapes.splice(this._constraintShapes.indexOf(e),1),e.dispose()},insertConstraintSegment:function(e,t,i,r){var n=e,a=t,o=i,s=r;if(this.width<e&&this.width<i||e<0&&i<0||this.height<t&&this.height<r||t<0&&r<0)return null;r-=t;var l=NEGATIVE_INFINITY,c=POSITIVE_INFINITY;if(0!=(i-=e)){var h=(0-e)/i;l=max(l,min(h,u=(this.width-e)/i)),c=min(c,max(h,u))}if(0!=r&&(l=max(l,min(h=(0-t)/r,u=(this.height-t)/r)),c=min(c,max(h,u))),!(l<=c))return null;if(c<1&&(o=i*c+e,s=r*c+t),0<l&&(n=i*l+e,a=r*l+t),null==(e=this.insertVertex(n,a)))return null;if(null==(o=this.insertVertex(o,s))||e.id==o.id)return null;s=new FromVertexToOutgoingEdges,t=new Segment,n=new Edge,a=new Edge,n.setDatas(e,a,null,null,!0,!0),a.setDatas(o,n,null,null,!0,!0),a=[],i=[],r=[];var u={type:3},d=(l=new Point,!1);for(u=e;;)if(d=!1,0===u.type){for(s.fromVertex=c=u;null!=(h=s.next());){if(h.destinationVertex.id==o.id)return h.isConstrained||(h.isConstrained=!0,h.oppositeEdge.isConstrained=!0),h.addFromConstraintSegment(t),h.oppositeEdge.fromConstraintSegments=h.fromConstraintSegments,e.addFromConstraintSegment(t),o.addFromConstraintSegment(t),t.addEdge(h),t;if(Geom2D.distanceSquaredVertexToEdge(h.destinationVertex,n)<=EPSILON_SQUARED){h.isConstrained||(h.isConstrained=!0,h.oppositeEdge.isConstrained=!0),h.addFromConstraintSegment(t),h.oppositeEdge.fromConstraintSegments=h.fromConstraintSegments,e.addFromConstraintSegment(t),t.addEdge(h),u=n.originVertex=e=h.destinationVertex,d=!0;break}}if(!d)for(s.fromVertex=c;null!=(h=s.next());)if(Geom2D.intersections2edges(h=h.nextLeftEdge,n,l)){if(h.isConstrained){for(e=this.splitEdge(h,l.x,l.y),s.fromVertex=c;null!=(h=s.next());)if(h.destinationVertex.id==e.id){h.isConstrained=!0,h.oppositeEdge.isConstrained=!0,h.addFromConstraintSegment(t),h.oppositeEdge.fromConstraintSegments=h.fromConstraintSegments,t.addEdge(h);break}c.addFromConstraintSegment(t),u=n.originVertex=e}else a.push(h),i.unshift(h.nextLeftEdge),r.push(h.prevLeftEdge),u=h=h.oppositeEdge;break}}else if(1===u.type){if((c=(h=u).nextLeftEdge).destinationVertex.id==o.id)return i.unshift(c.nextLeftEdge),r.push(c),h=new Edge,u=new Edge,h.setDatas(e,u,null,null,!0,!0),u.setDatas(o,h,null,null,!0,!0),i.push(h),r.push(u),this.insertNewConstrainedEdge(t,h,a,i,r),t;if(Geom2D.distanceSquaredVertexToEdge(c.destinationVertex,n)<=EPSILON_SQUARED)i.unshift(c.nextLeftEdge),r.push(c),h=new Edge,u=new Edge,h.setDatas(e,u,null,null,!0,!0),u.setDatas(c.destinationVertex,h,null,null,!0,!0),i.push(h),r.push(u),this.insertNewConstrainedEdge(t,h,a,i,r),a.splice(0,a.length),i.splice(0,i.length),r.splice(0,r.length),u=n.originVertex=e=c.destinationVertex;else if(Geom2D.intersections2edges(c,n,l))if(c.isConstrained){for(c=this.splitEdge(c,l.x,l.y),s.fromVertex=c;null!=(h=s.next());)h.destinationVertex==i[0].originVertex&&i.unshift(h),h.destinationVertex==r[r.length-1].destinationVertex&&r.push(h.oppositeEdge);h=new Edge,u=new Edge,h.setDatas(e,u,null,null,!0,!0),u.setDatas(c,h,null,null,!0,!0),i.push(h),r.push(u),this.insertNewConstrainedEdge(t,h,a,i,r),a.splice(0,a.length),i.splice(0,i.length),r.splice(0,r.length),u=n.originVertex=e=c}else a.push(c),i.unshift(c.nextLeftEdge),u=h=c.oppositeEdge;else if(Geom2D.intersections2edges(c=c.nextLeftEdge,n,l),c.isConstrained){for(c=this.splitEdge(c,l.x,l.y),s.fromVertex=c;null!=(h=s.next());)h.destinationVertex.id==i[0].originVertex.id&&i.unshift(h),h.destinationVertex.id==r[r.length-1].destinationVertex.id&&r.push(h.oppositeEdge);h=new Edge,u=new Edge,h.setDatas(e,u,null,null,!0,!0),u.setDatas(c,h,null,null,!0,!0),i.push(h),r.push(u),this.insertNewConstrainedEdge(t,h,a,i,r),a.splice(0,a.length),i.splice(0,i.length),r.splice(0,r.length),u=n.originVertex=e=c}else a.push(c),r.push(c.prevLeftEdge),u=h=c.oppositeEdge}},insertNewConstrainedEdge:function(e,t,i,r,n){this._edges.push(t),this._edges.push(t.oppositeEdge),t.addFromConstraintSegment(e),t.oppositeEdge.fromConstraintSegments=t.fromConstraintSegments,e.addEdge(t),t.originVertex.addFromConstraintSegment(e),t.destinationVertex.addFromConstraintSegment(e),this.untriangulate(i),this.triangulate(r,!0),this.triangulate(n,!0)},deleteConstraintSegment:function(e){for(var t,i=[],r=null,n=e.edges.length,a=0;a<n;)r=a++,(r=e.edges[r]).removeFromConstraintSegment(e),0==r.fromConstraintSegments.length&&(r.isConstrained=!1,r.oppositeEdge.isConstrained=!1),(t=r.originVertex).removeFromConstraintSegment(e),i.push(t);for((t=r.destinationVertex).removeFromConstraintSegment(e),i.push(t),n=i.length,a=0;a<n;)r=a++,this.deleteVertex(i[r]);e.dispose()},check:function(){for(var e,t=this._edges.length,i=0;i<t;)if(e=i++,null==this._edges[e].nextLeftEdge)return void Log("!!! missing nextLeftEdge");Log("check OK")},insertVertex:function(e,t){if(e<0||t<0||this.width<e||this.height<t)return null;this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var i=Geom2D.locatePosition(new Point(e,t),this),r=null;switch(i.type){case 0:r=i;break;case 1:r=this.splitEdge(i,e,t);break;case 2:r=this.splitFace(i,e,t)}return this.restoreAsDelaunay(),r},flipEdge:function(e){var t=e.oppositeEdge,i=new Edge,r=new Edge,n=e.nextLeftEdge,a=n.nextLeftEdge,o=t.nextLeftEdge,s=o.nextLeftEdge,l=e.originVertex,c=t.originVertex,h=a.originVertex,u=s.originVertex,d=e.leftFace,p=t.leftFace,m=new Face,f=new Face;return this._edges.push(i),this._edges.push(r),this._faces.push(f),this._faces.push(m),i.setDatas(h,r,s,f,e.isReal,e.isConstrained),r.setDatas(u,i,a,m,e.isReal,e.isConstrained),f.setDatas(i),m.setDatas(r),c.edge.id==t.id&&c.setDatas(n),l.edge.id==e.id&&l.setDatas(o),n.nextLeftEdge=i,n.leftFace=f,a.nextLeftEdge=o,a.leftFace=m,o.nextLeftEdge=r,o.leftFace=m,s.nextLeftEdge=n,s.leftFace=f,this._edges.splice(this._edges.indexOf(e),1),this._edges.splice(this._edges.indexOf(t),1),e.dispose(),t.dispose(),this._faces.splice(this._faces.indexOf(d),1),this._faces.splice(this._faces.indexOf(p),1),d.dispose(),p.dispose(),r},splitEdge:function(e,t,i){this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var r=e.oppositeEdge,n=e.nextLeftEdge,a=n.nextLeftEdge,o=r.nextLeftEdge,s=o.nextLeftEdge,l=a.originVertex,c=e.originVertex,h=s.originVertex,u=r.originVertex,d=e.leftFace,p=r.leftFace;if((c.pos.x-t)*(c.pos.x-t)+(c.pos.y-i)*(c.pos.y-i)<=EPSILON_SQUARED)return c;if((u.pos.x-t)*(u.pos.x-t)+(u.pos.y-i)*(u.pos.y-i)<=EPSILON_SQUARED)return u;var m=new Vertex$1,f=new Edge,g=new Edge,v=new Edge,y=new Edge,x=new Edge,_=new Edge,b=new Edge,w=new Edge,M=new Face,S=new Face,T=new Face,A=new Face;if(this._vertices.push(m),this._edges.push(g),this._edges.push(f),this._edges.push(_),this._edges.push(x),this._edges.push(y),this._edges.push(v),this._edges.push(w),this._edges.push(b),this._faces.push(A),this._faces.push(T),this._faces.push(S),this._faces.push(M),m.setDatas(d.isReal?g:y),m.pos.x=t,m.pos.y=i,Geom2D.projectOrthogonaly(m.pos,e),g.setDatas(m,f,a,M,d.isReal),f.setDatas(l,g,w,A,d.isReal),_.setDatas(m,x,o,S,e.isReal,e.isConstrained),x.setDatas(c,_,g,M,e.isReal,e.isConstrained),y.setDatas(m,v,s,T,p.isReal),v.setDatas(h,y,_,S,p.isReal),w.setDatas(m,b,n,A,e.isReal,e.isConstrained),b.setDatas(u,w,y,T,e.isReal,e.isConstrained),M.setDatas(g,d.isReal),S.setDatas(_,p.isReal),T.setDatas(y,p.isReal),A.setDatas(w,d.isReal),c.edge.id==e.id&&c.setDatas(x),u.edge.id==r.id&&u.setDatas(b),a.nextLeftEdge=x,a.leftFace=M,o.nextLeftEdge=v,o.leftFace=S,s.nextLeftEdge=b,s.leftFace=T,n.nextLeftEdge=f,n.leftFace=A,e.isConstrained){for(x.fromConstraintSegments=(t=e.fromConstraintSegments).slice(0),_.fromConstraintSegments=x.fromConstraintSegments,w.fromConstraintSegments=t.slice(0),b.fromConstraintSegments=w.fromConstraintSegments,i=0,l=e.fromConstraintSegments.length;i<l;)c=i++,-1!=(h=(c=e.fromConstraintSegments[c].edges).indexOf(e))?c.splice(h,1,x,w):c.splice(c.indexOf(r),1,b,_);m.fromConstraintSegments=t.slice(0)}return this._edges.splice(this._edges.indexOf(e),1),this._edges.splice(this._edges.indexOf(r),1),e.dispose(),r.dispose(),this._faces.splice(this._faces.indexOf(d),1),this._faces.splice(this._faces.indexOf(p),1),d.dispose(),p.dispose(),this.__centerVertex=m,this.__edgesToCheck.push(a),this.__edgesToCheck.push(o),this.__edgesToCheck.push(s),this.__edgesToCheck.push(n),m},splitFace:function(e,t,i){this.__edgesToCheck.splice(0,this.__edgesToCheck.length);var r=e.edge,n=r.nextLeftEdge,a=n.nextLeftEdge,o=r.originVertex,s=n.originVertex,l=a.originVertex,c=new Vertex$1,h=new Edge,u=new Edge,d=new Edge,p=new Edge,m=new Edge,f=new Edge,g=new Face,v=new Face,y=new Face;return this._vertices.push(c),this._edges.push(h),this._edges.push(u),this._edges.push(d),this._edges.push(p),this._edges.push(m),this._edges.push(f),this._faces.push(g),this._faces.push(v),this._faces.push(y),c.setDatas(u),c.pos.x=t,c.pos.y=i,h.setDatas(o,u,f,y),u.setDatas(c,h,r,g),d.setDatas(s,p,u,g),p.setDatas(c,d,n,v),m.setDatas(l,f,p,v),f.setDatas(c,m,a,y),g.setDatas(u),v.setDatas(p),y.setDatas(f),r.nextLeftEdge=d,r.leftFace=g,n.nextLeftEdge=m,n.leftFace=v,a.nextLeftEdge=h,a.leftFace=y,this._faces.splice(this._faces.indexOf(e),1),e.dispose(),this.__centerVertex=c,this.__edgesToCheck.push(r),this.__edgesToCheck.push(n),this.__edgesToCheck.push(a),c},restoreAsDelaunay:function(){for(var e;0<this.__edgesToCheck.length;)!(e=this.__edgesToCheck.shift()).isReal||e.isConstrained||Geom2D.isDelaunay(e)||(e.nextLeftEdge.destinationVertex.id==this.__centerVertex.id?(this.__edgesToCheck.push(e.nextRightEdge),this.__edgesToCheck.push(e.prevRightEdge)):(this.__edgesToCheck.push(e.nextLeftEdge),this.__edgesToCheck.push(e.prevLeftEdge)),this.flipEdge(e))},deleteVertex:function(e){var t,i=new FromVertexToOutgoingEdges;i.fromVertex=e;var r,n=[],a=[],o=i.realEdgesOnly=!1,s=!1,l=[],c=[];if(t=0==e.fromConstraintSegments.length)for(;null!=(r=i.next());)n.push(r),a.push(r.nextLeftEdge);else{for(l=0,c=e.fromConstraintSegments.length;l<c;)if(o=l++,(r=e.fromConstraintSegments[o].edges)[0].originVertex.id==e.id||r[r.length-1].destinationVertex.id==e.id)return!1;for(l=0;null!=(r=i.next());)if(n.push(r),r.isConstrained&&2<++l)return!1;l=[],c=[];var h=i=null,u=new Edge,d=new Edge;for(this._edges.push(u),this._edges.push(d),o=0,s=n.length;o<s;)(r=n[r=o++]).isConstrained?null==i?(d.setDatas(r.destinationVertex,u,null,null,!0,!0),l.push(u),l.push(r.nextLeftEdge),c.push(d),i=r):null==h&&(u.setDatas(r.destinationVertex,d,null,null,!0,!0),c.push(r.nextLeftEdge),h=r):null!=i&&null==h?l.push(r.nextLeftEdge):c.push(r.nextLeftEdge);o=i.leftFace.isReal,s=h.leftFace.isReal,u.fromConstraintSegments=i.fromConstraintSegments.slice(0),d.fromConstraintSegments=u.fromConstraintSegments;for(var p,m=0,f=e.fromConstraintSegments.length;m<f;)r=m++,-1!=(p=(r=e.fromConstraintSegments[r].edges).indexOf(i))?r.splice(p-1,2,u):r.splice(r.indexOf(h)-1,2,d)}for(i=0,h=n.length;i<h;)u=i++,this._faces.splice(this._faces.indexOf(u=(r=n[u]).leftFace),1),u.dispose(),r.destinationVertex.edge=r.nextLeftEdge,this._edges.splice(this._edges.indexOf(r.oppositeEdge),1),r.oppositeEdge.dispose(),this._edges.splice(this._edges.indexOf(r),1),r.dispose();return this._vertices.splice(this._vertices.indexOf(e),1),e.dispose(),t?this.triangulate(a,!0):(this.triangulate(l,o),this.triangulate(c,s)),!0},untriangulate:function(e){for(var t,i=new Dictionary(1),r=0,n=e.length;r<n;){var a=r++;null==i.get((t=e[a]).originVertex)&&(t.originVertex.edge=t.prevLeftEdge.oppositeEdge,i.set(t.originVertex,!0)),null==i.get(t.destinationVertex)&&(t.destinationVertex.edge=t.nextLeftEdge,i.set(t.destinationVertex,!0)),this._faces.splice(this._faces.indexOf(t.leftFace),1),t.leftFace.dispose(),a==e.length-1&&(this._faces.splice(this._faces.indexOf(t.rightFace),1),t.rightFace.dispose())}for(i.dispose(),i=0,r=e.length;i<r;)t=i++,this._edges.splice(this._edges.indexOf((t=e[t]).oppositeEdge),1),this._edges.splice(this._edges.indexOf(t),1),t.oppositeEdge.dispose(),t.dispose()},triangulate:function(e,t){if(e.length<2)Log("BREAK ! the hole has less than 2 edges");else if(2==e.length)Log("BREAK ! the hole has only 2 edges");else if(3==e.length){(i=new Face).setDatas(e[0],t),this._faces.push(i),e[0].leftFace=i,e[1].leftFace=i,e[2].leftFace=i,e[0].nextLeftEdge=e[1],e[1].nextLeftEdge=e[2],e[2].nextLeftEdge=e[0]}else{var i,r,n,a=(i=e[0]).originVertex,o=i.destinationVertex,s=new Point;n=r=0;for(var l=!1,c=0,h=2,u=e.length;h<u;){var d=h++;if(1==Geom2D.getRelativePosition2((r=e[d].originVertex).pos,i)){c=d,l=!0,Geom2D.getCircumcenter(a.pos,o.pos,r.pos,s),r=Squared(a.pos.x-s.x,a.pos.y-s.y),r-=EPSILON_SQUARED;for(var p=2,m=e.length;p<m;)if((n=p++)!=d&&(n=Squared((n=e[n].originVertex).pos.x-s.x,n.pos.y-s.y))<r){l=!1;break}if(l)break}}l||(Log("NO DELAUNAY FOUND"),c=2),s=o=l=null,c<e.length-1&&(l=new Edge,o=new Edge,this._edges.push(l,o),l.setDatas(a,o,null,null,t,!1),o.setDatas(e[c].originVertex,l,null,null,t,!1),(a=e.slice(c)).push(l),this.triangulate(a,t)),2<c&&(s=new Edge,a=new Edge,this._edges.push(s,a),s.setDatas(e[1].originVertex,a,null,null,t,!1),a.setDatas(e[c].originVertex,s,null,null,t,!1),(l=e.slice(1,c)).push(a),this.triangulate(l,t)),a=[],2==c?a.push(i,e[1],o):a.push(i,s,c==e.length-1?e[c]:o),this.triangulate(a,t)}},findPositionFromBounds:function(e,t){return e<=0?t<=0?1:this.height<=t?7:8:this.width<=e?t<=0?3:this.height<=t?5:4:t<=0?2:this.height<=t?6:0},compute_Data:function(){var e,t,i,r=[],n=[];(t=new FromMeshToVertices).fromMesh=this,i=new FromVertexToIncomingEdges;for(var a=new Dictionary(1);null!=(e=t.next());)if(a.set(e,!0),this.vertexIsInsideAABB(e,this))for(r.push(e.pos.x,e.pos.y),i.fromVertex=e;null!=(e=i.next());)a.get(e.originVertex)||(n=n.concat(e.getDatas()));a.dispose(),this.AR_vertex=new DDLS_ARRAY_TYPE(r),this.AR_edge=new DDLS_ARRAY_TYPE(n),this.data_edges=this.data_vertex=null},vertexIsInsideAABB:function(e,t){return!(e.pos.x<0||t.width<e.pos.x||e.pos.y<0||t.height<e.pos.y)}},Mesh$1.prototype.draw=function(){console.log("meshdraw"),this.compute_Data();for(var e=this.AR_edge,t=e.length,i=0;t--;)e[(i=5*t)+4]?window.WEngine.ddlsRender.insertLine(e[i],e[i+1],e[i+2],e[i+3],0,0,0):window.WEngine.ddlsRender.insertLine(e[i],e[i+1],e[i+2],e[i+3],.4,.4,.4);this.isRedraw=!1};var RectMesh=function(e,t){for(var i=[],r=[],n=[],a=[],o=4;o--;)n.push(new Face),i.push(new Vertex$1),a.push(new Segment),r.push(new Edge,new Edge,new Edge);return o=new Shape$1,i[0].pos.set(-10,-10),i[1].pos.set(e+10,-10),i[2].pos.set(e+10,t+10),i[3].pos.set(-10,t+10),i[0].setDatas(r[0]),i[1].setDatas(r[2]),i[2].setDatas(r[4]),i[3].setDatas(r[6]),r[0].setDatas(i[0],r[1],r[2],n[3],!0,!0),r[1].setDatas(i[1],r[0],r[7],n[0],!0,!0),r[2].setDatas(i[1],r[3],r[11],n[3],!0,!0),r[3].setDatas(i[2],r[2],r[8],n[1],!0,!0),r[4].setDatas(i[2],r[5],r[6],n[2],!0,!0),r[5].setDatas(i[3],r[4],r[3],n[1],!0,!0),r[6].setDatas(i[3],r[7],r[10],n[2],!0,!0),r[7].setDatas(i[0],r[6],r[9],n[0],!0,!0),r[8].setDatas(i[1],r[9],r[5],n[1],!0,!1),r[9].setDatas(i[3],r[8],r[1],n[0],!0,!1),r[10].setDatas(i[0],r[11],r[4],n[2],!1,!1),r[11].setDatas(i[2],r[10],r[0],n[3],!1,!1),n[0].setDatas(r[9],!0),n[1].setDatas(r[8],!0),n[2].setDatas(r[4],!1),n[3].setDatas(r[2],!1),i[0].fromConstraintSegments=[a[0],a[3]],i[1].fromConstraintSegments=[a[0],a[1]],i[2].fromConstraintSegments=[a[1],a[2]],i[3].fromConstraintSegments=[a[2],a[3]],r[0].fromConstraintSegments.push(a[0]),r[1].fromConstraintSegments.push(a[0]),r[2].fromConstraintSegments.push(a[1]),r[3].fromConstraintSegments.push(a[1]),r[4].fromConstraintSegments.push(a[2]),r[5].fromConstraintSegments.push(a[2]),r[6].fromConstraintSegments.push(a[3]),r[7].fromConstraintSegments.push(a[3]),a[0].edges.push(r[0]),a[1].edges.push(r[2]),a[2].edges.push(r[4]),a[3].edges.push(r[6]),a[0].fromShape=o,a[1].fromShape=o,a[2].fromShape=o,(a[3].fromShape=o).segments.push(a[0],a[1],a[2],a[3]),(a=new Mesh$1(e,t))._vertices=i,a._edges=r,a._faces=n,a._constraintShapes.push(o),a.clipping=!1,a.insertConstraintShape([0,0,e,0,e,0,e,t,e,t,0,t,0,t,0,0]),a.clipping=!0,a},AStar=function(){this.iterEdge=new FromFaceToInnerEdges,this.mesh=null,this.diameterSquared=this.diameter=this.radiusSquared=this._radius=0,Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this.radiusSquared=this._radius*this._radius,this.diameter=2*this._radius,this.diameterSquared=this.diameter*this.diameter}})};AStar.prototype={dispose:function(){this.mesh=null,this.closedFaces.dispose(),this.openedFaces.dispose(),this.entryEdges.dispose(),this.predecessor.dispose(),this.entryX.dispose(),this.entryY.dispose(),this.scoreF.dispose(),this.scoreG.dispose(),this.scoreH.dispose(),this.predecessor=this.scoreH=this.scoreG=this.scoreF=this.entryY=this.entryX=this.entryEdges=this.openedFaces=this.closedFaces=this.sortedOpenedFaces=null},findPath:function(e,t,i,r){var n;if(this.sortedOpenedFaces=[],this.closedFaces=new Dictionary(1),this.openedFaces=new Dictionary(1),this.entryEdges=new Dictionary(1),this.predecessor=new Dictionary(1),this.entryX=new Dictionary(1),this.entryY=new Dictionary(1),this.scoreF=new Dictionary(1),this.scoreG=new Dictionary(1),this.scoreH=new Dictionary(1),0!=(n=Geom2D.locatePosition(e,this.mesh)).type){if(1==n.type){if(n.isConstrained)return;this.fromFace=n.leftFace}else this.fromFace=n;n=Geom2D.locatePosition(t,this.mesh),this.toFace=0==n.type?n.edge.leftFace:1==n.type?n.leftFace:n,this.sortedOpenedFaces.push(this.fromFace),this.entryEdges.set(this.fromFace,null),this.entryX.set(this.fromFace,e.x),this.entryY.set(this.fromFace,e.y),this.scoreG.set(this.fromFace,0),e=SquaredSqrt(t.x-e.x,t.y-e.y),this.scoreH.set(this.fromFace,e),this.scoreF.set(this.fromFace,e);for(var a,o,s,l=new Point,c=new Point,h=new Point,u=!1;;){if(0==this.sortedOpenedFaces.length){Log("AStar no path found"),this.curFace=null;break}if(this.curFace=this.sortedOpenedFaces.pop(),this.curFace==this.toFace)break;for(this.iterEdge.fromFace=this.curFace;null!=(e=this.iterEdge.next());)e.isConstrained||(this.closedFaces.get(n=e.rightFace)||this.curFace!=this.fromFace&&0<this._radius&&!this.isWalkableByRadius(this.entryEdges.get(this.curFace),this.curFace,e)||(l.x=this.entryX.get(this.curFace),l.y=this.entryY.get(this.curFace),c.x=l.x,c.y=l.y,c.x=.5*(e.originVertex.pos.x+e.destinationVertex.pos.x),c.y=.5*(e.originVertex.pos.y+e.destinationVertex.pos.y),h.x=c.x-t.x,h.y=c.y-t.y,s=h.get_length(),h.x=l.x-c.x,h.y=l.y-c.y,a=s+(o=this.scoreG.get(this.curFace)+h.get_length()),u=!1,null!=this.openedFaces.get(n)&&this.openedFaces.get(n)?this.scoreF.get(n)>a&&(u=!0):(this.sortedOpenedFaces.push(n),this.openedFaces.set(n,!0),u=!0),u&&(this.entryEdges.set(n,e),this.entryX.set(n,c.x),this.entryY.set(n,c.y),this.scoreF.set(n,a),this.scoreG.set(n,o),this.scoreH.set(n,s),this.predecessor.set(n,this.curFace))));this.openedFaces.set(this.curFace,!1),this.closedFaces.set(this.curFace,!0),this.sortedOpenedFaces.sort(function(e,t){return this.scoreF.get(e)==this.scoreF.get(t)?0:this.scoreF.get(e)<this.scoreF.get(t)?1:-1}.bind(this))}if(null!=this.curFace)for(i.push(this.curFace);this.curFace!=this.fromFace;)r.unshift(this.entryEdges.get(this.curFace)),this.curFace=this.predecessor.get(this.curFace),i.unshift(this.curFace)}},isWalkableByRadius:function(e,t,i){var r,n,a=null,o=null,s=null;if(e.originVertex==i.originVertex?(a=e.destinationVertex,o=i.destinationVertex,s=e.originVertex):e.destinationVertex==i.destinationVertex?(a=e.originVertex,o=i.originVertex,s=e.destinationVertex):e.originVertex==i.destinationVertex?(a=e.destinationVertex,o=i.originVertex,s=e.originVertex):e.destinationVertex==i.originVertex&&(a=e.originVertex,o=i.destinationVertex,s=e.destinationVertex),(r=(s.pos.x-a.pos.x)*(o.pos.x-a.pos.x)+(s.pos.y-a.pos.y)*(o.pos.y-a.pos.y))<=0)return s=Squared(s.pos.x-a.pos.x,s.pos.y-a.pos.y),this.diameterSquared<=s;if((r=(s.pos.x-o.pos.x)*(a.pos.x-o.pos.x)+(s.pos.y-o.pos.y)*(a.pos.y-o.pos.y))<=0)return s=Squared(s.pos.x-o.pos.x,s.pos.y-o.pos.y),this.diameterSquared<=s;if((i=t.edge!=e&&t.edge.oppositeEdge!=e&&t.edge!=i&&t.edge.oppositeEdge!=i?t.edge:t.edge.nextLeftEdge!=e&&t.edge.nextLeftEdge.oppositeEdge!=e&&t.edge.nextLeftEdge!=i&&t.edge.nextLeftEdge.oppositeEdge!=i?t.edge.nextLeftEdge:t.edge.prevLeftEdge).isConstrained)return t=new Point(s.pos.x,s.pos.y),Geom2D.projectOrthogonaly(t,i),s=Squared(t.x-s.pos.x,t.y-s.pos.y),this.diameterSquared<=s;if(a=Squared(s.pos.x-a.pos.x,s.pos.y-a.pos.y),o=Squared(s.pos.x-o.pos.x,s.pos.y-o.pos.y),a<this.diameterSquared||o<this.diameterSquared)return!1;for(o=[],a=[],e=new Dictionary(1),a.push(i),i.leftFace==t?(o.push(i.rightFace),e.set(i.rightFace,!0)):(o.push(i.leftFace),e.set(i.leftFace,!0));0<o.length;){if(t=o.shift(),i=a.shift(),n=t.edge==i||t.edge==i.oppositeEdge?(i=t.edge.nextLeftEdge).nextLeftEdge:t.edge.nextLeftEdge==i||t.edge.nextLeftEdge==i.oppositeEdge?(i=t.edge).nextLeftEdge.nextLeftEdge:(i=t.edge).nextLeftEdge,r=i.leftFace==t?i.rightFace:i.leftFace,t=n.leftFace==t?n.rightFace:n.leftFace,!e.get(r)&&Geom2D.distanceSquaredVertexToEdge(s,i)<this.diameterSquared){if(i.isConstrained)return!1;o.push(r),a.push(i),e.set(r,!0)}if(!e.get(t)&&Geom2D.distanceSquaredVertexToEdge(s,n)<this.diameterSquared){if(n.isConstrained)return!1;o.push(t),a.push(n),e.set(t,!0)}}return e.dispose(),!0}};var Funnel=function(){this._currPoolPointsIndex=0,this._poolPointsSize=3e3,this._numSamplesCircle=16,this._radius=this._radiusSquared=0,this._poolPoints=[];for(var e=this._poolPointsSize,t=0;t<e;)t++,this._poolPoints.push(new Point);Object.defineProperty(this,"radius",{get:function(){return this._radius},set:function(e){if(this._radius=max(0,e),this._radiusSquared=this._radius*this._radius,this._sampleCircle=[],0!=this._radius){e=this._numSamplesCircle;for(var t,i=0;i<e;)t=i++,this._sampleCircle.push(new Point(this._radius*cos(t=-TwoPI*t/this._numSamplesCircle),this._radius*sin(t)));this._sampleCircleDistanceSquared=Squared(this._sampleCircle[0].x-this._sampleCircle[1].x,this._sampleCircle[0].y-this._sampleCircle[1].y)}}})};Funnel.prototype={dispose:function(){this._sampleCircle=null},getPoint:function(e,t){return this.__point=this._poolPoints[this._currPoolPointsIndex],this.__point.set(e||0,t||0),this._currPoolPointsIndex++,this._currPoolPointsIndex==this._poolPointsSize&&(this._poolPoints.push(new Point),this._poolPointsSize++),this.__point},getCopyPoint:function(e){return this.getPoint(e.x,e.y)},findPath:function(e,t,i,r,n){var a,o=1.01*this._radius;if((this._currPoolPointsIndex=0)<this._radius){var s,l,c,h=i[0];l=h.edge.originVertex.pos,c=h.edge.destinationVertex.pos,h=h.edge.nextLeftEdge.destinationVertex.pos,(s=Squared(l.x-e.x,l.y-e.y))<=this._radiusSquared?(s=sqrt(s),e.sub(l).div(s).mul(o).add(l)):(s=Squared(c.x-e.x,c.y-e.y))<=this._radiusSquared?(s=sqrt(s),e.sub(c).div(s).mul(o).add(c)):(s=Squared(h.x-e.x,h.y-e.y))<=this._radiusSquared&&(s=sqrt(s),e.sub(h).div(s).mul(o).add(h)),l=(h=i[i.length-1]).edge.originVertex.pos,c=h.edge.destinationVertex.pos,h=h.edge.nextLeftEdge.destinationVertex.pos,(s=Squared(l.x-t.x,l.y-t.y))<=this._radiusSquared?(s=sqrt(s),t.sub(l).div(s).mul(o).add(l)):(s=Squared(c.x-t.x,c.y-t.y))<=this._radiusSquared?(s=sqrt(s),t.sub(c).div(s).mul(o).add(c)):(s=Squared(h.x-t.x,h.y-t.y))<=this._radiusSquared&&(s=sqrt(s),t.sub(h).div(s).mul(o).add(h))}if(a=e.clone(),o=t.clone(),1==i.length)n.push(fix(a.x)),n.push(fix(a.y)),n.push(fix(o.x)),n.push(fix(o.y));else{var u=null,d=null;if(r[0]==Geom2D.isInFace(e,i[0])&&(r.shift(),i.shift()),0==r.length)return;h=[],(c=[]).push(a),h.push(a);var p=new Dictionary(1);s=[],i=new Dictionary(0),l=new Dictionary(0),i.set(a,0);var m,f,g=Geom2D.getRelativePosition2(e,u=r[0]);m=this.getCopyPoint(u.destinationVertex.pos),f=this.getCopyPoint(u.originVertex.pos),s.push(m),s.push(f),l.set(a,m),l.set(m,f),e=f,1==g?(i.set(m,1),i.set(f,-1),p.set(u.destinationVertex,1),p.set(u.originVertex,-1)):-1==g&&(i.set(m,-1),i.set(f,1),p.set(u.destinationVertex,-1),p.set(u.originVertex,1)),g=r[0].originVertex,m=r[0].destinationVertex,f=1;for(var v=r.length;f<v;)(u=r[u=f++]).originVertex==g?d=u.destinationVertex:u.destinationVertex==g?d=u.originVertex:u.originVertex==m?(d=u.destinationVertex,g=m):u.destinationVertex==m?(d=u.originVertex,g=m):Log("IMPOSSIBLE TO IDENTIFY THE VERTEX !!!"),m=this.getCopyPoint(d.pos),s.push(m),u=-p.get(g),i.set(m,u),l.set(e,m),p.set(d,u),e=m,m=g,g=d;for(l.set(e,o),i.set(o,0),r=[],d=new Dictionary(1),r.push(a),d.set(a,0),p=0,e=s.length;p<e;)if(a=p++,-1==i.get(m=s[a])){for(a=c.length-2;0<=a;){if(-1!=(u=Geom2D.getDirection(c[a],c[a+1],m))){for(c.shift(),u=0;u<a;)u++,r.push(c[0]),d.set(c[0],1),c.shift();r.push(c[0]),d.set(c[0],1),h.splice(0,h.length),h.push(c[0]),h.push(m);break}a--}for(h.push(m),a=h.length-3;0<=a&&-1!=(u=Geom2D.getDirection(h[a],h[a+1],m));)h.splice(a+1,1),a--}else{for(a=h.length-2;0<=a;){if(1!=(u=Geom2D.getDirection(h[a],h[a+1],m))){for(h.shift(),u=0;u<a;)u++,r.push(h[0]),d.set(h[0],-1),h.shift();r.push(h[0]),d.set(h[0],-1),c.splice(0,c.length),c.push(h[0]),c.push(m);break}a--}for(c.push(m),a=c.length-3;0<=a&&1!=(u=Geom2D.getDirection(c[a],c[a+1],m));)c.splice(a+1,1),a--}for(s=!1,a=h.length-2;0<=a;){if(1!=(u=Geom2D.getDirection(h[a],h[a+1],t))){for(h.shift(),s=0,a+=1;s<a;)s++,r.push(h[0]),d.set(h[0],-1),h.shift();r.push(o),d.set(o,0),s=!0;break}a--}if(!s)for(a=c.length-2;0<=a;){if(-1!=(u=Geom2D.getDirection(c[a],c[a+1],t))){for(c.shift(),t=0,h=a+1;t<h;)t++,r.push(c[0]),d.set(c[0],1),c.shift();r.push(o),d.set(o,0),s=!0;break}a--}if(s||(r.push(o),d.set(o,0)),t=[],0<this._radius){if(c=[],2==r.length)this.adjustWithTangents(r[0],!1,r[1],!1,i,l,c,t);else if(2<r.length){if(this.adjustWithTangents(r[0],!1,r[1],!0,i,l,c,t),3<r.length)for(s=r.length-3+(h=1);h<s;)a=h++,this.adjustWithTangents(r[a],!0,r[a+1],!0,i,l,c,t);this.adjustWithTangents(r[(h=r.length)-2],!0,r[h-1],!1,i,l,c,t)}for(c.push(o),this.checkAdjustedPath(c,t,i),l=[],o=c.length-2;1<=o;){for(this.smoothAngle(t[2*o-1],c[o],t[2*o],i.get(c[o]),l);0!=l.length;)t.splice(2*o,0,l.pop());o--}}else t=r;for(l=0,i=t.length;l<i;)o=l++,n.push(fix(t[o].x)),n.push(fix(t[o].y))}},adjustWithTangents:function(e,t,i,r,n,a,o,s){var l=[],c=n.get(e),h=n.get(i),u=null,d=null;if(t||r)if(t)if(r)if(1==c&&1==h)Geom2D.tangentsParalCircleToCircle(this._radius,e,i,l),u=this.getPoint(l[2],l[3]),d=this.getPoint(l[4],l[5]);else if(-1==c&&-1==h)Geom2D.tangentsParalCircleToCircle(this._radius,e,i,l),u=this.getPoint(l[0],l[1]),d=this.getPoint(l[6],l[7]);else if(1==c&&-1==h){if(!Geom2D.tangentsCrossCircleToCircle(this._radius,e,i,l))return void Log("NO TANGENT, points are too close for radius");u=this.getPoint(l[2],l[3]),d=this.getPoint(l[6],l[7])}else{if(!Geom2D.tangentsCrossCircleToCircle(this._radius,e,i,l))return void Log("NO TANGENT, points are too close for radius");u=this.getPoint(l[0],l[1]),d=this.getPoint(l[4],l[5])}else{if(!Geom2D.tangentsPointToCircle(i,e,this._radius,l))return void Log("NO TANGENT");0<l.length&&(u=1==c?this.getPoint(l[0],l[1]):this.getPoint(l[2],l[3]),d=i)}else{if(!Geom2D.tangentsPointToCircle(e,i,this._radius,l))return void Log("NO TANGENT");d=1==h?(u=e,this.getPoint(l[2],l[3])):(u=e,this.getPoint(l[0],l[1]))}else u=e,d=i;for(l=a.get(e);l!=i;){if((c=Geom2D.distanceSquaredPointToSegment(l,u,d))<this._radiusSquared)return this.adjustWithTangents(e,t,l,!0,n,a,o,s),void this.adjustWithTangents(l,!0,i,r,n,a,o,s);l=a.get(l)}s.push(u),s.push(d),o.push(e)},checkAdjustedPath:function(e,t,i){for(var r,n,a,o,s,l,c,h=!0,u=[],d=null,p=null;h;){h=!1;for(var m=2;m<e.length;)s=i.get(o=e[m]),a=i.get(r=e[m-1]),n=i.get(r=e[m-2]),a==s&&(0<(a=((a=t[2*(m-2)]).x-(l=t[2*(m-1)-1]).x)*((c=t[2*(m-1)]).x-l.x)+(a.y-l.y)*(c.y-l.y))&&(2==m?(Geom2D.tangentsPointToCircle(r,o,this._radius,u),p=1==s?(d=r,this.getPoint(u[2],u[3])):(d=r,this.getPoint(u[0],u[1]))):m==e.length-1?(Geom2D.tangentsPointToCircle(o,r,this._radius,u),d=1==n?this.getPoint(u[0],u[1]):this.getPoint(u[2],u[3]),p=o):1==n&&-1==s?(Geom2D.tangentsCrossCircleToCircle(this._radius,r,o,u),d=this.getPoint(u[2],u[3]),p=this.getPoint(u[6],u[7])):-1==n&&1==s?(Geom2D.tangentsCrossCircleToCircle(this._radius,r,o,u),d=this.getPoint(u[0],u[1]),p=this.getPoint(u[4],u[5])):1==n&&1==s?(Geom2D.tangentsParalCircleToCircle(this._radius,r,o,u),d=this.getPoint(u[2],u[3]),p=this.getPoint(u[4],u[5])):-1==n&&-1==s&&(Geom2D.tangentsParalCircleToCircle(this._radius,r,o,u),d=this.getPoint(u[0],u[1]),p=this.getPoint(u[6],u[7])),t.splice(2*(m-2),1,d),t.splice(2*m-1,1,p),e.splice(m-1,1),t.splice(2*(m-1)-1,2),u.splice(0,u.length),m--)),m++}},smoothAngle:function(e,t,i,r,n){var a=Geom2D.getDirection(e,t,i);if(!(Squared(e.x-i.x,e.y-i.y)<=this._sampleCircleDistanceSquared)){for(var o,s,l,c,h=0,u=0,d=this._numSamplesCircle;u<d;)o=u++,l=!1,c=t.clone().add(this._sampleCircle[o]),o=Geom2D.getDirection(e,t,c),s=Geom2D.getDirection(t,i,c),1==r?-1==a?-1==o&&-1==s&&(l=!0):-1!=o&&-1!=s||(l=!0):1==a?1==o&&1==s&&(l=!0):1!=o&&1!=s||(l=!0),l?(n.splice(h,0,c),h++):h=0;-1==r&&n.reverse()}}};var PathFinder=function(){this.astar=new AStar,this.funnel=new Funnel,this.listFaces=[],this.listEdges=[],this.entity=this._mesh=null,Object.defineProperty(this,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh=e,this.astar.mesh=e}})};PathFinder.prototype={dispose:function(){this._mesh=null,this.astar.dispose(),this.astar=null,this.funnel.dispose(),this.listFaces=this.listEdges=this.funnel=null},findPath:function(e,t){if(t.splice(0,t.length),!Geom2D.isCircleIntersectingAnyConstraint(e,this.entity.radius,this._mesh)){this.astar.radius=this.entity.radius,this.funnel.radius=this.entity.radius,this.listFaces.splice(0,this.listFaces.length),this.listEdges.splice(0,this.listEdges.length);var i=this.entity.position;this.astar.findPath(i,e,this.listFaces,this.listEdges),0==this.listFaces.length?Log("PathFinder listFaces.length == 0"):this.funnel.findPath(i,e,this.listFaces,this.listEdges,t)}}};var EntityAI=function(e,t,i){this.path=[],this.position=new Point(e||0,t||0),this.direction=new Point(1,0),this.radius=i||10,this.angle=0,this.angleFOV=60,this.radiusFOV=0};EntityAI.prototype={};var FieldOfView=function(e,t){this.entity=e||null,this.mesh=t||null};FieldOfView.prototype={isInField:function(e){if(this.mesh&&this.entity){var t=this.entity.position,i=this.entity.direction,r=this.entity.angleFOV,n=e.radius;if(((o=this.entity.radiusFOV)+n)*(o+n)<=(e=Squared(t.x-(u=e.position).x,t.y-u.y)))return!1;if(e<n*n)return!0;e=new Point;var a=new Point;if(Geom2D.intersections2Circles(t,o,u,n,m=[])&&(e.set(m[0],m[1]),a.set(m[2],m[3])),o=t.clone().add(u).mul(.5),(0==m.length||Squared(o.x-u.x,o.y-u.y)<Squared(o.x-e.x,o.y-e.y))&&(m.splice(0,m.length),Geom2D.tangentsPointToCircle(t,u,n,m),e.set(m[0],m[1]),a.set(m[2],m[3])),o=cos(.5*this.entity.angleFOV),u=e.clone().sub(t),n=sqrt(u.x*u.x+u.y*u.y),u=o<u.x/n*i.x+u.y/n*i.y,n=a.clone().sub(t),m=sqrt(n.x*n.x+n.y*n.y),o=o<n.x/m*i.x+n.y/m*i.y,!u&&!o&&(n=t.clone().add(i),1!=Geom2D.getDirection(t,n,e)||-1!=Geom2D.getDirection(t,n,a)))return!1;u&&o||(n=new Point,i=atan2(i.y,i.x),u||(u=new Point(cos(i-.5*r),sin(i-.5*r)).add(t),Geom2D.intersections2segments(t,u,e,a,n,null,!0),e=n.clone()),o||(r=new Point(cos(i+.5*r),sin(i+.5*r)).add(t),Geom2D.intersections2segments(t,r,e,a,n,null,!0),a=n.clone()));r=new Dictionary,i=new Dictionary;var o,s,l,c,h,u=[];2==(o=Geom2D.locatePosition(t,this.mesh)).type?s=o:1==o.type?s=o.leftFace:0==o.type&&(s=o.edge.leftFace),o=[],n=new Dictionary,o.push(s),n[s]=!0,s=new Point;for(var d,p,m=new Point,f=[],g=[];0<o.length;)for(l=o.shift(),n.set(l,null),r.set(l,!0),i.get(l=l.edge)||i.get(l.oppositeEdge)||(g.push(l),i.set(l,!0)),i.get(l=l.nextLeftEdge)||i.get(l.oppositeEdge)||(g.push(l),i.set(l,!0)),i.get(l=l.nextLeftEdge)||i.get(l.oppositeEdge)||(g.push(l),i.set(l,!0));0<g.length;)if(l=g.pop(),Geom2D.clipSegmentByTriangle((c=l.originVertex.pos).x,c.y,(h=l.destinationVertex.pos).x,h.y,t.x,t.y,a.x,a.y,e.x,e.y,s,m)){if(l.isConstrained){for(f.splice(0,f.length),Geom2D.intersections2segments(t,s,e,a,null,f,!0),Geom2D.intersections2segments(t,m,e,a,null,f,!0),(d=f[3])<(c=f[1])&&(c=d,d=f[1]),p=u.length-1;0<=p&&!(u[p]<=d);p--);for(0==(h=p+1)%2&&u.splice(h,0,d),p=0;p<u.length&&!(c<=u[p]);p++);if(0==(d=p)%2?(u.splice(d,0,c),h++):d--,u.splice(d+1,h-d-1),2==u.length&&-EPSILON<u[0]&&u[0]<EPSILON&&1-EPSILON<u[1]&&u[1]<1+EPSILON)return!1}n.get(l=l.rightFace)||r.get(l)||(o.push(l),n.set(l,!0))}return!0}}};var LinearPathSampler=function(){this._path=this.entity=null,this._samplingDistance=this._samplingDistanceSquared=1,this._preCompX=[],this._preCompY=[],this.pos=new Point,this.hasNext=this.hasPrev=!1,this._count=0,Object.defineProperty(this,"x",{get:function(){return this.pos.x}}),Object.defineProperty(this,"y",{get:function(){return this.pos.y}}),Object.defineProperty(this,"countMax",{get:function(){return this._preCompX.length-1}}),Object.defineProperty(this,"count",{get:function(){return this._count},set:function(e){this._count=e,this._count<0&&(this._count=0),this.countMax-1<this._count&&(this._count=this.countMax-1),this.hasPrev=0!=this._count,this.hasNext=this._count!=this.countMax-1,this.applyLast(),this.updateEntity()}}),Object.defineProperty(this,"samplingDistance",{get:function(){return this._samplingDistance},set:function(e){this._samplingDistance=e,this._samplingDistanceSquared=this._samplingDistance*this._samplingDistance}}),Object.defineProperty(this,"path",{get:function(){return this._path},set:function(e){this._path=e,this._preComputed=!1,this.reset()}})};LinearPathSampler.prototype={dispose:function(){this._preCompY=this._preCompX=this._path=this.entity=null},reset:function(){0<this._path.length?(this.pos.x=this._path[0],this.pos.y=this._path[1],this._iPrev=0,this._iNext=2,this.hasPrev=!1,this.hasNext=!0,this._count=0,this.updateEntity()):(this.hasNext=this.hasPrev=!1,this._count=0)},preCompute:function(){for(this._preCompX.splice(0,this._preCompX.length),this._preCompY.splice(0,this._preCompY.length),this._count=0,this._preCompX.push(this.pos.x),this._preCompY.push(this.pos.y),this._preComputed=!1;this.next();)this._preCompX.push(this.pos.x),this._preCompY.push(this.pos.y);this.reset(),this._preComputed=!0},prev:function(){if(!this.hasPrev)return!1;if(this.hasNext=!0,this._preComputed)return this._count--,0==this._count&&(this.hasPrev=!1),this.applyLast(),this.updateEntity(),!0;var e,t;for(e=this._samplingDistance;(t=SquaredSqrt(this.pos.x-this._path[this._iPrev],this.pos.y-this._path[this._iPrev+1]))<e&&(e-=t,this._iPrev-=2,this._iNext-=2,0!=this._iNext););return 0==this._iNext?(this.pos.x=this._path[0],this.pos.y=this._path[1],this.hasPrev=!1,this._iNext=2,this._iPrev=0):(this.pos.x+=(this._path[this._iPrev]-this.pos.x)*e/t,this.pos.y+=(this._path[this._iPrev+1]-this.pos.y)*e/t),this.updateEntity(),!0},next:function(){if(!this.hasNext)return!1;if(this.hasPrev=!0,this._preComputed)return this._count++,this._count==this._preCompX.length-1&&(this.hasNext=!1),this.applyLast(),this.updateEntity(),!0;var e,t;for(e=this._samplingDistance;(t=SquaredSqrt(this.pos.x-this._path[this._iNext],this.pos.y-this._path[this._iNext+1]))<e&&(e-=t,this.pos.x=this._path[this._iNext],this.pos.y=this._path[this._iNext+1],this._iPrev+=2,this._iNext+=2,this._iNext!=this._path.length););return this._iNext==this._path.length?(this.pos.x=this._path[this._iPrev],this.pos.y=this._path[this._iPrev+1],this.hasNext=!1,this._iNext=this._path.length-2,this._iPrev=this._iNext-2):(this.pos.x+=(this._path[this._iNext]-this.pos.x)*e/t,this.pos.y+=(this._path[this._iNext+1]-this.pos.y)*e/t),this.updateEntity(),!0},applyLast:function(){this.pos.set(this._preCompX[this._count],this._preCompY[this._count])},updateEntity:function(){null!=this.entity&&this.entity.position.copy(this.pos)}};var Heroe=function(e,t){e=e||{},this.world=t,this.path=[],this.tmppath=[],this.target=new Point,this.newPath=this.move=!1,this.mesh=null,this.isSelected=!1,this.entity=new EntityAI(e.x||0,e.y||0,e.r||4),this.fov=new FieldOfView(this.entity,this.world.mesh),this.pathSampler=new LinearPathSampler,this.pathSampler.entity=this.entity,this.pathSampler.path=this.path,this.pathSampler.samplingDistance=e.speed||10};Heroe.prototype={setTarget:function(e,t){this.entity.position.set(this.mesh.position.x,this.mesh.position.z),this.target.set(e,t),this.world.pathFinder.entity=this.entity,this.world.pathFinder.findPath(this.target,this.path),this.testPath()},testPath:function(){if(0<this.path.length){this.tmppath=[];for(var e=this.path.length;e--;)this.tmppath[e]=this.path[e];this.newPath=!0}},update:function(){if(null!=this.mesh&&this.move){new Vector3(0,1,0);var e=new Vector3,t=new Vector3(this.entity.position.x,this.mesh.position.y,this.entity.position.y),i=new Vector3(this.mesh.position.x,this.mesh.position.y,this.mesh.position.z);e.subVectors(t,i).normalize();var r=Math.atan2(e.x,e.z);window.WEngine.options({name:this.mesh.name,type:"character",angle:r,pos:[this.entity.position.x,this.mesh.position.y,this.entity.position.y]},!0),this.mesh.userData.findPath=!0,this.mesh.userData.avatar.playAction(this.mesh.userData.actionName||"run")}this.newPath&&this.pathSampler.reset(),this.pathSampler.hasNext?(this.newPath=!1,this.move=!0,this.pathSampler.next()):(this.move=!1,this.mesh.userData.findPath=!1,this.mesh.userData.findPathCallBack())}};var World=function(e,t){this.w=e||512,this.h=t||512,this.mesh=RectMesh(this.w,this.h),this.pathFinder=new PathFinder,this.pathFinder.mesh=this.mesh,this.heroes=[],this.shapes=[],this.segments=[],this.objects=[]};function DDLSRender(e,t){var i;this.maxVertices=3e4,this.currentVertex=0,this.world=e,this.scene=t,this.renderObjs=[],this.debug=!1,(i=new BufferGeometry).setAttribute("position",new BufferAttribute(new Float32Array(3*this.maxVertices),3)),i.setAttribute("color",new BufferAttribute(new Float32Array(3*this.maxVertices),3)),this.positions=i.attributes.position.array,this.colors=i.attributes.color.array,i.computeBoundingSphere(),this.buffer=new LineSegments(i,new LineBasicMaterial({vertexColors:!0})),this.buffer.frustumCulled=!1,this.buffer.visible=this.debug,this.scene.add(this.buffer),this.renderObjs.push(this.buffer),this.maxPathVertices=1e3,this.currentPathVertex=0,(i=new BufferGeometry).setAttribute("position",new BufferAttribute(new Float32Array(3*this.maxPathVertices),3)),i.setAttribute("color",new BufferAttribute(new Float32Array(3*this.maxPathVertices),3)),this.positionsPath=i.attributes.position.array,this.colorsPath=i.attributes.color.array,i.computeBoundingSphere(),this.bufferPath=new LineSegments(i,new LineBasicMaterial({vertexColors:!0})),this.bufferPath.frustumCulled=!1,this.bufferPath.visible=this.debug,this.scene.add(this.bufferPath),this.renderObjs.push(this.bufferPath)}World.prototype={update:function(){for(var e=this.heroes.length;e--;)this.heroes[e].update()},add:function(e){this.mesh.insertObject(e),this.objects.push(e)},addObject:function(e){e=e||{};var t=new DDLSObject;return t.coordinates=e.coord||[-1,-1,1,-1,1,-1,1,1,1,1,-1,1,-1,1,-1,-1],t.position(e.x||1,e.y||1),t.scale(e.w||1,e.h||1),t.pivot(e.px||0,e.py||0),t.rotation=e.r||0,this.mesh.insertObject(t),this.objects.push(t),t},reset:function(e,t){this.mesh.dispose(),e&&(this.w=e),t&&(this.h=t),this.mesh=RectMesh(this.w,this.h),this.pathFinder.mesh=this.mesh},rebuild:function(){this.mesh.clear(!0),this.mesh=RectMesh(this.w,this.h),this.pathFinder.mesh=this.mesh;for(var e=this.objects.length;e--;)this.objects[e]._constraintShape=null,this.mesh.insertObject(this.objects[e])},addHeroe:function(e){return e=new Heroe(e,this),this.heroes.push(e),e}},DDLSRender.prototype={constructor:DDLSRender,collapseBuffer:function(){for(var e=this.maxVertices,t=this.currentVertex,i=0;t<=e;)this.positions[i=3*e]=0,this.positions[i+1]=0,this.positions[i+2]=0,this.colors[i]=0,this.colors[i+1]=0,this.colors[i+2]=0,e--},collapsePathBuffer:function(){for(var e=this.maxPathVertices,t=this.currentPathVertex,i=0;t<=e;)this.positionsPath[i=3*e]=0,this.positionsPath[i+1]=0,this.positionsPath[i+2]=0,this.colorsPath[i]=0,this.colorsPath[i+1]=0,this.colorsPath[i+2]=0,e--},show:function(e){this.debug=e;for(var t=this.renderObjs.length;t--;)this.renderObjs[t].visible=e},update:function(){this.world.mesh.isRedraw&&(this.currentVertex=0,this.world.mesh.draw(),this.collapseBuffer(),this.buffer.geometry.attributes.position.needsUpdate=!0,this.buffer.geometry.attributes.color.needsUpdate=!0);for(var e=this.world.heroes.length;e--;)if(this.world.heroes[e].update(),this.world.heroes[e].isSelected&&0<this.world.heroes[e].tmppath.length){this.currentPathVertex=0;for(var t=this.world.heroes[e].tmppath,i=t[0],r=t[1],n=2;n<t.length;)this.insertPath(i,r,t[n],t[n+1],1,0,0),i=t[n],r=t[n+1],n+=2;this.collapsePathBuffer(),this.bufferPath.geometry.attributes.position.needsUpdate=!0,this.bufferPath.geometry.attributes.color.needsUpdate=!0}},insertLine:function(e,t,i,r,n,a,o){var s=this.currentVertex,l=3*s;this.positions[l]=e,this.positions[l+1]=0,this.positions[l+2]=t,this.colors[l]=n,this.colors[l+1]=a,this.colors[l+2]=o,this.positions[l=3*++s]=i,this.positions[l+1]=0,this.positions[l+2]=r,this.colors[l]=n,this.colors[l+1]=a,this.colors[l+2]=o,this.currentVertex+=2},insertPath:function(e,t,i,r,n,a,o){var s=this.currentPathVertex,l=3*s;this.positionsPath[l]=e,this.positionsPath[l+1]=0,this.positionsPath[l+2]=t,this.colorsPath[l]=n,this.colorsPath[l+1]=a,this.colorsPath[l+2]=o,this.positionsPath[l=3*++s]=i,this.positionsPath[l+1]=0,this.positionsPath[l+2]=r,this.colorsPath[l]=n,this.colorsPath[l+1]=a,this.colorsPath[l+2]=o,this.currentPathVertex+=2}},void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t});var T={frag:document.createDocumentFragment(),colorRing:null,joystick_0:null,joystick_1:null,circular:null,knob:null,svgns:"http://www.w3.org/2000/svg",htmls:"http://www.w3.org/1999/xhtml",DOM_SIZE:["height","width","top","left","bottom","right","margin-left","margin-right","margin-top","margin-bottom"],SVG_TYPE_D:["pattern","defs","transform","stop","animate","radialGradient","linearGradient","animateMotion"],SVG_TYPE_G:["svg","rect","circle","path","polygon","text","g","line","foreignObject"],TwoPI:6.283185307179586,size:{w:240,h:20,p:30,s:20},colors:{text:"#C0C0C0",textOver:"#FFFFFF",background:"rgba(44,44,44,0.3)",backgroundOver:"rgba(11,11,11,0.5)",input:"#005AAA",border:"#454545",borderOver:"#5050AA",borderSelect:"#308AFF",scrollback:"rgba(44,44,44,0.2)",scrollbackover:"rgba(44,44,44,0.5)",button:"#404040",boolbg:"#181818",select:"#308AFF",moving:"#03afff",down:"#024699",stroke:"rgba(11,11,11,0.5)",scroll:"#333333",hide:"rgba(0,0,0,0)"},css:{basic:"position:absolute; pointer-events:none; box-sizing:border-box; margin:0; padding:0; overflow:hidden; -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select:none;"},svgs:{group:"M 7 7 L 7 8 8 8 8 7 7 7 M 5 7 L 5 8 6 8 6 7 5 7 M 3 7 L 3 8 4 8 4 7 3 7 M 7 5 L 7 6 8 6 8 5 7 5 M 6 6 L 6 5 5 5 5 6 6 6 M 7 3 L 7 4 8 4 8 3 7 3 M 6 4 L 6 3 5 3 5 4 6 4 M 3 5 L 3 6 4 6 4 5 3 5 M 3 3 L 3 4 4 4 4 3 3 3 Z",arrow:"M 3 8 L 8 5 3 2 3 8 Z",arrowDown:"M 5 8 L 8 3 2 3 5 8 Z",arrowUp:"M 5 2 L 2 7 8 7 5 2 Z"},setText:function(e,t,i,r){e=e||13,i=i||"Consolas,monaco,monospace;",T.colors.text=t=t||"#CCC",T.css.txt=T.css.basic+"font-family:"+i+"; font-size:"+e+"px; color:"+t+"; padding:2px 10px; left:0; top:2px; height:16px; width:100px; overflow:hidden; white-space: nowrap;",r&&(T.css.txt+=" text-shadow:"+r+"; "),T.css.txtselect=T.css.txt+"padding:2px 5px; border:1px dashed "+T.colors.border+";",T.css.item=T.css.txt+"position:relative; background:rgba(0,0,0,0.2); margin-bottom:1px;"},clone:function(e){return e.cloneNode(!0)},setSvg:function(e,t,i,r){-1===r?e.setAttributeNS(null,t,i):e.childNodes[r||0].setAttributeNS(null,t,i)},setCss:function(e,t){for(var i in t)-1!==T.DOM_SIZE.indexOf(i)?e.style[i]=t[i]+"px":e.style[i]=t[i]},set:function(e,t){for(var i in t)"txt"===i&&(e.textContent=t[i]),e.setAttributeNS(null,i,t[i])},get:function(e,t){if(void 0===t)return e;if(!isNaN(t))return e.childNodes[t];if(t instanceof Array){if(2===t.length)return e.childNodes[t[0]].childNodes[t[1]];if(3===t.length)return e.childNodes[t[0]].childNodes[t[1]].childNodes[t[2]]}},dom:function(e,t,i,r,n){return-1!==T.SVG_TYPE_D.indexOf(e=e||"div")||-1!==T.SVG_TYPE_G.indexOf(e)?"svg"===e?(r=document.createElementNS(T.svgns,"svg"),T.set(r,i)):(void 0===r&&(r=document.createElementNS(T.svgns,"svg")),T.addAttributes(r,e,i,n)):r=void 0===r?document.createElementNS(T.htmls,e):r.appendChild(document.createElementNS(T.htmls,e)),t&&(r.style.cssText=t),void 0===n?r:r.childNodes[n||0]},addAttributes:function(e,t,i,r){var n=document.createElementNS(T.svgns,t);return T.set(n,i),T.get(e,r).appendChild(n),-1!==T.SVG_TYPE_G.indexOf(t)&&(n.style.pointerEvents="none"),n},clear:function(e){for(T.purge(e);e.firstChild;)e.firstChild.firstChild&&T.clear(e.firstChild),e.removeChild(e.firstChild)},purge:function(e){var t,i,r=e.attributes;if(r)for(t=r.length;t--;)"function"==typeof e[i=r[t].name]&&(e[i]=null);if(r=e.childNodes)for(t=r.length;t--;)T.purge(e.childNodes[t])},clamp:function(e,t,i){return e<t?t:i<e?i:e},ColorLuma:function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var i,r,n="#";for(r=0;r<3;r++)i=parseInt(e.substr(2*r,2),16),n+=("00"+(i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16))).substr(i.length);return n},findDeepInver:function(e){return.3*e[0]+.59*e[1]+.11*e[2]<=.6},hexToHtml:function(e){return"#"+("000000"+(e=void 0===e?0:e).toString(16)).substr(-6)},htmlToHex:function(e){return e.toUpperCase().replace("#","0x")},u255:function(e,t){return parseInt(e.substring(t,t+2),16)/255},u16:function(e,t){return parseInt(e.substring(t,t+1),16)/15},unpack:function(e){return 7==e.length?[T.u255(e,1),T.u255(e,3),T.u255(e,5)]:4==e.length?[T.u16(e,1),T.u16(e,2),T.u16(e,3)]:void 0},htmlRgb:function(e){return"rgb("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+")"},rgbToHex:function(e){return"#"+("000000"+(255*e[0]<<16^255*e[1]<<8^255*e[2]<<0).toString(16)).slice(-6)},hueToRgb:function(e,t,i){return i<0&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e},rgbToHsl:function(e){var t=e[0],i=e[1],r=e[2],n=Math.min(t,i,r),a=Math.max(t,i,r),o=a-n,s=0,l=0,c=(n+a)/2;return 0<c&&c<1&&(l=o/(c<.5?2*c:2-2*c)),0<o&&(a==t&&a!=i&&(s+=(i-r)/o),a==i&&a!=r&&(s+=2+(r-t)/o),a==r&&a!=t&&(s+=4+(t-i)/o),s/=6),[s,l,c]},hslToRgb:function(e){var t,i,r=e[0],n=e[1],a=e[2];return 0===n?[a,a,a]:[T.hueToRgb(t=2*a-(i=a<=.5?a*(n+1):a+n-a*n),i,r+.33333),T.hueToRgb(t,i,r),T.hueToRgb(t,i,r-.33333)]},makeGradiant:function(e,t,i,r){T.dom(e,null,t,i,0);for(var n,a=i.childNodes[0].childNodes.length-1,o=0;o<r.length;o++)T.dom("stop",null,{offset:(n=r[o])[0]+"%",style:"stop-color:"+n[1]+"; stop-opacity:"+n[2]+";"},i,[0,a])},makeKnob:function(){var e=T.dom("svg",T.css.basic,{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});T.dom("circle","",{cx:64,cy:64,r:34,fill:T.colors.button,stroke:"rgba(0,0,0,0.3)","stroke-width":8},e),T.dom("path","",{d:"",stroke:T.colors.text,"stroke-width":4,fill:"none","stroke-linecap":"round"},e),T.dom("circle","",{cx:64,cy:64,r:41,stroke:"rgba(0,0,0,0.1)","stroke-width":7,fill:"none"},e),T.dom("path","",{d:"",stroke:"rgba(255,255,255,0.3)","stroke-width":2,fill:"none","stroke-linecap":"round","stroke-opacity":.5},e),T.knob=e},makeCircular:function(){var e=T.dom("svg",T.css.basic,{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});T.dom("circle","",{cx:64,cy:64,r:40,stroke:"rgba(0,0,0,0.1)","stroke-width":10,fill:"none"},e),T.dom("path","",{d:"",stroke:T.colors.text,"stroke-width":7,fill:"none","stroke-linecap":"butt"},e),T.circular=e},makeJoystick:function(e){var t=Math.floor(49),i=Math.floor(.6*t),r=T.dom("svg",T.css.basic,{viewBox:"0 0 128 128",width:128,height:128,preserveAspectRatio:"none"});if(T.dom("defs",null,{},r),T.dom("g",null,{},r),0===e){var n=[[40,"rgb(0,0,0)",.3],[80,"rgb(0,0,0)",0],[90,"rgb(50,50,50)",.4],[100,"rgb(50,50,50)",0]];T.makeGradiant("radialGradient",{id:"grad",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},r,n),T.makeGradiant("radialGradient",{id:"gradS",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},r,n=[[60,"rgb(0,0,0)",.5],[100,"rgb(0,0,0)",0]]);var a=["rgb(40,40,40)","rgb(48,48,48)","rgb(30,30,30)"],o=["rgb(1,90,197)","rgb(3,95,207)","rgb(0,65,167)"];T.makeGradiant("radialGradient",{id:"gradIn",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},r,n=[[30,a[0],1],[60,a[1],1],[80,a[1],1],[100,a[2],1]]),T.makeGradiant("radialGradient",{id:"gradIn2",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},r,n=[[30,o[0],1],[60,o[1],1],[80,o[1],1],[100,o[2],1]]),T.dom("circle","",{cx:64,cy:64,r:t,fill:"url(#grad)"},r),T.dom("circle","",{cx:69,cy:74,r:i+10,fill:"url(#gradS)"},r),T.dom("circle","",{cx:64,cy:64,r:i,fill:"url(#gradIn)"},r),T.joystick_0=r}else T.makeGradiant("radialGradient",{id:"gradX",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},r,n=[[69,"rgb(0,0,0)",0],[70,"rgb(0,0,0)",.3],[100,"rgb(0,0,0)",0]]),T.dom("circle","",{cx:64,cy:64,r:t,fill:"none",stroke:"rgba(100,100,100,0.25)","stroke-width":"4"},r),T.dom("circle","",{cx:64,cy:64,r:i+14,fill:"url(#gradX)"},r),T.dom("circle","",{cx:64,cy:64,r:i,fill:"none",stroke:"rgb(100,100,100)","stroke-width":"4"},r),T.joystick_1=r},makeColorRing:function(){var e=T.dom("svg",T.css.basic,{viewBox:"0 0 256 256",width:256,height:256,preserveAspectRatio:"none"});T.dom("defs",null,{},e),T.dom("g",null,{},e);var t,i,r,n,a,o,s,l,c=8/108/24*Math.PI,h=0,u=[];for(o=0;o<=24;++o){if(t=.5*(h+(n=(r=o/24)*T.TwoPI)),i=1/Math.cos(.5*(n-h)),a=[Math.sin(h),-Math.cos(h),Math.sin(t)*i,-Math.cos(t)*i,Math.sin(n),-Math.cos(n)],u[1]=T.rgbToHex(T.hslToRgb([r,1,.5])),0<o){for(s=6;s--;)a[s]=(108*a[s]+128).toFixed(2);l=" M"+a[0]+" "+a[1]+" Q"+a[2]+" "+a[3]+" "+a[4]+" "+a[5],T.makeGradiant("linearGradient",{id:"G"+o,x1:a[0],y1:a[1],x2:a[4],y2:a[5],gradientUnits:"userSpaceOnUse"},e,[[0,u[0],1],[100,u[1],1]]),T.dom("path","",{d:l,"stroke-width":40,stroke:"url(#G"+o+")","stroke-linecap":"butt"},e,1)}h=n-c,u[0]=u[1]}T.makeGradiant("linearGradient",{id:"GL1",x1:68,y1:68,x2:68,y2:188,gradientUnits:"userSpaceOnUse"},e,[[0,"#FFFFFF",1],[50,"#FFFFFF",0],[50,"#000000",0],[100,"#000000",1]]),T.makeGradiant("linearGradient",{id:"GL2",x1:68,y1:68,x2:188,y2:68,gradientUnits:"userSpaceOnUse"},e,[[0,"#7f7f7f",0],[50,"#7f7f7f",.5],[100,"#7f7f7f",1]]),T.dom("circle","",{cx:128,cy:128,r:90,fill:"red"},e),T.dom("circle","",{cx:128,cy:128,r:90,fill:"url(#GL2)"},e),T.dom("circle","",{cx:128,cy:128,r:90,fill:"url(#GL1)"},e),T.dom("circle","",{cx:0,cy:0,r:6,"stroke-width":3,stroke:"#FFF",fill:"none"},e),T.dom("circle","",{cx:0,cy:0,r:6,"stroke-width":3,stroke:"#000",fill:"none"},e),T.colorRing=e},icon:function(e,t,i){t=t||"#DEDEDE";var r=["<svg xmlns='"+T.svgns+"' version='1.1' xmlns:xlink='"+T.htmls+"' style='pointer-events:none;' preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='"+(i=i||40)+"px' height='"+i+"px' viewBox='0 0 256 256'><g>"];switch(e){case"logo":r[1]="<path id='logoin' stroke='"+t+"' stroke-width='16' stroke-linejoin='round' stroke-linecap='square' fill='none' d='M 192 44 L 192 148 Q 192 174.5 173.3 193.25 154.55 212 128 212 101.5 212 82.75 193.25 64 174.5 64 148 L 64 44 M 160 44 L 160 148 Q 160 161.25 150.65 170.65 141.25 180 128 180 114.75 180 105.35 170.65 96 161.25 96 148 L 96 44'/>";break;case"save":r[1]="<path stroke='"+t+"' stroke-width='4' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 26.125 17 L 20 22.95 14.05 17 M 20 9.95 L 20 22.95'/><path stroke='"+t+"' stroke-width='2.5' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 32.6 23 L 32.6 25.5 Q 32.6 28.5 29.6 28.5 L 10.6 28.5 Q 7.6 28.5 7.6 25.5 L 7.6 23'/>"}return r[2]="</g></svg>",r.join("\n")}};T.setText();var Tools=T,R={ui:[],ID:null,lock:!1,wlock:!1,current:-1,needReZone:!0,isEventsInit:!1,prevDefault:["contextmenu","mousedown","mousemove","mouseup"],xmlserializer:new XMLSerializer,tmpTime:null,tmpImage:null,oldCursor:"auto",input:null,parent:null,firstImput:!0,callbackImput:null,isLoop:!1,listens:[],e:{type:null,clientX:0,clientY:0,keyCode:NaN,key:null,delta:0},isMobile:!1,add:function(e){R.ui.push(e),R.getZone(e),R.isEventsInit||R.initEvents()},testMobile:function(){var e=navigator.userAgent;return!!(e.match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone/i)||e.match(/iPad/i)||e.match(/iPod/i)||e.match(/BlackBerry/i)||e.match(/Windows Phone/i))},remove:function(e){var t=R.ui.indexOf(e);-1!==t&&(R.removeListen(e),R.ui.splice(t,1)),0===R.ui.length&&R.removeEvents()},initEvents:function(){if(!R.isEventsInit){var e=document.body;R.isMobile=R.testMobile(),R.isMobile?(e.addEventListener("touchstart",R,!1),e.addEventListener("touchend",R,!1),e.addEventListener("touchmove",R,!1)):(e.addEventListener("mousedown",R,!1),e.addEventListener("contextmenu",R,!1),e.addEventListener("wheel",R,!1),document.addEventListener("mousemove",R,!1),document.addEventListener("mouseup",R,!1)),window.addEventListener("keydown",R,!1),window.addEventListener("resize",R.resize,!1),R.isEventsInit=!0}},removeEvents:function(){if(R.isEventsInit){var e=document.body;R.isMobile?(e.removeEventListener("touchstart",R,!1),e.removeEventListener("touchend",R,!1),e.removeEventListener("touchmove",R,!1)):(e.removeEventListener("mousedown",R,!1),e.removeEventListener("contextmenu",R,!1),e.removeEventListener("wheel",R,!1),document.removeEventListener("mousemove",R,!1),document.removeEventListener("mouseup",R,!1)),window.removeEventListener("keydown",R),window.removeEventListener("resize",R.resize),R.isEventsInit=!1}},resize:function(){R.needReZone=!0;for(var e,t=R.ui.length;t--;)(e=R.ui[t]).isGui&&!e.isCanvasOnly&&e.autoResize&&e.setHeight()},handleEvent:function(e){if(-1!==e.type.indexOf(R.prevDefault)&&e.preventDefault(),"contextmenu"!==e.type){R.findZone();var t=R.e;"keydown"===e.type&&R.editText(e),t.delta="wheel"===e.type?0<e.deltaY?1:-1:0,t.clientX=e.clientX||0,t.clientY=e.clientY||0,t.type=e.type,R.isMobile&&(e.touches&&0<e.touches.length&&(t.clientX=e.touches[0].clientX||0,t.clientY=e.touches[0].clientY||0),"touchstart"===e.type&&(t.type="mousedown"),"touchend"===e.type&&(t.type="mouseup"),"touchmove"===e.type&&(t.type="mousemove")),"mousedown"===t.type&&(R.lock=!0),"mouseup"===t.type&&(R.lock=!1),R.isMobile&&"mousedown"===t.type&&R.findID(t),"mousemove"!==t.type||R.lock||R.findID(t),null!==R.ID&&(R.ID.isCanvasOnly&&(t.clientX=R.ID.mouse.x,t.clientY=R.ID.mouse.y),R.ID.handleEvent(t)),R.isMobile&&"mouseup"===t.type&&R.clearOldID()}},findID:function(e){for(var t,i,r,n=R.ui.length,a=-1;n--;)if(r=(t=R.ui[n]).isCanvasOnly?(i=t.mouse.x,t.mouse.y):(i=e.clientX,e.clientY),R.onZone(t,i,r)){(a=n)!==R.current&&(R.clearOldID(),R.current=a,R.ID=t);break}-1===a&&R.clearOldID()},clearOldID:function(){R.ID&&(R.current=-1,R.ID.reset(),R.ID=null,R.cursor())},calcUis:function(e,t,i){var r,n,a=e.length,o=0,s=0;for(n=0;n<a;n++)(r=e[n]).zone.w=r.w,r.zone.h=r.h,r.autoWidth?(r.zone.x=t.x,r.zone.y=i,i+=r.h+1):(0===o&&(i+=r.h+1),r.zone.x=t.x+o,r.zone.y=0===o?i-r.h:s,s=r.zone.y,t.w<(o+=r.w)+r.w&&(o=0)),r.isGroup&&r.calcUis()},findTarget:function(e,t){for(var i=e.length;i--;)if(R.onZone(e[i],t.clientX,t.clientY))return i;return-1},findZone:function(e){if(R.needReZone||e){for(var t,i=R.ui.length;i--;)R.getZone(t=R.ui[i]),t.isGui&&t.calcUis();R.needReZone=!1}},onZone:function(e,t,i){if(void 0===t||void 0===i)return!1;var r=e.zone,n=t-r.x,a=i-r.y,o=0<=n&&0<=a&&n<=r.w&&a<=r.h;return o?e.local.set(n,a):e.local.neg(),o},getZone:function(e){if(!e.isCanvasOnly){var t=e.getDom().getBoundingClientRect();e.zone={x:t.left,y:t.top,w:t.width,h:t.height}}},cursor:function(e){(e=e||"auto")!==R.oldCursor&&(document.body.style.cursor=e,R.oldCursor=e)},toCanvas:function(t,i,r,e){if(e&&null!==R.tmpTime&&(clearTimeout(R.tmpTime),R.tmpTime=null),null===R.tmpTime){R.lock&&(R.tmpTime=setTimeout(function(){R.tmpTime=null},10));var n=!1;i===t.canvas.width&&r===t.canvas.height||(n=!0),null===R.tmpImage&&(R.tmpImage=new Image);var a=R.tmpImage,o=R.xmlserializer.serializeToString(t.content),s='<svg xmlns="http://www.w3.org/2000/svg" width="'+i+'" height="'+r+'"><foreignObject style="pointer-events: none; left:0;" width="100%" height="100%">'+o+"</foreignObject></svg>";a.onload=function(){var e=t.canvas.getContext("2d");n?(t.canvas.width=i,t.canvas.height=r):e.clearRect(0,0,i,r),e.drawImage(this,0,0),t.onDraw()},a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(s),a.crossOrigin=""}},clearInput:function(){null!==R.input&&(R.firstImput||R.callbackImput(),R.input.style.borderColor=R.parent.defaultBorderColor,R.parent.isEdit=!1,R.callbackImput=null,R.input=null,R.parent=null,R.firstImput=!0)},setInput:function(e,t,i,r){R.clearInput(),R.callbackImput=t,R.input=e,R.parent=r,R.input.style.borderColor=i},select:function(){document.execCommand("selectall",null,!1)},editText:function(e){null!==R.input&&(R.parent.isEdit=!0,e.preventDefault(),13===e.keyCode?(R.callbackImput(),R.clearInput()):8===e.keyCode?R.input.textContent="":(!R.input.isNum||95<e.keyCode&&e.keyCode<106||110===e.keyCode||109===e.keyCode)&&(R.firstImput?(R.input.textContent=e.key,R.firstImput=!1):R.input.textContent+=e.key))},loop:function(){R.isLoop&&requestAnimationFrame(R.loop),R.update()},update:function(){for(var e=R.listens.length;e--;)R.listens[e].listening()},removeListen:function(e){var t=R.listens.indexOf(e);-1!==t&&R.listens.splice(t,1),0===R.listens.length&&(R.isLoop=!1)},addListen:function(e){-1===R.listens.indexOf(e)&&(R.listens.push(e),R.isLoop||(R.isLoop=!0,R.loop()))}},Roots=R;function V2(e,t){this.x=e||0,this.y=t||0}function Proto(e){if(e=e||{},this.css=Tools.css,this.colors=Tools.colors,this.defaultBorderColor=this.colors.border,this.svgs=Tools.svgs,this.zone={x:0,y:0,w:0,h:0},this.local=(new V2).neg(),this.isCanvasOnly=!1,this.main=e.main||null,this.isUI=e.isUI||!1,this.parentGroup=null,this.p=void 0!==e.p?e.p:Tools.size.p,this.w=this.isUI?this.main.size.w:Tools.size.w,void 0!==e.w&&(this.w=e.w),this.h=this.isUI?this.main.size.h:Tools.size.h,void 0!==e.h&&(this.h=e.h),this.h=this.h<11?11:this.h,this.autoWidth=e.auto||!0,this.isOpen=!1,this.radius=e.radius||0,this.isNumber=!1,this.mono=!1,this.isEdit=!1,this.simple=e.simple||!1,this.simple&&(this.sa=0),this.setSize(this.w),void 0!==e.sa&&(this.sa=e.sa),void 0!==e.sb&&(this.sb=e.sb),this.simple&&(this.sb=this.w-this.sa),this.sc=void 0===e.sc?47:e.sc,this.objectLink=null,this.isSend=!1,this.val=null,this.bg=this.isUI?this.main.bg:Tools.colors.background,this.bgOver=Tools.colors.backgroundOver,void 0!==e.bg&&(this.bg=e.bg,this.bgOver=e.bg),void 0!==e.bgOver&&(this.bgOver=e.bgOver),this.titleColor=e.titleColor||Tools.colors.text,this.fontColor=e.fontColor||Tools.colors.text,void 0!==e.color&&("n"===e.color&&(e.color="#ff0000"),"no"!==e.color&&(isNaN(e.color)?this.fontColor=e.color:this.fontColor=Tools.hexToHtml(e.color),this.titleColor=this.fontColor)),this.colorPlus=Tools.ColorLuma(this.fontColor,.3),this.txt=e.name||"Proto",this.rename=e.rename||"",this.target=e.target||null,this.callback=void 0===e.callback?null:e.callback,(this.endCallback=null)===this.callback&&this.isUI&&null!==this.main.callback&&(this.callback=this.main.callback),this.c=[],this.s=[],this.c[0]=Tools.dom("div",Tools.css.basic+"position:relative; height:20px; float:left; overflow:hidden;"),this.s[0]=this.c[0].style,this.isUI&&(this.s[0].marginBottom="1px"),this.simple||(this.c[1]=Tools.dom("div",Tools.css.txt),this.s[1]=this.c[1].style,this.c[1].textContent=""===this.rename?this.txt:this.rename,this.s[1].color=this.titleColor),e.pos){for(var t in this.s[0].position="absolute",e.pos)this.s[0][t]=e.pos[t];this.mono=!0}e.css&&(this.s[0].cssText=e.css)}function Bool(e){Proto.call(this,e),this.value=e.value||!1,this.buttonColor=e.bColor||this.colors.button,this.inh=e.inh||this.h;var t=Math.floor(.5*this.h)-.5*(this.inh-2);this.c[2]=this.dom("div",this.css.basic+"background:"+this.colors.boolbg+"; height:"+(this.inh-2)+"px; width:36px; top:"+t+"px; border-radius:10px; border:2px solid "+this.boolbg),this.c[3]=this.dom("div",this.css.basic+"height:"+(this.inh-6)+"px; width:16px; top:"+(2+t)+"px; border-radius:10px; background:"+this.buttonColor+";"),this.init(),this.update()}function Button(e){Proto.call(this,e),this.value=!1,this.values=e.value||this.txt,"string"==typeof this.values&&(this.values=[this.values]),this.isDown=!1,this.buttonColor=e.bColor||this.colors.button,this.isLoadButton=e.loader||!1,this.isDragButton=e.drag||!1,this.isDragButton&&(this.isLoadButton=!0),this.lng=this.values.length,this.tmp=[],this.stat=[];for(var t=0;t<this.lng;t++)this.c[t+2]=this.dom("div",this.css.txt+"text-align:center; top:1px; background:"+this.buttonColor+"; height:"+(this.h-2)+"px; border-radius:"+this.radius+"px; line-height:"+(this.h-4)+"px;"),this.c[t+2].style.color=this.fontColor,this.c[t+2].innerHTML=this.values[t],this.stat[t]=1;void 0!==this.c[1]&&(this.c[1].textContent=""),this.isLoadButton&&this.initLoader(),this.isDragButton&&(this.lng++,this.initDrager()),this.init()}function Circular(e){Proto.call(this,e),this.autoWidth=!1,this.buttonColor=this.colors.button,this.setTypeNumber(e),this.radius=.5*this.w,this.twoPi=2*Math.PI,this.pi90=.5*Math.PI,this.offset=new V2,this.h=e.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.c[1].style.textAlign="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0,this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[3]=this.getCircular(),this.setSvg(this.c[3],"d",this.makePath(),1),this.setSvg(this.c[3],"stroke",this.fontColor,1),this.setSvg(this.c[3],"viewBox","0 0 "+this.w+" "+this.w),this.setCss(this.c[3],{width:this.w,height:this.w,left:0,top:this.top}),this.init(),this.update()}function Color$1(e){Proto.call(this,e),this.ctype=e.ctype||"array",this.wfixe=256<this.sb?256:this.sb,this.side=e.side||"down",this.up="down"===this.side?0:1,this.baseH=this.h,this.offset=new V2,this.decal=new V2,this.pi90=.5*Math.PI,this.c[2]=this.dom("div",this.css.txt+"height:"+(this.h-4)+"px;border-radius:"+this.radius+"px; line-height:"+(this.h-8)+"px;"),this.s[2]=this.c[2].style,this.up&&(this.s[2].top="auto",this.s[2].bottom="2px"),this.c[3]=this.getColorRing(),this.c[3].style.visibility="hidden",this.hsl=null,this.value="#ffffff",void 0!==e.value&&(e.value instanceof Array?this.value=Tools.rgbToHex(e.value):isNaN(e.value)?this.value=e.value:this.value=Tools.hexToHtml(e.value)),this.bcolor=null,this.isDown=!1,this.setColor(this.value),this.init(),void 0!==e.open&&this.open()}function Fps(e){Proto.call(this,e),this.round=Math.round,this.autoHeight=!0,this.baseH=this.h,this.hplus=50,this.res=e.res||40,this.l=1,this.pa1=[],this.pa2=[],this.pa3=[];for(var t=this.res+1;t--;)this.pa1.push(50),this.pa2.push(50),this.pa3.push(50);var i=Math.floor(.5*this.h)-6;this.c[1].textContent="FPS",this.c[0].style.cursor="pointer",this.c[0].style.pointerEvents="auto",this.c[2]=this.dom("path",this.css.basic+("display:none; left:10px; top:"+this.h+"px; height:"+(this.hplus-8)+"px; background: rgba(0, 0, 0, 0.2);border:1px solid rgba(255, 255, 255, 0.2); "),{fill:"rgba(200,200,200,0.3)","stroke-width":1,stroke:this.fontColor,"vector-effect":"non-scaling-stroke"}),this.c[2].setAttribute("viewBox","0 0 "+this.res+" 42"),this.c[2].setAttribute("height","100%"),this.c[2].setAttribute("width","100%"),this.c[2].setAttribute("preserveAspectRatio","none"),this.dom("path",null,{fill:"rgba(255,255,0,0.3)","stroke-width":1,stroke:"#FF0","vector-effect":"non-scaling-stroke"},this.c[2]),this.dom("path",null,{fill:"rgba(0,255,255,0.3)","stroke-width":1,stroke:"#0FF","vector-effect":"non-scaling-stroke"},this.c[2]),this.c[3]=this.dom("div",this.css.basic+"width:100%; bottom:0px; height:1px; background: rgba(255, 255, 255, 0.2);"),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:4px; top:"+i+"px;",{d:"M 3 8 L 8 5 3 2 3 8 Z",fill:this.fontColor,stroke:"none"}),this.isShow=e.show||!1,this.c[1].style.marginLeft="10px",this.now=self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now,this.startTime=this.now(),this.prevTime=this.startTime,this.frames=0,this.isMem=!1,this.ms=0,this.fps=0,this.mem=0,this.mm=0,self.performance&&self.performance.memory&&(this.isMem=!0),this.init()}function Graph(e){Proto.call(this,e),this.value=void 0!==e.value?e.value:[0,0,0],this.lng=this.value.length,this.precision=void 0!==e.precision?e.precision:2,this.multiplicator=e.multiplicator||1,this.neg=e.neg||!1,this.autoWidth=void 0===e.autoWidth||e.autoWidth,this.isNumber=!1,this.isDown=!1,this.h=e.h||138,this.rh=this.h-10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.top=10,this.h+=10),this.gh=this.rh-28,this.gw=this.w-28,this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[2].textContent=this.value;var t=this.dom("svg",this.css.basic,{viewBox:"0 0 "+this.w+" "+this.rh,width:this.w,height:this.rh,preserveAspectRatio:"none"});this.setCss(t,{width:this.w,height:this.rh,left:0,top:this.top}),this.dom("path","",{d:"",stroke:this.colors.text,"stroke-width":2,fill:"none","stroke-linecap":"butt"},t),this.dom("rect","",{x:10,y:10,width:this.gw+8,height:this.gh+8,stroke:"rgba(0,0,0,0.3)","stroke-width":1,fill:"none"},t),this.iw=(this.gw-4*(this.lng-1))/this.lng;var i=[];this.cMode=[],this.v=[];for(var r=0;r<this.lng;r++)i[r]=[14+r*this.iw+4*r,this.iw],i[r][2]=i[r][0]+i[r][1],this.cMode[r]=0,this.v[r]=this.neg?.5*(1+this.value[r]/this.multiplicator):this.value[r]/this.multiplicator,this.dom("rect","",{x:i[r][0],y:14,width:i[r][1],height:1,fill:this.fontColor,"fill-opacity":.3},t);this.tmp=i,this.c[3]=t,console.log(this.w),this.init(),void 0!==this.c[1]&&(this.c[1].style.top="0px",this.c[1].style.height="20px",this.s[1].lineHeight="15px"),this.update(!1)}function Group$1(e){Proto.call(this,e),this.uis=[],this.autoHeight=!0,this.current=-1,this.target=null,this.decal=0,this.baseH=this.h;var t=Math.floor(.5*this.h)-6;this.isLine=void 0!==e.line&&e.line,this.c[2]=this.dom("div",this.css.basic+"width:100%; left:0; height:auto; overflow:hidden; top:"+this.h+"px"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:0; top:"+t+"px;",{d:this.svgs.group,fill:this.fontColor,stroke:"none"}),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; left:4px; top:"+t+"px;",{d:this.svgs.arrow,fill:this.fontColor,stroke:"none"}),this.isLine&&(this.c[5]=this.dom("div",this.css.basic+"background:rgba(255, 255, 255, 0.2); width:100%; left:0; height:1px; bottom:0px"));var i=this.s;i[0].height=this.h+"px",i[1].height=this.h+"px",this.c[1].name="group",this.s[1].marginLeft="10px",this.s[1].lineHeight=this.h-4,this.s[1].color=this.fontColor,this.s[1].fontWeight="bold",this.init(),void 0!==e.bg&&this.setBG(e.bg),void 0!==e.open&&this.open()}function Joystick(e){Proto.call(this,e),this.autoWidth=!1,this.value=[0,0],this.joyType="analogique",this.model=void 0!==e.mode?e.mode:0,this.precision=e.precision||2,this.multiplicator=e.multiplicator||1,this.pos=new V2,this.tmp=new V2,this.interval=null,this.radius=.5*this.w,this.distance=.25*this.radius,this.h=e.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.c[1].style.textAlign="center",this.top=10,this.h+=10),this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[2].textContent=this.value,this.c[3]=this.getJoystick(this.model),this.setSvg(this.c[3],"viewBox","0 0 "+this.w+" "+this.w),this.setCss(this.c[3],{width:this.w,height:this.w,left:0,top:this.top}),this.ratio=128/this.w,this.init(),this.update(!1)}function Knob(e){Proto.call(this,e),this.autoWidth=!1,this.buttonColor=this.colors.button,this.setTypeNumber(e),this.mPI=.8*Math.PI,this.toDeg=180/Math.PI,this.cirRange=2*this.mPI,this.offset=new V2,this.radius=.5*this.w,this.h=e.h||this.w+10,this.top=0,this.c[0].style.width=this.w+"px",void 0!==this.c[1]&&(this.c[1].style.width=this.w+"px",this.c[1].style.textAlign="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0,this.c[2]=this.dom("div",this.css.txt+"text-align:center; top:"+(this.h-20)+"px; width:"+this.w+"px; color:"+this.fontColor),this.c[3]=this.getKnob(),this.setSvg(this.c[3],"stroke",this.fontColor,1),this.setSvg(this.c[3],"stroke",this.fontColor,3),this.setSvg(this.c[3],"d",this.makeGrad(),3),this.setSvg(this.c[3],"viewBox","0 0 "+this.ww+" "+this.ww),this.setCss(this.c[3],{width:this.w,height:this.w,left:0,top:this.top}),this.r=0,this.init(),this.update()}function List(e){Proto.call(this,e),this.path=e.path||"",this.format=e.format||"",this.imageSize=e.imageSize||[20,20],this.isWithImage=""!==this.path,this.preLoadComplete=!1,this.tmpImage={},this.tmpUrl=[],this.autoHeight=!1;var t=e.align||"center";this.sMode=0,this.tMode=0,this.buttonColor=e.bColor||this.colors.button;var i=Math.floor(.5*this.h)-5;this.c[2]=this.dom("div",this.css.basic+"top:0; display:none;"),this.c[3]=this.dom("div",this.css.txt+"text-align:"+t+"; line-height:"+(this.h-4)+"px; top:1px; background:"+this.buttonColor+"; height:"+(this.h-2)+"px; border-radius:"+this.radius+"px;"),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:10px; height:10px; top:"+i+"px;",{d:this.svgs.arrow,fill:this.fontColor,stroke:"none"}),this.scroller=this.dom("div",this.css.basic+"right:5px;  width:10px; background:#666; display:none;"),this.c[3].style.color=this.fontColor,this.list=e.list||[],this.items=[],this.prevName="",this.baseH=this.h,this.itemHeight=e.itemHeight||this.h-3,this.full=e.full||!1,this.py=0,this.ww=this.sb,this.scroll=!1,this.isDown=!1,this.current=null,this.side=e.side||"down",this.up="down"===this.side?0:1,this.up?(this.c[2].style.top="auto",this.c[3].style.top="auto",this.c[4].style.top="auto",this.c[2].style.bottom=this.h-2+"px",this.c[3].style.bottom="1px",this.c[4].style.bottom=i+"px"):this.c[2].style.top=this.baseH+"px",this.listIn=this.dom("div",this.css.basic+"left:0; top:0; width:100%; background:rgba(0,0,0,0.2);"),this.listIn.name="list",this.topList=0,this.c[2].appendChild(this.listIn),this.c[2].appendChild(this.scroller),void 0!==e.value?isNaN(e.value)?this.value=e.value:this.value=this.list[e.value]:this.value=this.list[0],this.isOpenOnStart=e.open||!1,this.isWithImage&&this.preloadImage(),this.setList(this.list),this.init(),this.isOpenOnStart&&this.open()}function Numeric(e){Proto.call(this,e),this.setTypeNumber(e),this.isDown=!1,this.value=[0],this.toRad=1,this.isNumber=!0,this.isAngle=!1,this.isVector=!1,void 0!==e.value&&(isNaN(e.value)?e.value instanceof Array?(this.value=e.value,this.isNumber=!1):e.value instanceof Object&&(this.value=[],e.value.x&&(this.value[0]=e.value.x),e.value.y&&(this.value[1]=e.value.y),e.value.z&&(this.value[2]=e.value.z),e.value.w&&(this.value[3]=e.value.w),this.isVector=!0):this.value=[e.value]),this.lng=this.value.length,this.tmp=[],e.isAngle&&(this.isAngle=!0,this.toRad=Math.PI/180),this.current=-1,this.prev={x:0,y:0,d:0,v:0},this.cMode=[];for(var t=this.lng;t--;)this.isAngle&&(this.value[t]=(180*this.value[t]/Math.PI).toFixed(this.precision)),this.c[2+t]=this.dom("div",this.css.txtselect+"letter-spacing:-1px; height:"+(this.h-4)+"px; line-height:"+(this.h-8)+"px;"),e.center&&(this.c[2+t].style.textAlign="center"),this.c[2+t].textContent=this.value[t],this.c[2+t].style.color=this.fontColor,this.c[2+t].isNum=!0,this.cMode[t]=0;this.init()}function Slide(e){if(Proto.call(this,e),this.setTypeNumber(e),this.model=e.stype||0,void 0!==e.mode&&(this.model=e.mode),this.buttonColor=e.bColor||this.colors.button,this.defaultBorderColor=this.colors.hide,this.isDown=!1,this.isOver=!1,this.allway=e.allway||!1,this.firstImput=!1,this.c[2]=this.dom("div",this.css.txtselect+"text-align:right; width:47px; border:1px dashed "+this.defaultBorderColor+"; color:"+this.fontColor),this.c[3]=this.dom("div",this.css.basic+" top:0; height:"+this.h+"px;"),this.c[4]=this.dom("div",this.css.basic+"background:"+this.colors.scrollback+"; top:2px; height:"+(this.h-4)+"px;"),this.c[5]=this.dom("div",this.css.basic+"left:4px; top:5px; height:"+(this.h-10)+"px; background:"+this.fontColor+";"),this.c[2].isNum=!0,this.c[2].style.height=this.h-2+"px",this.c[2].style.lineHeight=this.h-10+"px",0!==this.model){if(1===this.model||3===this.model)var t=4,i=8,r=this.h-4,n=20;2===this.model&&(i=8,n=2,r=.5*(this.h-(t=4))),3===this.model&&(this.c[5].style.visible="none"),this.c[4].style.borderRadius=t+"px",this.c[4].style.height=i+"px",this.c[4].style.top=.5*this.h-t+"px",this.c[5].style.borderRadius=.5*t+"px",this.c[5].style.height=t+"px",this.c[5].style.top=.5*this.h-.5*t+"px",this.c[6]=this.dom("div",this.css.basic+"border-radius:"+n+"px; margin-left:"+.5*-r+"px; border:1px solid "+this.colors.border+"; background:"+this.buttonColor+"; left:4px; top:2px; height:"+(this.h-4)+"px; width:"+r+"px;")}this.init()}function TextInput(e){Proto.call(this,e),this.cmode=0,this.value=e.value||"",this.allway=e.allway||!1,this.firstImput=!1,this.c[2]=this.dom("div",this.css.txtselect),this.c[2].textContent=this.value,this.init()}function Title(e){Proto.call(this,e);var t=e.prefix||"";this.c[2]=this.dom("div",this.css.txt+"text-align:right; width:60px; line-height:"+(this.h-8)+"px; color:"+this.fontColor),31===this.h&&(this.s[0].height=this.h+"px",this.s[1].top="8px",this.c[2].style.top="8px"),this.c[1].textContent=this.txt.substring(0,1).toUpperCase()+this.txt.substring(1).replace("-"," "),this.c[2].textContent=t,this.init()}function _add(){var e,t,i=arguments,r=!1,n=null;switch("string"==typeof i[0]?(e=i[0],t=i[1]||{}):"object"===_typeof(i[0])&&(r=!0,void 0===i[2]&&[].push.call(i,{}),e=i[2].type?i[2].type:"slide",(t=i[2]).name=i[1],t.value=i[0][i[1]]),e.toLowerCase()){case"bool":n=new Bool(t);break;case"button":n=new Button(t);break;case"circular":n=new Circular(t);break;case"color":n=new Color$1(t);break;case"fps":n=new Fps(t);break;case"graph":n=new Graph(t);break;case"group":n=new Group$1(t);break;case"joystick":n=new Joystick(t);break;case"knob":n=new Knob(t);break;case"list":n=new List(t);break;case"numeric":case"number":n=new Numeric(t);break;case"slide":n=new Slide(t);break;case"textInput":case"string":n=new TextInput(t);break;case"title":n=new Title(t)}if(null!==n)return r&&n.setReferency(i[0],i[1]),n}function Gui(e){this.canvas=null,void 0!==(e=e||{}).transparent&&(Tools.colors.background="none",Tools.colors.backgroundOver="none"),this.isReset=!0,this.tmpAdd=null,this.tmpH=0,this.isCanvas=e.isCanvas||!1,this.isCanvasOnly=!1,this.css=void 0!==e.css?e.css:"",this.callback=void 0===e.callback?null:e.callback,this.forceHeight=e.maxHeight||0,this.cn="",this.size=Tools.size,void 0!==e.p&&(this.size.p=e.p),void 0!==e.w&&(this.size.w=e.w),void 0!==e.h&&(this.size.h=e.h),void 0!==e.s&&(this.size.s=e.s),this.size.h=this.size.h<11?11:this.size.h,this.local=(new V2).neg(),this.zone={x:0,y:0,w:this.size.w,h:0},this.mouse=(new V2).neg(),this.h=0,this.prevY=-1,this.sw=0,this.colors=Tools.colors,this.bg=e.bg||Tools.colors.background,this.isWithClose=void 0===e.close||e.close,this.bh=this.isWithClose?this.size.h:0,this.autoResize=void 0===e.autoResize||e.autoResize,this.isCenter=e.center||!1,this.isOpen=!0,this.isDown=!1,this.isScroll=!1,this.uis=[],this.current=-1,this.target=null,this.decal=0,this.ratio=1,this.oy=0,this.isNewTarget=!1,this.content=Tools.dom("div",Tools.css.basic+" width:0px; height:auto; top:0px; "+this.css),this.innerContent=Tools.dom("div",Tools.css.basic+"width:100%; top:0; left:0; height:auto; overflow:hidden;"),this.content.appendChild(this.innerContent),this.inner=Tools.dom("div",Tools.css.basic+"width:100%; left:0; "),this.innerContent.appendChild(this.inner),this.scrollBG=Tools.dom("div",Tools.css.basic+"right:0; top:0; width:"+(this.size.s-1)+"px; height:10px; display:none; background:"+this.bg+";"),this.content.appendChild(this.scrollBG),this.scroll=Tools.dom("div",Tools.css.basic+"background:"+this.colors.scroll+"; right:2px; top:0; width:"+(this.size.s-4)+"px; height:10px;"),this.scrollBG.appendChild(this.scroll),this.bottom=Tools.dom("div",Tools.css.txt+"width:100%; top:auto; bottom:0; left:0; border-bottom-right-radius:10px;  border-bottom-left-radius:10px; text-align:center; height:"+this.bh+"px; line-height:"+(this.bh-5)+"px; border-top:1px solid "+Tools.colors.stroke+";"),this.content.appendChild(this.bottom),this.bottom.textContent="close",this.bottom.style.background=this.bg,this.parent=void 0!==e.parent?e.parent:null,null!==this.parent||this.isCanvas||(this.parent=document.body,this.isCenter||(this.content.style.right="10px")),null!==this.parent&&this.parent.appendChild(this.content),this.isCanvas&&null===this.parent&&(this.isCanvasOnly=!0),this.isCanvasOnly||(this.content.style.pointerEvents="auto"),this.setWidth(),this.isCanvas&&this.makeCanvas(),Roots.add(this)}Object.assign(V2.prototype,{set:function(e,t){return this.x=e,this.y=t,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return this.multiplyScalar(1/e)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},addScalar:function(e){return this.x+=e,this.y+=e,this},negate:function(){return this.x*=-1,this.y*=-1,this},neg:function(){return this.x=-1,this.y=-1,this},isZero:function(){return 0===this.x&&0===this.y},copy:function(e){return this.x=e.x,this.y=e.y,this},equals:function(e){return e.x===this.x&&e.y===this.y},nearEquals:function(e,t){return e.x.toFixed(t)===this.x.toFixed(t)&&e.y.toFixed(t)===this.y.toFixed(t)},lerp:function(e,t){return null===e?(this.x-=this.x*t,this.y-=this.y*t):(this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t),this}}),Object.assign(Proto.prototype,{constructor:Proto,init:function(){var e=this.s,t=this.c;e[0].height=this.h+"px",this.zone.h=this.h,this.isUI&&(e[0].background=this.bg),void 0!==t[1]&&this.autoWidth&&(e[1]=t[1].style,e[1].height=this.h-4+"px",e[1].lineHeight=this.h-8+"px");for(var i=Tools.frag,r=1,n=t.length;r!==n;r++)void 0!==t[r]&&(i.appendChild(t[r]),e[r]=t[r].style);null!==this.target?this.target.appendChild(t[0]):this.isUI?this.main.inner.appendChild(t[0]):document.body.appendChild(t[0]),t[0].appendChild(i),this.rSize(),this.isUI||(this.c[0].style.pointerEvents="auto",Roots.add(this))},dom:function(e,t,i,r,n){return Tools.dom(e,t,i,r,n)},setSvg:function(e,t,i,r){Tools.setSvg(e,t,i,r)},setCss:function(e,t){Tools.setCss(e,t)},clamp:function(e,t,i){return Tools.clamp(e,t,i)},getColorRing:function(){return Tools.colorRing||Tools.makeColorRing(),Tools.clone(Tools.colorRing)},getJoystick:function(e){return Tools["joystick_"+e]||Tools.makeJoystick(e),Tools.clone(Tools["joystick_"+e])},getCircular:function(e){return Tools.circular||Tools.makeCircular(e),Tools.clone(Tools.circular)},getKnob:function(e){return Tools.knob||Tools.makeKnob(e),Tools.clone(Tools.knob)},cursor:function(e){Roots.cursor(e)},setInput:function(e,t){Roots.setInput(e,t,Tools.colors.input,this)},update:function(){},reset:function(){},getDom:function(){return this.c[0]},uiout:function(){this.s[0].background=this.bg},uiover:function(){this.s[0].background=this.bgOver},rename:function(e){void 0!==this.c[1]&&(this.c[1].textContent=e)},listen:function(){return Roots.addListen(this),this},listening:function(){null!==this.objectLink&&(this.isSend||this.isEdit||this.setValue(this.objectLink[this.val]))},setValue:function(e){this.value=this.isNumber?this.numValue(e):e,this.update()},onChange:function(e){return this.callback=e,this},onFinishChange:function(e){return this.callback=null,this.endCallback=e,this},send:function(e){this.isSend=!0,null!==this.objectLink&&(this.objectLink[this.val]=e||this.value),this.callback&&this.callback(e||this.value),this.isSend=!1},sendEnd:function(e){this.endCallback&&this.endCallback(e||this.value),null!==this.objectLink&&(this.objectLink[this.val]=e||this.value)},clear:function(){Tools.clear(this.c[0]),null!==this.target?this.target.removeChild(this.c[0]):this.isUI?this.main.clearOne(this):document.body.removeChild(this.c[0]),this.isUI||Roots.remove(this),this.c=null,this.s=null,this.callback=null,this.target=null},setSize:function(e){if(this.autoWidth)if(this.w=e,this.simple)this.sb=this.w-this.sa;else{var t=this.w*(this.p/100);this.sa=Math.floor(10+t),this.sb=Math.floor(this.w-t-20)}},rSize:function(){this.autoWidth&&(this.s[0].width=this.w+"px",this.simple||(this.s[1].width=this.sa+"px"))},setTypeNumber:function(e){var t;switch(this.isNumber=!0,void(this.value=0)!==e.value&&(this.value="string"==typeof e.value?+e.value:e.value),this.min=void 0===e.min?-1/0:e.min,this.max=void 0===e.max?1/0:e.max,this.precision=void 0===e.precision?2:e.precision,this.precision){case 0:t=1;break;case 1:t=.1;break;case 2:t=.01;break;case 3:t=.001;break;case 4:t=1e-4}this.step=void 0===e.step?t:e.step,this.range=this.max-this.min,this.value=this.numValue(this.value)},numValue:function(e){return+Math.min(this.max,Math.max(this.min,e)).toFixed(this.precision)},handleEvent:function(e){return this[e.type](e)},wheel:function(){return!1},mousedown:function(){return!1},mousemove:function(){return!1},mouseup:function(){return!1},keydown:function(){return!1},setReferency:function(e,t){this.objectLink=e,this.val=t},display:function(e){this.s[0].display=(e=e||!1)?"block":"none"},open:function(){this.isOpen||(this.isOpen=!0)},close:function(){this.isOpen&&(this.isOpen=!1)},needZone:function(){Roots.needReZone=!0}}),Bool.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Bool,mousemove:function(){this.cursor("pointer")},mousedown:function(){return this.value=!this.value,this.update(),this.send(),!0},update:function(){var e=this.s;this.value?(e[2].background=this.fontColor,e[2].borderColor=this.fontColor,e[3].marginLeft="17px"):(e[2].background=this.colors.boolbg,e[2].borderColor=this.colors.boolbg,e[3].marginLeft="2px")},rSize:function(){Proto.prototype.rSize.call(this);var e=this.s;e[2].left=this.sa+"px",e[3].left=this.sa+1+"px"}}),Button.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Button,testZone:function(){var e=this.local;if(-1===e.x&&-1===e.y)return"";for(var t=this.lng,i=this.tmp;t--;)if(i[t][0]<e.x&&e.x<i[t][2])return t+2;return""},mouseup:function(e){return!!this.isDown&&(this.value=!1,this.isDown=!1,this.mousemove(e))},mousedown:function(e){var t=this.testZone(e);return!!t&&(this.isDown=!0,this.value=this.values[t-2],this.isLoadButton||this.send(),this.mousemove(e))},mousemove:function(e){var t=this.testZone(e);return""!==t?(this.cursor("pointer"),this.modes(this.isDown?3:2,t)):this.reset()},modes:function(e,t){for(var i=!1,r=0;r<this.lng;r++)this.mode(r===t-2?e:1,r+2)&&(i=!0);return i},mode:function(e,t){var i=!1,r=t-2;if(this.stat[r]!==e){switch(e){case 1:this.stat[r]=1,this.s[2+r].color=this.fontColor,this.s[2+r].background=this.buttonColor;break;case 2:this.stat[r]=2,this.s[2+r].color="#FFF",this.s[2+r].background=this.colors.select;break;case 3:this.stat[r]=3,this.s[2+r].color="#FFF",this.s[2+r].background=this.colors.down}i=!0}return i},reset:function(){return this.cursor(),this.modes(1,2)},dragover:function(e){e.preventDefault(),this.s[4].borderColor=this.colors.select,this.s[4].color=this.colors.select},dragend:function(e){e.preventDefault(),this.s[4].borderColor=this.fontColor,this.s[4].color=this.fontColor},drop:function(e){e.preventDefault(),this.dragend(e),this.fileSelect(e.dataTransfer.files[0])},initDrager:function(){this.c[4]=this.dom("div",this.css.txt+" text-align:center; line-height:"+(this.h-8)+"px; border:1px dashed "+this.fontColor+"; top:2px;  height:"+(this.h-4)+"px; border-radius:"+this.radius+"px; pointer-events:auto;"),this.c[4].textContent="DRAG",this.c[4].addEventListener("dragover",function(e){this.dragover(e)}.bind(this),!1),this.c[4].addEventListener("dragend",function(e){this.dragend(e)}.bind(this),!1),this.c[4].addEventListener("dragleave",function(e){this.dragend(e)}.bind(this),!1),this.c[4].addEventListener("drop",function(e){this.drop(e)}.bind(this),!1)},initLoader:function(){this.c[3]=this.dom("input",this.css.basic+"top:0px; opacity:0; height:"+this.h+"px; pointer-events:auto; cursor:pointer;"),this.c[3].name="loader",this.c[3].type="file",this.c[3].addEventListener("change",function(e){this.fileSelect(e.target.files[0])}.bind(this),!1)},fileSelect:function(e){if(void 0!==e){var t=new FileReader,i=e.name,r=i.substring(i.lastIndexOf(".")+1,i.length);-1!==["png","jpg","mp4","webm","ogg"].indexOf(r)?t.readAsDataURL(e):-1!==["sea","z","hex","bvh","BVH"].indexOf(r)?t.readAsArrayBuffer(e):t.readAsText(e),t.onload=function(e){this.callback&&this.callback(e.target.result,i,r)}.bind(this)}},label:function(e,t){this.c[t=t||2].textContent=e},icon:function(e,t,i){this.s[i=i||2].padding=(t||0)+"px 0px",this.c[i].innerHTML=e},rSize:function(){Proto.prototype.rSize.call(this);for(var e=this.s,t=this.sa,i=this.lng,r=Math.floor((this.sb-3*(i-1))/i);i--;)this.tmp[i]=[Math.floor(t+r*i+3*i),r],this.tmp[i][2]=this.tmp[i][0]+this.tmp[i][1],e[i+2].left=this.tmp[i][0]+"px",e[i+2].width=this.tmp[i][1]+"px";this.isDragButton&&(e[4].left=t+r+3+"px",e[4].width=r+"px"),this.isLoadButton&&(e[3].left=t+"px",e[3].width=r+"px")}}),Circular.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Circular,mode:function(e){if(this.cmode===e)return!1;switch(e){case 0:this.s[2].color=this.fontColor,this.setSvg(this.c[3],"stroke","rgba(0,0,0,0.1)",0),this.setSvg(this.c[3],"stroke",this.fontColor,1);break;case 1:this.s[2].color=this.colorPlus,this.setSvg(this.c[3],"stroke","rgba(0,0,0,0.3)",0),this.setSvg(this.c[3],"stroke",this.colorPlus,1)}return this.cmode=e,!0},reset:function(){this.isDown=!1},mouseup:function(){return this.isDown=!1,this.sendEnd(),this.mode(0)},mousedown:function(e){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(e),this.mode(1)},mousemove:function(e){if(this.isDown){var t=this.offset;if(t.x=this.radius-(e.clientX-this.zone.x),t.y=this.radius-(e.clientY-this.zone.y-this.top),this.r=t.angle()-this.pi90,this.r=(this.r%this.twoPi+this.twoPi)%this.twoPi,null!==this.oldr){var i=this.r-this.oldr;this.r=Math.abs(i)>Math.PI?this.oldr:this.r,6<i&&(this.r=0),i<-6&&(this.r=this.twoPi)}var r=this.range*(this.r*(1/this.twoPi))+this.min-this.old;(this.step<=r||r<=this.step)&&(this.value=this.numValue(this.old+(r=~~(r/this.step))*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}},makePath:function(){var e=this.percent*this.twoPi-.001,t=40+40*Math.sin(e)+24,i=40-40*Math.cos(e)+24;return"M 64,24 A 40,40 0 "+(e>Math.PI?1:0)+" 1 "+t+","+i},update:function(e){this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range,this.setSvg(this.c[3],"d",this.makePath(),1),e&&this.send()}}),Color$1.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Color$1,testZone:function(){var e=this.local;return-1===e.x&&-1===e.y?"":this.up&&this.isOpen?this.wfixe<e.y?"title":"color":e.y<this.baseH+2?"title":this.isOpen?"color":void 0},mouseup:function(){this.isDown=!1},mousedown:function(e){var t=this.testZone(e.clientX,e.clientY);if("title"===t)return this.isOpen?this.close():this.open(),!0;"color"===t&&(this.isDown=!0,this.mousemove(e))},mousemove:function(e){var t,i,r,n,a,o=this.testZone(e.clientX,e.clientY);"title"===o&&this.cursor("pointer"),"color"===o&&(this.cursor("crosshair"),this.isDown&&((t=this.offset).x=e.clientX-(this.zone.x+this.decal.x+this.mid),t.y=e.clientY-(this.zone.y+this.decal.y+this.mid),(i=t.length()*this.ratio)<128&&(88<i?(r=(t.angle()+this.pi90)/6.28,this.setHSL([(1+r)%1,this.hsl[1],this.hsl[2]])):(n=Math.max(0,Math.min(1,.5-t.x*this.square*.5)),a=Math.max(0,Math.min(1,.5-t.y*this.square*.5)),this.setHSL([this.hsl[0],n,a])))))},setHeight:function(){this.h=this.isOpen?this.wfixe+this.baseH+5:this.baseH,this.s[0].height=this.h+"px",this.zone.h=this.h},parentHeight:function(e){null!==this.parentGroup?this.parentGroup.calc(e):this.isUI&&this.main.calc(e)},open:function(){Proto.prototype.open.call(this),this.setHeight(),this.up&&(this.zone.y-=this.wfixe+5);var e=this.h-this.baseH;this.s[3].visibility="visible",this.parentHeight(e)},close:function(){Proto.prototype.close.call(this),this.up&&(this.zone.y+=this.wfixe+5);var e=this.h-this.baseH;this.setHeight(),this.s[3].visibility="hidden",this.parentHeight(-e)},update:function(e){var t=Tools.rgbToHex(Tools.hslToRgb([this.hsl[0],1,.5]));this.moveMarkers(),this.value=this.bcolor,this.setSvg(this.c[3],"fill",t,2),this.s[2].background=this.bcolor,this.c[2].textContent=Tools.htmlToHex(this.bcolor),this.invert=Tools.findDeepInver(this.rgb),this.s[2].color=this.invert?"#fff":"#000",e&&("array"===this.ctype&&this.send(this.rgb),"rgb"===this.ctype&&this.send(Tools.htmlRgb(this.rgb)),"hex"===this.ctype&&this.send(Tools.htmlToHex(this.value)),"html"===this.ctype&&this.send())},setColor:function(e){var t=Tools.unpack(e);return this.bcolor!=e&&t&&(this.bcolor=e,this.rgb=t,this.hsl=Tools.rgbToHsl(this.rgb),this.update()),this},setHSL:function(e){return this.hsl=e,this.rgb=Tools.hslToRgb(e),this.bcolor=Tools.rgbToHex(this.rgb),this.update(!0),this},moveMarkers:function(){var e=this.invert?"#fff":"#000",t=6.28*this.hsl[0],i=new V2(108*Math.sin(t),108*-Math.cos(t)).addScalar(128);this.setSvg(this.c[3],"cx",i.x,5),this.setSvg(this.c[3],"cy",i.y,5),i.set(120*(.5-this.hsl[1]),120*(.5-this.hsl[2])).addScalar(128),this.setSvg(this.c[3],"cx",i.x,6),this.setSvg(this.c[3],"cy",i.y,6),this.setSvg(this.c[3],"stroke",e,6)},rSize:function(){Proto.prototype.rSize.call(this);var e=this.s;e[2].width=this.sb+"px",e[2].left=this.sa+"px",this.decal.x=Math.floor(.5*(this.w-this.wfixe)),this.decal.y="up"===this.side?2:this.baseH+2,this.mid=Math.floor(.5*this.wfixe),this.setSvg(this.c[3],"viewBox","0 0 "+this.wfixe+" "+this.wfixe),e[3].width=this.wfixe+"px",e[3].height=this.wfixe+"px",e[3].left=this.decal.x+"px",e[3].top=this.decal.y+"px",this.ratio=256/this.wfixe,this.square=1/(this.wfixe/256*60),this.setHeight()}}),Fps.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Fps,mousedown:function(){this.isShow?this.hide():this.show()},mode:function(e){var t=this.s;switch(e){case 0:t[1].color=this.fontColor;break;case 1:t[1].color="#FFF";break;case 2:t[1].color=this.fontColor}},makePath:function(e){var t="";t+="M -1 50";for(var i=0;i<this.res+1;i++)t+=" L "+i+" "+e[i];return t+=" L "+(this.res+1)+" 50"},drawGraph:function(){var e=this.c[2];this.pa1.shift(),this.pa1.push(8.5+this.round(30*(1-this.fps/100))),this.setSvg(e,"d",this.makePath(this.pa1),0),this.pa2.shift(),this.pa2.push(8.5+this.round(30*(1-this.ms/200))),this.setSvg(e,"d",this.makePath(this.pa2),1),this.isMem&&(this.pa3.shift(),this.pa3.push(8.5+this.round(30*(1-this.mm))),this.setSvg(e,"d",this.makePath(this.pa3),2))},show:function(){this.h=this.hplus+this.baseH,this.setSvg(this.c[4],"d","M 5 8 L 8 3 2 3 5 8 Z"),null!==this.parentGroup?this.parentGroup.calc(this.hplus):this.isUI&&this.main.calc(this.hplus),this.s[0].height=this.h+"px",this.s[2].display="block",this.isShow=!0,Roots.addListen(this)},hide:function(){this.h=this.baseH,this.setSvg(this.c[4],"d","M 3 8 L 8 5 3 2 3 8 Z"),null!==this.parentGroup?this.parentGroup.calc(-this.hplus):this.isUI&&this.main.calc(-this.hplus),this.s[0].height=this.h+"px",this.s[2].display="none",this.isShow=!1,Roots.removeListen(this),this.c[1].textContent="FPS"},begin:function(){this.startTime=this.now()},end:function(){var e=this.now();if(this.ms=e-this.startTime,this.frames++,this.prevTime+1e3<e&&(this.fps=this.round(1e3*this.frames/(e-this.prevTime)),this.prevTime=e,this.frames=0,this.isMem)){var t=performance.memory.usedJSHeapSize,i=performance.memory.jsHeapSizeLimit;this.mem=this.round(954e-9*t),this.mm=t/i}return this.drawGraph(),this.c[1].innerHTML="FPS "+this.fps+'<font color="yellow"> MS '+(0|this.ms)+'</font><font color="cyan"> MB '+this.mem+'</font><font color="green"> ammo '+window.WEngine.physic.getFps()+"</font>",e},listening:function(){this.startTime=this.end()},rSize:function(){this.s[0].width=this.w+"px",this.s[1].width=this.w+"px",this.s[2].left="10px",this.s[2].width=this.w-20+"px"}}),Graph.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Graph,updateSVG:function(){this.setSvg(this.c[3],"d",this.makePath(),0);for(var e=0;e<this.lng;e++)this.setSvg(this.c[3],"height",this.v[e]*this.gh,e+2),this.setSvg(this.c[3],"y",this.gh-this.v[e]*this.gh+14,e+2),this.value[e]=this.neg?+((2*this.v[e]-1)*this.multiplicator).toFixed(this.precision):+(this.v[e]*this.multiplicator).toFixed(this.precision);this.c[2].textContent=this.value},testZone:function(){var e=this.local;if(-1===e.x&&-1===e.y)return"";var t=this.lng,i=this.tmp;if(this.top<e.y&&e.y<this.h-20)for(;t--;)if(i[t][0]<e.x&&e.x<i[t][2])return t;return""},mode:function(e,t){if(e===this.cMode[t])return!1;var i;switch(e){case 0:i=.3;break;case 1:i=.6;break;case 2:i=1}return this.reset(),this.setSvg(this.c[3],"fill-opacity",i,t+2),this.cMode[t]=e,!0},reset:function(){for(var e=!1,t=this.lng;t--;)0!==this.cMode[t]&&(this.cMode[t]=0,this.setSvg(this.c[3],"fill-opacity",.3,t+2),e=!0);return e},mouseup:function(){if(this.isDown=!1,-1!==this.current)return this.reset()},mousedown:function(e){return this.isDown=!0,this.mousemove(e)},mousemove:function(e){var t=!1,i=this.testZone(e);return""===i?t=this.reset():(t=this.mode(this.isDown?2:1,i),this.isDown&&(this.v[i]=this.clamp(1-(e.clientY-this.zone.y-this.top-10)/this.gh,0,1),this.update(!0))),t},update:function(e){this.updateSVG(),e&&this.send()},makePath:function(){for(var e,t,i,r,n,a,o="",s=0;s<this.lng;s++)e=this.gh-this.v[s]*this.gh+14,r=(t=14+s*this.iw+4*s)+.5*this.iw,i=t+this.iw,o+=0===s?"M "+t+" "+e+" T "+r+" "+e:" C "+n+" "+a+","+t+" "+e+","+r+" "+e,s===this.lng-1&&(o+=" T "+i+" "+e),n=i,a=e;return o},rSize:function(){Proto.prototype.rSize.call(this);var e=this.s;void 0!==this.c[1]&&(e[1].width=this.w+"px"),e[2].width=this.w+"px",e[3].width=this.w+"px";for(var t=(this.w-28-4*(this.lng-1))/this.lng,i=[],r=0;r<this.lng;r++)i[r]=[14+r*t+4*r,t],i[r][2]=i[r][0]+i[r][1];this.tmp=i}}),Group$1.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Group$1,isGroup:!0,testZone:function(){var e=this.local;if(-1===e.x&&-1===e.y)return"";var t="";return e.y<this.baseH?t="title":this.isOpen&&(t="content"),t},clearTarget:function(){return-1!==this.current&&(this.target.uiout(),this.target.reset(),this.current=-1,this.target=null,Roots.cursor(),!0)},reset:function(){this.clearTarget()},handleEvent:function(e){var t=e.type,i=!1,r=!1,n=this.testZone(e);if(n){switch(n){case"content":Roots.isMobile&&"mousedown"===t&&this.getNext(e,i),this.target&&(r=this.target.handleEvent(e)),Roots.lock||this.getNext(e,i);break;case"title":"mousedown"===t&&(this.isOpen?this.close():this.open())}return this.isDown&&(i=!0),r&&(i=!0),i}},getNext:function(e){var t=Roots.findTarget(this.uis,e);t!==this.current&&(this.clearTarget(),this.current=t),-1!==t&&(this.target=this.uis[this.current],this.target.uiover())},calcH:function(){var e,t,i=this.uis.length,r=0,n=0,a=0;for(e=0;e<i;e++)(t=this.uis[e]).autoWidth?r+=t.h+1:(0===n?r+=t.h+1:a<t.h&&(r+=t.h-a),a=t.h,this.w<(n+=t.w)+t.w&&(n=0));return r},calcUis:function(){this.isOpen&&Roots.calcUis(this.uis,this.zone,this.zone.y+this.baseH)},setBG:function(e){this.s[0].background=e;for(var t=this.uis.length;t--;)this.uis[t].setBG(e)},add:function(e,t){var i=arguments;"object"===_typeof(i[1])?(i[1].isUI=this.isUI,i[1].target=this.c[2],i[1].main=this.main):"string"==typeof t&&(void 0===i[2]?[].push.call(i,{isUI:!0,target:this.c[2],main:this.main}):(i[2].isUI=!0,i[2].target=this.c[2],i[2].main=this.main));var r=_add.apply(this,i);return this.uis.push(r),r.autoHeight&&(r.parentGroup=this),r},parentHeight:function(e){null!==this.parentGroup?this.parentGroup.calc(e):this.isUI&&this.main.calc(e)},open:function(){Proto.prototype.open.call(this),this.setSvg(this.c[4],"d",this.svgs.arrowDown),this.rSizeContent(),this.parentHeight(this.h-this.baseH)},close:function(){Proto.prototype.close.call(this);var e=this.h-this.baseH;this.setSvg(this.c[4],"d",this.svgs.arrow),this.h=this.baseH,this.s[0].height=this.h+"px",this.parentHeight(-e)},clear:function(){this.clearGroup(),this.isUI&&this.main.calc(-(this.h+1)),Proto.prototype.clear.call(this)},clearGroup:function(){this.close();for(var e=this.uis.length;e--;)this.uis[e].clear(),this.uis.pop();this.uis=[],this.h=this.baseH},calc:function(e){this.isOpen&&(void 0!==e?(this.h+=e,this.isUI&&this.main.calc(e)):this.h=this.calcH()+this.baseH,this.s[0].height=this.h+"px")},rSizeContent:function(){for(var e=this.uis.length;e--;)this.uis[e].setSize(this.w),this.uis[e].rSize();this.calc()},rSize:function(){Proto.prototype.rSize.call(this);var e=this.s;e[3].left=this.sa+this.sb-17+"px",e[1].width=this.w+"px",e[2].width=this.w+"px",this.isOpen&&this.rSizeContent()}}),Joystick.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Joystick,mode:function(e){switch(e){case 0:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn)",4),this.setSvg(this.c[3],"stroke","#000",4)):(this.setSvg(this.c[3],"stroke","rgba(100,100,100,0.25)",2),this.setSvg(this.c[3],"stroke","#666",4),this.setSvg(this.c[3],"fill","none",4));break;case 1:0===this.model?(this.setSvg(this.c[3],"fill","url(#gradIn2)",4),this.setSvg(this.c[3],"stroke","rgba(0,0,0,0)",4)):(this.setSvg(this.c[3],"stroke","rgba(48,138,255,0.25)",2),this.setSvg(this.c[3],"stroke",this.colors.select,4),this.setSvg(this.c[3],"fill","rgba(48,138,255,0.25)",4))}},addInterval:function(){null!==this.interval&&this.stopInterval(),this.pos.isZero()||(this.interval=setInterval(function(){this.update()}.bind(this),10))},stopInterval:function(){null!==this.interval&&(clearInterval(this.interval),this.interval=null)},reset:function(){this.addInterval(),this.mode(0)},mouseup:function(){this.addInterval(),this.isDown=!1},mousedown:function(e){this.isDown=!0,this.mousemove(e),this.mode(2)},mousemove:function(e){if(this.mode(1),this.isDown){this.tmp.x=this.radius-(e.clientX-this.zone.x),this.tmp.y=this.radius-(e.clientY-this.zone.y-this.top);var t=this.tmp.length();if(this.distance<t){var i=Math.atan2(this.tmp.x,this.tmp.y);this.tmp.x=Math.sin(i)*this.distance,this.tmp.y=Math.cos(i)*this.distance}this.pos.copy(this.tmp).divideScalar(this.distance).negate(),this.update()}},setValue:function(e){void 0===e&&(e=[0,0]),this.pos.set(e[0]||0,e[1]||0),this.updateSVG()},update:function(e){void 0===e&&(e=!0),null!==this.interval&&(this.isDown||(this.pos.lerp(null,.3),this.pos.x=Math.abs(this.pos.x)<.01?0:this.pos.x,this.pos.y=Math.abs(this.pos.y)<.01?0:this.pos.y,this.isUI&&this.main.isCanvas&&this.main.draw())),this.updateSVG(),e&&this.send(),this.pos.isZero()&&this.stopInterval()},updateSVG:function(){var e=this.radius- -this.pos.x*this.distance,t=this.radius- -this.pos.y*this.distance;if(0===this.model){var i=t+5*this.pos.y+10;this.setSvg(this.c[3],"cx",(e+5*this.pos.x+5)*this.ratio,3),this.setSvg(this.c[3],"cy",i*this.ratio,3)}else this.setSvg(this.c[3],"cx",e*this.ratio,3),this.setSvg(this.c[3],"cy",t*this.ratio,3);this.setSvg(this.c[3],"cx",e*this.ratio,4),this.setSvg(this.c[3],"cy",t*this.ratio,4),this.value[0]=+(this.pos.x*this.multiplicator).toFixed(this.precision),this.value[1]=+(this.pos.y*this.multiplicator).toFixed(this.precision),this.c[2].textContent=this.value},clear:function(){this.stopInterval(),Proto.prototype.clear.call(this)}}),Knob.prototype=Object.assign(Object.create(Circular.prototype),{constructor:Knob,mode:function(e){if(this.cmode===e)return!1;switch(e){case 0:this.s[2].color=this.fontColor,this.setSvg(this.c[3],"fill",this.colors.button,0),this.setSvg(this.c[3],"stroke",this.fontColor,1);break;case 1:this.s[2].color=this.colorPlus,this.setSvg(this.c[3],"fill",this.colors.select,0),this.setSvg(this.c[3],"stroke",this.colorPlus,1)}return this.cmode=e,!0},mousemove:function(e){if(this.isDown){var t=this.offset;t.x=this.radius-(e.clientX-this.zone.x),t.y=this.radius-(e.clientY-this.zone.y-this.top),this.r=-Math.atan2(t.x,t.y),null!==this.oldr&&(this.r=Math.abs(this.r-this.oldr)>Math.PI?this.oldr:this.r),this.r=this.mPI<this.r?this.mPI:this.r,this.r=this.r<-this.mPI?-this.mPI:this.r;var i=this.range*((this.r+this.mPI)*(1/this.cirRange))+this.min-this.old;(this.step<=i||i<=this.step)&&(i=Math.floor(i/this.step),this.value=this.numValue(this.old+i*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}},makeGrad:function(){var e,t,i,r="",n=Math.PI+this.mPI,a=Math.PI-this.mPI;5<this.step?e=(n-a)/(t=this.range/this.step):(e=(n-a)/64*2,t=32);for(var o=0;o<=t;++o)i=n-e*o,r+="M"+(64+44*Math.sin(i))+" "+(64+44*Math.cos(i))+" L"+(64+40*Math.sin(i))+" "+(64+40*Math.cos(i))+" ";return r},update:function(e){this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range;var t=this.percent*this.cirRange-this.mPI,i=Math.sin(t),r=Math.cos(t);this.setSvg(this.c[3],"d","M "+(25*i+64)+" "+(-25*r+64)+" L "+(20*i+64)+" "+(-20*r+64),1),e&&this.send()}}),List.prototype=Object.assign(Object.create(Proto.prototype),{constructor:List,preloadImage:function(){this.preLoadComplete=!1,this.tmpImage={};for(var e=0;e<this.list.length;e++)this.tmpUrl.push(this.list[e]);this.loadOne()},nextImg:function(){this.tmpUrl.shift(),0===this.tmpUrl.length?(this.preLoadComplete=!0,this.addImages()):this.loadOne()},loadOne:function(){var e=this,t=this.tmpUrl[0],i=document.createElement("img");i.style.cssText="position:absolute; width:"+e.imageSize[0]+"px; height:"+e.imageSize[1]+"px",i.setAttribute("src",this.path+t+this.format),i.addEventListener("load",function(){e.imageSize[2]=i.width,e.imageSize[3]=i.height,e.tmpImage[t]=i,e.nextImg()})},testZone:function(){var e=this.local;if(-1===e.x&&-1===e.y)return"";if(this.up&&this.isOpen){if(this.h-this.baseH<e.y)return"title";if(this.scroll&&this.sa+this.sb-20<e.x)return"scroll";if(this.sa<e.x)return this.testItems(e.y-this.baseH)}else{if(e.y<this.baseH+2)return"title";if(this.isOpen){if(this.scroll&&this.sa+this.sb-20<e.x)return"scroll";if(this.sa<e.x)return this.testItems(e.y-this.baseH)}}return""},testItems:function(e){for(var t,i="",r=this.items.length;r--;)if((t=this.items[r]).posy+this.topList<=e&&e<=t.posy+this.itemHeight+1+this.topList)return i="item"+r,this.unSelected(),this.current=t,this.selected(),i;return i},unSelected:function(){this.current&&(this.current.style.background="rgba(0,0,0,0.2)",this.current.style.color=this.fontColor,this.current=null)},selected:function(){this.current.style.background=this.colors.select,this.current.style.color="#FFF"},mouseup:function(){this.isDown=!1},mousedown:function(e){var t=this.testZone(e);return!!t&&("scroll"===t?(this.isDown=!0,this.mousemove(e)):"title"===t?(this.modeTitle(2),this.isOpen?this.close():this.open()):this.current&&(this.value=this.list[this.current.id],this.setTopItem(),this.send(),this.close()),!0)},mousemove:function(e){var t=!1,i=this.testZone(e);if(!i)return t;if("title"===i)this.unSelected(),this.modeTitle(1),this.cursor("pointer");else if("scroll"===i){if(this.cursor("s-resize"),this.modeScroll(1),this.isDown)this.modeScroll(2),this.update(e.clientY-(this.zone.y+this.baseH-2)-.5*this.sh)}else this.modeTitle(0),this.modeScroll(0),this.cursor("pointer");return i!==this.prevName&&(t=!0),this.prevName=i,t},wheel:function(e){return"title"!==this.testZone(e)&&(this.py+=10*e.delta,this.update(this.py),!0)},reset:function(){this.prevName="",this.unSelected(),this.modeTitle(0),this.modeScroll(0)},modeScroll:function(e){if(e!==this.sMode){switch(e){case 0:this.scroller.style.background=this.buttonColor;break;case 1:this.scroller.style.background=this.colors.select;break;case 2:this.scroller.style.background=this.colors.down}this.sMode=e}},modeTitle:function(e){if(e!==this.tMode){var t=this.s;switch(e){case 0:t[3].color=this.fontColor,t[3].background=this.buttonColor;break;case 1:t[3].color="#FFF",t[3].background=this.colors.select;break;case 2:t[3].color=this.fontColor,t[3].background=this.colors.down}this.tMode=e}},clearList:function(){for(;this.listIn.children.length;)this.listIn.removeChild(this.listIn.lastChild);this.items=[]},setList:function(e){var t,i;this.clearList(),this.list=e,this.length=this.list.length,this.maxItem=this.full?this.length:5,this.maxItem=this.length<this.maxItem?this.length:this.maxItem,this.maxHeight=this.maxItem*(this.itemHeight+1)+2,this.max=this.length*(this.itemHeight+1)+2,this.ratio=this.maxHeight/this.max,this.sh=this.maxHeight*this.ratio,this.range=this.maxHeight-this.sh,this.c[2].style.height=this.maxHeight+"px",this.scroller.style.height=this.sh+"px",this.maxHeight<this.max&&(this.ww=this.sb-20,this.scroll=!0);for(var r=0;r<this.length;r++)i=this.list[r],(t=this.dom("div",this.css.item+"width:"+this.ww+"px; height:"+this.itemHeight+"px; line-height:"+(this.itemHeight-5)+"px; color:"+this.fontColor+";")).name="item"+r,t.id=r,t.posy=(this.itemHeight+1)*r,this.listIn.appendChild(t),this.items.push(t),this.isWithImage||(t.textContent=i);this.setTopItem()},addImages:function(){for(var e=this.list.length,t=0;t<e;t++)this.items[t].appendChild(this.tmpImage[this.list[t]]);this.setTopItem()},setTopItem:function(){if(this.isWithImage){if(!this.preLoadComplete)return;this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.canvas.style.cssText="position:absolute; top:0px; left:0px;",this.ctx=this.canvas.getContext("2d"),this.c[3].appendChild(this.canvas));this.ctx.drawImage(this.tmpImage[this.value],0,0,this.imageSize[2],this.imageSize[3],0,0,this.imageSize[0],this.imageSize[1])}else this.c[3].textContent=this.value},update:function(e){this.scroll&&(e=this.range<(e=e<0?0:e)?this.range:e,this.topList=-Math.floor(e/this.ratio),this.listIn.style.top=this.topList+"px",this.scroller.style.top=Math.floor(e)+"px",this.py=e)},parentHeight:function(e){null!==this.parentGroup?this.parentGroup.calc(e):this.isUI&&this.main.calc(e)},open:function(){Proto.prototype.open.call(this),this.update(0),this.h=this.maxHeight+this.baseH+5,this.scroll?this.scroller.style.display="block":(this.topList=0,this.h=this.baseH+5+this.max,this.scroller.style.display="none"),this.s[0].height=this.h+"px",this.s[2].display="block",this.up?(this.zone.y-=this.h-(this.baseH-10),this.setSvg(this.c[4],"d",this.svgs.arrowUp)):this.setSvg(this.c[4],"d",this.svgs.arrowDown),this.rSizeContent();var e=this.h-this.baseH;this.zone.h=this.h,this.parentHeight(e)},close:function(){Proto.prototype.close.call(this),this.up&&(this.zone.y+=this.h-(this.baseH-10));var e=this.h-this.baseH;this.h=this.baseH,this.s[0].height=this.h+"px",this.s[2].display="none",this.setSvg(this.c[4],"d",this.svgs.arrow),this.zone.h=this.h,this.parentHeight(-e)},text:function(e){this.c[3].textContent=e},rSizeContent:function(){for(var e=this.length;e--;)this.listIn.children[e].style.width=this.ww+"px"},rSize:function(){Proto.prototype.rSize.call(this);var e=this.s,t=this.sb,i=this.sa;void 0!==e[2]&&(e[2].width=t+"px",e[2].left=i+"px",e[3].width=t+"px",e[3].left=i+"px",e[4].left=i+t-17+"px",this.ww=t,this.maxHeight<this.max&&(this.ww=t-20),this.isOpen&&this.rSizeContent())}}),Numeric.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Numeric,testZone:function(){var e=this.local;if(-1===e.x&&-1===e.y)return"";for(var t=this.lng,i=this.tmp;t--;)if(i[t][0]<e.x&&e.x<i[t][2])return t;return""},mode:function(e,t){return e!==this.cMode[t]&&(this.reset(),this.cMode[t]=e,!0)},mousedown:function(e){var t=this.testZone(e);return""!==t&&(this.current=t,this.isDown=!0,this.prev={x:e.clientX,y:e.clientY,d:0,v:this.isNumber?parseFloat(this.value):parseFloat(this.value[this.current])},this.mode(2,t))},mouseup:function(e){var t=this.testZone(e);if(this.isDown=!1,-1!==this.current){var i=this.prev.d;return this.current=-1,this.prev={x:0,y:0,d:0,v:0},i?this.reset():(this.setInput(this.c[t+2],function(){this.testValue()}.bind(this)),!0)}},mousemove:function(e){var t=!1,i=this.testZone(e);""===i?(t=this.reset(),this.cursor()):(t=this.mode(1,i),this.cursor(-1!==this.current?"move":"pointer")),-1!==this.current&&(this.prev.d+=e.clientX-this.prev.x-(e.clientY-this.prev.y),this.value[this.current]=this.numValue(this.prev.v+this.prev.d*this.step),this.c[2+this.current].textContent=this.value[this.current],this.validate(),this.prev.x=e.clientX,this.prev.y=e.clientY,t=!0);return t},keydown:function(){return!0},reset:function(){var e=!1;this.isDown=!1;for(var t=this.lng;t--;)0!==this.cMode[t]&&(e=!(this.cMode[t]=0));return e},setValue:function(e,t){this.value[t=t||0]=this.numValue(e),this.c[2+t].textContent=this.value[t]},testValue:function(){for(var e=this.lng;e--;)if(isNaN(this.c[2+e].textContent))this.c[2+e].textContent=this.value[e];else{var t=this.numValue(this.c[2+e].textContent);this.c[2+e].textContent=t,this.value[e]=t}this.validate()},validate:function(){for(var e=[],t=this.lng;t--;)e[t]=this.value[t]*this.toRad;this.send(this.isNumber?e[0]:e)},rSize:function(){Proto.prototype.rSize.call(this);for(var e=Math.floor((this.sb+5)/this.lng)-5,t=this.s,i=this.lng;i--;)this.tmp[i]=[Math.floor(this.sa+e*i+5*i),e],this.tmp[i][2]=this.tmp[i][0]+this.tmp[i][1],t[2+i].left=this.tmp[i][0]+"px",t[2+i].width=this.tmp[i][1]+"px"}}),Slide.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Slide,testZone:function(){var e=this.local;return-1===e.x&&-1===e.y?"":this.txl<=e.x?"text":this.sa<=e.x?"scroll":""},mouseup:function(){this.isDown&&(this.isDown=!1)},mousedown:function(e){var t=this.testZone(e);return!!t&&("scroll"===t&&(this.isDown=!0,this.old=this.value,this.mousemove(e)),"text"===t&&this.setInput(this.c[2],function(){this.validate()}.bind(this)),!0)},mousemove:function(e){var t=!1,i=this.testZone(e);if("scroll"===i?(this.mode(1),this.cursor("w-resize")):"text"===i?this.cursor("pointer"):this.cursor(),this.isDown){var r=(e.clientX-(this.zone.x+this.sa)-3)/this.ww*this.range+this.min-this.old;(this.step<=r||r<=this.step)&&(r=Math.floor(r/this.step),this.value=this.numValue(this.old+r*this.step),this.update(!0),this.old=this.value),t=!0}return t},keydown:function(){return!0},validate:function(){var e=this.c[2].textContent;isNaN(e)?this.c[2].textContent=this.value:(this.value=this.numValue(e),this.update(!0))},reset:function(){this.isDown=!1,this.mode(0)},mode:function(e){var t=this.s;switch(e){case 0:t[2].color=this.fontColor,t[4].background=this.colors.scrollback,t[5].background=this.fontColor;break;case 1:t[2].color=this.colorPlus,t[4].background=this.colors.scrollbackover,t[5].background=this.colorPlus}},update:function(e){var t=Math.floor(this.ww*((this.value-this.min)/this.range));3!==this.model&&(this.s[5].width=t+"px"),this.s[6]&&(this.s[6].left=this.sa+t+3+"px"),this.c[2].textContent=this.value,e&&this.send()},rSize:function(){Proto.prototype.rSize.call(this);var e=this.sb-this.sc;this.ww=e-6;var t=this.sc;!this.isUI&&this.simple||(t=this.sc+10),this.txl=this.w-t+2;var i=this.s;i[2].width=this.sc-6+"px",i[2].left=this.txl+4+"px",i[3].left=this.sa+"px",i[3].width=e+"px",i[4].left=this.sa+"px",i[4].width=e+"px",i[5].left=this.sa+3+"px",this.update()}}),TextInput.prototype=Object.assign(Object.create(Proto.prototype),{constructor:TextInput,mousedown:function(){return this.setInput(this.c[2],function(){this.validate()}.bind(this)),this.mode(2)},mousemove:function(){return this.mode(1)},keydown:function(){return!0},mode:function(e){return e!==this.cmode&&(this.cmode=e,!0)},reset:function(){this.mode(0)},rSize:function(){Proto.prototype.rSize.call(this);var e=this.s;e[2].color=this.fontColor,e[2].left=this.sa+"px",e[2].width=this.sb+"px",e[2].height=this.h-4+"px",e[2].lineHeight=this.h-8+"px"},validate:function(){this.value=this.c[2].textContent,this.send()}}),Title.prototype=Object.assign(Object.create(Proto.prototype),{constructor:Title,text:function(e){this.c[1].textContent=e},text2:function(e){this.c[2].textContent=e},rSize:function(){Proto.prototype.rSize.call(this),this.s[1].width=this.w-50+"px",this.s[2].left=this.w-76+"px"}}),Object.assign(Gui.prototype,{constructor:Gui,isGui:!0,dispose:function(){this.clear(),null!==this.parent&&this.parent.removeChild(this.content),Roots.remove(this)},onDraw:function(){},makeCanvas:function(){this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.canvas.width=this.zone.w,this.canvas.height=this.forceHeight?this.forceHeight:this.zone.h},draw:function(e){null!==this.canvas&&Roots.toCanvas(this,this.zone.w,this.forceHeight?this.forceHeight:this.zone.h,e)},getDom:function(){return this.content},setMouse:function(e){this.mouse.set(e.x,e.y)},setText:function(e,t,i){Tools.setText(e,t,i)},hide:function(e){this.content.style.display=e?"none":"block"},onChange:function(e){return this.callback=e,this},mode:function(e){var t=!1;if(e!==this.cn){switch(this.cn=e){case"def":this.scroll.style.background=this.colors.scroll,this.bottom.style.background=this.colors.background,this.bottom.style.color=this.colors.text;break;case"scrollOver":this.scroll.style.background=this.colors.select;break;case"scrollDown":this.scroll.style.background=this.colors.down;break;case"bottomOver":this.bottom.style.background=this.colors.backgroundOver,this.bottom.style.color="#FFF"}t=!0}return t},clearTarget:function(){return-1!==this.current&&(this.target.uiout(),this.target.reset(),this.target=null,this.current=-1,Roots.cursor(),!0)},testZone:function(){var e=this.local;if(-1===e.x&&-1===e.y)return"";this.isReset=!1;return this.zone.h-this.bh<e.y&&e.y<this.zone.h?"bottom":(this.isScroll?this.zone.w-this.size.s:this.zone.w)<e.x?"scroll":"content"},handleEvent:function(e){var t=e.type,i=!1,r=!1,n=this.testZone(e);if("mouseup"===t&&this.isDown&&(this.isDown=!1),"mousedown"!==t||this.isDown||(this.isDown=!0),this.isDown&&this.isNewTarget&&(Roots.clearInput(),this.isNewTarget=!1),n){switch(n){case"content":e.clientY=this.isScroll?e.clientY+this.decal:e.clientY,Roots.isMobile&&"mousedown"===t&&this.getNext(e,i),this.target&&(r=this.target.handleEvent(e)),"mousemove"===t&&(i=this.mode("def")),"wheel"===t&&!r&&this.isScroll&&(i=this.onWheel(e)),Roots.lock||this.getNext(e,i);break;case"bottom":this.clearTarget(),"mousemove"===t&&(i=this.mode("bottomOver")),"mousedown"===t&&(this.isOpen=!this.isOpen,this.bottom.textContent=this.isOpen?"close":"open",this.setHeight(),this.mode("def"),i=!0);break;case"scroll":this.clearTarget(),"mousemove"===t&&(i=this.mode("scrollOver")),"mousedown"===t&&(i=this.mode("scrollDown")),"wheel"===t&&(i=this.onWheel(e)),this.isDown&&this.update(e.clientY-this.zone.y-.5*this.sh)}this.isDown&&(i=!0),r&&(i=!0),i&&this.draw()}},getNext:function(e){var t=Roots.findTarget(this.uis,e);t!==this.current&&(this.clearTarget(),this.current=t,this.isNewTarget=!0),-1!==t&&(this.target=this.uis[this.current],this.target.uiover())},onWheel:function(e){return this.oy+=20*e.delta,this.update(this.oy),!0},reset:function(){if(!this.isReset){this.mouse.neg(),this.isDown=!1;var e=this.mode("def"),t=this.clearTarget();(e||t)&&this.draw(!0),this.isReset=!0}},add:function(){var e=arguments;"object"===_typeof(e[1])?(e[1].isUI=!0,e[1].main=this):"string"==typeof e[1]&&(void 0===e[2]?[].push.call(e,{isUI:!0,main:this}):(e[2].isUI=!0,e[2].main=this));var t=_add.apply(this,e);if(null!==t){if(this.uis.push(t),t.autoWidth)this.prevY=0,this.calc(t.h+1);else{var i=t.c[0].getBoundingClientRect().top;this.prevY!==i&&(this.calc(t.h+1),this.prevY=i)}return t}},applyCalc:function(){this.calc(this.tmpH),this.tmpAdd=null},calcUis:function(){Roots.calcUis(this.uis,this.zone,this.zone.y)},remove:function(e){var t=this.uis.indexOf(e);-1!==t&&this.uis[t].clear()},clearOne:function(e){var t=this.uis.indexOf(e);-1!==t&&(this.inner.removeChild(this.uis[t].c[0]),this.uis.splice(t,1))},clear:function(){for(var e=this.uis.length;e--;)this.uis[e].clear();this.uis=[],Roots.listens=[],this.calc(-this.h)},upScroll:function(e){this.sw=e?this.size.s:0,this.oy=e?this.oy:0,this.scrollBG.style.display=e?"block":"none",e&&(this.total=this.h,this.maxView=this.maxHeight,this.ratio=this.maxView/this.total,this.sh=this.maxView*this.ratio,this.range=this.maxView-this.sh,this.oy=Tools.clamp(this.oy,0,this.range),this.scrollBG.style.height=this.maxView+"px",this.scroll.style.height=this.sh+"px"),this.setItemWidth(this.zone.w-this.sw),this.update(this.oy)},update:function(e){e=Tools.clamp(e,0,this.range),this.decal=Math.floor(e/this.ratio),this.inner.style.top=-this.decal+"px",this.scroll.style.top=Math.floor(e)+"px",this.oy=e},calc:function(e){this.h+=e,clearTimeout(this.tmp),this.tmp=setTimeout(this.setHeight.bind(this),10)},setHeight:function(){if(this.tmp&&clearTimeout(this.tmp),this.zone.h=this.bh,this.isScroll=!1,this.isOpen){var e=this.forceHeight?this.forceHeight:window.innerHeight;this.maxHeight=e-this.zone.y-this.bh,1<this.h-this.maxHeight?(this.isScroll=!0,this.zone.h=this.maxHeight+this.bh):this.zone.h=this.h+this.bh}this.upScroll(this.isScroll),this.innerContent.style.height=this.zone.h-this.bh+"px",this.content.style.height=this.zone.h+"px",this.bottom.style.top=this.zone.h-this.bh+"px",this.isOpen&&this.calcUis(),this.isCanvas&&this.draw(!0)},setWidth:function(e){e&&(this.zone.w=e),this.content.style.width=this.zone.w+"px",this.isCenter&&(this.content.style.marginLeft=-Math.floor(.5*this.zone.w)+"px"),this.setItemWidth(this.zone.w-this.sw),this.setHeight(),this.isCanvasOnly||(Roots.needReZone=!0)},setItemWidth:function(e){for(var t=this.uis.length;t--;)this.uis[t].setSize(e),this.uis[t].rSize()}});var WGui=function(){var i,t,r,n,a,o,s,l,c,h,u,d,e=!!("ontouchstart"in window),p=!!window.PointerEvent,m=!!window.MSPointerEvent,f=!1,g=null,v=null,y=null,x=null,_=function(){},b="#DE5825",w="-o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select: none;";d=p?{start:"pointerdown",move:"pointermove",end:"pointerup"}:m?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:e?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"};var M={};function S(e){console.log("mode=="+e)}M.distance=function(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},M.angle=function(e,t){return M.degrees(Math.atan2(t.y-e.y,t.x-e.x))},M.findCoord=function(e,t,i){var r={x:0,y:0};return i=M.radians(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},M.radians=function(e){return e*(Math.PI/180)},M.degrees=function(e){return e*(180/Math.PI)},M.bindEvt=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent(t,i)},M.unbindEvt=function(e,t,i){e.removeEventListener?e.removeEventListener(t,i):e.detachEvent&&e.detachEvent(t,i)},M.trigger=function(e,t,i){var r=new CustomEvent(t,i);e.dispatchEvent(r)},M.prepareEvent=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},M.getScroll=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},M.applyPosition=function(e,t){t.x&&t.y?(e.style.left=t.x+"px",e.style.top=t.y+"px"):(t.top||t.right||t.bottom||t.left)&&(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left)},M.getTransitionStyle=function(e,t,i){var r=M.configStylePropertyObject(e);for(var n in r)if(r.hasOwnProperty(n))if("string"==typeof t)r[n]=t+" "+i;else{for(var a="",o=0,s=t.length;o<s;o+=1)a+=t[o]+" "+i+", ";r[n]=a.slice(0,-2)}return r},M.getVendorStyle=function(e,t){var i=M.configStylePropertyObject(e);for(var r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},M.configStylePropertyObject=function(t){var i={};i[t]="";return["webkit","Moz","o"].forEach(function(e){i[e+t.charAt(0).toUpperCase()+t.slice(1)]=""}),i},M.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},M.safeExtend=function(e,t){var i={};for(var r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},M.map=function(e,t){if(e.length)for(var i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)};function T(){this.isFullScreen=!1,this.extraMode=""}var A,E,C,L;return T.update=function(){g.update()},T.init=function(){(g=new Gui({size:250,color:"no",height:30})).callbackClose=T.draw,(x=document.createElement("div")).style.cssText="position: absolute; bottom:10px; left:0px; pointer-events:none; width:100%; height:30px; display:none",document.body.appendChild(x),(v=document.createElement("canvas")).width=100,v.height=40,v.style.cssText="position: absolute; top:0; left:0; pointer-events:none; width:100px; height:30px; opacity:0.8; ",y=v.getContext("2d"),(s=document.createElement("div")).style.cssText=w+"position:absolute; right:0; bottom:0;",document.body.appendChild(s),(l=document.createElement("div")).style.cssText=w+"position:absolute; left:0; bottom:0;",document.body.appendChild(l),(r=document.createElement("div")).style.cssText=w+"width:150px; font-size: 10px; position:absolute;  bottom:9px; color:#000000; text-align:left; left:21px",l.appendChild(r),(t=document.createElement("div")).style.cssText=w+"width:150px; font-size: 10px; position:absolute; bottom:10px; color:"+b+"; text-align:left; left:70px",l.appendChild(t),(n=document.createElement("div")).style.cssText=w+"position:absolute; font-size: 14px;  bottom: 24px; color:#888988; text-shadow: 1px 1px #000000; text-align:right; right:50px",s.appendChild(n),(o=document.createElement("div")).style.cssText=w+"width:150px; font-size: 10px; position:absolute;  bottom:9px; color:#000000; text-align:right; right:49px",s.appendChild(o),(a=document.createElement("div")).style.cssText=w+"width:150px; font-size: 10px; position:absolute; bottom:10px; color:#787978; text-align:right; right:50px",s.appendChild(a),(A=document.createElement("div")).className="progress",E=document.createElement("div"),L=document.createElement("span"),E.appendChild(L);var e=document.createElement("div");e.className="progressbar shadow",(C=document.createElement("div")).className="bar shadow",e.appendChild(C),E.appendChild(e),A.appendChild(E),document.body.appendChild(A),this.hideProcess(),this.basicMenu()},T.showProcess=function(e,t,i){var r=250;r=Math.floor(r*e/t),C.style.width=r+"px",E.style.display=L.style.display="block",L.innerHTML=i},T.hideProcess=function(){E.style.display=L.style.display="none"},T.showDebugPanel=function(e){g.hide(!e),g.update()},T.resize=function(e){},T.icon=function(e,t,i,r){var n=i=i||40;t=t||"#DEDEDE";var a="0 0 "+(r=r||40)+" "+r,o="";"3TH"===e&&(a="0 0 100 50",i=60,n=30,o="<filter id='f1' x='0' y='0' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='1' dy='1' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='1' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter>");var s=["<svg xmlns='http://www.w3.org/2000/svg' version='1.1' xmlns:xlink='http://www.w3.org/1999/xlink' style='pointer-events:none;' preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='"+i+"px' height='"+n+"px' viewBox='"+a+"'>"+o+"<g>"];switch(e){case"save":s[1]="<path stroke='"+t+"' stroke-width='4' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 26.125 17 L 20 22.95 14.05 17 M 20 9.95 L 20 22.95'/>",s[1]+="<path stroke='"+t+"' stroke-width='2.5' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 32.6 23 L 32.6 25.5 Q 32.6 28.5 29.6 28.5 L 10.6 28.5 Q 7.6 28.5 7.6 25.5 L 7.6 23'/>";break;case"scrIn":s[1]="<path fill='rgba(0,0,0,0.5)' stroke='none' d='M 3 20 L 1 20 1 30 11 30 11 28 3 28 3 20 M 11 3 L 11 1 1 1 1 11 3 11 3 3 11 3 M 30 11 L 30 1 20 1 20 3 28 3 28 11 30 11 M 30 20 L 28 20 28 28 20 28 20 30 30 30 30 20 M 24 22 L 24 9 7 9 7 22 24 22 M 22 11 L 22 20 9 20 9 11 22 11 Z'/>",s[1]+="<path fill='"+t+"' stroke='none' d='M 23 21 L 23 8 6 8 6 21 23 21 M 21 10 L 21 19 8 19 8 10 21 10 M 2 19 L 0 19 0 29 10 29 10 27 2 27 2 19 M 10 2 L 10 0 0 0 0 10 2 10 2 2 10 2 M 29 19 L 27 19 27 27 19 27 19 29 29 29 29 19 M 27 10 L 29 10 29 0 19 0 19 2 27 2 27 10 Z'/>";break;case"scrOut":s[1]="<path fill='rgba(0,0,0,0.5)' stroke='none' d='M 30 1 L 1 1 1 30 30 30 30 1 M 3 3 L 28 3 28 28 3 28 3 3 M 9 17 L 7 17 7 22 12 22 12 20 9 20 9 17 M 12 11 L 12 9 7 9 7 14 9 14 9 11 12 11 M 22 14 L 24 14 24 9 19 9 19 11 22 11 22 14 M 24 17 L 22 17 22 20 19 20 19 22 24 22 24 17 Z'/>",s[1]+="<path fill='"+t+"' stroke='none' d='M 29 0 L 0 0 0 29 29 29 29 0 M 27 27 L 2 27 2 2 27 2 27 27 M 8 16 L 6 16 6 21 11 21 11 19 8 19 8 16 M 11 10 L 11 8 6 8 6 13 8 13 8 10 11 10 M 21 16 L 21 19 18 19 18 21 23 21 23 16 21 16 M 21 10 L 21 13 23 13 23 8 18 8 18 10 21 10 Z'/>";break;case"shoot":s[1]="<path fill='rgba(0,0,0,0.5)' stroke='none' d='M 12.1 11.1 Q 11.9 11.55 10.7 11.9 9.5 12.2 10.4 13.15 12.45 14.3 12 14.8 11.55 15 11.15 15.4 10.15 16.4 10.15 17.85 10.15 19.3 11.15 20.3 12.15 21.3 13.6 21.3 L 17.3 21.3 Q 21.1 21.1 21.45 16.25 21.85 14.05 19.7 14.65 17.35 15.5 16.5 14.35 16.6 14.3 16.65 14.2 17.5 13.4 17.5 12.25 17.5 11.05 16.65 10.25 15.85 9.45 14.7 9.45 13.5 9.45 12.7 10.25 12.35 10.6 12.15 11.1 L 12.1 11.1 M 3 18 L 3 24 7 28 13 28 13 26 8 26 5 23 5 18 3 18 M 13 5 L 13 3 7 3 3 7 3 13 5 13 5 8 8 5 13 5 M 28 18 L 26 18 26 23 23 26 18 26 18 28 24 28 28 24 28 18 M 23 5 L 26 8 26 13 28 13 28 7 24 3 18 3 18 5 23 5 M 14.5 25 L 14.5 30 16.5 30 16.5 25 14.5 25 M 1 14.5 L 1 16.5 6 16.5 6 14.5 1 14.5 M 16.5 6 L 16.5 1 14.5 1 14.5 6 16.5 6 M 30 14.5 L 25 14.5 25 16.5 30 16.5 30 14.5 Z'/>",s[1]+="<path fill='"+t+"' stroke='none' d='M 11.1 10.05 L 11.1 10.1 Q 10.9 10.57 9.7 10.85 8.5 11.2 9.4 12.15 11.48 13.3 10.95 13.75 10.53 14 10.15 14.4 9.15 15.4 9.15 16.85 9.15 18.3 10.15 19.3 11.15 20.3 12.6 20.3 L 16.3 20.3 Q 20.1 20.1 20.45 15.25 20.8625 13 18.7 13.65 16.36 14.5 15.5 13.35 15.57 13.27 15.65 13.2 16.5 12.4 16.5 11.25 16.5 10.05 15.65 9.25 14.85 8.45 13.7 8.45 12.5 8.45 11.7 9.25 11.33 9.61 11.1 10.05 M 2 17 L 2 23 6 27 12 27 12 25 7 25 4 22 4 17 2 17 M 12 4 L 12 2 6 2 2 6 2 12 4 12 4 7 7 4 12 4 M 27 17 L 25 17 25 22 22 25 17 25 17 27 23 27 27 23 27 17 M 22 4 L 25 7 25 12 27 12 27 6 23 2 17 2 17 4 22 4 M 5 15.5 L 5 13.5 0 13.5 0 15.5 5 15.5 M 15.5 24 L 13.5 24 13.5 29 15.5 29 15.5 24 M 15.5 5 L 15.5 0 13.5 0 13.5 5 15.5 5 M 24 13.5 L 24 15.5 29 15.5 29 13.5 24 13.5 Z'/>";break;case"picker":s[1]="<path fill='rgba(0,0,0,0.5)' stroke='none' d='M 7.15 14.25 L 5.75 12.85 2.95 15.65 4.35 17.05 7.15 14.25 M 5 9 L 1 9 1 11 5 11 5 9 M 4.35 2.95 L 2.95 4.35 5.75 7.15 7.15 5.75 4.35 2.95 M 14.25 7.15 L 17.05 4.35 15.65 2.95 12.85 5.75 14.25 7.15 M 11 5 L 11 1 9 1 9 5 11 5 M 22.9 19.9 L 28 17 10 10 17 28 19.9 22.9 26 29 29 26 22.9 19.9 M 19 20 L 17 24 13 13 24 17 20 19 27 26 26 27 19 20 Z'/>",s[1]+="<path fill='"+t+"' stroke='none' d='M 3.35 16.05 L 6.15 13.25 4.75 11.85 1.95 14.65 3.35 16.05 M 4 10 L 4 8 0 8 0 10 4 10 M 3.35 1.95 L 1.95 3.35 4.75 6.15 6.15 4.75 3.35 1.95 M 8 4 L 10 4 10 0 8 0 8 4 M 16.05 3.35 L 14.65 1.95 11.85 4.75 13.25 6.15 16.05 3.35 M 21.9 18.9 L 27 16 9 9 16 27 18.9 21.9 25 28 28 25 21.9 18.9 M 18 19 L 16 23 12 12 23 16 19 18 26 25 25 26 18 19 Z'/>"}return s[2]="</g></svg>",s.join("\n")},T.roundRect=function(e,t,i,r,n,a,o){void 0===n&&(n=5),y.beginPath(),y.moveTo(e+n,t),y.lineTo(e+i-n,t),y.quadraticCurveTo(e+i,t,e+i,t+n),y.lineTo(e+i,t+r-n),y.quadraticCurveTo(e+i,t+r,e+i-n,t+r),y.lineTo(e+n,t+r),y.quadraticCurveTo(e,t+r,e,t+r-n),y.lineTo(e,t+n),y.quadraticCurveTo(e,t,e+n,t),y.closePath(),y.fill()},T.log=function(e){r.textContent=t.textContent=e},T.tell=function(e){o.textContent=a.textContent=e},T.basicMenu=function(){g.clear(),g.add("title",{name:"",prefix:"V20200504",h:20,r:10}),g.add("fps",{height:30}),g.add("button",{name:"",p:70,h:30,r:10}).onChange(function(){g.hide(!0)}),g.add("bool",{name:"",p:70,h:20,value:!1}).onChange(function(e){window.WEngine.showAxisHelper(e)}),g.add("bool",{name:"",p:70,h:20,value:!1}).onChange(function(e){window.WEngine.enableClickMeasure(e)}),g.add("slide",{name:"24",min:0,max:24,value:12,step:.01,precision:2,mode:1}).onChange(function(e){window.WEngine.setHour(e)}),g.add("bool",{name:"",p:70,h:20,value:!1}).onChange(function(e){window.WEngine.switchLightHelper(e)}),g.add("bool",{name:"",p:70,h:20,value:!0}).onChange(function(e){window.WEngine.view.showShadow(e)}),g.add("bool",{name:"",p:70,h:20,value:!0,inh:16}).onChange(function(e){window.WEngine.currentFollow.userData.avatar.model.visible?window.WEngine.currentFollow.userData.avatar.model.visible=!1:window.WEngine.currentFollow.userData.avatar.model.visible=!0}),g.add("bool",{name:"",p:70,h:20,value:!1,inh:16}).onChange(function(e){var t;f=t=e,window.WEngine.view.setCameraFollowBehind(t)}),g.add("bool",{name:"",p:70,h:20,value:!1,bg:"rgba(0,255,0,0.8)"}).onChange(function(e){window.WEngine.enableDDLSDebug(e)}),g.add("bool",{name:"",p:70,h:20,value:!1,inh:16}).onChange(function(e){null==window.WEngine.currentFollow.userData.avatar.helper?window.WEngine.currentFollow.userData.avatar.addHelper():window.WEngine.currentFollow.userData.avatar.removeHelper()}),this.initUI_Effect(),this.initUI_Physics(),this.initUI_BVH(),this.initUI_HOLO(g),this.initFullBtn(),this.addExtraOption(S)},T.initFullBtn=function(){(i=document.createElement("div")).style.cssText="position:absolute; width:30px; height:30px; right:10px; bottom:10px; pointer-events:auto; cursor:pointer; ",i.innerHTML=this.icon("scrIn","#787978",30,30),s.appendChild(i);var t=this;i.addEventListener("click",function(){if(t.isFullScreen)"exitFullscreen"in document?document.exitFullscreen():"webkitExitFullscreen"in document?document.webkitExitFullscreen():"mozCancelFullScreen"in document?document.mozCancelFullScreen():"msExitFullscreen"in document&&document.msExitFullscreen();else if(("fullscreenEnabled"in document||"webkitFullscreenEnabled"in document||"mozFullScreenEnabled"in document||"msFullscreenEnabled"in document)&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)){var e=document.body;"requestFullscreen"in e?e.requestFullscreen():"webkitRequestFullscreen"in e?e.webkitRequestFullscreen():"mozRequestFullScreen"in e?e.mozRequestFullScreen():"msRequestFullscreen"in e&&e.msRequestFullscreen()}},!1),i.addEventListener("mouseover",function(){this.innerHTML=t.icon(t.isFullScreen?"scrOut":"scrIn",b,30,30)},!1),i.addEventListener("mouseout",function(){this.innerHTML=t.icon(t.isFullScreen?"scrOut":"scrIn","#787978",30,30)},!1);function e(){t.isFullScreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement),i.innerHTML=t.icon(t.isFullScreen?"scrOut":"scrIn","#787978",30,30)}document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1)},T.addExtraOption=function(e){var t=this;_=e,(c=document.createElement("div")).style.cssText="position:absolute; width:30px; height:30px; right:10px; bottom:50px; pointer-events:auto; cursor:pointer; ",c.innerHTML=t.icon("shoot","#383938",30,30),s.appendChild(c),(h=document.createElement("div")).style.cssText="position:absolute; width:30px; height:30px; right:10px; bottom:90px; pointer-events:auto; cursor:pointer; ",h.innerHTML=t.icon("picker","#383938",30,30),s.appendChild(h),c.addEventListener("click",function(){t.toggleExtraMode("shoot")},!1),c.addEventListener("mouseover",function(){this.innerHTML=t.icon("shoot",b,30,30)},!1),c.addEventListener("mouseout",function(){this.innerHTML=t.icon("shoot","shoot"===t.extraMode?"#787978":"#383938",30,30)},!1),h.addEventListener("click",function(){t.toggleExtraMode("picker")},!1),h.addEventListener("mouseover",function(){this.innerHTML=t.icon("picker",b,30,30)},!1),h.addEventListener("mouseout",function(){this.innerHTML=t.icon("picker","picker"===t.extraMode?"#787978":"#383938",30,30)},!1)},T.toggleExtraMode=function(e){this.extraMode=e!==this.extraMode?e:"",c.innerHTML=this.icon("shoot","shoot"===this.extraMode?"#787978":"#383938",30,30),h.innerHTML=this.icon("picker","picker"===this.extraMode?"#787978":"#383938",30,30),_(this.extraMode)},T.initPauseBtn=function(){},T.initUI_scenes=function(){var i,r={},n=[];window.world.scenes.forEach(function(e,t){n.push(e.cname),r[e.cname]=e.ename,e.ename==window.world.currentSceneName&&(i=e.cname)}),_add("list",{target:document.body,pos:{left:"120px",top:"auto",bottom:"10px"},name:"",list:n,value:i,p:40,height:30,simple:!0,side:"up",type:"html",callback:function(e){window.WEngine.scene.load(r[e])}})},T.initUI_Effect=function(){g.add("group",{name:"",bg:"rgba(120,80,80,0.8)"}).add("bool",{name:"",p:70,h:20,inh:16,value:!1}).onChange(function(e){window.WEngine.view.enableOutlineEffect(e)})},T.initUI_Physics=function(){var e=g.add("group",{name:"",bg:"rgba(120,80,80,0.8)"});e.add("bool",{name:"",p:70,h:20,inh:16,value:!1}).onChange(function(e){window.WEngine.showHeroCapsule(e)}),e.add("bool",{name:"",p:70,h:20,inh:16,value:!1}).onChange(function(e){window.WEngine.showAmmoSkeleton(e)}),e.add("bool",{name:"",p:70,h:20,inh:16,value:!1}).onChange(function(e){window.WEngine.showPhysicInfo(e)})},T.initUI_BVH=function(){var e=g.add("group",{name:"BVH",bg:"rgba(120,120,80,0.8)"}),i=e.add("bool",{name:"",p:70,h:20,value:!1}).onChange(function(e){window.WEngine.currentFollow.userData.avatar.enableTestBvhData(e)});e.add("button",{name:"LOAD",p:4,h:30,r:10,loader:!0,drag:!0}).onChange(function(e,t){i.value||(i.value=!0,i.update()),window.WEngine.currentFollow.userData.avatar.loadAndPlayBvhData(e,t)}),e.add("slide",{name:"speed",min:0,max:1.5,value:1,precision:2,fontColor:"#D4B87B",stype:1,bColor:"#999"}).onChange(function(e){window.WEngine.currentFollow.userData.avatar.setBvhPlaySpeed(e)})},T.initUI_HOLO=function(e){var t=e.add("group",{name:"",bg:"rgba(120,100,80,0.8)"}),i=t.add("bool",{name:"",p:70,h:20,value:!1}).onChange(function(e){r.value=!1,r.update(),window.WEngine.enableHoloEffect(e,4)}),r=t.add("bool",{name:"",p:70,h:20,value:!1}).onChange(function(e){i.value=!1,i.update(),window.WEngine.enableHoloEffect(e,3)})},T.reset=function(){this.removeJoystick(),this.clearBtns()},T.addControl=function(e,t){switch(e.type){case"joystick":this.addJoystick(e);break;case"toggleButton":this.addToggleButton(e)}},T.addBtns=function(e){if(null!=e&&0<e.length){e.forEach(function(e,t){var i=document.createElement("div");i.style.cssText="color:#CCC; margin-left:5px; margin-right:5px; padding-top:10px; position:relative; pointer-events:auto; width:100px; height:20px; display:inline-block; text-align:center; font-size: 14px; cursor:pointer; letter-spacing: 1px;";var r=document.createElement("img");r.src="./assets/textures/"+e.btnimg,r.title=e.btnTitle,r.id=e.btnid,r.onclick=e.event,i.appendChild(r),x.appendChild(i)});for(var t=[],i=t.length,r=function(e){var t=document.getElementById("btn"+e);M.bindEvt(t,d.start,function(){window.WEngine.user.keyboard.setKeyFromBtns({key:e,type:"down"})}),M.bindEvt(t,d.end,function(){window.WEngine.user.keyboard.setKeyFromBtns({key:e,type:"up"})})};i--;)r(t[i])}},T.clearBtns=function(){for(;null!=x.firstChild;)x.removeChild(x.firstChild);x.style.display="none"},T.showBtns=function(){x.style.display="block"},T.addToggleButton=function(e){var t;(t=_add("button",{target:document.body,callback:function(){e.callback(t.selected),t.selected=!t.selected,t.label(t.selected?e.labels.sel:e.labels.def)},name:e.labels.def,w:e.w,h:e.h,pos:e.pos,simple:!0})).selected=!1},T.joyMove=function(e){f?(window.WEngine.user.key[0]=e[0],window.WEngine.user.key[1]=e[1]):(window.WEngine.user.key[1]=-Math.sqrt(e[0]*e[0]+e[1]*e[1]),.5<Math.abs(e[0])||.5<Math.abs(e[1])?window.WEngine.user.key[7]=1:window.WEngine.user.key[7]=0,0!=e[0]&&0!=e[1]&&window.WEngine.currentFollow&&window.WEngine.options({name:window.WEngine.currentFollow.name,type:"character",angle:Math.atan2(e[0],e[1])-window.WEngine.compassAngle-Math.Pi/2}))},T.addJoystick=function(e){f=e.isFollow,u=_add("joystick",{type:"joystick",target:document.body,pos:{left:"70px",top:"auto",bottom:"10px"},name:e.name||"MOVE",w:150,multiplicator:1,precision:2,fontColor:"#308AFF",mode:1}).onChange(this.joyMove).listen(),e.debug||(u.c[2].style.display="none")},T.removeJoystick=function(){null!=u&&(u.clear(),u=null)},T},StereoEffect=function(i){var r=new StereoCamera;r.aspect=.5;var n=new Vector2;this.setEyeSeparation=function(e){r.eyeSep=e},this.setSize=function(e,t){i.setSize(e,t)},this.render=function(e,t){e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),r.update(t),i.getSize(n),i.autoClear&&i.clear(),i.setScissorTest(!0),i.setScissor(0,0,n.width/2,n.height),i.setViewport(0,0,n.width/2,n.height),i.render(e,r.cameraL),i.setScissor(n.width/2,0,n.width/2,n.height),i.setViewport(n.width/2,0,n.width/2,n.height),i.render(e,r.cameraR),i.setScissorTest(!1)}},OutlineEffect=function(o,e){e=e||{},this.enabled=!0;var t=void 0!==e.defaultThickness?e.defaultThickness:.003,i=(new Color).fromArray(void 0!==e.defaultColor?e.defaultColor:[0,0,0]),r=void 0!==e.defaultKeepAlive&&e.defaultKeepAlive,s={},l=60,c={},h={},n={outlineThickness:{value:t},outlineColor:{value:i},outlineAlpha:{value:void 0!==e.defaultAlpha?e.defaultAlpha:1}},a=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tconst float ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}","void main() {","\t#include <uv_vertex>","\t#include <beginnormal_vertex>","\t#include <morphnormal_vertex>","\t#include <skinbase_vertex>","\t#include <skinnormal_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <displacementmap_vertex>","\t#include <project_vertex>","\tvec3 outlineNormal = - objectNormal;","\tgl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\t#include <fog_vertex>","}"].join("\n"),u=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\t#include <clipping_planes_fragment>","\t#include <logdepthbuf_fragment>","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","\t#include <premultiplied_alpha_fragment>","}"].join("\n");function d(e){var t=s[e.uuid];return void 0===t&&(t={material:new ShaderMaterial({type:"OutlineEffect",uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.displacementmap,n]),vertexShader:a,fragmentShader:u,side:BackSide}),used:!0,keepAlive:r,count:0},s[e.uuid]=t),t.used=!0,t.material}function p(e){var t=d(e);return function(e,t){if("invisible"===e.name)return;var i=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,e.toneMapped=t.toneMapped,e.premultipliedAlpha=t.premultipliedAlpha,e.displacementMap=t.displacementMap,void 0!==i?(e.visible=!1!==t.visible&&(void 0===i.visible||i.visible),e.transparent=void 0!==i.alpha&&i.alpha<1||t.transparent,void 0!==i.keepAlive&&(s[t.uuid].keepAlive=i.keepAlive)):(e.transparent=t.transparent,e.visible=t.visible);!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1);t.clippingPlanes&&(e.clipping=!0,e.clippingPlanes=t.clippingPlanes,e.clipIntersection=t.clipIntersection,e.clipShadows=t.clipShadows);e.version=t.version}(t,c[t.uuid]=e),t}function m(e){var t=e.geometry,i=!1;return void 0!==e.geometry&&(i=!t.isBufferGeometry||void 0!==t.attributes.normal),!0===e.isMesh&&void 0!==e.material&&!0===i}function f(e){if(!1!==m(e)){if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t]=p(e.material[t]);else e.material=p(e.material);h[e.uuid]=e.onBeforeRender,e.onBeforeRender=v}}function g(e){if(!1!==m(e)){if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t]=c[e.material[t].uuid];else e.material=c[e.material.uuid];e.onBeforeRender=h[e.uuid]}}function v(e,t,i,r,n){var a=c[n.uuid];void 0!==a&&function(e,t){var i=t.userData.outlineParameters;e.uniforms.outlineAlpha.value=t.opacity,void 0!==i&&(void 0!==i.thickness&&(e.uniforms.outlineThickness.value=i.thickness),void 0!==i.color&&e.uniforms.outlineColor.value.fromArray(i.color),void 0!==i.alpha&&(e.uniforms.outlineAlpha.value=i.alpha));t.displacementMap&&(e.uniforms.displacementMap.value=t.displacementMap,e.uniforms.displacementScale.value=t.displacementScale,e.uniforms.displacementBias.value=t.displacementBias)}(n,a)}this.render=function(e,t){var i,r=!1;if(void 0!==arguments[2]&&(console.warn("THREE.OutlineEffect.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.OutlineEffect.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==i&&o.setRenderTarget(i),r&&o.clear(),!1!==this.enabled){var n=o.autoClear;o.autoClear=this.autoClear,o.render(e,t),o.autoClear=n,this.renderOutline(e,t)}else o.render(e,t)},this.renderOutline=function(e,t){var i=o.autoClear,r=e.autoUpdate,n=e.background,a=o.shadowMap.enabled;e.autoUpdate=!1,e.background=null,o.autoClear=!1,o.shadowMap.enabled=!1,e.traverse(f),o.render(e,t),e.traverse(g),function(){for(var e,t=0,i=(e=Object.keys(c)).length;t<i;t++)c[e[t]]=void 0;for(t=0,i=(e=Object.keys(h)).length;t<i;t++)h[e[t]]=void 0;for(t=0,i=(e=Object.keys(s)).length;t<i;t++){var r=e[t];!1===s[r].used?(s[r].count++,!1===s[r].keepAlive&&l<s[r].count&&delete s[r]):(s[r].used=!1,s[r].count=0)}}(),e.autoUpdate=r,e.background=n,o.autoClear=i,o.shadowMap.enabled=a},this.autoClear=o.autoClear,this.domElement=o.domElement,this.shadowMap=o.shadowMap,this.clear=function(e,t,i){o.clear(e,t,i)},this.getPixelRatio=function(){return o.getPixelRatio()},this.setPixelRatio=function(e){o.setPixelRatio(e)},this.getSize=function(e){return o.getSize(e)},this.setSize=function(e,t,i){o.setSize(e,t,i)},this.setViewport=function(e,t,i,r){o.setViewport(e,t,i,r)},this.setScissor=function(e,t,i,r){o.setScissor(e,t,i,r)},this.setScissorTest=function(e){o.setScissorTest(e)},this.setRenderTarget=function(e){o.setRenderTarget(e)}},OrbitControls=function(e,t){var r,n,a,o,s,l;void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.getRadius=function(){return f.radius},this.getState=function(){return p},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(h),c.update(),p=d.NONE},this.update=(r=new Vector3,n=(new Quaternion).setFromUnitVectors(e.up,new Vector3(0,1,0)),a=n.clone().inverse(),o=new Vector3,s=new Quaternion,l=2*Math.PI,function(){var e=c.object.position;r.copy(e).sub(c.target),r.applyQuaternion(n),f.setFromVector3(r),c.autoRotate&&p===d.NONE&&R(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(f.theta+=g.theta*c.dampingFactor,f.phi+=g.phi*c.dampingFactor):(f.theta+=g.theta,f.phi+=g.phi);var t=c.minAzimuthAngle,i=c.maxAzimuthAngle;return isFinite(t)&&isFinite(i)&&(t<-Math.PI?t+=l:t>Math.PI&&(t-=l),i<-Math.PI?i+=l:i>Math.PI&&(i-=l),f.theta=t<i?Math.max(t,Math.min(i,f.theta)):(t+i)/2<f.theta?Math.max(t,f.theta):Math.min(i,f.theta)),f.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=v,f.radius=Math.max(c.minDistance,Math.min(c.maxDistance,f.radius)),!0===c.enableDamping?c.target.addScaledVector(y,c.dampingFactor):c.target.add(y),r.setFromSpherical(f),r.applyQuaternion(a),e.copy(c.target).add(r),c.object.lookAt(c.target),!0===c.enableDamping?(g.theta*=1-c.dampingFactor,g.phi*=1-c.dampingFactor,y.multiplyScalar(1-c.dampingFactor)):(g.set(0,0,0),y.set(0,0,0)),v=1,!(!(x||o.distanceToSquared(c.object.position)>m||8*(1-s.dot(c.object.quaternion))>m)||(c.dispatchEvent(h),o.copy(c.object.position),s.copy(c.object.quaternion),x=!1))}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",ie,!1),c.domElement.removeEventListener("mousedown",X,!1),c.domElement.removeEventListener("wheel",Q,!1),c.domElement.removeEventListener("touchstart",J,!1),c.domElement.removeEventListener("touchend",te,!1),c.domElement.removeEventListener("touchmove",ee,!1),c.domElement.ownerDocument.removeEventListener("mousemove",Y,!1),c.domElement.ownerDocument.removeEventListener("mouseup",Z,!1),c.domElement.removeEventListener("keydown",K,!1)};var c=this,h={type:"change"},u={type:"start"},i={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=d.NONE,m=1e-6,f=new Spherical,g=new Spherical,v=1,y=new Vector3,x=!1,_=new Vector2,b=new Vector2,w=new Vector2,M=new Vector2,S=new Vector2,T=new Vector2,A=new Vector2,E=new Vector2,C=new Vector2;function L(){return Math.pow(.95,c.zoomSpeed)}function R(e){g.theta-=e}function P(e){g.phi-=e}var D,k,B,F=(D=new Vector3,function(e,t){D.setFromMatrixColumn(t,0),D.multiplyScalar(-e),y.add(D)}),I=(k=new Vector3,function(e,t){!0===c.screenSpacePanning?k.setFromMatrixColumn(t,1):(k.setFromMatrixColumn(t,0),k.crossVectors(c.object.up,k)),k.multiplyScalar(e),y.add(k)}),O=(B=new Vector3,function(e,t){var i=c.domElement;if(c.object.isPerspectiveCamera){B.copy(c.object.position).sub(c.target);var r=B.length();r*=Math.tan(c.object.fov/2*Math.PI/180),F(2*e*r/i.clientHeight,c.object.matrix),I(2*t*r/i.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(F(e*(c.object.right-c.object.left)/c.object.zoom/i.clientWidth,c.object.matrix),I(t*(c.object.top-c.object.bottom)/c.object.zoom/i.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)});function V(e){c.object.isPerspectiveCamera?v/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function U(e){c.object.isPerspectiveCamera?v*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function G(e){_.set(e.clientX,e.clientY)}function N(e){M.set(e.clientX,e.clientY)}function z(e){1==e.touches.length?_.set(e.touches[0].pageX,e.touches[0].pageY):_.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function H(e){1==e.touches.length?M.set(e.touches[0].pageX,e.touches[0].pageY):M.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function j(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);A.set(0,r)}function W(e){1==e.touches.length?b.set(e.touches[0].pageX,e.touches[0].pageY):b.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY));w.subVectors(b,_).multiplyScalar(c.rotateSpeed);var t=c.domElement;R(2*Math.PI*w.x/t.clientHeight),P(2*Math.PI*w.y/t.clientHeight),_.copy(b)}function q(e){1==e.touches.length?S.set(e.touches[0].pageX,e.touches[0].pageY):S.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY));T.subVectors(S,M).multiplyScalar(c.panSpeed),O(T.x,T.y),M.copy(S)}function $(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);E.set(0,r),C.set(0,Math.pow(E.y/A.y,c.zoomSpeed)),V(C.y),A.copy(E)}function X(e){if(!1!==c.enabled){var t,i;switch(e.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case MOUSE.DOLLY:if(!1===c.enableZoom)return;A.set((i=e).clientX,i.clientY),p=d.DOLLY;break;case MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;N(e),p=d.PAN}else{if(!1===c.enableRotate)return;G(e),p=d.ROTATE}break;case MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;G(e),p=d.ROTATE}else{if(!1===c.enablePan)return;N(e),p=d.PAN}break;default:p=d.NONE}p!==d.NONE&&(c.domElement.ownerDocument.addEventListener("mousemove",Y,!1),c.domElement.ownerDocument.addEventListener("mouseup",Z,!1),c.dispatchEvent(u))}}function Y(e){var t,i;if(!1!==c.enabled)switch(e.preventDefault(),p){case d.ROTATE:if(!1===c.enableRotate)return;!function(e){b.set(e.clientX,e.clientY),w.subVectors(b,_).multiplyScalar(c.rotateSpeed);var t=c.domElement;R(2*Math.PI*w.x/t.clientHeight),P(2*Math.PI*w.y/t.clientHeight),_.copy(b),c.update()}(e);break;case d.DOLLY:if(!1===c.enableZoom)return;E.set((i=e).clientX,i.clientY),C.subVectors(E,A),0<C.y?V(L()):C.y<0&&U(L()),A.copy(E),c.update();break;case d.PAN:if(!1===c.enablePan)return;S.set((t=e).clientX,t.clientY),T.subVectors(S,M).multiplyScalar(c.panSpeed),O(T.x,T.y),M.copy(S),c.update()}}function Z(e){!1!==c.enabled&&(c.domElement.ownerDocument.removeEventListener("mousemove",Y,!1),c.domElement.ownerDocument.removeEventListener("mouseup",Z,!1),c.dispatchEvent(i),p=d.NONE)}function Q(e){var t;!1===c.enabled||!1===c.enableZoom||p!==d.NONE&&p!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),c.dispatchEvent(u),(t=e).deltaY<0?U(L()):0<t.deltaY&&V(L()),c.update(),c.dispatchEvent(i))}function K(e){!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan&&function(e){var t=!1;switch(e.keyCode){case c.keys.UP:O(0,c.keyPanSpeed),t=!0;break;case c.keys.BOTTOM:O(0,-c.keyPanSpeed),t=!0;break;case c.keys.LEFT:O(c.keyPanSpeed,0),t=!0;break;case c.keys.RIGHT:O(-c.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),c.update())}(e)}function J(e){if(!1!==c.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(c.touches.ONE){case TOUCH.ROTATE:if(!1===c.enableRotate)return;z(e),p=d.TOUCH_ROTATE;break;case TOUCH.PAN:if(!1===c.enablePan)return;H(e),p=d.TOUCH_PAN;break;default:p=d.NONE}break;case 2:switch(c.touches.TWO){case TOUCH.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;i=e,c.enableZoom&&j(i),c.enablePan&&H(i),p=d.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;t=e,c.enableZoom&&j(t),c.enableRotate&&z(t),p=d.TOUCH_DOLLY_ROTATE;break;default:p=d.NONE}break;default:p=d.NONE}var t,i;p!==d.NONE&&c.dispatchEvent(u)}}function ee(e){var t,i;if(!1!==c.enabled)switch(e.preventDefault(),e.stopPropagation(),p){case d.TOUCH_ROTATE:if(!1===c.enableRotate)return;W(e),c.update();break;case d.TOUCH_PAN:if(!1===c.enablePan)return;q(e),c.update();break;case d.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;i=e,c.enableZoom&&$(i),c.enablePan&&q(i),c.update();break;case d.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;t=e,c.enableZoom&&$(t),c.enableRotate&&W(t),c.update();break;default:p=d.NONE}}function te(e){!1!==c.enabled&&(c.dispatchEvent(i),p=d.NONE)}function ie(e){!1!==c.enabled&&e.preventDefault()}c.domElement.addEventListener("contextmenu",ie,!1),c.domElement.addEventListener("mousedown",X,!1),c.domElement.addEventListener("wheel",Q,!1),c.domElement.addEventListener("touchstart",J,!1),c.domElement.addEventListener("touchend",te,!1),c.domElement.addEventListener("touchmove",ee,!1),c.domElement.addEventListener("keydown",K,!1),-1===c.domElement.tabIndex&&(c.domElement.tabIndex=0),this.update()};OrbitControls.prototype=Object.create(EventDispatcher.prototype),OrbitControls.prototype.constructor=OrbitControls;var MapControls=function(e,t){OrbitControls.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=MOUSE.PAN,this.mouseButtons.RIGHT=MOUSE.ROTATE,this.touches.ONE=TOUCH.PAN,this.touches.TWO=TOUCH.DOLLY_ROTATE};MapControls.prototype=Object.create(EventDispatcher.prototype),MapControls.prototype.constructor=MapControls;var HOLO={Revision:0,Animator:function(){this._animations=[]}};HOLO.Animator.prototype={constructor:HOLO.Animator,get isEmpty(){return this._animations.length<1},add:function(e){this._animations.push(e)},remove:function(e){var t=this._animations.indexOf(e);-1<t&&this._animations.splice(t,1)},clear:function(){this._animations=[]},contains:function(e){return-1<this._animations.indexOf(e)},animate:function(){for(var e=0;e<this._animations.length;e++)this._animations[e].animate(),this._animations[e].finished&&this.remove(this._animations[e])}},HOLO.CameraAnimation=function(e,t,i,r){this._camera=e,this._newLocation=t,this._far=i,this._steps=r,this._calc()},HOLO.CameraAnimation.prototype={constructor:HOLO.CameraAnimation,get finished(){return this._steps<1},_calc:function(){this._changeX=(this._newLocation.x-this._camera.position.x)/this._steps,this._changeY=(this._newLocation.y-this._camera.position.y)/this._steps,this._changeZ=(this._newLocation.z-this._camera.position.z)/this._steps,this._changeFar=(this._far-this._camera.far)/this._steps},_lerp:function(){this._camera.position.x+=this._changeX,this._camera.position.y+=this._changeY,this._camera.position.z+=this._changeZ,this._camera.far+=this._changeFar},animate:function(){this._lerp(),--this._steps}},HOLO.ChangeLocationAnimation=function(e,t,i){if(this._object=e,this._steps=i,t.constructor===Array)this._calcSteps(new Vector3(t[0],t[1],t[2]));else{if(!t.isVector3)throw new Error("Object is not an array or vector: ");this._calcSteps(t)}},HOLO.ChangeLocationAnimation.prototype={constructor:HOLO.ChangeLocationAnimation,get finished(){return this._steps<1},_calcSteps:function(e){this._changeX=(e.x-this._object.position.x)/this._steps,this._changeY=(e.y-this._object.position.y)/this._steps,this._changeZ=(e.z-this._object.position.z)/this._steps},_lerp:function(){this._object.position.x+=this._changeX,this._object.position.y+=this._changeY,this._object.position.z+=this._changeZ,--this._steps},animate:function(){this._lerp()}},HOLO.ChangeRotationAnimation=function(e,t,i){if(this._object=e,this._steps=i,t.constructor===Array)this._calcSteps(new Vector3(t[0],t[1],t[2]));else{if(!t.isVector3)throw new Error("Object is not an array or vector: ");this._calcSteps(t)}},HOLO.ChangeRotationAnimation.prototype={constructor:HOLO.ChangeRotationAnimation,get finished(){return this._steps<1},_calcSteps:function(e){this._changeX=(e.x-this._object.rotation.x)/this._steps,this._changeY=(e.y-this._object.rotation.y)/this._steps,this._changeZ=(e.z-this._object.rotation.z)/this._steps},_lerp:function(){this._object.rotation.x+=this._changeX,this._object.rotation.y+=this._changeY,this._object.rotation.z+=this._changeZ,--this._steps},animate:function(){this._lerp()}},HOLO.ChangeScaleAnimation=function(e,t,i){if(this._object=e,this._steps=i,t.constructor===Array)this._scale=new Vector3(t[0],t[1],t[2]);else if(t.isVector3)this._scale=t;else{if("number"!=typeof t)throw new Error("Object is not an array or vector: ");this._scale=new Vector3(t,t,t)}this._calcSteps(this._scale)},HOLO.ChangeScaleAnimation.prototype={constructor:HOLO.ChangeScaleAnimation,get finished(){return this._steps<1},_calcSteps:function(e){this._changeX=Math.abs(Math.sin(this._steps*e.x)),this._changeY=Math.abs(Math.sin(this._steps*e.y)),this._changeZ=Math.abs(Math.sin(this._steps*e.z))},_lerp:function(){this._object.scale.set(this._changeX,this._changeY,this._changeZ),--this._steps},animate:function(){this._lerp()}},HOLO.FocusAnimation=function(e,t,i,r,n){this._scene=e,this._object=t,this._camera=i,this._steps=r,this._lookAt=n||!1},HOLO.FocusAnimation.prototype={constructor:HOLO.FocusAnimation,get finished(){return this._steps<1},_calc:function(){var e=this._object.position.y+this._scene.position.y,t=this._object.position.z+this._scene.position.z;this._changeX=(0-(this._object.position.x+this._scene.position.x))/this._steps,this._changeY=(0-e)/this._steps,this._changeZ=(this._camera.position.z-this._camera.far/2-t)/this._steps},_lerp:function(){this._scene.position.x+=this._changeX,this._scene.position.y+=this._changeY,this._scene.position.z+=this._changeZ},animate:function(){this._calc(),this._lerp(),--this._steps,this._lookAt&&0===this._steps&&this._object.lookAt(this._camera.position)}},HOLO.RotationAnimation=function(e,t,i){this._object=e,this._steps=2,this.alpha=t,this.rotationVector=i},HOLO.RotationAnimation.prototype={constructor:HOLO.RotationAnimation,get alpha(){return this._alpha},set alpha(e){if(void 0!==e&&"number"!=typeof e)throw new Error("Alpha is not a float value.");this._alpha=e||1},get rotationVector(){return this._rotationVector},set rotationVector(e){if(e.constructor===Array)this._rotationVector=new Vector3(e[0],e[1],e[2]);else{if(!e.isVector3)throw new Error("Object is not an array or vector: ");this._rotationVector=e}},get finished(){return this._steps<1},start:function(){this._steps=2},pause:function(){this._steps=1},stop:function(){this._steps=0},_lerp:function(){this._object.rotation.x+=this._rotationVector.x*this._alpha,this._object.rotation.y+=this._rotationVector.y*this._alpha,this._object.rotation.z+=this._rotationVector.z*this._alpha},animate:function(){1<this._steps&&this._lerp()}},HOLO.FourSidedDisplay=function(e){this.reflectFromAbove=!0,this.renderer=e,this._cameraF=new PerspectiveCamera,this._cameraB=new PerspectiveCamera,this._cameraL=new PerspectiveCamera,this._cameraR=new PerspectiveCamera,this._position=new Vector3,this._quaternion=new Quaternion,this._scale=new Vector3,this.renderer.autoClear=!1},HOLO.FourSidedDisplay.prototype={constructor:HOLO.FourSidedDisplay,get reflectFromAbove(){return this._reflectFromAbove},set reflectFromAbove(e){if("boolean"!=typeof e)throw new Error("Value is not boolean");this._reflectFromAbove=e},get renderer(){return this._renderer},set renderer(e){this._renderer=e},setSize:function(e,t){e<t?(this._startX=0,this._startY=(t-e)/2,this._width=e/3,this._height=e/3):(this._startX=(e-t)/2,this._startY=0,this._width=t/3,this._height=t/3),this._renderer.setSize(e,t)},render:function(e,t){this.cameraDistance=window.WEngine.view.cameraControls.getRadius(),this._setCameras(t),this._setScissors(e)},_setCameras:function(e){null===e.parent&&e.updateMatrixWorld(),e.matrixWorld.decompose(this._position,this._quaternion,this._scale);var t=new Vector3(0,0,-this.cameraDistance).applyQuaternion(this._quaternion).round().add(this._position),i=new Vector3(0,0,-this.cameraDistance).applyQuaternion(this._quaternion).round().add(t),r=new Vector3(-this.cameraDistance,0,0).applyQuaternion(this._quaternion).round().add(t),n=new Vector3(this.cameraDistance,0,0).applyQuaternion(this._quaternion).round().add(t),a=(new Quaternion).setFromAxisAngle(new Vector3(1,0,0),Math.PI/2),o=(new Quaternion).setFromAxisAngle(new Vector3(1,0,0),Math.PI),s=(new Quaternion).setFromAxisAngle(new Vector3(0,1,0),Math.PI/2),l=(new Quaternion).setFromAxisAngle(new Vector3(0,1,0),-Math.PI/2),c=(new Quaternion).copy(this._quaternion).multiply(a).multiply(s),h=(new Quaternion).copy(this._quaternion).multiply(o),u=(new Quaternion).copy(this._quaternion).multiply(a).multiply(l);this._cameraF.position.copy(this._position),this._cameraF.quaternion.copy(this._quaternion),this._cameraF.far=e.far,this._cameraR.position.copy(n),this._cameraR.quaternion.copy(c),this._cameraR.far=e.far,this._cameraB.position.copy(i),this._cameraB.quaternion.copy(h),this._cameraB.far=e.far,this._cameraL.position.copy(r),this._cameraL.quaternion.copy(u),this._cameraL.far=e.far},_setScissors:function(e){this.renderer.clear(),this.renderer.setScissorTest(!0),this.renderer.setScissor(this._startX+this._width,this._startY+2*this._height,this._width,this._height),this.renderer.setViewport(this._startX+this._width,this._startY+2*this._height,this._width,this._height),this.renderer.render(e,this.reflectFromAbove?this._cameraB:this._cameraF),this.renderer.setScissor(this._startX+this._width,this._startY,this._width,this._height),this.renderer.setViewport(this._startX+this._width,this._startY,this._width,this._height),this.renderer.render(e,this.reflectFromAbove?this._cameraF:this._cameraB),this.renderer.setScissor(this._startX,this._startY+this._height,this._width,this._height),this.renderer.setViewport(this._startX,this._startY+this._height,this._width,this._height),this.renderer.render(e,this.reflectFromAbove?this._cameraR:this._cameraL),this.renderer.setScissor(this._startX+2*this._width,this._startY+this._height,this._width,this._height),this.renderer.setViewport(this._startX+2*this._width,this._startY+this._height,this._width,this._height),this.renderer.render(e,this.reflectFromAbove?this._cameraL:this._cameraR),this.renderer.setScissorTest(!1)}},HOLO.ThreeSidedDisplay=function(i){var r,n,a,o;this.cameraDistance=1e3,this.reflectFromAbove=!0;var h=new PerspectiveCamera,u=new PerspectiveCamera,d=new PerspectiveCamera,p=new Vector3,m=new Quaternion,f=new Vector3;i.autoClear=!1,this.setSize=function(e,t){o=e<t?(a=0,(t-3*(n=r=e/2))/2):(a=(e-3*(r=n=t/2))/2,0),i.setSize(e,t)},this.render=function(e,t){this.cameraDistance=window.WEngine.view.cameraControls.getRadius(),e.updateMatrixWorld(),this._setCameras(t),this._setScissors(e)},this._setCameras=function(e){null===e.parent&&e.updateMatrixWorld(),e.matrixWorld.decompose(p,m,f);var t=new Vector3(0,0,-this.cameraDistance).applyQuaternion(m).round().add(p),i=new Vector3(-this.cameraDistance,0,0).applyQuaternion(m).round().add(t),r=new Vector3(this.cameraDistance,0,0).applyQuaternion(m).round().add(t),n=(new Quaternion).setFromAxisAngle(new Vector3(1,0,0),Math.PI/2),a=(new Quaternion).setFromAxisAngle(new Vector3(0,1,0),Math.PI/2),o=(new Quaternion).setFromAxisAngle(new Vector3(0,1,0),-Math.PI/2),s=(new Quaternion).setFromAxisAngle(new Vector3(0,0,1),Math.PI),l=(new Quaternion).copy(m).multiply(n).multiply(a),c=(new Quaternion).copy(m).multiply(n).multiply(o);h.position.copy(p),h.quaternion.copy(this.reflectFromAbove?m.multiply(s):m),h.far=e.far,d.position.copy(r),d.quaternion.copy(l),d.far=e.far,u.position.copy(i),u.quaternion.copy(c),u.far=e.far},this._setScissors=function(e){i.clear(),i.setScissorTest(!0),this.reflectFromAbove?(i.setScissor(a+r,o+n,r,n),i.setViewport(a+r,o+n,r,n),i.render(e,h),i.setScissor(a,o,r,n),i.setViewport(a,o,r,n),i.render(e,d),i.setScissor(a+2*r,o,r,n),i.setViewport(a+2*r,o,r,n),i.render(e,u)):(i.setScissor(a+n,o,r,n),i.setViewport(a+n,o,r,n),i.render(e,h),i.setScissor(a,o+n,n,r),i.setViewport(a,o+n,n,r),i.render(e,u),i.setScissor(a+n+r,o+n,n,r),i.setViewport(a+n+r,o+n,n,r),i.render(e,d)),i.setScissorTest(!1)}},HOLO.ModelLoader=function(){},HOLO.ModelLoader.prototype={constructor:HOLO.ModelLoader},HOLO.Cube=function(e,t,i,r,n,a){Group.call(this),this.type="Group",this._inside=[],this.autoScale=!0,this._width=e||200,this._height=t||200,this._depth=i||200,this._color=r||6750003,this._transparent=n||!0,this._oppacity=a||.5,this._cubeGeometry=new BoxGeometry(this._width,this._height,this._depth),this._cubeMaterials=[new MeshBasicMaterial({color:this._color,transparent:this._transparent,opacity:this._oppacity,side:DoubleSide}),new MeshBasicMaterial({color:this._color,transparent:this._transparent,opacity:this._oppacity,side:DoubleSide}),new MeshBasicMaterial({color:this._color,transparent:this._transparent,opacity:this._oppacity,side:DoubleSide}),new MeshBasicMaterial({color:this._color,transparent:this._transparent,opacity:this._oppacity,side:DoubleSide}),new MeshBasicMaterial({color:this._color,transparent:this._transparent,opacity:this._oppacity,side:DoubleSide}),new MeshBasicMaterial({color:this._color,transparent:this._transparent,opacity:this._oppacity,side:DoubleSide})],this._cubeFaceMaterial=new MeshFaceMaterial(this._cubeMaterials),this._cubeMesh=new Mesh(this._cubeGeometry,this._cubeFaceMaterial),this.add(this._cubeMesh),this._cubeGeometry.computeBoundingBox(),this.boundingBox=this._cubeGeometry.boundingBox},HOLO.Cube.prototype=Object.assign(Object.create(Group.prototype),{constructor:HOLO.Cube,addToCube:function(e){if(this.autoScale)if(this._fit(e),this._inside.push(e),1<this._inside.length){this.children=this.children.slice(0,1),this._computeSpacing();for(var t=0,i=0;i<this._inside.length;i++)this._inside[i].computeBoundingBox(),t+=this._inside[i].boundingBox.max.y;var r,n=this._objectSpace/t,a=this.boundingBox.max.y/2;for(i=0;i<this._inside.length;i++)r=this._inside[i].clone(),this.boundingBox.max.y<t&&r.scale.set(n,n,n),r.position.set(0,a,0),this.add(r),r.computeBoundingBox(),a-=r.boundingBox.max.y+this._singleSpacing}else this.add(e);else this.add(e)},removeFromCube:function(e){var t=this.children.indexOf(e);-1<t&&this.children.splice(t,1)},_fit:function(e){var t;e.computeBoundingBox(),this.boundingBox.max.x<e.boundingBox.max.x&&e.scale.set(t=this.boundingBox.max.x/e.boundingBox.max.x,t,t),this.boundingBox.max.y<e.boundingBox.max.y&&e.scale.set(t=this.boundingBox.max.y/e.boundingBox.max.y,t,t),this.boundingBox.max.z<e.boundingBox.max.z&&e.scale.set(t=this.boundingBox.max.z/e.boundingBox.max.z,t,t)},_computeSpacing:function(){this._totalSpacing=this.boundingBox.max.y/this._inside.length+1,this._singleSpacing=this._totalSpacing/this._inside.length-1,this._objectSpace=this.boundingBox.max.y-this._totalSpacing},set color(e){for(var t=0;t<this._cubeGeometry.faces.length;t++)this._cubeGeometry.faces[t].color=e;this._cubeGeometry.colorsNeedUpdate=!0},get color(){return new Color(this._color)}}),HOLO.Model=function(e,t){Mesh.call(this,e,t),this.type="Mesh"},HOLO.Model.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:HOLO.Model,computeBoundingBox:function(){this.geometry.computeBoundingBox(),this.boundingBox=this.geometry.boundingBox}}),HOLO.Text=function(e,t,i,r,n){this._font=e,this._text=t||"HoloJen",this._textSize=i||80,this._textHeight=r||20,this._curveSegments=n||2,this._textGeometry=new TextGeometry(this._text,{font:this._font,size:this._textSize,height:this._textHeight,curveSegments:this._curveSegments}),this._textGeometry.center(),this._textMaterial=new MultiMaterial([new MeshBasicMaterial({color:4873318,overdraw:.5}),new MeshBasicMaterial({color:16777215,overdraw:.5})]),Mesh.call(this,this._textGeometry,this._textMaterial),this.type="Mesh"},HOLO.Text.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:HOLO.Text,computeBoundingBox:function(){this._textGeometry.computeBoundingBox(),this.boundingBox=this._textGeometry.boundingBox},clone:function(){return new this.constructor(this._font,this._text).copy(this)}});var WMaterials=function(){var c=new Map;c.set("basic",new MeshBasicMaterial({color:16777215,name:"basic",wireframe:!1})),c.set("solid",new MeshPhongMaterial({color:2105376})),c.set("move",new MeshLambertMaterial({color:13421772,name:"move",wireframe:!1,shadowSide:!1})),c.set("speed",new MeshLambertMaterial({color:3394815,name:"sleep",wireframe:!1,shadowSide:!1})),c.set("cars",new MeshBasicMaterial({color:16777215,name:"cars",wireframe:!1,transparent:!0,side:DoubleSide})),c.set("sleep",new MeshLambertMaterial({color:3394815,name:"sleep",wireframe:!1,shadowSide:!1})),c.set("static",new MeshLambertMaterial({color:3355443,name:"static",wireframe:!1,side:DoubleSide,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1})),c.set("kinematic",new MeshLambertMaterial({color:8978227,name:"kinematic",wireframe:!0,shadowSide:!1})),c.set("soft",new MeshLambertMaterial({name:"soft",vertexColors:VertexColors,shadowSide:!1})),c.set("debug",new MeshBasicMaterial({name:"debug",color:65280,depthTest:!1,depthWrite:!1,wireframe:!0,shadowSide:!1})),c.set("tmp1",new MeshBasicMaterial({color:16777215,name:"tmp1",wireframe:!1,transparent:!0})),c.set("tmp2",new MeshBasicMaterial({color:16777215,name:"tmp2",wireframe:!1,transparent:!0})),c.set("movehigh",new MeshBasicMaterial({color:16777215,name:"movehigh",wireframe:!1})),c.set("meca1",new MeshBasicMaterial({color:16777215,name:"meca1",wireframe:!1})),c.set("meca2",new MeshBasicMaterial({color:16777215,name:"meca2",wireframe:!1})),c.set("meca3",new MeshBasicMaterial({color:16777215,name:"meca3",wireframe:!1})),c.set("both",new MeshBasicMaterial({color:16777215,name:"both",wireframe:!1,side:DoubleSide})),c.set("back",new MeshBasicMaterial({color:16777215,name:"back",wireframe:!1,side:BackSide})),c.set("terrain",new MeshBasicMaterial({vertexColors:VertexColors,name:"terrain",wireframe:!1})),c.set("cloth",new MeshBasicMaterial({vertexColors:VertexColors,name:"cloth",wireframe:!1,transparent:!0,opacity:.9,side:DoubleSide})),c.set("ball",new MeshBasicMaterial({vertexColors:VertexColors,name:"ball",wireframe:!1})),c.set("hero",new MeshBasicMaterial({color:10040217,name:"hero",wireframe:!1})),c.set("wall",new MeshBasicMaterial({color:0,name:"wall",wireframe:!1,depthTest:!1,depthWrite:!1,transparent:!0,opacity:.1})),c.set("kinect",new MeshBasicMaterial({color:65535,name:"kinect",wireframe:!0,depthTest:!1,depthWrite:!1,transparent:!0})),c.set("kinecton",new MeshBasicMaterial({color:16750848,name:"kinecton",wireframe:!0,depthTest:!1,depthWrite:!1}));var a={shadowSide:BackSide,envPower:1.2,mode:0},h=0,u={getMat:function(){var i={};return c.forEach(function(e,t){i[t]=e}),i},get:function(e){return c.has(e)?c.get(e):null},clone:function(e,t){var i=u.get(e);if(null!==i){var r=i.clone();return c.set(r.name=t,r),r}console.log("base material not existe !!")},getList:function(){return c.entries()},reset:function(){c.forEach(function(e,t){e.isTmp&&(c.delete(t),e.dispose())}),WTextures.reset()},clear:function(){h=0,WTextures.clear(),c.forEach(function(e,t){e.dispose()}),c.clear()},updateEnvmap:function(){var i=window.WEngine.view.getEnvmap();c.forEach(function(e,t){void 0!==e.envMap&&(e.wireframe||e.noEnv?e.envMap=null:(e.envMap=i,e.needsUpdate=!0))})},setMode:function(i){a.mode=i,c.forEach(function(e,t){e.uniforms.renderMode.value=i})},make:function(e){var t;if(void 0!==e.name?t=e.name:(t="mat"+h++,e.name=t),c.has(t))return c.get(t);var i=!1;e.noEnv&&(i=!0,delete e.noEnv);var r=void 0!==e.type?e.type:"Standard";void 0===e.sheen&&void 0===e.clearcoat&&void 0===e.reflectivity&&void 0===e.transparency||(r="Physical"),delete e.type,"Standard"!==r&&(delete e.metalness,delete e.roughness),"Phong"!==r&&(delete e.shininess,delete e.specular);var n,a=void 0===e.isTmp||e.isTmp;for(var o in delete e.isTmp,e.shadowSide=void 0!==e.shadowSide||null,e){if("Map"===o.substring(o.length-3)||"map"===o)if(e[o].isTexture)WTextures.add(e[o].name,e[o]);else{var s=e[o];s.isTmp=a,e[o]=WTextures.make(s)}"side"===o&&("string"==typeof e[o]||e[o]instanceof String)&&(e[o]=THREE$1[e[o]+"Side"]),"depth"===o&&(e[o]=THREE$1[e[o]+"Depth"]),"normalScale"!==o&&"clearcoatNormalScale"!==o||e[o].isVector2||(e[o]=(new Vector2).fromArray(e[o]))}console.log("type==="+r),n="Line"==r?c[t]?c[t]:new LineBasicMaterial(e):c[t]?c[t]:new THREE$1["Mesh"+r+"Material"](e),i?n.noEnv=!0:void 0!==n.envMap&&(n.envMap=window.WEngine.view.getEnvmap()),n.isTmp=a;var l=null;return e.extraCompile&&(l=e.extraCompile,delete e.extraCompile,u.customize(n,e,l)),c.set(t,n),n},customize:function(r,e,n){r.onBeforeCompile=function(e){var t=e.uniforms;t.renderMode={value:a.mode},t.depthPacking={value:1},t.extraShadow={value:.3},e.uniforms=t,this.uniforms=e.uniforms;var i=e.fragmentShader;i=(i=i.replace("uniform vec3 diffuse;",["uniform vec3 diffuse;","uniform int renderMode;","uniform int depthPacking;","uniform float extraShadow;"].join("\n"))).replace("#include <alphatest_fragment>",u.directDepth),"MeshBasicMaterial"!==r.type&&(i=i.replace("#include <normal_fragment_maps>",u.directNormal)),e.fragmentShader=i,null!==n&&(e=n(e))}},directDepth:["#include <alphatest_fragment>","if( renderMode == 1 ){","gl_FragColor = depthPacking == 1 ? packDepthToRGBA( gl_FragCoord.z ) : vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );","return;","}"].join("\n"),directNormal:["#include <normal_fragment_maps>","if( renderMode == 2 ){","gl_FragColor = vec4( packNormalToRGB( normal ), opacity );","return;","}"].join("\n"),shaderEnd:["    if( renderMode == 2 ) gl_FragColor = vec4( packNormalToRGB( normal ), opacity );","}"].join("\n"),mapSkinFrag:["#ifdef USE_MAP","vec4 underColor = texture2D( subdermal, vUv );","vec4 texelColor = texture2D( map, vUv );","float mx = ((underColor.r + underColor.g)-underColor.b)*0.5;","texelColor.xyz = mix( texelColor.xyz,vec3(0.0,underColor.g,underColor.b),  underColor.b*0.2 );","texelColor = mapTexelToLinear( texelColor );","diffuseColor *= texelColor;","#endif",""].join("\n"),normalFragRevers:["#ifdef USE_NORMALMAP","#ifdef OBJECTSPACE_NORMALMAP","normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","#ifdef FLIP_SIDED","   normal = - normal;","#endif","#ifdef DOUBLE_SIDED","   normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );","#endif","normal = normalize( normalMatrix * normal );","#else","normal = perturbNormal2Arb( vViewPosition, normal );","#endif","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif",""].join("\n"),lightStart:["PhysicalMaterial material;","if( renderMode == 3 ){","diffuseColor = vec4(1.0, 1.0, 1.0, diffuseColor.a);","}","material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );","vec3 ccc = diffuseColor.rgb;","if( velvet.r > 0.7 ) ccc = diffuseColor.r < 0.45 ? diffuseColor.rgb : velvet;","#ifdef REFLECTIVITY","material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), ccc, metalnessFactor );","#else","material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), ccc, metalnessFactor );","#endif","#ifdef CLEARCOAT","material.clearcoat = saturate( clearcoat );","material.clearcoatRoughness = clamp( clearcoatRoughness, 0.04, 1.0 );","#endif","#ifdef USE_SHEEN","if( velvet.r > 0.7 ) material.sheenColor = diffuseColor.r > 0.25 ? sheen : vec3(0.2,0.19,0.24);","else material.sheenColor =sheen;","#endif",""].join("\n"),lightEnd:["#if defined( RE_IndirectDiffuse )","irradiance = vec3(0.0);","RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );","#endif","#if defined( RE_IndirectSpecular )","radiance = vec3(0.0);","RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );","#endif",""].join("\n"),lightBegin:["float shadowTmp = 1.0;","float shadowFull = 1.0;","GeometricContext geometry;","geometry.position = - vViewPosition;","geometry.normal = normal;","geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );","#ifdef CLEARCOAT","   geometry.clearcoatNormal = clearcoatNormal;","#endif","IncidentLight directLight;","#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )","   PointLight pointLight;","   #pragma unroll_loop","   for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","       pointLight = pointLights[ i ];","       getPointDirectLightIrradiance( pointLight, geometry, directLight );","       #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )","       shadowTmp = all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;","       directLight.color *= shadowTmp","       shadowFull *= shadowTmp;","       #endif","       RE_Direct( directLight, geometry, material, reflectedLight );","   }","#endif","#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )","   SpotLight spotLight;","   #pragma unroll_loop","   for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {","       spotLight = spotLights[ i ];","       getSpotDirectLightIrradiance( spotLight, geometry, directLight );","       #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )","       shadowTmp = all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","       directLight.color *= shadowTmp","       shadowFull *= shadowTmp;","       #endif","       RE_Direct( directLight, geometry, material, reflectedLight );","   }","#endif","#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )","   DirectionalLightShadow directionalLightShadow;DirectionalLight directionalLight;","   #pragma unroll_loop","   for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {","       directionalLight = directionalLights[ i ]; directionalLightShadow = directionalLightShadows[ i ];","       getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );","       #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )","       shadowTmp = all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","       directLight.color *= shadowTmp;","       shadowFull *= shadowTmp;","       #endif","       RE_Direct( directLight, geometry, material, reflectedLight );","   }","#endif","#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )","   RectAreaLight rectAreaLight;","   #pragma unroll_loop","   for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {","       rectAreaLight = rectAreaLights[ i ];","       RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );","   }","#endif","#if defined( RE_IndirectDiffuse )","   vec3 iblIrradiance = vec3( 0.0 );","   vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );","   irradiance += getLightProbeIrradiance( lightProbe, geometry );","   #if ( NUM_HEMI_LIGHTS > 0 )","       #pragma unroll_loop","       for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","           irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );","       }","   #endif","#endif","#if defined( RE_IndirectSpecular )","   vec3 radiance = vec3( 0.0 );","   vec3 clearcoatRadiance = vec3( 0.0 );","#endif",""].join("\n")};return u}(),SkeletonUtils={retarget:(uid=new Vector3,vid=new Quaternion,wid=new Vector3,xid=new Matrix4,yid=new Matrix4,zid=new Matrix4,function(e,t,i){(i=i||{}).preserveMatrix=void 0===i.preserveMatrix||i.preserveMatrix,i.preservePosition=void 0===i.preservePosition||i.preservePosition,i.preserveHipPosition=void 0!==i.preserveHipPosition&&i.preserveHipPosition,i.useTargetMatrix=void 0!==i.useTargetMatrix&&i.useTargetMatrix,i.hip=void 0!==i.hip?i.hip:"hip",i.names=i.names||{};var r,n,a,o,s,l,c=t.isObject3D?t.skeleton.bones:this.getBones(t),h=e.isObject3D?e.skeleton.bones:this.getBones(e);if(e.isObject3D?e.skeleton.pose():(i.useTargetMatrix=!0,i.preserveMatrix=!1),i.preservePosition)for(s=[],l=0;l<h.length;l++)s.push(h[l].position.clone());if(i.preserveMatrix)for(e.updateMatrixWorld(),e.matrixWorld.identity(),l=0;l<e.children.length;++l)e.children[l].updateMatrixWorld(!0);if(i.offsets)for(r=[],l=0;l<h.length;++l)a=i.names[(n=h[l]).name]||n.name,i.offsets&&i.offsets[a]&&(n.matrix.multiply(i.offsets[a]),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld()),r.push(n.matrixWorld.clone());for(l=0;l<h.length;++l){if(o=this.getBoneByName(a=i.names[(n=h[l]).name]||n.name,c),zid.copy(n.matrixWorld),o){if(o.updateMatrixWorld(),i.useTargetMatrix?yid.copy(o.matrixWorld):(yid.getInverse(e.matrixWorld),yid.multiply(o.matrixWorld)),wid.setFromMatrixScale(yid),yid.scale(wid.set(1/wid.x,1/wid.y,1/wid.z)),zid.makeRotationFromQuaternion(vid.setFromRotationMatrix(yid)),e.isObject3D){var u=h.indexOf(n),d=r?r[u]:xid.getInverse(e.skeleton.boneInverses[u]);zid.multiply(d)}zid.copyPosition(yid)}n.parent&&n.parent.isBone?(n.matrix.getInverse(n.parent.matrixWorld),n.matrix.multiply(zid)):n.matrix.copy(zid),i.preserveHipPosition&&a===i.hip&&n.matrix.setPosition(uid.set(0,n.position.y,0)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld()}if(i.preservePosition)for(l=0;l<h.length;++l)(a=i.names[(n=h[l]).name]||n.name)!==i.hip&&n.position.copy(s[l]);i.preserveMatrix&&e.updateMatrixWorld(!0)}),retargetClip:function(e,t,i,r){(r=r||{}).useFirstFramePosition=void 0!==r.useFirstFramePosition&&r.useFirstFramePosition,r.fps=void 0!==r.fps?r.fps:30,r.names=r.names||[],t.isObject3D||(t=this.getHelperFromSkeleton(t));var n,a,o,s,l,c,h=Math.round(i.duration*(r.fps/1e3)*1e3),u=1/r.fps,d=[],p=new AnimationMixer(t),m=this.getBones(e.skeleton),f=[];for(p.clipAction(i).play(),p.update(0),t.updateMatrixWorld(),l=0;l<h;++l){var g=l*u;for(this.retarget(e,t,r),c=0;c<m.length;++c)this.getBoneByName(s=r.names[m[c].name]||m[c].name,t.skeleton)&&(a=m[c],o=f[c]=f[c]||{bone:a},r.hip===s&&(o.pos||(o.pos={times:new Float32Array(h),values:new Float32Array(3*h)}),r.useFirstFramePosition&&(0===l&&(n=a.position.clone()),a.position.sub(n)),o.pos.times[l]=g,a.position.toArray(o.pos.values,3*l)),o.quat||(o.quat={times:new Float32Array(h),values:new Float32Array(4*h)}),o.quat.times[l]=g,a.quaternion.toArray(o.quat.values,4*l));p.update(u),t.updateMatrixWorld()}for(l=0;l<f.length;++l)(o=f[l])&&(o.pos&&d.push(new VectorKeyframeTrack(".bones["+o.bone.name+"].position",o.pos.times,o.pos.values)),d.push(new QuaternionKeyframeTrack(".bones["+o.bone.name+"].quaternion",o.quat.times,o.quat.values)));return p.uncacheAction(i),new AnimationClip(i.name,-1,d)},getHelperFromSkeleton:function(e){var t=new SkeletonHelper(e.bones[0]);return t.skeleton=e,t},getSkeletonOffsets:(hjd=new Vector3,ijd=new Vector3,jjd=new Vector3,kjd=new Vector3,ljd=new Vector2,mjd=new Vector2,function(e,t,i){(i=i||{}).hip=void 0!==i.hip?i.hip:"hip",i.names=i.names||{},t.isObject3D||(t=this.getHelperFromSkeleton(t));var r,n,a,o,s=Object.keys(i.names),l=Object.values(i.names),c=t.isObject3D?t.skeleton.bones:this.getBones(t),h=e.isObject3D?e.skeleton.bones:this.getBones(e),u=[];for(e.skeleton.pose(),o=0;o<h.length;++o)if((n=this.getBoneByName(a=i.names[(r=h[o]).name]||r.name,c))&&a!==i.hip){var d=this.getNearestBone(r.parent,s),p=this.getNearestBone(n.parent,l);d.updateMatrixWorld(),p.updateMatrixWorld(),hjd.setFromMatrixPosition(d.matrixWorld),ijd.setFromMatrixPosition(r.matrixWorld),jjd.setFromMatrixPosition(p.matrixWorld),kjd.setFromMatrixPosition(n.matrixWorld),ljd.subVectors(new Vector2(ijd.x,ijd.y),new Vector2(hjd.x,hjd.y)).normalize(),mjd.subVectors(new Vector2(kjd.x,kjd.y),new Vector2(jjd.x,jjd.y)).normalize();var m=ljd.angle()-mjd.angle(),f=(new Matrix4).makeRotationFromEuler(new Euler(0,0,m));r.matrix.multiply(f),r.matrix.decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(),u[a]=f}return u}),renameBones:function(e,t){for(var i=this.getBones(e),r=0;r<i.length;++r){var n=i[r];t[n.name]&&(n.name=t[n.name])}return this},getBones:function(e){return Array.isArray(e)?e:e.bones},getBoneByName:function(e,t){for(var i=0,r=this.getBones(t);i<r.length;i++)if(e===r[i].name)return r[i]},getNearestBone:function(e,t){for(;e.isBone;){if(-1!==t.indexOf(e.name))return e;e=e.parent}},findBoneTrackData:function(e,t){for(var i=/\[(.*)\]\.(.*)/,r={name:e},n=0;n<t.length;++n){var a=i.exec(t[n].name);a&&e===a[1]&&(r[a[2]]=n)}return r},getEqualsBonesNames:function(e,t){var i=this.getBones(e),r=this.getBones(t),n=[];e:for(var a=0;a<i.length;a++)for(var o=i[a].name,s=0;s<r.length;s++)if(o===r[s].name){n.push(o);continue e}return n},clone:function(e){var n=new Map,a=new Map,t=e.clone();return parallelTraverse(e,t,function(e,t){n.set(t,e),a.set(e,t)}),t.traverse(function(e){if(e.isSkinnedMesh){var t=e,i=n.get(e),r=i.skeleton.bones;t.skeleton=i.skeleton.clone(),t.bindMatrix.copy(i.bindMatrix),t.skeleton.bones=r.map(function(e){return a.get(e)}),t.bind(t.skeleton,t.bindMatrix)}}),t}},hjd,ijd,jjd,kjd,ljd,mjd,uid,vid,wid,xid,yid,zid;function parallelTraverse(e,t,i){i(e,t);for(var r=0;r<e.children.length;r++)parallelTraverse(e.children[r],t.children[r],i)}var GLTFLoader=function(){function e(e){Loader.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.pluginCallbacks=[],this.register(function(e){return new t(e)}),this.register(function(e){return new n(e)}),this.register(function(e){return new r(e)})}function i(){var i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(t,i,e,r){var n,a=this;n=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(t),a.manager.itemStart(t);function o(e){r?r(e):console.error(e),a.manager.itemError(t),a.manager.itemEnd(t)}var s=new FileLoader(a.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),"use-credentials"===a.crossOrigin&&s.setWithCredentials(!0),s.load(t,function(e){try{a.parse(e,n,function(e){i(e),a.manager.itemEnd(t)},o)}catch(e){o(e)}},e,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,r){var n,a={},o={};if("string"==typeof e)n=e;else if(LoaderUtils.decodeText(new Uint8Array(e,0,4))===v){try{a[m.KHR_BINARY_GLTF]=new y(e)}catch(e){return void(r&&r(e))}n=a[m.KHR_BINARY_GLTF].content}else n=LoaderUtils.decodeText(new Uint8Array(e));var s=JSON.parse(n);if(void 0===s.asset||s.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var l=new $(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader});l.fileLoader.setRequestHeader(this.requestHeader);for(var c=0;c<this.pluginCallbacks.length;c++){var h=this.pluginCallbacks[c](l);a[(o[h.name]=h).name]=!0}if(s.extensionsUsed)for(c=0;c<s.extensionsUsed.length;++c){var u=s.extensionsUsed[c],d=s.extensionsRequired||[];switch(u){case m.KHR_LIGHTS_PUNCTUAL:a[u]=new f(s);break;case m.KHR_MATERIALS_UNLIT:a[u]=new g;break;case m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[u]=new w;break;case m.KHR_DRACO_MESH_COMPRESSION:a[u]=new x(s,this.dracoLoader);break;case m.MSFT_TEXTURE_DDS:a[u]=new p(this.ddsLoader);break;case m.KHR_TEXTURE_TRANSFORM:a[u]=new _;break;case m.KHR_MESH_QUANTIZATION:a[u]=new M;break;default:0<=d.indexOf(u)&&void 0===o[u]&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(i,r)}}});var m={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function p(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=m.MSFT_TEXTURE_DDS,this.ddsLoader=e}function f(e){this.name=m.KHR_LIGHTS_PUNCTUAL,this.lightDefs=(e.extensions&&e.extensions[m.KHR_LIGHTS_PUNCTUAL]||{}).lights||[]}function g(){this.name=m.KHR_MATERIALS_UNLIT}function t(e){this.parser=e,this.name=m.KHR_MATERIALS_CLEARCOAT}function r(e){this.parser=e,this.name=m.KHR_MATERIALS_TRANSMISSION}function n(e){this.parser=e,this.name=m.KHR_TEXTURE_BASISU}f.prototype.loadLight=function(e){var t,i=this.lightDefs[e],r=new Color(16777215);void 0!==i.color&&r.fromArray(i.color);var n=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new DirectionalLight(r)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new PointLight(r)).distance=n;break;case"spot":(t=new SpotLight(r)).distance=n,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=i.name||"light_"+e,Promise.resolve(t)},g.prototype.getMaterialType=function(){return MeshBasicMaterial},g.prototype.extendParams=function(e,t,i){var r=[];e.color=new Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var a=n.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==n.baseColorTexture&&r.push(i.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(r)},t.prototype.getMaterialType=function(){return MeshPhysicalMaterial},t.prototype.extendMaterialParams=function(e,t){var i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Vector2(o,o)}return Promise.all(n)},r.prototype.getMaterialType=function(){return MeshPhysicalMaterial},r.prototype.extendMaterialParams=function(e,t){var i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var n=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)},n.prototype.loadTexture=function(e){var t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var n=i.images[r.extensions[this.name].source],a=t.options.ktx2Loader;if(!a)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return t.loadTextureImage(e,n,a)};var v="glTF",l=12,c={JSON:1313821514,BIN:5130562};function y(e){this.name=m.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,l);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==v)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=new DataView(e,l),r=0;r<i.byteLength;){var n=i.getUint32(r,!0),a=i.getUint32(r+=4,!0);if(r+=4,a===c.JSON){var o=new Uint8Array(e,l+r,n);this.content=LoaderUtils.decodeText(o)}else if(a===c.BIN){var s=l+r;this.body=e.slice(s,s+n)}r+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function x(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=m.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function _(){this.name=m.KHR_TEXTURE_TRANSFORM}function b(e){MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),s={specular:{value:(new Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),e.fragmentShader=e.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_pars_fragment>",i),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_pars_fragment>",r),e.fragmentShader=e.fragmentShader.replace("#include <roughnessmap_fragment>",n),e.fragmentShader=e.fragmentShader.replace("#include <metalnessmap_fragment>",a),e.fragmentShader=e.fragmentShader.replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){(s.glossinessMap.value=e)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function w(){return{name:m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return b},extendParams:function(e,t,i){var r=t.extensions[this.name];e.color=new Color(1,1,1),e.opacity=1;var n=[];if(Array.isArray(r.diffuseFactor)){var a=r.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==r.diffuseTexture&&n.push(i.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var o=r.specularGlossinessTexture;n.push(i.assignTexture(e,"glossinessMap",o)),n.push(i.assignTexture(e,"specularMap",o))}return Promise.all(n)},createMaterial:function(e){var t=new b(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function M(){this.name=m.KHR_MESH_QUANTIZATION}function A(e,t,i,r){Interpolant.call(this,e,t,i,r)}x.prototype.decodePrimitive=function(e,t){var i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var c in a){var h=F[c]||c.toLowerCase();o[h]=a[c]}for(c in e.attributes){h=F[c]||c.toLowerCase();if(void 0!==a[c]){var u=i.accessors[e.attributes[c]];l[h]=D[u.componentType],s[h]=!0===u.normalized}}return t.getDependency("bufferView",r).then(function(e){return new Promise(function(r){n.decodeDracoFile(e,function(e){for(var t in e.attributes){var i=s[t];void 0!==i&&(e.attributes[t].normalized=i)}r(e)},o,l)})})},_.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},((b.prototype=Object.create(MeshStandardMaterial.prototype)).constructor=b).prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},((A.prototype=Object.create(Interpolant.prototype)).constructor=A).prototype.beforeStart_=A.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r,a=0;a!==r;a++)t[a]=i[n+a];return t},A.prototype.afterEnd_=A.prototype.copySampleValue_,A.prototype.interpolate_=function(e,t,i,r){for(var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=r-t,h=(i-t)/c,u=h*h,d=u*h,p=e*l,m=p-l,f=-2*d+3*u,g=d-u,v=1-f,y=g-u+h,x=0;x!==o;x++){n[x]=v*a[m+x+o]+y*(a[m+x+s]*c)+f*a[p+x+o]+g*(a[p+x]*c)}return n};var S=0,T=1,E=2,C=3,L=4,R=5,P=6,D={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},d={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},k={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},B={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},V="OPAQUE",U="MASK",G="BLEND",N={"image/png":RGBAFormat,"image/jpeg":RGBFormat};function z(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function H(e,t,i){for(var r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function j(e,t){void 0!==t.extras&&("object"===_typeof(t.extras)?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function W(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function q(e){for(var t="",i=Object.keys(e).sort(),r=0,n=i.length;r<n;r++)t+=i[r]+":"+e[i[r]]+";";return t}function $(e,t){this.json=e||{},this.extensions={},this.plugins={},this.options=t||{},this.cache=new i,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new ImageBitmapLoader(this.options.manager):this.textureLoader=new TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function X(i,e,r){var t=e.attributes,n=[];function a(e,t){return r.getDependency("accessor",e).then(function(e){i.setAttribute(t,e)})}for(var o in t){var s=F[o]||o.toLowerCase();s in i.attributes||n.push(a(t[o],s))}if(void 0!==e.indices&&!i.index){var l=r.getDependency("accessor",e.indices).then(function(e){i.setIndex(e)});n.push(l)}return j(i,e),function(e,t,i){var r=t.attributes,n=new Box3;if(void 0!==r.POSITION){var a=(d=i.json.accessors[r.POSITION]).max;if(void 0!==(p=d.min)&&void 0!==a){n.set(new Vector3(p[0],p[1],p[2]),new Vector3(a[0],a[1],a[2]));var o=t.targets;if(void 0!==o){for(var s=new Vector3,l=new Vector3,c=0,h=o.length;c<h;c++){var u=o[c];if(void 0!==u.POSITION){var d,p;a=(d=i.json.accessors[u.POSITION]).max;void 0!==(p=d.min)&&void 0!==a?(l.setX(Math.max(Math.abs(p[0]),Math.abs(a[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(a[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(a[2]))),s.max(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(s)}e.boundingBox=n;var m=new Sphere;n.getCenter(m.center),m.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(i,e,r),Promise.all(n).then(function(){return void 0!==e.targets?function(i,e,t){for(var r=!1,n=!1,a=0,o=e.length;a<o;a++){if(void 0!==(c=e[a]).POSITION&&(r=!0),void 0!==c.NORMAL&&(n=!0),r&&n)break}if(!r&&!n)return Promise.resolve(i);var s=[],l=[];for(a=0,o=e.length;a<o;a++){var c=e[a];if(r){var h=void 0!==c.POSITION?t.getDependency("accessor",c.POSITION):i.attributes.position;s.push(h)}if(n){h=void 0!==c.NORMAL?t.getDependency("accessor",c.NORMAL):i.attributes.normal;l.push(h)}}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(e){var t=e[1];return r&&(i.morphAttributes.position=e[0]),n&&(i.morphAttributes.normal=t),i.morphTargetsRelative=!0,i})}(i,e.targets,r):i})}function Y(e,t){var i=e.getIndex();if(null===i){var r=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<n.count;a++)r.push(a);e.setIndex(r),i=e.getIndex()}var o=i.count-2,s=[];if(t===TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(i.getX(0)),s.push(i.getX(a)),s.push(i.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(i.getX(a)),s.push(i.getX(a+1)),s.push(i.getX(a+2))):(s.push(i.getX(a+2)),s.push(i.getX(a+1)),s.push(i.getX(a)));s.length/3!=o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l}function h(e,a,o,s){var c=o.nodes[e];return s.getDependency("node",e).then(function(e){return void 0===c.skin?e:s.getDependency("skin",c.skin).then(function(e){for(var t=[],i=0,r=(l=e).joints.length;i<r;i++)t.push(s.getDependency("node",l.joints[i]));return Promise.all(t)}).then(function(s){return e.traverse(function(e){if(e.isMesh){for(var t=[],i=[],r=0,n=s.length;r<n;r++){var a=s[r];if(a){t.push(a);var o=new Matrix4;void 0!==l.inverseBindMatrices&&o.fromArray(l.inverseBindMatrices.array,16*r),i.push(o)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',l.joints[r])}e.bind(new Skeleton(t,i),e.matrixWorld)}}),e});var l}).then(function(e){a.add(e);var t=[];if(c.children)for(var i=c.children,r=0,n=i.length;r<n;r++){t.push(h(i[r],e,o,s))}return Promise.all(t)})}return $.prototype.setExtensions=function(e){this.extensions=e},$.prototype.setPlugins=function(e){this.plugins=e},$.prototype.parse=function(i,e){var r=this,n=this.json,a=this.extensions;this.cache.removeAll(),this._markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(e){var t={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:r,userData:{}};H(a,t,n),j(t,n),i(t)}).catch(e)},$.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],r=0,n=t.length;r<n;r++)for(var a=t[r].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var l=0,c=e.length;l<c;l++){var h=e[l];void 0!==h.mesh&&(this._addNodeRef(this.meshCache,h.mesh),void 0!==h.skin&&(i[h.mesh].isSkinnedMesh=!0)),void 0!==h.camera&&this._addNodeRef(this.cameraCache,h.camera),h.extensions&&h.extensions[m.KHR_LIGHTS_PUNCTUAL]&&void 0!==h.extensions[m.KHR_LIGHTS_PUNCTUAL].light&&this._addNodeRef(this.lightCache,h.extensions[m.KHR_LIGHTS_PUNCTUAL].light)}},$.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},$.prototype._getNodeRef=function(e,t,i){if(e.refs[t]<=1)return i;var r=i.clone();return r.name+="_instance_"+e.uses[t]++,r},$.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var i=0;i<t.length;i++){var r=e(t[i]);if(r)return r}},$.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var i=[],r=0;r<t.length;r++)i.push(e(t[r]));return Promise.all(i)},$.prototype.getDependency=function(e,t){var i=e+":"+t,r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;case"light":r=this.extensions[m.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r},$.prototype.getDependencies=function(i){var e=this.cache.get(i);if(!e){var r=this;e=Promise.all((this.json[i+("mesh"===i?"es":"s")]||[]).map(function(e,t){return r.getDependency(i,t)})),this.cache.add(i,e)}return e},$.prototype.loadBuffer=function(e){var i=this.json.buffers[e],r=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===e)return Promise.resolve(this.extensions[m.KHR_BINARY_GLTF].body);var n=this.options;return new Promise(function(e,t){r.load(z(i.uri,n.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})},$.prototype.loadBufferView=function(e){var i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(e){var t=i.byteOffset||0;return e.slice(t,t+(i.byteLength||0))})},$.prototype.loadAccessor=function(e){var y=this,x=this.json,_=this.json.accessors[e];if(void 0===_.bufferView&&void 0===_.sparse)return Promise.resolve(null);var t=[];return t.push(void 0!==_.bufferView?this.getDependency("bufferView",_.bufferView):null),void 0!==_.sparse&&(t.push(this.getDependency("bufferView",_.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",_.sparse.values.bufferView))),Promise.all(t).then(function(e){var t,i=e[0],r=B[_.type],n=D[_.componentType],a=n.BYTES_PER_ELEMENT,o=_.byteOffset||0,s=void 0!==_.bufferView?x.bufferViews[_.bufferView].byteStride:void 0,l=!0===_.normalized;if(s&&s!==a*r){var c=Math.floor(o/s),h="InterleavedBuffer:"+_.bufferView+":"+_.componentType+":"+c+":"+_.count,u=y.cache.get(h);u||(u=new InterleavedBuffer(new n(i,c*s,_.count*s/a),s/a),y.cache.add(h,u)),t=new InterleavedBufferAttribute(u,r,o%s/a,l)}else t=new BufferAttribute(null===i?new n(_.count*r):new n(i,o,_.count*r),r,l);if(void 0!==_.sparse){var d=_.sparse.values.byteOffset||0,p=new D[_.sparse.indices.componentType](e[1],_.sparse.indices.byteOffset||0,_.sparse.count*B.SCALAR),m=new n(e[2],d,_.sparse.count*r);null!==i&&(t=new BufferAttribute(t.array.slice(),t.itemSize,t.normalized));for(var f=0,g=p.length;f<g;f++){var v=p[f];if(t.setX(v,m[f*r]),2<=r&&t.setY(v,m[f*r+1]),3<=r&&t.setZ(v,m[f*r+2]),4<=r&&t.setW(v,m[f*r+3]),5<=r)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return t})},$.prototype.loadTexture=function(e){var t,i,r=this.json,n=r.textures[e],a=n.extensions||{};return(t=a[m.MSFT_TEXTURE_DDS]?r.images[a[m.MSFT_TEXTURE_DDS].source]:r.images[n.source]).uri&&(i=this.options.manager.getHandler(t.uri)),this.loadTextureImage(e,t,i=i||(a[m.MSFT_TEXTURE_DDS]?this.extensions[m.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader))},$.prototype.loadTextureImage=function(i,r,n){var a=this,o=this.json,s=this.options,l=o.textures[i],c=self.URL||self.webkitURL,h=r.uri,u=!1;return void 0!==r.bufferView&&(h=a.getDependency("bufferView",r.bufferView).then(function(e){u=!0;var t=new Blob([e],{type:r.mimeType});return h=c.createObjectURL(t)})),Promise.resolve(h).then(function(r){return new Promise(function(t,e){var i=t;!0===n.isImageBitmapLoader&&(i=function(e){t(new CanvasTexture(e))}),n.load(z(r,s.path),i,void 0,e)})}).then(function(e){!0===u&&c.revokeObjectURL(h),e.flipY=!1,l.name&&(e.name=l.name),r.mimeType in N&&(e.format=N[r.mimeType]);var t=(o.samplers||{})[l.sampler]||{};return e.magFilter=d[t.magFilter]||LinearFilter,e.minFilter=d[t.minFilter]||LinearMipmapLinearFilter,e.wrapS=k[t.wrapS]||RepeatWrapping,e.wrapT=k[t.wrapT]||RepeatWrapping,a.associations.set(e,{type:"textures",index:i}),e})},$.prototype.assignTexture=function(r,n,a){var o=this;return this.getDependency("texture",a.index).then(function(e){if(!e.isCompressedTexture)switch(n){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":e.format=RGBFormat}if(void 0===a.texCoord||0==a.texCoord||"aoMap"===n&&1==a.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+a.texCoord+" for texture "+n+" not yet supported."),o.extensions[m.KHR_TEXTURE_TRANSFORM]){var t=void 0!==a.extensions?a.extensions[m.KHR_TEXTURE_TRANSFORM]:void 0;if(t){var i=o.associations.get(e);e=o.extensions[m.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),o.associations.set(e,i)}}r[n]=e})},$.prototype.assignFinalMaterial=function(e){var t=e.geometry,i=e.material,r=void 0!==t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal,o=!0===e.isSkinnedMesh,s=0<Object.keys(t.morphAttributes).length,l=s&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c=this.cache.get(u="PointsMaterial:"+i.uuid);c||(c=new PointsMaterial,Material.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(u,c)),i=c}else if(e.isLine){var h=this.cache.get(u="LineBasicMaterial:"+i.uuid);h||(h=new LineBasicMaterial,Material.prototype.copy.call(h,i),h.color.copy(i.color),this.cache.add(u,h)),i=h}if(r||n||a||o||s){var u="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),o&&(u+="skinning:"),r&&(u+="vertex-tangents:"),n&&(u+="vertex-colors:"),a&&(u+="flat-shading:"),s&&(u+="morph-targets:"),l&&(u+="morph-normals:");var d=this.cache.get(u);d||(d=i.clone(),o&&(d.skinning=!0),r&&(d.vertexTangents=!0),n&&(d.vertexColors=!0),a&&(d.flatShading=!0),s&&(d.morphTargets=!0),l&&(d.morphNormals=!0),this.cache.add(u,d),this.associations.set(d,this.associations.get(i))),i=d}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),i.normalScale&&!r&&(i.normalScale.y=-i.normalScale.y),i.clearcoatNormalScale&&!r&&(i.clearcoatNormalScale.y=-i.clearcoatNormalScale.y),e.material=i},$.prototype.getMaterialType=function(){return MeshStandardMaterial},$.prototype.loadMaterial=function(t){var i,r=this,n=this.extensions,a=this.json.materials[t],o={},e=a.extensions||{},s=[];if(e[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=n[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=l.getMaterialType(),s.push(l.extendParams(o,a,r))}else if(e[m.KHR_MATERIALS_UNLIT]){var c=n[m.KHR_MATERIALS_UNLIT];i=c.getMaterialType(),s.push(c.extendParams(o,a,r))}else{var h=a.pbrMetallicRoughness||{};if(o.color=new Color(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var u=h.baseColorFactor;o.color.fromArray(u),o.opacity=u[3]}void 0!==h.baseColorTexture&&s.push(r.assignTexture(o,"map",h.baseColorTexture)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(s.push(r.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),s.push(r.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),i=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),s.push(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))}!0===a.doubleSided&&(o.side=DoubleSide);var d=a.alphaMode||V;return d===G?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,d===U&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&i!==MeshBasicMaterial&&(s.push(r.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new Vector2(1,1),void 0!==a.normalTexture.scale&&o.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&i!==MeshBasicMaterial&&(s.push(r.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&i!==MeshBasicMaterial&&(o.emissive=(new Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&i!==MeshBasicMaterial&&s.push(r.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(s).then(function(){var e;return e=i===b?n[m.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new i(o),a.name&&(e.name=a.name),e.map&&(e.map.encoding=sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=sRGBEncoding),j(e,a),r.associations.set(e,{type:"materials",index:t}),a.extensions&&H(n,e,a),e})},$.prototype.loadGeometries=function(e){var i=this,r=this.extensions,t=this.primitiveCache;function n(t){return r[m.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,i).then(function(e){return X(e,t,i)})}for(var a,o,s=[],l=0,c=e.length;l<c;l++){var h,u=e[l],d=(o=(a=u).extensions&&a.extensions[m.KHR_DRACO_MESH_COMPRESSION])?"draco:"+o.bufferView+":"+o.indices+":"+q(o.attributes):a.indices+":"+q(a.attributes)+":"+a.mode,p=t[d];if(p)s.push(p.promise);else h=u.extensions&&u.extensions[m.KHR_DRACO_MESH_COMPRESSION]?n(u):X(new BufferGeometry,u,i),t[d]={primitive:u,promise:h},s.push(h)}return Promise.all(s)},$.prototype.loadMesh=function(u){for(var e,d=this,p=this.json.meshes[u],m=p.primitives,t=[],i=0,r=m.length;i<r;i++){var n=void 0===m[i].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),e.DefaultMaterial):this.getDependency("material",m[i].material);t.push(n)}return t.push(d.loadGeometries(m)),Promise.all(t).then(function(e){for(var t=e.slice(0,e.length-1),i=e[e.length-1],r=[],n=0,a=i.length;n<a;n++){var o,s=i[n],l=m[n],c=t[n];if(l.mode===L||l.mode===R||l.mode===P||void 0===l.mode)!0!==(o=new(!0===p.isSkinnedMesh?SkinnedMesh:Mesh)(s,c)).isSkinnedMesh||o.geometry.attributes.skinWeight.normalized||o.normalizeSkinWeights(),l.mode===R?o.geometry=Y(o.geometry,TriangleStripDrawMode):l.mode===P&&(o.geometry=Y(o.geometry,TriangleFanDrawMode));else if(l.mode===T)o=new LineSegments(s,c);else if(l.mode===C)o=new Line(s,c);else if(l.mode===E)o=new LineLoop(s,c);else{if(l.mode!==S)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+l.mode);o=new Points(s,c)}0<Object.keys(o.geometry.morphAttributes).length&&W(o,p),o.name=p.name||"mesh_"+u,1<i.length&&(o.name+="_"+n),j(o,p),d.assignFinalMaterial(o),r.push(o)}if(1===r.length)return r[0];var h=new Group;for(n=0,a=r.length;n<a;n++)h.add(r[n]);return h})},$.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new PerspectiveCamera(MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=i.name),j(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},$.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})},$.prototype.loadAnimation=function(S){for(var T=this.json.animations[S],e=[],t=[],i=[],r=[],n=[],a=0,o=T.channels.length;a<o;a++){var s=T.channels[a],l=T.samplers[s.sampler],c=s.target,h=void 0!==T.parameters?T.parameters[l.input]:l.input,u=void 0!==T.parameters?T.parameters[l.output]:l.output;e.push(this.getDependency("node",void 0!==c.node?c.node:c.id)),t.push(this.getDependency("accessor",h)),i.push(this.getDependency("accessor",u)),r.push(l),n.push(c)}return Promise.all([Promise.all(e),Promise.all(t),Promise.all(i),Promise.all(r),Promise.all(n)]).then(function(e){for(var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=[],s=0,l=t.length;s<l;s++){var c=t[s],h=i[s],u=r[s],d=n[s],p=a[s];if(void 0!==c){var m;switch(c.updateMatrix(),c.matrixAutoUpdate=!0,I[p.path]){case I.weights:m=NumberKeyframeTrack;break;case I.rotation:m=QuaternionKeyframeTrack;break;case I.position:case I.scale:default:m=VectorKeyframeTrack}var f=c.name?c.name:c.uuid,g=void 0!==d.interpolation?O[d.interpolation]:InterpolateLinear,v=[];I[p.path]===I.weights?c.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&v.push(e.name?e.name:e.uuid)}):v.push(f);var y=u.array;if(u.normalized){var x;if(y.constructor===Int8Array)x=1/127;else if(y.constructor===Uint8Array)x=1/255;else if(y.constructor==Int16Array)x=1/32767;else{if(y.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");x=1/65535}for(var _=new Float32Array(y.length),b=0,w=y.length;b<w;b++)_[b]=y[b]*x;y=_}for(b=0,w=v.length;b<w;b++){var M=new m(v[b]+"."+I[p.path],h.array,y,g);"CUBICSPLINE"===d.interpolation&&(M.createInterpolant=function(e){return new A(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),o.push(M)}}}return new AnimationClip(T.name?T.name:"animation_"+S,void 0,o)})},$.prototype.loadNode=function(a){var o=this.extensions,s=this,l=this.json.nodes[a];return function(){var e=[];if(void 0!==l.mesh&&e.push(s.getDependency("mesh",l.mesh).then(function(e){var t=s._getNodeRef(s.meshCache,l.mesh,e);return void 0!==l.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,i=l.weights.length;t<i;t++)e.morphTargetInfluences[t]=l.weights[t]}),t})),void 0!==l.camera&&e.push(s.getDependency("camera",l.camera).then(function(e){return s._getNodeRef(s.cameraCache,l.camera,e)})),l.extensions&&l.extensions[m.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[m.KHR_LIGHTS_PUNCTUAL].light){var t=l.extensions[m.KHR_LIGHTS_PUNCTUAL].light;e.push(s.getDependency("light",t).then(function(e){return s._getNodeRef(s.lightCache,t,e)}))}return Promise.all(e)}().then(function(e){var t;if((t=!0===l.isBone?new Bone:1<e.length?new Group:1===e.length?e[0]:new Object3D)!==e[0])for(var i=0,r=e.length;i<r;i++)t.add(e[i]);if(l.name&&(t.userData.name=l.name,t.name=PropertyBinding.sanitizeNodeName(l.name)),j(t,l),l.extensions&&H(o,t,l),void 0!==l.matrix){var n=new Matrix4;n.fromArray(l.matrix),t.applyMatrix4(n)}else void 0!==l.translation&&t.position.fromArray(l.translation),void 0!==l.rotation&&t.quaternion.fromArray(l.rotation),void 0!==l.scale&&t.scale.fromArray(l.scale);return s.associations.set(t,{type:"nodes",index:a}),t})},$.prototype.loadScene=function(e){var t=this.json,i=this.extensions,r=this.json.scenes[e],n=new Group;r.name&&(n.name=r.name),j(n,r),r.extensions&&H(i,n,r);for(var a=r.nodes||[],o=[],s=0,l=a.length;s<l;s++)o.push(h(a[s],n,t,this));return Promise.all(o).then(function(){return n})},e}(),DRACOLoader=function(e){Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};DRACOLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,i,r){var n=this,a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&a.setWithCredentials(!0),a.load(e,function(e){n.decodeGeometry(e,{attributeIDs:n.defaultAttributeIDs,attributeTypes:n.defaultAttributeTypes,useUniqueIDs:!1}).then(t).catch(r)},i,r)},decodeDracoFile:function(e,t,i,r){this.decodeGeometry(e,{attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i}).then(t)},decodeGeometry:function(i,r){var t=this;for(var e in r.attributeTypes){var n=r.attributeTypes[e];void 0!==n.BYTES_PER_ELEMENT&&(r.attributeTypes[e]=n.name)}var a,o=JSON.stringify(r);if(DRACOLoader.taskCache.has(i)){var s=DRACOLoader.taskCache.get(i);if(s.key===o)return s.promise;if(0===i.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.workerNextTaskID++,c=this._getWorker(l,i.byteLength).then(function(e){return a=e,new Promise(function(e,t){a._callbacks[l]={resolve:e,reject:t},a.postMessage({type:"decode",id:l,taskConfig:r,buffer:i},[i])})}).then(function(e){return t._createGeometry(e.geometry)});return c.finally(function(){a&&l&&t._releaseTask(a,l)}),DRACOLoader.taskCache.set(i,{key:o,promise:c}),c},_createGeometry:function(e){var t=new BufferGeometry;e.index&&t.setIndex(new BufferAttribute(e.index.array,1));for(var i=0;i<e.attributes.length;i++){var r=e.attributes[i];t.setAttribute(r.name,new BufferAttribute(r.array,r.itemSize))}return t},_loadLibrary:function(i,e){var r=new FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(e),new Promise(function(e,t){r.load(i,e,void 0,t)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var n=this;if(this.decoderPending)return this.decoderPending;var a="object"!==("undefined"==typeof WebAssembly?"undefined":_typeof(WebAssembly))||"js"===this.decoderConfig.type,e=[];return a?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(function(e){var t=e[0];a||(n.decoderConfig.wasmBinary=e[1]);var i=DRACOLoader.DRACOWorker.toString(),r=["/* draco decoder */",t,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");n.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending},_getWorker:function(e,t){var r=this;return this._initDecoder().then(function(){var i;r.workerPool.length<r.workerLimit?((i=new Worker(r.workerSourceURL))._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:r.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},r.workerPool.push(i)):r.workerPool.sort(function(e,t){return t._taskLoad<e._taskLoad?-1:1});return(i=r.workerPool[r.workerPool.length-1])._taskCosts[e]=t,i._taskLoad+=t,i})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(function(e){return e._taskLoad}))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),DRACOLoader.DRACOWorker=function(){var i,t;function x(e,t,i,r,n,a){var o,s,l=a.num_components(),c=i.num_points()*l;switch(n){case Float32Array:o=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(i,a,o),s=new Float32Array(c);break;case Int8Array:o=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(i,a,o),s=new Int8Array(c);break;case Int16Array:o=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(i,a,o),s=new Int16Array(c);break;case Int32Array:o=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(i,a,o),s=new Int32Array(c);break;case Uint8Array:o=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(i,a,o),s=new Uint8Array(c);break;case Uint16Array:o=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(i,a,o),s=new Uint16Array(c);break;case Uint32Array:o=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(i,a,o),s=new Uint32Array(c);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var h=0;h<c;h++)s[h]=o.GetValue(h);return e.destroy(o),{name:r,array:s,itemSize:l}}this.onmessage=function(e){var o=e.data;switch(o.type){case"init":i=o.decoderConfig,t=new Promise(function(t){i.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(i)});break;case"decode":var s=o.buffer,l=o.taskConfig;t.then(function(e){var t=e.draco,i=new t.Decoder,r=new t.DecoderBuffer;r.Init(new Int8Array(s),s.byteLength);try{var n=function(e,t,i,r){var n,a,o=r.attributeIDs,s=r.attributeTypes,l=t.GetEncodedGeometryType(i);if(l===e.TRIANGULAR_MESH)n=new e.Mesh,a=t.DecodeBufferToMesh(i,n);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");n=new e.PointCloud,a=t.DecodeBufferToPointCloud(i,n)}if(!a.ok()||0===n.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+a.error_msg());var c={index:null,attributes:[]};for(var h in o){var u,d,p=self[s[h]];if(r.useUniqueIDs)u=t.GetAttributeByUniqueId(n,d=o[h]);else{if(-1===(d=t.GetAttributeId(n,e[o[h]])))continue;u=t.GetAttribute(n,d)}c.attributes.push(x(e,t,n,h,p,u))}if(l===e.TRIANGULAR_MESH){for(var m=n.num_faces(),f=new Uint32Array(3*m),g=new e.DracoInt32Array,v=0;v<m;++v){t.GetFaceFromMesh(n,v,g);for(var y=0;y<3;++y)f[3*v+y]=g.GetValue(y)}c.index={array:f,itemSize:1},e.destroy(g)}return e.destroy(n),c}(t,i,r,l),a=n.attributes.map(function(e){return e.array.buffer});n.index&&a.push(n.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:n},a)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(r),t.destroy(i)}})}}},DRACOLoader.taskCache=new WeakMap,DRACOLoader.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},DRACOLoader.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},DRACOLoader.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},DRACOLoader.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};var TGALoader=function(e){Loader.call(this,e)};function CharsetEncoder(){}function DataViewEx(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this.encoder=new CharsetEncoder}function DataCreationHelper(){}function Parser(){}TGALoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TGALoader,load:function(e,t,i,r){var n=this,a=new Texture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){a.image=n.parse(e),a.needsUpdate=!0,void 0!==t&&t(a)},i,r),a},parse:function(e){e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var t=new Uint8Array(e),i=0,f={id_length:t[i++],colormap_type:t[i++],image_type:t[i++],colormap_index:t[i++]|t[i++]<<8,colormap_length:t[i++]|t[i++]<<8,colormap_size:t[i++],origin:[t[i++]|t[i++]<<8,t[i++]|t[i++]<<8],width:t[i++]|t[i++]<<8,height:t[i++]|t[i++]<<8,pixel_size:t[i++],flags:t[i++]};!function(e){switch(e.image_type){case 1:case 9:(256<e.colormap_length||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(f),e.length<f.id_length+i&&console.error("THREE.TGALoader: No data."),i+=f.id_length;var r=!1,n=!1,u=!1;switch(f.image_type){case 9:n=r=!0;break;case 1:n=!0;break;case 10:r=!0;break;case 2:break;case 11:u=r=!0;break;case 3:u=!0}var a="undefined"!=typeof OffscreenCanvas,o=a?new OffscreenCanvas(f.width,f.height):document.createElement("canvas");o.width=f.width,o.height=f.height;var s=o.getContext("2d"),l=s.createImageData(f.width,f.height),c=function(e,t,i,r,n){var a,o,s,l;if(s=i.width*i.height*(o=i.pixel_size>>3),t&&(l=n.subarray(r,r+=i.colormap_length*(i.colormap_size>>3))),e){var c,h,u;a=new Uint8Array(s);for(var d=0,p=new Uint8Array(o);d<s;)if(h=1+(127&(c=n[r++])),128&c){for(u=0;u<o;++u)p[u]=n[r++];for(u=0;u<h;++u)a.set(p,d+u*o);d+=o*h}else{for(h*=o,u=0;u<h;++u)a[d+u]=n[r++];d+=h}}else a=n.subarray(r,r+=t?i.width*i.height:s);return{pixel_data:a,palettes:l}}(r,n,f,i,t);return function(e,t,i,r,n){var a,o,s,l,c,h;switch((48&f.flags)>>4){default:case 2:c=t,o=a=0,l=s=1,h=i;break;case 0:a=0,c=t,o=i-(s=1),h=l=-1;break;case 3:a=t-1,c=s=-1,o=0,l=1,h=i;break;case 1:a=t-1,o=i-1,h=l=c=s=-1}if(u)switch(f.pixel_size){case 8:!function(e,t,i,r,n,a,o,s){var l,c,h,u=0,d=f.width;for(h=t;h!==r;h+=i)for(c=n;c!==o;c+=a,u++)e[4*(c+d*h)+0]=l=s[u],e[4*(c+d*h)+1]=l,e[4*(c+d*h)+2]=l,e[4*(c+d*h)+3]=255}(e,o,l,h,a,s,c,r);break;case 16:!function(e,t,i,r,n,a,o,s){var l,c,h=0,u=f.width;for(c=t;c!==r;c+=i)for(l=n;l!==o;l+=a,h+=2)e[4*(l+u*c)+0]=s[h+0],e[4*(l+u*c)+1]=s[h+0],e[4*(l+u*c)+2]=s[h+0],e[4*(l+u*c)+3]=s[h+1]}(e,o,l,h,a,s,c,r);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(f.pixel_size){case 8:!function(e,t,i,r,n,a,o,s,l){var c,h,u,d=l,p=0,m=f.width;for(u=t;u!==r;u+=i)for(h=n;h!==o;h+=a,p++)c=s[p],e[4*(h+m*u)+3]=255,e[4*(h+m*u)+2]=d[3*c+0],e[4*(h+m*u)+1]=d[3*c+1],e[4*(h+m*u)+0]=d[3*c+2]}(e,o,l,h,a,s,c,r,n);break;case 16:!function(e,t,i,r,n,a,o,s){var l,c,h,u=0,d=f.width;for(h=t;h!==r;h+=i)for(c=n;c!==o;c+=a,u+=2)e[4*(c+d*h)+0]=(31744&(l=s[u+0]+(s[u+1]<<8)))>>7,e[4*(c+d*h)+1]=(992&l)>>2,e[4*(c+d*h)+2]=(31&l)>>3,e[4*(c+d*h)+3]=32768&l?0:255}(e,o,l,h,a,s,c,r);break;case 24:!function(e,t,i,r,n,a,o,s){var l,c,h=0,u=f.width;for(c=t;c!==r;c+=i)for(l=n;l!==o;l+=a,h+=3)e[4*(l+u*c)+3]=255,e[4*(l+u*c)+2]=s[h+0],e[4*(l+u*c)+1]=s[h+1],e[4*(l+u*c)+0]=s[h+2]}(e,o,l,h,a,s,c,r);break;case 32:!function(e,t,i,r,n,a,o,s){var l,c,h=0,u=f.width;for(c=t;c!==r;c+=i)for(l=n;l!==o;l+=a,h+=4)e[4*(l+u*c)+2]=s[h+0],e[4*(l+u*c)+1]=s[h+1],e[4*(l+u*c)+0]=s[h+2],e[4*(l+u*c)+3]=s[h+3]}(e,o,l,h,a,s,c,r);break;default:console.error("THREE.TGALoader: Format not supported.")}}(l.data,f.width,f.height,c.pixel_data,c.palettes),s.putImageData(l,0,0),a?o.transferToImageBitmap():o}}),CharsetEncoder.prototype.s2u=function(e){for(var t=this.s2uTable,i="",r=0;r<e.length;){var n=e[r++];if(!(0<=n&&n<=126||161<=n&&n<=223)&&r<e.length&&(n=n<<8|e[r++]),void 0===t[n])throw"unknown char code "+n+".";i+=String.fromCharCode(t[n])}return i},CharsetEncoder.prototype.s2uTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:65340,33120:65374,33121:8741,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:65293,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:65504,33170:65505,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:65506,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34624:9312,34625:9313,34626:9314,34627:9315,34628:9316,34629:9317,34630:9318,34631:9319,34632:9320,34633:9321,34634:9322,34635:9323,34636:9324,34637:9325,34638:9326,34639:9327,34640:9328,34641:9329,34642:9330,34643:9331,34644:8544,34645:8545,34646:8546,34647:8547,34648:8548,34649:8549,34650:8550,34651:8551,34652:8552,34653:8553,34655:13129,34656:13076,34657:13090,34658:13133,34659:13080,34660:13095,34661:13059,34662:13110,34663:13137,34664:13143,34665:13069,34666:13094,34667:13091,34668:13099,34669:13130,34670:13115,34671:13212,34672:13213,34673:13214,34674:13198,34675:13199,34676:13252,34677:13217,34686:13179,34688:12317,34689:12319,34690:8470,34691:13261,34692:8481,34693:12964,34694:12965,34695:12966,34696:12967,34697:12968,34698:12849,34699:12850,34700:12857,34701:13182,34702:13181,34703:13180,34704:8786,34705:8801,34706:8747,34707:8750,34708:8721,34709:8730,34710:8869,34711:8736,34712:8735,34713:8895,34714:8757,34715:8745,34716:8746,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081,60736:32394,60737:35100,60738:37704,60739:37512,60740:34012,60741:20425,60742:28859,60743:26161,60744:26824,60745:37625,60746:26363,60747:24389,60748:20008,60749:20193,60750:20220,60751:20224,60752:20227,60753:20281,60754:20310,60755:20370,60756:20362,60757:20378,60758:20372,60759:20429,60760:20544,60761:20514,60762:20479,60763:20510,60764:20550,60765:20592,60766:20546,60767:20628,60768:20724,60769:20696,60770:20810,60771:20836,60772:20893,60773:20926,60774:20972,60775:21013,60776:21148,60777:21158,60778:21184,60779:21211,60780:21248,60781:21255,60782:21284,60783:21362,60784:21395,60785:21426,60786:21469,60787:64014,60788:21660,60789:21642,60790:21673,60791:21759,60792:21894,60793:22361,60794:22373,60795:22444,60796:22472,60797:22471,60798:64015,60800:64016,60801:22686,60802:22706,60803:22795,60804:22867,60805:22875,60806:22877,60807:22883,60808:22948,60809:22970,60810:23382,60811:23488,60812:29999,60813:23512,60814:23532,60815:23582,60816:23718,60817:23738,60818:23797,60819:23847,60820:23891,60821:64017,60822:23874,60823:23917,60824:23992,60825:23993,60826:24016,60827:24353,60828:24372,60829:24423,60830:24503,60831:24542,60832:24669,60833:24709,60834:24714,60835:24798,60836:24789,60837:24864,60838:24818,60839:24849,60840:24887,60841:24880,60842:24984,60843:25107,60844:25254,60845:25589,60846:25696,60847:25757,60848:25806,60849:25934,60850:26112,60851:26133,60852:26171,60853:26121,60854:26158,60855:26142,60856:26148,60857:26213,60858:26199,60859:26201,60860:64018,60861:26227,60862:26265,60863:26272,60864:26290,60865:26303,60866:26362,60867:26382,60868:63785,60869:26470,60870:26555,60871:26706,60872:26560,60873:26625,60874:26692,60875:26831,60876:64019,60877:26984,60878:64020,60879:27032,60880:27106,60881:27184,60882:27243,60883:27206,60884:27251,60885:27262,60886:27362,60887:27364,60888:27606,60889:27711,60890:27740,60891:27782,60892:27759,60893:27866,60894:27908,60895:28039,60896:28015,60897:28054,60898:28076,60899:28111,60900:28152,60901:28146,60902:28156,60903:28217,60904:28252,60905:28199,60906:28220,60907:28351,60908:28552,60909:28597,60910:28661,60911:28677,60912:28679,60913:28712,60914:28805,60915:28843,60916:28943,60917:28932,60918:29020,60919:28998,60920:28999,60921:64021,60922:29121,60923:29182,60924:29361,60992:29374,60993:29476,60994:64022,60995:29559,60996:29629,60997:29641,60998:29654,60999:29667,61e3:29650,61001:29703,61002:29685,61003:29734,61004:29738,61005:29737,61006:29742,61007:29794,61008:29833,61009:29855,61010:29953,61011:30063,61012:30338,61013:30364,61014:30366,61015:30363,61016:30374,61017:64023,61018:30534,61019:21167,61020:30753,61021:30798,61022:30820,61023:30842,61024:31024,61025:64024,61026:64025,61027:64026,61028:31124,61029:64027,61030:31131,61031:31441,61032:31463,61033:64028,61034:31467,61035:31646,61036:64029,61037:32072,61038:32092,61039:32183,61040:32160,61041:32214,61042:32338,61043:32583,61044:32673,61045:64030,61046:33537,61047:33634,61048:33663,61049:33735,61050:33782,61051:33864,61052:33972,61053:34131,61054:34137,61056:34155,61057:64031,61058:34224,61059:64032,61060:64033,61061:34823,61062:35061,61063:35346,61064:35383,61065:35449,61066:35495,61067:35518,61068:35551,61069:64034,61070:35574,61071:35667,61072:35711,61073:36080,61074:36084,61075:36114,61076:36214,61077:64035,61078:36559,61079:64036,61080:64037,61081:36967,61082:37086,61083:64038,61084:37141,61085:37159,61086:37338,61087:37335,61088:37342,61089:37357,61090:37358,61091:37348,61092:37349,61093:37382,61094:37392,61095:37386,61096:37434,61097:37440,61098:37436,61099:37454,61100:37465,61101:37457,61102:37433,61103:37479,61104:37543,61105:37495,61106:37496,61107:37607,61108:37591,61109:37593,61110:37584,61111:64039,61112:37589,61113:37600,61114:37587,61115:37669,61116:37665,61117:37627,61118:64040,61119:37662,61120:37631,61121:37661,61122:37634,61123:37744,61124:37719,61125:37796,61126:37830,61127:37854,61128:37880,61129:37937,61130:37957,61131:37960,61132:38290,61133:63964,61134:64041,61135:38557,61136:38575,61137:38707,61138:38715,61139:38723,61140:38733,61141:38735,61142:38737,61143:38741,61144:38999,61145:39013,61146:64042,61147:64043,61148:39207,61149:64044,61150:39326,61151:39502,61152:39641,61153:39644,61154:39797,61155:39794,61156:39823,61157:39857,61158:39867,61159:39936,61160:40304,61161:40299,61162:64045,61163:40473,61164:40657,61167:8560,61168:8561,61169:8562,61170:8563,61171:8564,61172:8565,61173:8566,61174:8567,61175:8568,61176:8569,61177:65506,61178:65508,61179:65287,61180:65282,61504:57344,61505:57345,61506:57346,61507:57347,61508:57348,61509:57349,61510:57350,61511:57351,61512:57352,61513:57353,61514:57354,61515:57355,61516:57356,61517:57357,61518:57358,61519:57359,61520:57360,61521:57361,61522:57362,61523:57363,61524:57364,61525:57365,61526:57366,61527:57367,61528:57368,61529:57369,61530:57370,61531:57371,61532:57372,61533:57373,61534:57374,61535:57375,61536:57376,61537:57377,61538:57378,61539:57379,61540:57380,61541:57381,61542:57382,61543:57383,61544:57384,61545:57385,61546:57386,61547:57387,61548:57388,61549:57389,61550:57390,61551:57391,61552:57392,61553:57393,61554:57394,61555:57395,61556:57396,61557:57397,61558:57398,61559:57399,61560:57400,61561:57401,61562:57402,61563:57403,61564:57404,61565:57405,61566:57406,61568:57407,61569:57408,61570:57409,61571:57410,61572:57411,61573:57412,61574:57413,61575:57414,61576:57415,61577:57416,61578:57417,61579:57418,61580:57419,61581:57420,61582:57421,61583:57422,61584:57423,61585:57424,61586:57425,61587:57426,61588:57427,61589:57428,61590:57429,61591:57430,61592:57431,61593:57432,61594:57433,61595:57434,61596:57435,61597:57436,61598:57437,61599:57438,61600:57439,61601:57440,61602:57441,61603:57442,61604:57443,61605:57444,61606:57445,61607:57446,61608:57447,61609:57448,61610:57449,61611:57450,61612:57451,61613:57452,61614:57453,61615:57454,61616:57455,61617:57456,61618:57457,61619:57458,61620:57459,61621:57460,61622:57461,61623:57462,61624:57463,61625:57464,61626:57465,61627:57466,61628:57467,61629:57468,61630:57469,61631:57470,61632:57471,61633:57472,61634:57473,61635:57474,61636:57475,61637:57476,61638:57477,61639:57478,61640:57479,61641:57480,61642:57481,61643:57482,61644:57483,61645:57484,61646:57485,61647:57486,61648:57487,61649:57488,61650:57489,61651:57490,61652:57491,61653:57492,61654:57493,61655:57494,61656:57495,61657:57496,61658:57497,61659:57498,61660:57499,61661:57500,61662:57501,61663:57502,61664:57503,61665:57504,61666:57505,61667:57506,61668:57507,61669:57508,61670:57509,61671:57510,61672:57511,61673:57512,61674:57513,61675:57514,61676:57515,61677:57516,61678:57517,61679:57518,61680:57519,61681:57520,61682:57521,61683:57522,61684:57523,61685:57524,61686:57525,61687:57526,61688:57527,61689:57528,61690:57529,61691:57530,61692:57531,61760:57532,61761:57533,61762:57534,61763:57535,61764:57536,61765:57537,61766:57538,61767:57539,61768:57540,61769:57541,61770:57542,61771:57543,61772:57544,61773:57545,61774:57546,61775:57547,61776:57548,61777:57549,61778:57550,61779:57551,61780:57552,61781:57553,61782:57554,61783:57555,61784:57556,61785:57557,61786:57558,61787:57559,61788:57560,61789:57561,61790:57562,61791:57563,61792:57564,61793:57565,61794:57566,61795:57567,61796:57568,61797:57569,61798:57570,61799:57571,61800:57572,61801:57573,61802:57574,61803:57575,61804:57576,61805:57577,61806:57578,61807:57579,61808:57580,61809:57581,61810:57582,61811:57583,61812:57584,61813:57585,61814:57586,61815:57587,61816:57588,61817:57589,61818:57590,61819:57591,61820:57592,61821:57593,61822:57594,61824:57595,61825:57596,61826:57597,61827:57598,61828:57599,61829:57600,61830:57601,61831:57602,61832:57603,61833:57604,61834:57605,61835:57606,61836:57607,61837:57608,61838:57609,61839:57610,61840:57611,61841:57612,61842:57613,61843:57614,61844:57615,61845:57616,61846:57617,61847:57618,61848:57619,61849:57620,61850:57621,61851:57622,61852:57623,61853:57624,61854:57625,61855:57626,61856:57627,61857:57628,61858:57629,61859:57630,61860:57631,61861:57632,61862:57633,61863:57634,61864:57635,61865:57636,61866:57637,61867:57638,61868:57639,61869:57640,61870:57641,61871:57642,61872:57643,61873:57644,61874:57645,61875:57646,61876:57647,61877:57648,61878:57649,61879:57650,61880:57651,61881:57652,61882:57653,61883:57654,61884:57655,61885:57656,61886:57657,61887:57658,61888:57659,61889:57660,61890:57661,61891:57662,61892:57663,61893:57664,61894:57665,61895:57666,61896:57667,61897:57668,61898:57669,61899:57670,61900:57671,61901:57672,61902:57673,61903:57674,61904:57675,61905:57676,61906:57677,61907:57678,61908:57679,61909:57680,61910:57681,61911:57682,61912:57683,61913:57684,61914:57685,61915:57686,61916:57687,61917:57688,61918:57689,61919:57690,61920:57691,61921:57692,61922:57693,61923:57694,61924:57695,61925:57696,61926:57697,61927:57698,61928:57699,61929:57700,61930:57701,61931:57702,61932:57703,61933:57704,61934:57705,61935:57706,61936:57707,61937:57708,61938:57709,61939:57710,61940:57711,61941:57712,61942:57713,61943:57714,61944:57715,61945:57716,61946:57717,61947:57718,61948:57719,62016:57720,62017:57721,62018:57722,62019:57723,62020:57724,62021:57725,62022:57726,62023:57727,62024:57728,62025:57729,62026:57730,62027:57731,62028:57732,62029:57733,62030:57734,62031:57735,62032:57736,62033:57737,62034:57738,62035:57739,62036:57740,62037:57741,62038:57742,62039:57743,62040:57744,62041:57745,62042:57746,62043:57747,62044:57748,62045:57749,62046:57750,62047:57751,62048:57752,62049:57753,62050:57754,62051:57755,62052:57756,62053:57757,62054:57758,62055:57759,62056:57760,62057:57761,62058:57762,62059:57763,62060:57764,62061:57765,62062:57766,62063:57767,62064:57768,62065:57769,62066:57770,62067:57771,62068:57772,62069:57773,62070:57774,62071:57775,62072:57776,62073:57777,62074:57778,62075:57779,62076:57780,62077:57781,62078:57782,62080:57783,62081:57784,62082:57785,62083:57786,62084:57787,62085:57788,62086:57789,62087:57790,62088:57791,62089:57792,62090:57793,62091:57794,62092:57795,62093:57796,62094:57797,62095:57798,62096:57799,62097:57800,62098:57801,62099:57802,62100:57803,62101:57804,62102:57805,62103:57806,62104:57807,62105:57808,62106:57809,62107:57810,62108:57811,62109:57812,62110:57813,62111:57814,62112:57815,62113:57816,62114:57817,62115:57818,62116:57819,62117:57820,62118:57821,62119:57822,62120:57823,62121:57824,62122:57825,62123:57826,62124:57827,62125:57828,62126:57829,62127:57830,62128:57831,62129:57832,62130:57833,62131:57834,62132:57835,62133:57836,62134:57837,62135:57838,62136:57839,62137:57840,62138:57841,62139:57842,62140:57843,62141:57844,62142:57845,62143:57846,62144:57847,62145:57848,62146:57849,62147:57850,62148:57851,62149:57852,62150:57853,62151:57854,62152:57855,62153:57856,62154:57857,62155:57858,62156:57859,62157:57860,62158:57861,62159:57862,62160:57863,62161:57864,62162:57865,62163:57866,62164:57867,62165:57868,62166:57869,62167:57870,62168:57871,62169:57872,62170:57873,62171:57874,62172:57875,62173:57876,62174:57877,62175:57878,62176:57879,62177:57880,62178:57881,62179:57882,62180:57883,62181:57884,62182:57885,62183:57886,62184:57887,62185:57888,62186:57889,62187:57890,62188:57891,62189:57892,62190:57893,62191:57894,62192:57895,62193:57896,62194:57897,62195:57898,62196:57899,62197:57900,62198:57901,62199:57902,62200:57903,62201:57904,62202:57905,62203:57906,62204:57907,62272:57908,62273:57909,62274:57910,62275:57911,62276:57912,62277:57913,62278:57914,62279:57915,62280:57916,62281:57917,62282:57918,62283:57919,62284:57920,62285:57921,62286:57922,62287:57923,62288:57924,62289:57925,62290:57926,62291:57927,62292:57928,62293:57929,62294:57930,62295:57931,62296:57932,62297:57933,62298:57934,62299:57935,62300:57936,62301:57937,62302:57938,62303:57939,62304:57940,62305:57941,62306:57942,62307:57943,62308:57944,62309:57945,62310:57946,62311:57947,62312:57948,62313:57949,62314:57950,62315:57951,62316:57952,62317:57953,62318:57954,62319:57955,62320:57956,62321:57957,62322:57958,62323:57959,62324:57960,62325:57961,62326:57962,62327:57963,62328:57964,62329:57965,62330:57966,62331:57967,62332:57968,62333:57969,62334:57970,62336:57971,62337:57972,62338:57973,62339:57974,62340:57975,62341:57976,62342:57977,62343:57978,62344:57979,62345:57980,62346:57981,62347:57982,62348:57983,62349:57984,62350:57985,62351:57986,62352:57987,62353:57988,62354:57989,62355:57990,62356:57991,62357:57992,62358:57993,62359:57994,62360:57995,62361:57996,62362:57997,62363:57998,62364:57999,62365:58e3,62366:58001,62367:58002,62368:58003,62369:58004,62370:58005,62371:58006,62372:58007,62373:58008,62374:58009,62375:58010,62376:58011,62377:58012,62378:58013,62379:58014,62380:58015,62381:58016,62382:58017,62383:58018,62384:58019,62385:58020,62386:58021,62387:58022,62388:58023,62389:58024,62390:58025,62391:58026,62392:58027,62393:58028,62394:58029,62395:58030,62396:58031,62397:58032,62398:58033,62399:58034,62400:58035,62401:58036,62402:58037,62403:58038,62404:58039,62405:58040,62406:58041,62407:58042,62408:58043,62409:58044,62410:58045,62411:58046,62412:58047,62413:58048,62414:58049,62415:58050,62416:58051,62417:58052,62418:58053,62419:58054,62420:58055,62421:58056,62422:58057,62423:58058,62424:58059,62425:58060,62426:58061,62427:58062,62428:58063,62429:58064,62430:58065,62431:58066,62432:58067,62433:58068,62434:58069,62435:58070,62436:58071,62437:58072,62438:58073,62439:58074,62440:58075,62441:58076,62442:58077,62443:58078,62444:58079,62445:58080,62446:58081,62447:58082,62448:58083,62449:58084,62450:58085,62451:58086,62452:58087,62453:58088,62454:58089,62455:58090,62456:58091,62457:58092,62458:58093,62459:58094,62460:58095,62528:58096,62529:58097,62530:58098,62531:58099,62532:58100,62533:58101,62534:58102,62535:58103,62536:58104,62537:58105,62538:58106,62539:58107,62540:58108,62541:58109,62542:58110,62543:58111,62544:58112,62545:58113,62546:58114,62547:58115,62548:58116,62549:58117,62550:58118,62551:58119,62552:58120,62553:58121,62554:58122,62555:58123,62556:58124,62557:58125,62558:58126,62559:58127,62560:58128,62561:58129,62562:58130,62563:58131,62564:58132,62565:58133,62566:58134,62567:58135,62568:58136,62569:58137,62570:58138,62571:58139,62572:58140,62573:58141,62574:58142,62575:58143,62576:58144,62577:58145,62578:58146,62579:58147,62580:58148,62581:58149,62582:58150,62583:58151,62584:58152,62585:58153,62586:58154,62587:58155,62588:58156,62589:58157,62590:58158,62592:58159,62593:58160,62594:58161,62595:58162,62596:58163,62597:58164,62598:58165,62599:58166,62600:58167,62601:58168,62602:58169,62603:58170,62604:58171,62605:58172,62606:58173,62607:58174,62608:58175,62609:58176,62610:58177,62611:58178,62612:58179,62613:58180,62614:58181,62615:58182,62616:58183,62617:58184,62618:58185,62619:58186,62620:58187,62621:58188,62622:58189,62623:58190,62624:58191,62625:58192,62626:58193,62627:58194,62628:58195,62629:58196,62630:58197,62631:58198,62632:58199,62633:58200,62634:58201,62635:58202,62636:58203,62637:58204,62638:58205,62639:58206,62640:58207,62641:58208,62642:58209,62643:58210,62644:58211,62645:58212,62646:58213,62647:58214,62648:58215,62649:58216,62650:58217,62651:58218,62652:58219,62653:58220,62654:58221,62655:58222,62656:58223,62657:58224,62658:58225,62659:58226,62660:58227,62661:58228,62662:58229,62663:58230,62664:58231,62665:58232,62666:58233,62667:58234,62668:58235,62669:58236,62670:58237,62671:58238,62672:58239,62673:58240,62674:58241,62675:58242,62676:58243,62677:58244,62678:58245,62679:58246,62680:58247,62681:58248,62682:58249,62683:58250,62684:58251,62685:58252,62686:58253,62687:58254,62688:58255,62689:58256,62690:58257,62691:58258,62692:58259,62693:58260,62694:58261,62695:58262,62696:58263,62697:58264,62698:58265,62699:58266,62700:58267,62701:58268,62702:58269,62703:58270,62704:58271,62705:58272,62706:58273,62707:58274,62708:58275,62709:58276,62710:58277,62711:58278,62712:58279,62713:58280,62714:58281,62715:58282,62716:58283,62784:58284,62785:58285,62786:58286,62787:58287,62788:58288,62789:58289,62790:58290,62791:58291,62792:58292,62793:58293,62794:58294,62795:58295,62796:58296,62797:58297,62798:58298,62799:58299,62800:58300,62801:58301,62802:58302,62803:58303,62804:58304,62805:58305,62806:58306,62807:58307,62808:58308,62809:58309,62810:58310,62811:58311,62812:58312,62813:58313,62814:58314,62815:58315,62816:58316,62817:58317,62818:58318,62819:58319,62820:58320,62821:58321,62822:58322,62823:58323,62824:58324,62825:58325,62826:58326,62827:58327,62828:58328,62829:58329,62830:58330,62831:58331,62832:58332,62833:58333,62834:58334,62835:58335,62836:58336,62837:58337,62838:58338,62839:58339,62840:58340,62841:58341,62842:58342,62843:58343,62844:58344,62845:58345,62846:58346,62848:58347,62849:58348,62850:58349,62851:58350,62852:58351,62853:58352,62854:58353,62855:58354,62856:58355,62857:58356,62858:58357,62859:58358,62860:58359,62861:58360,62862:58361,62863:58362,62864:58363,62865:58364,62866:58365,62867:58366,62868:58367,62869:58368,62870:58369,62871:58370,62872:58371,62873:58372,62874:58373,62875:58374,62876:58375,62877:58376,62878:58377,62879:58378,62880:58379,62881:58380,62882:58381,62883:58382,62884:58383,62885:58384,62886:58385,62887:58386,62888:58387,62889:58388,62890:58389,62891:58390,62892:58391,62893:58392,62894:58393,62895:58394,62896:58395,62897:58396,62898:58397,62899:58398,62900:58399,62901:58400,62902:58401,62903:58402,62904:58403,62905:58404,62906:58405,62907:58406,62908:58407,62909:58408,62910:58409,62911:58410,62912:58411,62913:58412,62914:58413,62915:58414,62916:58415,62917:58416,62918:58417,62919:58418,62920:58419,62921:58420,62922:58421,62923:58422,62924:58423,62925:58424,62926:58425,62927:58426,62928:58427,62929:58428,62930:58429,62931:58430,62932:58431,62933:58432,62934:58433,62935:58434,62936:58435,62937:58436,62938:58437,62939:58438,62940:58439,62941:58440,62942:58441,62943:58442,62944:58443,62945:58444,62946:58445,62947:58446,62948:58447,62949:58448,62950:58449,62951:58450,62952:58451,62953:58452,62954:58453,62955:58454,62956:58455,62957:58456,62958:58457,62959:58458,62960:58459,62961:58460,62962:58461,62963:58462,62964:58463,62965:58464,62966:58465,62967:58466,62968:58467,62969:58468,62970:58469,62971:58470,62972:58471,63040:58472,63041:58473,63042:58474,63043:58475,63044:58476,63045:58477,63046:58478,63047:58479,63048:58480,63049:58481,63050:58482,63051:58483,63052:58484,63053:58485,63054:58486,63055:58487,63056:58488,63057:58489,63058:58490,63059:58491,63060:58492,63061:58493,63062:58494,63063:58495,63064:58496,63065:58497,63066:58498,63067:58499,63068:58500,63069:58501,63070:58502,63071:58503,63072:58504,63073:58505,63074:58506,63075:58507,63076:58508,63077:58509,63078:58510,63079:58511,63080:58512,63081:58513,63082:58514,63083:58515,63084:58516,63085:58517,63086:58518,63087:58519,63088:58520,63089:58521,63090:58522,63091:58523,63092:58524,63093:58525,63094:58526,63095:58527,63096:58528,63097:58529,63098:58530,63099:58531,63100:58532,63101:58533,63102:58534,63104:58535,63105:58536,63106:58537,63107:58538,63108:58539,63109:58540,63110:58541,63111:58542,63112:58543,63113:58544,63114:58545,63115:58546,63116:58547,63117:58548,63118:58549,63119:58550,63120:58551,63121:58552,63122:58553,63123:58554,63124:58555,63125:58556,63126:58557,63127:58558,63128:58559,63129:58560,63130:58561,63131:58562,63132:58563,63133:58564,63134:58565,63135:58566,63136:58567,63137:58568,63138:58569,63139:58570,63140:58571,63141:58572,63142:58573,63143:58574,63144:58575,63145:58576,63146:58577,63147:58578,63148:58579,63149:58580,63150:58581,63151:58582,63152:58583,63153:58584,63154:58585,63155:58586,63156:58587,63157:58588,63158:58589,63159:58590,63160:58591,63161:58592,63162:58593,63163:58594,63164:58595,63165:58596,63166:58597,63167:58598,63168:58599,63169:58600,63170:58601,63171:58602,63172:58603,63173:58604,63174:58605,63175:58606,63176:58607,63177:58608,63178:58609,63179:58610,63180:58611,63181:58612,63182:58613,63183:58614,63184:58615,63185:58616,63186:58617,63187:58618,63188:58619,63189:58620,63190:58621,63191:58622,63192:58623,63193:58624,63194:58625,63195:58626,63196:58627,63197:58628,63198:58629,63199:58630,63200:58631,63201:58632,63202:58633,63203:58634,63204:58635,63205:58636,63206:58637,63207:58638,63208:58639,63209:58640,63210:58641,63211:58642,63212:58643,63213:58644,63214:58645,63215:58646,63216:58647,63217:58648,63218:58649,63219:58650,63220:58651,63221:58652,63222:58653,63223:58654,63224:58655,63225:58656,63226:58657,63227:58658,63228:58659,63296:58660,63297:58661,63298:58662,63299:58663,63300:58664,63301:58665,63302:58666,63303:58667,63304:58668,63305:58669,63306:58670,63307:58671,63308:58672,63309:58673,63310:58674,63311:58675,63312:58676,63313:58677,63314:58678,63315:58679,63316:58680,63317:58681,63318:58682,63319:58683,63320:58684,63321:58685,63322:58686,63323:58687,63324:58688,63325:58689,63326:58690,63327:58691,63328:58692,63329:58693,63330:58694,63331:58695,63332:58696,63333:58697,63334:58698,63335:58699,63336:58700,63337:58701,63338:58702,63339:58703,63340:58704,63341:58705,63342:58706,63343:58707,63344:58708,63345:58709,63346:58710,63347:58711,63348:58712,63349:58713,63350:58714,63351:58715,63352:58716,63353:58717,63354:58718,63355:58719,63356:58720,63357:58721,63358:58722,63360:58723,63361:58724,63362:58725,63363:58726,63364:58727,63365:58728,63366:58729,63367:58730,63368:58731,63369:58732,63370:58733,63371:58734,63372:58735,63373:58736,63374:58737,63375:58738,63376:58739,63377:58740,63378:58741,63379:58742,63380:58743,63381:58744,63382:58745,63383:58746,63384:58747,63385:58748,63386:58749,63387:58750,63388:58751,63389:58752,63390:58753,63391:58754,63392:58755,63393:58756,63394:58757,63395:58758,63396:58759,63397:58760,63398:58761,63399:58762,63400:58763,63401:58764,63402:58765,63403:58766,63404:58767,63405:58768,63406:58769,63407:58770,63408:58771,63409:58772,63410:58773,63411:58774,63412:58775,63413:58776,63414:58777,63415:58778,63416:58779,63417:58780,63418:58781,63419:58782,63420:58783,63421:58784,63422:58785,63423:58786,63424:58787,63425:58788,63426:58789,63427:58790,63428:58791,63429:58792,63430:58793,63431:58794,63432:58795,63433:58796,63434:58797,63435:58798,63436:58799,63437:58800,63438:58801,63439:58802,63440:58803,63441:58804,63442:58805,63443:58806,63444:58807,63445:58808,63446:58809,63447:58810,63448:58811,63449:58812,63450:58813,63451:58814,63452:58815,63453:58816,63454:58817,63455:58818,63456:58819,63457:58820,63458:58821,63459:58822,63460:58823,63461:58824,63462:58825,63463:58826,63464:58827,63465:58828,63466:58829,63467:58830,63468:58831,63469:58832,63470:58833,63471:58834,63472:58835,63473:58836,63474:58837,63475:58838,63476:58839,63477:58840,63478:58841,63479:58842,63480:58843,63481:58844,63482:58845,63483:58846,63484:58847,63552:58848,63553:58849,63554:58850,63555:58851,63556:58852,63557:58853,63558:58854,63559:58855,63560:58856,63561:58857,63562:58858,63563:58859,63564:58860,63565:58861,63566:58862,63567:58863,63568:58864,63569:58865,63570:58866,63571:58867,63572:58868,63573:58869,63574:58870,63575:58871,63576:58872,63577:58873,63578:58874,63579:58875,63580:58876,63581:58877,63582:58878,63583:58879,63584:58880,63585:58881,63586:58882,63587:58883,63588:58884,63589:58885,63590:58886,63591:58887,63592:58888,63593:58889,63594:58890,63595:58891,63596:58892,63597:58893,63598:58894,63599:58895,63600:58896,63601:58897,63602:58898,63603:58899,63604:58900,63605:58901,63606:58902,63607:58903,63608:58904,63609:58905,63610:58906,63611:58907,63612:58908,63613:58909,63614:58910,63616:58911,63617:58912,63618:58913,63619:58914,63620:58915,63621:58916,63622:58917,63623:58918,63624:58919,63625:58920,63626:58921,63627:58922,63628:58923,63629:58924,63630:58925,63631:58926,63632:58927,63633:58928,63634:58929,63635:58930,63636:58931,63637:58932,63638:58933,63639:58934,63640:58935,63641:58936,63642:58937,63643:58938,63644:58939,63645:58940,63646:58941,63647:58942,63648:58943,63649:58944,63650:58945,63651:58946,63652:58947,63653:58948,63654:58949,63655:58950,63656:58951,63657:58952,63658:58953,63659:58954,63660:58955,63661:58956,63662:58957,63663:58958,63664:58959,63665:58960,63666:58961,63667:58962,63668:58963,63669:58964,63670:58965,63671:58966,63672:58967,63673:58968,63674:58969,63675:58970,63676:58971,63677:58972,63678:58973,63679:58974,63680:58975,63681:58976,63682:58977,63683:58978,63684:58979,63685:58980,63686:58981,63687:58982,63688:58983,63689:58984,63690:58985,63691:58986,63692:58987,63693:58988,63694:58989,63695:58990,63696:58991,63697:58992,63698:58993,63699:58994,63700:58995,63701:58996,63702:58997,63703:58998,63704:58999,63705:59e3,63706:59001,63707:59002,63708:59003,63709:59004,63710:59005,63711:59006,63712:59007,63713:59008,63714:59009,63715:59010,63716:59011,63717:59012,63718:59013,63719:59014,63720:59015,63721:59016,63722:59017,63723:59018,63724:59019,63725:59020,63726:59021,63727:59022,63728:59023,63729:59024,63730:59025,63731:59026,63732:59027,63733:59028,63734:59029,63735:59030,63736:59031,63737:59032,63738:59033,63739:59034,63740:59035,64064:8560,64065:8561,64066:8562,64067:8563,64068:8564,64069:8565,64070:8566,64071:8567,64072:8568,64073:8569,64074:8544,64075:8545,64076:8546,64077:8547,64078:8548,64079:8549,64080:8550,64081:8551,64082:8552,64083:8553,64084:65506,64085:65508,64086:65287,64087:65282,64088:12849,64089:8470,64090:8481,64091:8757,64092:32394,64093:35100,64094:37704,64095:37512,64096:34012,64097:20425,64098:28859,64099:26161,64100:26824,64101:37625,64102:26363,64103:24389,64104:20008,64105:20193,64106:20220,64107:20224,64108:20227,64109:20281,64110:20310,64111:20370,64112:20362,64113:20378,64114:20372,64115:20429,64116:20544,64117:20514,64118:20479,64119:20510,64120:20550,64121:20592,64122:20546,64123:20628,64124:20724,64125:20696,64126:20810,64128:20836,64129:20893,64130:20926,64131:20972,64132:21013,64133:21148,64134:21158,64135:21184,64136:21211,64137:21248,64138:21255,64139:21284,64140:21362,64141:21395,64142:21426,64143:21469,64144:64014,64145:21660,64146:21642,64147:21673,64148:21759,64149:21894,64150:22361,64151:22373,64152:22444,64153:22472,64154:22471,64155:64015,64156:64016,64157:22686,64158:22706,64159:22795,64160:22867,64161:22875,64162:22877,64163:22883,64164:22948,64165:22970,64166:23382,64167:23488,64168:29999,64169:23512,64170:23532,64171:23582,64172:23718,64173:23738,64174:23797,64175:23847,64176:23891,64177:64017,64178:23874,64179:23917,64180:23992,64181:23993,64182:24016,64183:24353,64184:24372,64185:24423,64186:24503,64187:24542,64188:24669,64189:24709,64190:24714,64191:24798,64192:24789,64193:24864,64194:24818,64195:24849,64196:24887,64197:24880,64198:24984,64199:25107,64200:25254,64201:25589,64202:25696,64203:25757,64204:25806,64205:25934,64206:26112,64207:26133,64208:26171,64209:26121,64210:26158,64211:26142,64212:26148,64213:26213,64214:26199,64215:26201,64216:64018,64217:26227,64218:26265,64219:26272,64220:26290,64221:26303,64222:26362,64223:26382,64224:63785,64225:26470,64226:26555,64227:26706,64228:26560,64229:26625,64230:26692,64231:26831,64232:64019,64233:26984,64234:64020,64235:27032,64236:27106,64237:27184,64238:27243,64239:27206,64240:27251,64241:27262,64242:27362,64243:27364,64244:27606,64245:27711,64246:27740,64247:27782,64248:27759,64249:27866,64250:27908,64251:28039,64252:28015,64320:28054,64321:28076,64322:28111,64323:28152,64324:28146,64325:28156,64326:28217,64327:28252,64328:28199,64329:28220,64330:28351,64331:28552,64332:28597,64333:28661,64334:28677,64335:28679,64336:28712,64337:28805,64338:28843,64339:28943,64340:28932,64341:29020,64342:28998,64343:28999,64344:64021,64345:29121,64346:29182,64347:29361,64348:29374,64349:29476,64350:64022,64351:29559,64352:29629,64353:29641,64354:29654,64355:29667,64356:29650,64357:29703,64358:29685,64359:29734,64360:29738,64361:29737,64362:29742,64363:29794,64364:29833,64365:29855,64366:29953,64367:30063,64368:30338,64369:30364,64370:30366,64371:30363,64372:30374,64373:64023,64374:30534,64375:21167,64376:30753,64377:30798,64378:30820,64379:30842,64380:31024,64381:64024,64382:64025,64384:64026,64385:31124,64386:64027,64387:31131,64388:31441,64389:31463,64390:64028,64391:31467,64392:31646,64393:64029,64394:32072,64395:32092,64396:32183,64397:32160,64398:32214,64399:32338,64400:32583,64401:32673,64402:64030,64403:33537,64404:33634,64405:33663,64406:33735,64407:33782,64408:33864,64409:33972,64410:34131,64411:34137,64412:34155,64413:64031,64414:34224,64415:64032,64416:64033,64417:34823,64418:35061,64419:35346,64420:35383,64421:35449,64422:35495,64423:35518,64424:35551,64425:64034,64426:35574,64427:35667,64428:35711,64429:36080,64430:36084,64431:36114,64432:36214,64433:64035,64434:36559,64435:64036,64436:64037,64437:36967,64438:37086,64439:64038,64440:37141,64441:37159,64442:37338,64443:37335,64444:37342,64445:37357,64446:37358,64447:37348,64448:37349,64449:37382,64450:37392,64451:37386,64452:37434,64453:37440,64454:37436,64455:37454,64456:37465,64457:37457,64458:37433,64459:37479,64460:37543,64461:37495,64462:37496,64463:37607,64464:37591,64465:37593,64466:37584,64467:64039,64468:37589,64469:37600,64470:37587,64471:37669,64472:37665,64473:37627,64474:64040,64475:37662,64476:37631,64477:37661,64478:37634,64479:37744,64480:37719,64481:37796,64482:37830,64483:37854,64484:37880,64485:37937,64486:37957,64487:37960,64488:38290,64489:63964,64490:64041,64491:38557,64492:38575,64493:38707,64494:38715,64495:38723,64496:38733,64497:38735,64498:38737,64499:38741,64500:38999,64501:39013,64502:64042,64503:64043,64504:39207,64505:64044,64506:39326,64507:39502,64508:39641,64576:39644,64577:39797,64578:39794,64579:39823,64580:39857,64581:39867,64582:39936,64583:40304,64584:40299,64585:64045,64586:40473,64587:40657},DataViewEx.prototype={constructor:DataViewEx,getInt8:function(){var e=this.dv.getInt8(this.offset);return this.offset+=1,e},getInt8Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt8());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint8Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getUint8());return t},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt16Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt16());return t},getUint16:function(){var e=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},getUint16Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getUint16());return t},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getUint32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getUint32());return t},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getIndex:function(e,t){switch(e){case 1:return!0===t?this.getUint8():this.getInt8();case 2:return!0===t?this.getUint16():this.getInt16();case 4:return this.getInt32();default:throw"unknown number type "+e+" exception."}},getIndexArray:function(e,t,i){for(var r=[],n=0;n<t;n++)r.push(this.getIndex(e,i));return r},getChars:function(e){for(var t="";0<e;){var i=this.getUint8();if(e--,0===i)break;t+=String.fromCharCode(i)}for(;0<e;)this.getUint8(),e--;return t},getSjisStringsAsUnicode:function(e){for(var t=[];0<e;){var i=this.getUint8();if(e--,0===i)break;t.push(i)}for(;0<e;)this.getUint8(),e--;return this.encoder.s2u(new Uint8Array(t))},getUnicodeStrings:function(e){for(var t="";0<e;){var i=this.getUint16();if(e-=2,0===i)break;t+=String.fromCharCode(i)}for(;0<e;)this.getUint8(),e--;return t},getTextBuffer:function(){var e=this.getUint32();return this.getUnicodeStrings(e)}},DataCreationHelper.prototype={constructor:DataCreationHelper,leftToRightVector3:function(e){e[2]=-e[2]},leftToRightQuaternion:function(e){e[0]=-e[0],e[1]=-e[1]},leftToRightEuler:function(e){e[0]=-e[0],e[1]=-e[1]},leftToRightIndexOrder:function(e){var t=e[2];e[2]=e[0],e[0]=t},leftToRightVector3Range:function(e,t){var i=-t[2];t[2]=-e[2],e[2]=i},leftToRightEulerRange:function(e,t){var i=-t[0],r=-t[1];t[0]=-e[0],t[1]=-e[1],e[0]=i,e[1]=r}},Parser.prototype.parsePmd=function(e,t){var r={},n=new DataViewEx(e);r.metadata={},r.metadata.format="pmd",r.metadata.coordinateSystem="left";var i;return function(){var e=r.metadata;if(e.magic=n.getChars(3),"Pmd"!==e.magic)throw"PMD file magic is not Pmd, but "+e.magic;e.version=n.getFloat32(),e.modelName=n.getSjisStringsAsUnicode(20),e.comment=n.getSjisStringsAsUnicode(256)}(),function(){var e,t=r.metadata;t.vertexCount=n.getUint32(),r.vertices=[];for(var i=0;i<t.vertexCount;i++)r.vertices.push((e=void 0,(e={}).position=n.getFloat32Array(3),e.normal=n.getFloat32Array(3),e.uv=n.getFloat32Array(2),e.skinIndices=n.getUint16Array(2),e.skinWeights=[n.getUint8()/100],e.skinWeights.push(1-e.skinWeights[0]),e.edgeFlag=n.getUint8(),e))}(),function(){var e,t=r.metadata;t.faceCount=n.getUint32()/3,r.faces=[];for(var i=0;i<t.faceCount;i++)r.faces.push((e=void 0,(e={}).indices=n.getUint16Array(3),e))}(),function(){var e,t=r.metadata;t.materialCount=n.getUint32(),r.materials=[];for(var i=0;i<t.materialCount;i++)r.materials.push((e=void 0,(e={}).diffuse=n.getFloat32Array(4),e.shininess=n.getFloat32(),e.specular=n.getFloat32Array(3),e.ambient=n.getFloat32Array(3),e.toonIndex=n.getInt8(),e.edgeFlag=n.getUint8(),e.faceCount=n.getUint32()/3,e.fileName=n.getSjisStringsAsUnicode(20),e))}(),function(){var e,t=r.metadata;t.boneCount=n.getUint16(),r.bones=[];for(var i=0;i<t.boneCount;i++)r.bones.push((e=void 0,(e={}).name=n.getSjisStringsAsUnicode(20),e.parentIndex=n.getInt16(),e.tailIndex=n.getInt16(),e.type=n.getUint8(),e.ikIndex=n.getInt16(),e.position=n.getFloat32Array(3),e))}(),function(){function e(){var e={};e.target=n.getUint16(),e.effector=n.getUint16(),e.linkCount=n.getUint8(),e.iteration=n.getUint16(),e.maxAngle=n.getFloat32(),e.links=[];for(var t=0;t<e.linkCount;t++){var i={};i.index=n.getUint16(),e.links.push(i)}return e}var t=r.metadata;t.ikCount=n.getUint16(),r.iks=[];for(var i=0;i<t.ikCount;i++)r.iks.push(e())}(),function(){function e(){var e={};e.name=n.getSjisStringsAsUnicode(20),e.elementCount=n.getUint32(),e.type=n.getUint8(),e.elements=[];for(var t=0;t<e.elementCount;t++)e.elements.push({index:n.getUint32(),position:n.getFloat32Array(3)});return e}var t=r.metadata;t.morphCount=n.getUint16(),r.morphs=[];for(var i=0;i<t.morphCount;i++)r.morphs.push(e())}(),function(){var e,t=r.metadata;t.morphFrameCount=n.getUint8(),r.morphFrames=[];for(var i=0;i<t.morphFrameCount;i++)r.morphFrames.push((e=void 0,(e={}).index=n.getUint16(),e))}(),function(){var e,t=r.metadata;t.boneFrameNameCount=n.getUint8(),r.boneFrameNames=[];for(var i=0;i<t.boneFrameNameCount;i++)r.boneFrameNames.push((e=void 0,(e={}).name=n.getSjisStringsAsUnicode(50),e))}(),function(){var e,t=r.metadata;t.boneFrameCount=n.getUint32(),r.boneFrames=[];for(var i=0;i<t.boneFrameCount;i++)r.boneFrames.push((e=void 0,(e={}).boneIndex=n.getInt16(),e.frameIndex=n.getUint8(),e))}(),(i=r.metadata).englishCompatibility=n.getUint8(),0<i.englishCompatibility&&(i.englishModelName=n.getSjisStringsAsUnicode(20),i.englishComment=n.getSjisStringsAsUnicode(256)),function(){var e=r.metadata;if(0!==e.englishCompatibility){r.englishBoneNames=[];for(var t=0;t<e.boneCount;t++)r.englishBoneNames.push((i=void 0,(i={}).name=n.getSjisStringsAsUnicode(20),i));var i}}(),function(){var e=r.metadata;if(0!==e.englishCompatibility){r.englishMorphNames=[];for(var t=0;t<e.morphCount-1;t++)r.englishMorphNames.push((i=void 0,(i={}).name=n.getSjisStringsAsUnicode(20),i));var i}}(),function(){var e=r.metadata;if(0!==e.englishCompatibility){r.englishBoneFrameNames=[];for(var t=0;t<e.boneFrameNameCount;t++)r.englishBoneFrameNames.push((i=void 0,(i={}).name=n.getSjisStringsAsUnicode(50),i));var i}}(),function(){var e;r.toonTextures=[];for(var t=0;t<10;t++)r.toonTextures.push((e=void 0,(e={}).fileName=n.getSjisStringsAsUnicode(100),e))}(),function(){var e,t=r.metadata;t.rigidBodyCount=n.getUint32(),r.rigidBodies=[];for(var i=0;i<t.rigidBodyCount;i++)r.rigidBodies.push((e=void 0,(e={}).name=n.getSjisStringsAsUnicode(20),e.boneIndex=n.getInt16(),e.groupIndex=n.getUint8(),e.groupTarget=n.getUint16(),e.shapeType=n.getUint8(),e.width=n.getFloat32(),e.height=n.getFloat32(),e.depth=n.getFloat32(),e.position=n.getFloat32Array(3),e.rotation=n.getFloat32Array(3),e.weight=n.getFloat32(),e.positionDamping=n.getFloat32(),e.rotationDamping=n.getFloat32(),e.restitution=n.getFloat32(),e.friction=n.getFloat32(),e.type=n.getUint8(),e))}(),function(){var e,t=r.metadata;t.constraintCount=n.getUint32(),r.constraints=[];for(var i=0;i<t.constraintCount;i++)r.constraints.push((e=void 0,(e={}).name=n.getSjisStringsAsUnicode(20),e.rigidBodyIndex1=n.getUint32(),e.rigidBodyIndex2=n.getUint32(),e.position=n.getFloat32Array(3),e.rotation=n.getFloat32Array(3),e.translationLimitation1=n.getFloat32Array(3),e.translationLimitation2=n.getFloat32Array(3),e.rotationLimitation1=n.getFloat32Array(3),e.rotationLimitation2=n.getFloat32Array(3),e.springPosition=n.getFloat32Array(3),e.springRotation=n.getFloat32Array(3),e))}(),!0===t&&this.leftToRightModel(r),r},Parser.prototype.parsePmx=function(e,t){var a={},o=new DataViewEx(e);a.metadata={},a.metadata.format="pmx",a.metadata.coordinateSystem="left";return function(){var e=a.metadata;if(e.magic=o.getChars(4),"PMX "!==e.magic)throw"PMX file magic is not PMX , but "+e.magic;if(e.version=o.getFloat32(),2!==e.version&&2.1!==e.version)throw"PMX version "+e.version+" is not supported.";e.headerSize=o.getUint8(),e.encoding=o.getUint8(),e.additionalUvNum=o.getUint8(),e.vertexIndexSize=o.getUint8(),e.textureIndexSize=o.getUint8(),e.materialIndexSize=o.getUint8(),e.boneIndexSize=o.getUint8(),e.morphIndexSize=o.getUint8(),e.rigidBodyIndexSize=o.getUint8(),e.modelName=o.getTextBuffer(),e.englishModelName=o.getTextBuffer(),e.comment=o.getTextBuffer(),e.englishComment=o.getTextBuffer()}(),function(){function e(){var e={};e.position=o.getFloat32Array(3),e.normal=o.getFloat32Array(3),e.uv=o.getFloat32Array(2),e.auvs=[];for(var t=0;t<a.metadata.additionalUvNum;t++)e.auvs.push(o.getFloat32Array(4));e.type=o.getUint8();var i=r.boneIndexSize;if(0===e.type)e.skinIndices=o.getIndexArray(i,1),e.skinWeights=[1];else if(1===e.type)e.skinIndices=o.getIndexArray(i,2),e.skinWeights=o.getFloat32Array(1),e.skinWeights.push(1-e.skinWeights[0]);else if(2===e.type)e.skinIndices=o.getIndexArray(i,4),e.skinWeights=o.getFloat32Array(4);else{if(3!==e.type)throw"unsupport bone type "+e.type+" exception.";e.skinIndices=o.getIndexArray(i,2),e.skinWeights=o.getFloat32Array(1),e.skinWeights.push(1-e.skinWeights[0]),e.skinC=o.getFloat32Array(3),e.skinR0=o.getFloat32Array(3),e.skinR1=o.getFloat32Array(3),e.type=1}return e.edgeRatio=o.getFloat32(),e}var r=a.metadata;r.vertexCount=o.getUint32(),a.vertices=[];for(var t=0;t<r.vertexCount;t++)a.vertices.push(e())}(),function(){var e,t=a.metadata;t.faceCount=o.getUint32()/3,a.faces=[];for(var i=0;i<t.faceCount;i++)a.faces.push((e=void 0,(e={}).indices=o.getIndexArray(t.vertexIndexSize,3,!0),e))}(),function(){var e=a.metadata;e.textureCount=o.getUint32(),a.textures=[];for(var t=0;t<e.textureCount;t++)a.textures.push(o.getTextBuffer())}(),function(){function e(){var e={};if(e.name=o.getTextBuffer(),e.englishName=o.getTextBuffer(),e.diffuse=o.getFloat32Array(4),e.specular=o.getFloat32Array(3),e.shininess=o.getFloat32(),e.ambient=o.getFloat32Array(3),e.flag=o.getUint8(),e.edgeColor=o.getFloat32Array(4),e.edgeSize=o.getFloat32(),e.textureIndex=o.getIndex(a.metadata.textureIndexSize),e.envTextureIndex=o.getIndex(a.metadata.textureIndexSize),e.envFlag=o.getUint8(),e.toonFlag=o.getUint8(),0===e.toonFlag)e.toonIndex=o.getIndex(a.metadata.textureIndexSize);else{if(1!==e.toonFlag)throw"unknown toon flag "+e.toonFlag+" exception.";e.toonIndex=o.getInt8()}return e.comment=o.getTextBuffer(),e.faceCount=o.getUint32()/3,e}var t=a.metadata;t.materialCount=o.getUint32(),a.materials=[];for(var i=0;i<t.materialCount;i++)a.materials.push(e())}(),function(){function e(){var e={};if(e.name=o.getTextBuffer(),e.englishName=o.getTextBuffer(),e.position=o.getFloat32Array(3),e.parentIndex=o.getIndex(a.metadata.boneIndexSize),e.transformationClass=o.getUint32(),e.flag=o.getUint16(),1&e.flag?e.connectIndex=o.getIndex(a.metadata.boneIndexSize):e.offsetPosition=o.getFloat32Array(3),256&e.flag||512&e.flag){var t={};t.isLocal=0!=(128&e.flag),t.affectRotation=0!=(256&e.flag),t.affectPosition=0!=(512&e.flag),t.parentIndex=o.getIndex(a.metadata.boneIndexSize),t.ratio=o.getFloat32(),e.grant=t}if(1024&e.flag&&(e.fixAxis=o.getFloat32Array(3)),2048&e.flag&&(e.localXVector=o.getFloat32Array(3),e.localZVector=o.getFloat32Array(3)),8192&e.flag&&(e.key=o.getUint32()),32&e.flag){var i={};i.effector=o.getIndex(a.metadata.boneIndexSize),i.target=null,i.iteration=o.getUint32(),i.maxAngle=o.getFloat32(),i.linkCount=o.getUint32(),i.links=[];for(var r=0;r<i.linkCount;r++){var n={};n.index=o.getIndex(a.metadata.boneIndexSize),n.angleLimitation=o.getUint8(),1===n.angleLimitation&&(n.lowerLimitationAngle=o.getFloat32Array(3),n.upperLimitationAngle=o.getFloat32Array(3)),i.links.push(n)}e.ik=i}return e}var t=a.metadata;t.boneCount=o.getUint32(),a.bones=[];for(var i=0;i<t.boneCount;i++)a.bones.push(e())}(),function(){function e(){var e={};e.name=o.getTextBuffer(),e.englishName=o.getTextBuffer(),e.panel=o.getUint8(),e.type=o.getUint8(),e.elementCount=o.getUint32(),e.elements=[];for(var t=0;t<e.elementCount;t++){if(0===e.type)(i={}).index=o.getIndex(a.metadata.morphIndexSize),i.ratio=o.getFloat32(),e.elements.push(i);else if(1===e.type){(i={}).index=o.getIndex(a.metadata.vertexIndexSize,!0),i.position=o.getFloat32Array(3),e.elements.push(i)}else if(2===e.type){(i={}).index=o.getIndex(a.metadata.boneIndexSize),i.position=o.getFloat32Array(3),i.rotation=o.getFloat32Array(4),e.elements.push(i)}else if(3===e.type){(i={}).index=o.getIndex(a.metadata.vertexIndexSize,!0),i.uv=o.getFloat32Array(4),e.elements.push(i)}else if(4!==e.type&&5!==e.type&&6!==e.type&&7!==e.type&&8===e.type){var i;(i={}).index=o.getIndex(a.metadata.materialIndexSize),i.type=o.getUint8(),i.diffuse=o.getFloat32Array(4),i.specular=o.getFloat32Array(3),i.shininess=o.getFloat32(),i.ambient=o.getFloat32Array(3),i.edgeColor=o.getFloat32Array(4),i.edgeSize=o.getFloat32(),i.textureColor=o.getFloat32Array(4),i.sphereTextureColor=o.getFloat32Array(4),i.toonColor=o.getFloat32Array(4),e.elements.push(i)}}return e}var t=a.metadata;t.morphCount=o.getUint32(),a.morphs=[];for(var i=0;i<t.morphCount;i++)a.morphs.push(e())}(),function(){function e(){var e={};e.name=o.getTextBuffer(),e.englishName=o.getTextBuffer(),e.type=o.getUint8(),e.elementCount=o.getUint32(),e.elements=[];for(var t=0;t<e.elementCount;t++){var i={};i.target=o.getUint8(),i.index=o.getIndex(0===i.target?a.metadata.boneIndexSize:a.metadata.morphIndexSize),e.elements.push(i)}return e}var t=a.metadata;t.frameCount=o.getUint32(),a.frames=[];for(var i=0;i<t.frameCount;i++)a.frames.push(e())}(),function(){var e,t=a.metadata;t.rigidBodyCount=o.getUint32(),a.rigidBodies=[];for(var i=0;i<t.rigidBodyCount;i++)a.rigidBodies.push((e=void 0,(e={}).name=o.getTextBuffer(),e.englishName=o.getTextBuffer(),e.boneIndex=o.getIndex(a.metadata.boneIndexSize),e.groupIndex=o.getUint8(),e.groupTarget=o.getUint16(),e.shapeType=o.getUint8(),e.width=o.getFloat32(),e.height=o.getFloat32(),e.depth=o.getFloat32(),e.position=o.getFloat32Array(3),e.rotation=o.getFloat32Array(3),e.weight=o.getFloat32(),e.positionDamping=o.getFloat32(),e.rotationDamping=o.getFloat32(),e.restitution=o.getFloat32(),e.friction=o.getFloat32(),e.type=o.getUint8(),e))}(),function(){var e,t=a.metadata;t.constraintCount=o.getUint32(),a.constraints=[];for(var i=0;i<t.constraintCount;i++)a.constraints.push((e=void 0,(e={}).name=o.getTextBuffer(),e.englishName=o.getTextBuffer(),e.type=o.getUint8(),e.rigidBodyIndex1=o.getIndex(a.metadata.rigidBodyIndexSize),e.rigidBodyIndex2=o.getIndex(a.metadata.rigidBodyIndexSize),e.position=o.getFloat32Array(3),e.rotation=o.getFloat32Array(3),e.translationLimitation1=o.getFloat32Array(3),e.translationLimitation2=o.getFloat32Array(3),e.rotationLimitation1=o.getFloat32Array(3),e.rotationLimitation2=o.getFloat32Array(3),e.springPosition=o.getFloat32Array(3),e.springRotation=o.getFloat32Array(3),e))}(),!0===t&&this.leftToRightModel(a),a},Parser.prototype.parseVmd=function(e,t){var r={},n=new DataViewEx(e);r.metadata={},r.metadata.coordinateSystem="left";return function(){var e=r.metadata;if(e.magic=n.getChars(30),"Vocaloid Motion Data 0002"!==e.magic)throw"VMD file magic is not Vocaloid Motion Data 0002, but "+e.magic;e.name=n.getSjisStringsAsUnicode(20)}(),function(){var e,t=r.metadata;t.motionCount=n.getUint32(),r.motions=[];for(var i=0;i<t.motionCount;i++)r.motions.push((e=void 0,(e={}).boneName=n.getSjisStringsAsUnicode(15),e.frameNum=n.getUint32(),e.position=n.getFloat32Array(3),e.rotation=n.getFloat32Array(4),e.interpolation=n.getUint8Array(64),e))}(),function(){var e,t=r.metadata;t.morphCount=n.getUint32(),r.morphs=[];for(var i=0;i<t.morphCount;i++)r.morphs.push((e=void 0,(e={}).morphName=n.getSjisStringsAsUnicode(15),e.frameNum=n.getUint32(),e.weight=n.getFloat32(),e))}(),function(){var e,t=r.metadata;t.cameraCount=n.getUint32(),r.cameras=[];for(var i=0;i<t.cameraCount;i++)r.cameras.push((e=void 0,(e={}).frameNum=n.getUint32(),e.distance=n.getFloat32(),e.position=n.getFloat32Array(3),e.rotation=n.getFloat32Array(3),e.interpolation=n.getUint8Array(24),e.fov=n.getUint32(),e.perspective=n.getUint8(),e))}(),!0===t&&this.leftToRightVmd(r),r},Parser.prototype.parseVpd=function(e,t){var u={metadata:{}};u.metadata.coordinateSystem="left",u.bones=[];var d=e.replace(/\/\/\w*(\r|\n|\r\n)/g,"").split(/\r|\n|\r\n/);function p(){throw"the file seems not vpd file."}return"Vocaloid Pose Data file"!==d[0]&&p(),d.length<4&&p(),u.metadata.parentFile=d[2],u.metadata.boneCount=parseInt(d[3]),function(){for(var e=/^\s*(Bone[0-9]+)\s*\{\s*(.*)$/,t=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,i=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,r=/^\s*}/,n=u.bones,a=null,o=null,s=null,l=4;l<d.length;l++){var c,h=d[l];null!==(c=h.match(e))&&(null!==a&&p(),a=c[2]),null!==(c=h.match(t))&&(null!==o&&p(),o=[parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])]),null!==(c=h.match(i))&&(null!==s&&p(),s=[parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]),parseFloat(c[4])]),null!==(c=h.match(r))&&(null!==a&&null!==o&&null!==s||p(),n.push({name:a,translation:o,quaternion:s}),s=o=a=null)}null===a&&null===o&&null===s||p()}(),!0===t&&this.leftToRightVpd(u),u},Parser.prototype.mergeVmds=function(e){var t={metadata:{}};t.metadata.name=e[0].metadata.name,t.metadata.coordinateSystem=e[0].metadata.coordinateSystem,t.metadata.motionCount=0,t.metadata.morphCount=0,t.metadata.cameraCount=0,t.motions=[],t.morphs=[],t.cameras=[];for(var i=0;i<e.length;i++){var r=e[i];t.metadata.motionCount+=r.metadata.motionCount,t.metadata.morphCount+=r.metadata.morphCount,t.metadata.cameraCount+=r.metadata.cameraCount;for(var n=0;n<r.metadata.motionCount;n++)t.motions.push(r.motions[n]);for(n=0;n<r.metadata.morphCount;n++)t.morphs.push(r.morphs[n]);for(n=0;n<r.metadata.cameraCount;n++)t.cameras.push(r.cameras[n])}return t},Parser.prototype.leftToRightModel=function(e){if("right"!==e.metadata.coordinateSystem){e.metadata.coordinateSystem="right";for(var t=new DataCreationHelper,i=0;i<e.metadata.vertexCount;i++)t.leftToRightVector3(e.vertices[i].position),t.leftToRightVector3(e.vertices[i].normal);for(i=0;i<e.metadata.faceCount;i++)t.leftToRightIndexOrder(e.faces[i].indices);for(i=0;i<e.metadata.boneCount;i++)t.leftToRightVector3(e.bones[i].position);for(i=0;i<e.metadata.morphCount;i++){var r=e.morphs[i];if("pmx"!==e.metadata.format||1===r.type)for(var n=0;n<r.elements.length;n++)t.leftToRightVector3(r.elements[n].position)}for(i=0;i<e.metadata.rigidBodyCount;i++)t.leftToRightVector3(e.rigidBodies[i].position),t.leftToRightEuler(e.rigidBodies[i].rotation);for(i=0;i<e.metadata.constraintCount;i++)t.leftToRightVector3(e.constraints[i].position),t.leftToRightEuler(e.constraints[i].rotation),t.leftToRightVector3Range(e.constraints[i].translationLimitation1,e.constraints[i].translationLimitation2),t.leftToRightEulerRange(e.constraints[i].rotationLimitation1,e.constraints[i].rotationLimitation2)}},Parser.prototype.leftToRightVmd=function(e){if("right"!==e.metadata.coordinateSystem){e.metadata.coordinateSystem="right";for(var t=new DataCreationHelper,i=0;i<e.metadata.motionCount;i++)t.leftToRightVector3(e.motions[i].position),t.leftToRightQuaternion(e.motions[i].rotation);for(i=0;i<e.metadata.cameraCount;i++)t.leftToRightVector3(e.cameras[i].position),t.leftToRightEuler(e.cameras[i].rotation)}},Parser.prototype.leftToRightVpd=function(e){if("right"!==e.metadata.coordinateSystem){e.metadata.coordinateSystem="right";for(var t=new DataCreationHelper,i=0;i<e.bones.length;i++)t.leftToRightVector3(e.bones[i].translation),t.leftToRightQuaternion(e.bones[i].quaternion)}};var MMDParser={CharsetEncoder:CharsetEncoder,Parser:Parser},MMDLoader=function(){function e(e){Loader.call(this,e),this.loader=new FileLoader(this.manager),this.parser=null,this.meshBuilder=new t(this.manager),this.animationBuilder=new n}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,setAnimationPath:function(e){return this.animationPath=e,this},load:function(e,t,i,r){var n,a=this.meshBuilder.setCrossOrigin(this.crossOrigin);n=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(e);var o=this._extractExtension(e).toLowerCase();"pmd"===o||"pmx"===o?this["pmd"===o?"loadPMD":"loadPMX"](e,function(e){t(a.build(e,n,i,r))},i,r):r&&r(new Error("THREE.MMDLoader: Unknown model file extension ."+o+"."))},loadAnimation:function(e,t,i,r,n){var a=this.animationBuilder;this.loadVMD(e,function(e){i(t.isCamera?a.buildCameraAnimation(e):a.build(e,t))},r,n)},loadWithAnimation:function(e,i,r,n,a){var o=this;this.load(e,function(t){o.loadAnimation(i,t,function(e){r({mesh:t,animation:e})},n,a)},n,a)},loadPMD:function(e,t,i,r){var n=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).load(e,function(e){t(n.parsePmd(e,!0))},i,r)},loadPMX:function(e,t,i,r){var n=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).load(e,function(e){t(n.parsePmx(e,!0))},i,r)},loadVMD:function(e,t,i,r){var n=Array.isArray(e)?e:[e],a=[],o=n.length,s=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer").setRequestHeader(this.requestHeader);for(var l=0,c=n.length;l<c;l++)this.loader.load(n[l],function(e){a.push(s.parseVmd(e,!0)),a.length===o&&t(s.mergeVmds(a))},i,r)},loadVPD:function(e,t,i,r,n){var a=this._getParser();this.loader.setMimeType(t?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").setRequestHeader(this.requestHeader).load(e,function(e){i(a.parseVpd(e,!0))},r,n)},_extractExtension:function(e){var t=e.lastIndexOf(".");return t<0?"":e.slice(t+1)},_getParser:function(){if(null===this.parser){if(void 0===MMDParser)throw new Error("THREE.MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser");this.parser=new MMDParser.Parser}return this.parser}});var h=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];function t(e){this.geometryBuilder=new i,this.materialBuilder=new r(e)}function i(){}function r(e){this.manager=e,this.textureLoader=new TextureLoader(this.manager),this.tgaLoader=null}function n(){}function d(e,t,i,r,n){Interpolant.call(this,e,t,i,r),this.interpolationParams=n}return t.prototype={constructor:t,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},build:function(e,t,i,r){var n=this.geometryBuilder.build(e),a=new SkinnedMesh(n,this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(t).build(e,n,i,r)),o=new Skeleton(function(e){var t,i,r,n,a=e.geometry,o=[];if(a&&void 0!==a.bones){for(r=0,n=a.bones.length;r<n;r++)i=a.bones[r],t=new Bone,o.push(t),t.name=i.name,t.position.fromArray(i.pos),t.quaternion.fromArray(i.rotq),void 0!==i.scl&&t.scale.fromArray(i.scl);for(r=0,n=a.bones.length;r<n;r++)-1!==(i=a.bones[r]).parent&&null!==i.parent&&void 0!==o[i.parent]?o[i.parent].add(o[r]):e.add(o[r])}return e.updateMatrixWorld(!0),o}(a));return a.bind(o),a}},i.prototype={constructor:i,build:function(o){for(var e=[],t=[],i=[],r=[],n=[],a=[],s=[],l=[],c=[],h=[],u=[],d=[],p=[],m=[],f=0,g={},v=0;v<o.metadata.vertexCount;v++){for(var y=o.vertices[v],x=0,_=y.position.length;x<_;x++)e.push(y.position[x]);for(x=0,_=y.normal.length;x<_;x++)i.push(y.normal[x]);for(x=0,_=y.uv.length;x<_;x++)t.push(y.uv[x]);for(x=0;x<4;x++)s.push(x<=y.skinIndices.length-1?y.skinIndices[x]:0);for(x=0;x<4;x++)l.push(x<=y.skinWeights.length-1?y.skinWeights[x]:0)}for(v=0;v<o.metadata.faceCount;v++){var b=o.faces[v];for(x=0,_=b.indices.length;x<_;x++)r.push(b.indices[x])}for(v=0;v<o.metadata.materialCount;v++){var w=o.materials[v];n.push({offset:3*f,count:3*w.faceCount}),f+=w.faceCount}for(v=0;v<o.metadata.rigidBodyCount;v++){var M=o.rigidBodies[v],S=g[M.boneIndex];S=void 0===S?M.type:Math.max(M.type,S),g[M.boneIndex]=S}for(v=0;v<o.metadata.boneCount;v++){-1!==(U={parent:(D=o.bones[v]).parentIndex,name:D.name,pos:D.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==g[v]?g[v]:-1}).parent&&(U.pos[0]-=o.bones[U.parent].position[0],U.pos[1]-=o.bones[U.parent].position[1],U.pos[2]-=o.bones[U.parent].position[2]),a.push(U)}if("pmd"===o.metadata.format)for(v=0;v<o.metadata.ikCount;v++){var T={target:(A=o.iks[v]).target,effector:A.effector,iteration:A.iteration,maxAngle:4*A.maxAngle,links:[]};for(x=0,_=A.links.length;x<_;x++){(E={}).index=A.links[x].index,E.enabled=!0,0<=o.bones[E.index].name.indexOf("")&&(E.limitation=new Vector3(1,0,0)),T.links.push(E)}u.push(T)}else for(v=0;v<o.metadata.boneCount;v++){var A;if(void 0!==(A=o.bones[v].ik)){for(T={target:v,effector:A.effector,iteration:A.iteration,maxAngle:A.maxAngle,links:[]},x=0,_=A.links.length;x<_;x++){var E;if((E={}).index=A.links[x].index,E.enabled=!0,1===A.links[x].angleLimitation){var C=A.links[x].lowerLimitationAngle,L=A.links[x].upperLimitationAngle,R=-L[0],P=-L[1];L[0]=-C[0],L[1]=-C[1],C[0]=R,C[1]=P,E.rotationMin=(new Vector3).fromArray(C),E.rotationMax=(new Vector3).fromArray(L)}T.links.push(E)}u.push(T)}}if("pmx"===o.metadata.format){for(v=0;v<o.metadata.boneCount;v++){var D,k=(D=o.bones[v]).grant;if(void 0!==k)d.push(T={index:v,parentIndex:k.parentIndex,ratio:k.ratio,isLocal:k.isLocal,affectRotation:k.affectRotation,affectPosition:k.affectPosition,transformationClass:D.transformationClass})}d.sort(function(e,t){return e.transformationClass-t.transformationClass})}function B(e,t,i){for(var r=0;r<t.elementCount;r++){var n,a=t.elements[r];e.array[3*(n="pmd"===o.metadata.format?o.morphs[0].elements[a.index].index:a.index)+0]+=a.position[0]*i,e.array[3*n+1]+=a.position[1]*i,e.array[3*n+2]+=a.position[2]*i}}for(v=0;v<o.metadata.morphCount;v++){var F=o.morphs[v],I={name:F.name},O=new Float32BufferAttribute(3*o.metadata.vertexCount,3);O.name=F.name;for(x=0;x<3*o.metadata.vertexCount;x++)O.array[x]=e[x];if("pmd"===o.metadata.format)0!==v&&B(O,F,1);else if(0===F.type)for(x=0;x<F.elementCount;x++){var V=o.morphs[F.elements[x].index];1===V.type&&B(O,V,F.elements[x].ratio)}else 1===F.type&&B(O,F,1);c.push(I),h.push(O)}for(v=0;v<o.metadata.rigidBodyCount;v++){var U,G=o.rigidBodies[v];I={};for(var N in G)I[N]=G[N];if("pmx"===o.metadata.format)if(-1!==I.boneIndex)I.position[0]-=(U=o.bones[I.boneIndex]).position[0],I.position[1]-=U.position[1],I.position[2]-=U.position[2];p.push(I)}for(v=0;v<o.metadata.constraintCount;v++){var z=o.constraints[v];I={};for(var N in z)I[N]=z[N];var H=p[I.rigidBodyIndex1],j=p[I.rigidBodyIndex2];0!==H.type&&2===j.type&&-1!==H.boneIndex&&-1!==j.boneIndex&&o.bones[j.boneIndex].parentIndex===H.boneIndex&&(j.type=1),m.push(I)}var W=new BufferGeometry;W.setAttribute("position",new Float32BufferAttribute(e,3)),W.setAttribute("normal",new Float32BufferAttribute(i,3)),W.setAttribute("uv",new Float32BufferAttribute(t,2)),W.setAttribute("skinIndex",new Uint16BufferAttribute(s,4)),W.setAttribute("skinWeight",new Float32BufferAttribute(l,4)),W.setIndex(r);v=0;for(var q=n.length;v<q;v++)W.addGroup(n[v].offset,n[v].count,v);return W.bones=a,W.morphTargets=c,W.morphAttributes.position=h,W.morphTargetsRelative=!1,W.userData.MMD={bones:a,iks:u,grants:d,rigidBodies:p,constraints:m,format:o.metadata.format},W.computeBoundingSphere(),W}},r.prototype={constructor:r,crossOrigin:"anonymous",resourcePath:void 0,setCrossOrigin:function(e){return this.crossOrigin=e,this},setResourcePath:function(e){return this.resourcePath=e,this},build:function(e,t){var i=[],r={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var n=0;n<e.metadata.materialCount;n++){var a=e.materials[n],o={userData:{}};if(void 0!==a.name&&(o.name=a.name),o.color=(new Color).fromArray(a.diffuse),o.opacity=a.diffuse[3],o.emissive=(new Color).fromArray(a.ambient),o.transparent=1!==o.opacity,o.skinning=0<t.bones.length,o.morphTargets=0<t.morphTargets.length,o.fog=!0,o.blending=CustomBlending,o.blendSrc=SrcAlphaFactor,o.blendDst=OneMinusSrcAlphaFactor,o.blendSrcAlpha=SrcAlphaFactor,o.blendDstAlpha=DstAlphaFactor,o.side=("pmx"!==e.metadata.format||1!=(1&a.flag))&&1===o.opacity?FrontSide:DoubleSide,"pmd"===e.metadata.format){if(a.fileName){var s=a.fileName.split("*");if(o.map=this._loadTexture(s[0],r),1<s.length){var l=s[1].slice(-4).toLowerCase();o.envMap=this._loadTexture(s[1],r),o.combine=".sph"===l?MultiplyOperation:AddOperation}}o.gradientMap=this._loadTexture(c=-1===a.toonIndex?"toon00.bmp":e.toonTextures[a.toonIndex].fileName,r,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(c)}),o.userData.outlineParameters={thickness:1===a.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===a.edgeFlag}}else{var c,h;-1!==a.textureIndex&&(o.map=this._loadTexture(e.textures[a.textureIndex],r)),-1===a.envTextureIndex||1!==a.envFlag&&2!=a.envFlag||(o.envMap=this._loadTexture(e.textures[a.envTextureIndex],r),o.combine=1===a.envFlag?MultiplyOperation:AddOperation),h=-1===a.toonIndex||0!==a.toonFlag?(c="toon"+("0"+(a.toonIndex+1)).slice(-2)+".bmp",!0):(c=e.textures[a.toonIndex],!1),o.gradientMap=this._loadTexture(c,r,{isToonTexture:!0,isDefaultToonTexture:h}),o.userData.outlineParameters={thickness:a.edgeSize/300,color:a.edgeColor.slice(0,3),alpha:a.edgeColor[3],visible:0!=(16&a.flag)&&0<a.edgeSize}}void 0!==o.map&&(o.transparent||this._checkImageTransparency(o.map,t,n),o.emissive.multiplyScalar(.2)),i.push(new MeshToonMaterial(o))}if("pmx"===e.metadata.format)for(var u=function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(-1!==n.index){var a=t[n.index];a.opacity!==n.diffuse[3]&&(a.transparent=!0)}}},d=(n=0,e.morphs.length);n<d;n++){var p=e.morphs[n],m=p.elements;if(0===p.type)for(var f=0,g=m.length;f<g;f++){var v=e.morphs[m[f].index];8===v.type&&u(v.elements,i)}else 8===p.type&&u(m,i)}return i},_getTGALoader:function(){if(null===this.tgaLoader){if(void 0===TGALoader)throw new Error("THREE.MMDLoader: Import TGALoader");this.tgaLoader=new TGALoader(this.manager)}return this.tgaLoader},_isDefaultToonTexture:function(e){return 10===e.length&&/toon(10|0[0-9])\.bmp/.test(e)},_loadTexture:function(t,e,i,r,n){var a,o=this;if(!0===(i=i||{}).isDefaultToonTexture){var s;try{s=parseInt(t.match(/toon([0-9]{2})\.bmp$/)[1])}catch(e){console.warn("THREE.MMDLoader: "+t+" seems like a not right default texture path. Using toon00.bmp instead."),s=0}a=h[s]}else a=this.resourcePath+t;if(void 0!==e[a])return e[a];var l=this.manager.getHandler(a);null===l&&(l=".tga"===t.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var c=l.load(a,function(e){!0===i.isToonTexture&&(e.image=o._getRotatedImage(e.image),e.magFilter=NearestFilter,e.minFilter=NearestFilter),e.flipY=!1,e.wrapS=RepeatWrapping,e.wrapT=RepeatWrapping;for(var t=0;t<c.readyCallbacks.length;t++)c.readyCallbacks[t](c);delete c.readyCallbacks},r,n);return c.readyCallbacks=[],e[a]=c},_getRotatedImage:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=e.width,n=e.height;return i.clearRect(0,0,t.width=r,t.height=n),i.translate(r/2,n/2),i.rotate(.5*Math.PI),i.translate(-r/2,-n/2),i.drawImage(e,0,0),i.getImageData(0,0,r,n)},_checkImageTransparency:function(r,n,a){r.readyCallbacks.push(function(e){function l(e,t){var i=e.width,r=e.height,n=Math.round(t.x*i)%i,a=Math.round(t.y*r)%r;return n<0&&(n+=i),a<0&&(a+=r),e.data[4*(a*i+n)+3]}var t=void 0!==e.image.data?e.image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var i=t.getContext("2d");return i.drawImage(e,0,0),i.getImageData(0,0,t.width,t.height)}(e.image),i=n.groups[a];!function(e,t,i){if(e.data.length/(e.width*e.height)==4)for(var r=0;r<i.length;r+=3){for(var n={x:0,y:0},a=0;a<3;a++){var o=i[3*r+a],s={x:t[2*o+0],y:t[2*o+1]};if(l(e,s)<253)return 1;n.x+=s.x,n.y+=s.y}if(n.x/=3,n.y/=3,l(e,n)<253)return 1}}(t,n.attributes.uv.array,n.index.array.slice(i.start,i.start+i.count))||(r.transparent=!0)})}},n.prototype={constructor:n,build:function(e,t){for(var i=this.buildSkeletalAnimation(e,t).tracks,r=this.buildMorphAnimation(e,t).tracks,n=0,a=r.length;n<a;n++)i.push(r[n]);return new AnimationClip("",-1,i)},buildSkeletalAnimation:function(e,t){function i(e,t,i){e.push(t[i+0]/127),e.push(t[i+8]/127),e.push(t[i+4]/127),e.push(t[i+12]/127)}for(var r=[],n={},a=t.skeleton.bones,o={},s=0,l=a.length;s<l;s++)o[a[s].name]=!0;for(s=0;s<e.metadata.motionCount;s++){var c=e.motions[s],h=c.boneName;void 0!==o[h]&&(n[h]=n[h]||[],n[h].push(c))}for(var u in n){var d=n[u];d.sort(function(e,t){return e.frameNum-t.frameNum});var p=[],m=[],f=[],g=[],v=[],y=t.skeleton.getBoneByName(u).position.toArray();for(s=0,l=d.length;s<l;s++){var x=d[s].position,_=d[s].rotation,b=d[s].interpolation;p.push(d[s].frameNum/30);for(var w=0;w<3;w++)m.push(y[w]+x[w]);for(w=0;w<4;w++)f.push(_[w]);for(w=0;w<3;w++)i(g,b,w);i(v,b,3)}var M=".bones["+u+"]";r.push(this._createTrack(M+".position",VectorKeyframeTrack,p,m,g)),r.push(this._createTrack(M+".quaternion",QuaternionKeyframeTrack,p,f,v))}return new AnimationClip("",-1,r)},buildMorphAnimation:function(e,t){for(var i=[],r={},n=t.morphTargetDictionary,a=0;a<e.metadata.morphCount;a++){var o=e.morphs[a],s=o.morphName;void 0!==n[s]&&(r[s]=r[s]||[],r[s].push(o))}for(var l in r){var c=r[l];c.sort(function(e,t){return e.frameNum-t.frameNum});for(var h=[],u=[],d=(a=0,c.length);a<d;a++)h.push(c[a].frameNum/30),u.push(c[a].weight);i.push(new NumberKeyframeTrack(".morphTargetInfluences["+n[l]+"]",h,u))}return new AnimationClip("",-1,i)},buildCameraAnimation:function(e){function t(e,t){e.push(t.x),e.push(t.y),e.push(t.z)}function i(e,t,i){e.push(t[4*i+0]/127),e.push(t[4*i+1]/127),e.push(t[4*i+2]/127),e.push(t[4*i+3]/127)}var r=[],n=void 0===e.cameras?[]:e.cameras.slice();n.sort(function(e,t){return e.frameNum-t.frameNum});for(var a,o,s=[],l=[],c=[],h=[],u=[],d=[],p=[],m=[],f=[],g=new Quaternion,v=new Euler,y=new Vector3,x=new Vector3,_=0,b=n.length;_<b;_++){var w=n[_],M=w.position,S=w.rotation,T=w.distance,A=w.fov,E=w.interpolation;s.push(w.frameNum/30),y.set(0,0,-T),x.set(M[0],M[1],M[2]),v.set(-S[0],-S[1],-S[2]),g.setFromEuler(v),y.add(x),y.applyQuaternion(g),t(l,x),(a=c).push((o=g).x),a.push(o.y),a.push(o.z),a.push(o.w),t(h,y),u.push(A);for(var C=0;C<3;C++)i(d,E,C);i(p,E,3);for(C=0;C<3;C++)i(m,E,4);i(f,E,5)}return(r=[]).push(this._createTrack("target.position",VectorKeyframeTrack,s,l,d)),r.push(this._createTrack(".quaternion",QuaternionKeyframeTrack,s,c,p)),r.push(this._createTrack(".position",VectorKeyframeTrack,s,h,m)),r.push(this._createTrack(".fov",NumberKeyframeTrack,s,u,f)),new AnimationClip("",-1,r)},_createTrack:function(e,t,i,r,n){if(2<i.length){i=i.slice(),r=r.slice(),n=n.slice();for(var a=r.length/i.length,o=n.length/i.length,s=1,l=2,c=i.length;l<c;l++){for(var h=0;h<a;h++)if(r[s*a+h]!==r[(s-1)*a+h]||r[s*a+h]!==r[l*a+h]){s++;break}if(s<l){i[s]=i[l];for(h=0;h<a;h++)r[s*a+h]=r[l*a+h];for(h=0;h<o;h++)n[s*o+h]=n[l*o+h]}}i.length=s+1,r.length=(s+1)*a,n.length=(s+1)*o}var u=new t(e,i,r);return u.createInterpolant=function(e){return new d(this.times,this.values,this.getValueSize(),e,new Float32Array(n))},u}},d.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:d,interpolate_:function(e,t,i,r){var n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=this.interpolationParams,l=e*o,c=l-o,h=r-t<.05?0:(i-t)/(r-t);if(4===o){var u=this._calculate(s[4*e+0],s[4*e+1],s[4*e+2],s[4*e+3],h);Quaternion.slerpFlat(n,0,a,c,a,l,u)}else if(3===o)for(var d=0;d!==o;++d){u=this._calculate(s[12*e+4*d],s[12*e+4*d+1],s[12*e+4*d+2],s[12*e+4*d+3],h);n[d]=a[c+d]*(1-u)+a[l+d]*u}else{u=this._calculate(s[4*e+0],s[4*e+1],s[4*e+2],s[4*e+3],h);n[0]=a[c]*(1-u)+a[l]*u}return n},_calculate:function(e,t,i,r,n){for(var a,o,s,l=.5,c=l,h=1-c,u=Math,d=0;d<15;d++){var p=(a=3*h*h*c)*e+(o=3*h*c*c)*t+(s=c*c*c)-n;if(u.abs(p)<1e-5)break;l/=2,h=1-(c+=p<0?l:-l)}return a*i+o*r+s}}),e}(),GeometryTools={reversUV:function(e){for(var t=e.attributes.uv.array,i=Math.floor(.25*t.length);i--;)t[2*i]*=-1;e.attributes.uv.needsUpdate=!0},addVertexColor:function(e){for(var t,i=new Float32BufferAttribute(3*e.attributes.position.count,3),r=i.count;r--;)i[t=3*r]=1,i[1+t]=1,i[2+t]=1;e.setAttribute("color",i),e.attributes.color.needsUpdate=!0},addUV2:function(e){e.setAttribute("uv2",e.attributes.uv)},mergeGeometryArray:function(e){for(var t=[],i=e.length;i--;)t[i]=(new Geometry).fromBufferGeometry(e[i]);for(var r=new Geometry;0<t.length;)i=t.pop(),r.merge(i),i.dispose();r.mergeVertices();var n=(new BufferGeometry).fromGeometry(r);return r.dispose(),n},prepaGeometry:function(e,t){var i,r,n,a,o,s=!1,l=!1;"mesh"==t&&(l=!0),"convex"==t&&(s=!0);var c=(new Geometry).fromBufferGeometry(e);c.mergeVertices();var h=e.attributes.position.array.length/3,u=c.vertices.length,d=c.faces.length;e.realVertices=new Float32Array(3*u),e.realIndices=new(65535<3*d?Uint32Array:Uint16Array)(3*d),e.setAttribute("color",new BufferAttribute(new Float32Array(3*h),3));var p=e.attributes.color.array;for(i=h;i--;)p[n=3*i]=1,p[n+1]=1,p[n+2]=1;for(i=u;i--;)e.realVertices[n=3*i]=(a=c.vertices[i]).x,e.realVertices[n+1]=a.y,e.realVertices[n+2]=a.z;if(s)return c.dispose(),e.realVertices;for(i=d;i--;)e.realIndices[n=3*i]=(a=c.faces[i]).a,e.realIndices[n+1]=a.b,e.realIndices[n+2]=a.c;if(c.dispose(),l){var m=[];for(i=e.realIndices.length;i--;)m[n=3*i]=e.realVertices[a=3*e.realIndices[i]],m[n+1]=e.realVertices[a+1],m[n+2]=e.realVertices[a+2];return m}var f=[],g=e.attributes.position.array;for(i=u;i--;)for(n=3*i,f[i]=[],r=h;r--;)g[o=3*r]==e.realVertices[n]&&g[1+o]==e.realVertices[n+1]&&g[2+o]==e.realVertices[n+2]&&f[i].push(r);var v=new(65535<u?Uint32Array:Uint16Array)(u),y=new(65535<h?Uint32Array:Uint16Array)(h);for(i=a=0;i<u;i++){for(n=f[i].length,v[i]=a,r=n;r--;)y[a+r]=f[i][r];a+=n}e.numFaces=d,e.numVertices=u,e.maxi=h,e.pPoint=v,e.lPoint=y},getGeomtryInfo:function(e){var t=void 0===e.Revers||e.Revers,i=!1;e.geometry instanceof BufferGeometry&&(i=!0);var r=i?(new Geometry).fromBufferGeometry(e.geometry):e.geometry;i&&r.mergeVertices();var n=r.vertices.length,a=r.faces.length;e.vertices=new Float32Array(3*n),e.indices=new Int32Array(3*a);for(var o,s,l=n;l--;)e.vertices[o=3*l]=(s=r.vertices[l]).x,e.vertices[o+1]=t?s.z:s.y,e.vertices[o+2]=t?s.y:s.z;for(l=a;l--;)e.indices[o=3*l]=(s=r.faces[l]).a,e.indices[o+1]=t?s.c:s.b,e.indices[o+2]=t?s.b:s.c;i&&r.dispose()}},mod={},l=void 0,aa=mod;function r(e,t){var i,r=e.split("."),n=aa;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(;r.length&&(i=r.shift());)r.length||t===l?n=n[i]?n[i]:n[i]={}:n[i]=t}var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function v(e){var i,r,n,a,o,s,l,c,h,u,d=e.length,p=0,m=Number.POSITIVE_INFINITY;for(c=0;c<d;++c)p<e[c]&&(p=e[c]),e[c]<m&&(m=e[c]);for(i=1<<p,r=new(t?Uint32Array:Array)(i),n=1,a=0,o=2;n<=p;){for(c=0;c<d;++c)if(e[c]===n){for(l=a,h=s=0;h<n;++h)s=s<<1|1&l,l>>=1;for(u=n<<16|c,h=s;h<i;h+=o)r[h]=u;++a}++n,a<<=1,o<<=1}return[r,p,m]}function w(e,i){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=t?new Uint8Array(e):e,this.m=!1,this.i=y,this.r=!1,i?(i.index&&(this.a=i.index),i.bufferSize&&(this.h=i.bufferSize),i.bufferType&&(this.i=i.bufferType),i.resize&&(this.r=i.resize)):i={},this.i){case A:this.b=32768,this.c=new(t?Uint8Array:Array)(32768+this.h+258);break;case y:this.b=0,this.c=new(t?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var A=0,y=1,B={t:A,s:y};w.prototype.k=function(){for(;!this.m;){var e=C(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var i=this.input,r=this.a,n=this.c,a=this.b,o=i.length,s=l,c=n.length,h=l;if(this.d=this.f=0,o<=r+1)throw Error("invalid uncompressed block header: LEN");if(s=i[r++]|i[r++]<<8,o<=r+1)throw Error("invalid uncompressed block header: NLEN");if(s===~(i[r++]|i[r++]<<8))throw Error("invalid uncompressed block header: length verify");if(i.length<r+s)throw Error("input buffer is broken");switch(this.i){case A:for(;n.length<a+s;){if(s-=h=c-a,t)n.set(i.subarray(r,r+h),a),a+=h,r+=h;else for(;h--;)n[a++]=i[r++];this.b=a,n=this.e(),a=this.b}break;case y:for(;n.length<a+s;)n=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(t)n.set(i.subarray(r,r+s),a),a+=s,r+=s;else for(;s--;)n[a++]=i[r++];this.a=r,this.b=a,this.c=n;break;case 1:this.j(ba,ca);break;case 2:var u,d,p,m,f=C(this,5)+257,g=C(this,5)+1,x=C(this,4)+4,_=new(t?Uint8Array:Array)(D.length),b=l,w=l,M=l,S=l,T=l;for(T=0;T<x;++T)_[D[T]]=C(this,3);if(!t)for(T=x,x=_.length;T<x;++T)_[D[T]]=0;for(u=v(_),b=new(t?Uint8Array:Array)(f+g),T=0,m=f+g;T<m;)switch(w=E(this,u)){case 16:for(S=3+C(this,2);S--;)b[T++]=M;break;case 17:for(S=3+C(this,3);S--;)b[T++]=0;M=0;break;case 18:for(S=11+C(this,7);S--;)b[T++]=0;M=0;break;default:M=b[T++]=w}d=v(t?b.subarray(0,f):b.slice(0,f)),p=v(t?b.subarray(f):b.slice(f)),this.j(d,p);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=t?new Uint16Array(G):G,H=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],I=t?new Uint16Array(H):H,J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],K=t?new Uint8Array(J):J,L=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],da=t?new Uint16Array(L):L,ea=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=t?new Uint8Array(ea):ea,O=new(t?Uint8Array:Array)(288),P,fa;for(P=0,fa=O.length;P<fa;++P)O[P]=P<=143?8:P<=255?9:P<=279?7:8;var ba=v(O),Q=new(t?Uint8Array:Array)(30),R$1,ga;for(R$1=0,ga=Q.length;R$1<ga;++R$1)Q[R$1]=5;var ca=v(Q);function C(e,t){for(var i,r=e.f,n=e.d,a=e.input,o=e.a,s=a.length;n<t;){if(s<=o)throw Error("input buffer is broken");r|=a[o++]<<n,n+=8}return i=r&(1<<t)-1,e.f=r>>>t,e.d=n-t,e.a=o,i}function E(e,t){for(var i,r,n=e.f,a=e.d,o=e.input,s=e.a,l=o.length,c=t[0],h=t[1];a<h&&!(l<=s);)n|=o[s++]<<a,a+=8;if(a<(r=(i=c[n&(1<<h)-1])>>>16))throw Error("invalid code length: "+r);return e.f=n>>r,e.d=a-r,e.a=s,65535&i}function W(e,t){var i,r;switch(this.input=e,this.a=0,t?(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)):t={},i=e[this.a++],r=e[this.a++],15&i){case ha:this.method=ha;break;default:throw Error("unsupported compression method")}if(0!=((i<<8)+r)%31)throw Error("invalid fcheck flag:"+((i<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new w(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}w.prototype.j=function(e,t){var i=this.c,r=this.b;this.o=e;for(var n,a,o,s,l=i.length-258;256!==(n=E(this,e));)if(n<256)l<=r&&(this.b=r,i=this.e(),r=this.b),i[r++]=n;else for(s=I[a=n-257],0<K[a]&&(s+=C(this,K[a])),n=E(this,t),o=da[n],0<N[n]&&(o+=C(this,N[n])),l<=r&&(this.b=r,i=this.e(),r=this.b);s--;)i[r]=i[r++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},w.prototype.w=function(e,t){var i=this.c,r=this.b;this.o=e;for(var n,a,o,s,l=i.length;256!==(n=E(this,e));)if(n<256)l<=r&&(l=(i=this.e()).length),i[r++]=n;else for(s=I[a=n-257],0<K[a]&&(s+=C(this,K[a])),n=E(this,t),o=da[n],0<N[n]&&(o+=C(this,N[n])),l<r+s&&(l=(i=this.e()).length);s--;)i[r]=i[r++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},w.prototype.e=function(){var e,i,r=new(t?Uint8Array:Array)(this.b-32768),n=this.b-32768,a=this.c;if(t)r.set(a.subarray(32768,r.length));else for(e=0,i=r.length;e<i;++e)r[e]=a[e+32768];if(this.g.push(r),this.l+=r.length,t)a.set(a.subarray(n,32768+n));else for(e=0;e<32768;++e)a[e]=a[n+e];return this.b=32768,a},w.prototype.z=function(e){var i,r,n,a=this.input.length/this.a+1|0,o=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),r=a<2?(n=(this.input.length-this.a)/this.o[2]/2*258|0)<o.length?o.length+n:o.length<<1:o.length*a,t?(i=new Uint8Array(r)).set(o):i=o,this.c=i},w.prototype.n=function(){var e,i,r,n,a,o=0,s=this.c,l=this.g,c=new(t?Uint8Array:Array)(this.l+(this.b-32768));if(0===l.length)return t?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(i=0,r=l.length;i<r;++i)for(n=0,a=(e=l[i]).length;n<a;++n)c[o++]=e[n];for(i=32768,r=this.b;i<r;++i)c[o++]=s[i];return this.g=[],this.buffer=c},w.prototype.v=function(){var e,i=this.b;return t?this.r?(e=new Uint8Array(i)).set(this.c.subarray(0,i)):e=this.c.subarray(0,i):(i<this.c.length&&(this.c.length=i),e=this.c),this.buffer=e},W.prototype.k=function(){var e,t,i=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(i[this.a++]<<24|i[this.a++]<<16|i[this.a++]<<8|i[this.a++])>>>0;var r=e;if("string"==typeof r){var n,a,o=r.split("");for(n=0,a=o.length;n<a;n++)o[n]=(255&o[n].charCodeAt(0))>>>0;r=o}for(var s,l=1,c=0,h=r.length,u=0;0<h;){for(h-=s=1024<h?1024:h;c+=l+=r[u++],--s;);l%=65521,c%=65521}if(t!=(c<<16|l)>>>0)throw Error("invalid adler-32 checksum")}return e};var ha=8;r("Zlib.Inflate",W),r("Zlib.Inflate.prototype.decompress",W.prototype.k);var X={ADAPTIVE:B.s,BLOCK:B.t},Y,Z,$,ia;if(Object.keys)Y=Object.keys(X);else for(Z in Y=[],$=0,X)Y[$++]=Z;for($=0,ia=Y.length;$<ia;++$)Z=Y[$],r("Zlib.Inflate.BufferType."+Z,X[Z]);var Inflate=mod.Zlib.Inflate,NURBSUtils={findSpan:function(e,t,i){var r=i.length-e-1;if(i[r]<=t)return r-1;if(t<=i[e])return e;for(var n=e,a=r,o=Math.floor((n+a)/2);t<i[o]||i[o+1]<=t;)t<i[o]?a=o:n=o,o=Math.floor((n+a)/2);return o},calcBasisFunctions:function(e,t,i,r){for(var n=[],a=[],o=[],s=n[0]=1;s<=i;++s){a[s]=t-r[e+1-s],o[s]=r[e+s]-t;for(var l=0,c=0;c<s;++c){var h=o[c+1],u=a[s-c],d=n[c]/(h+u);n[c]=l+h*d,l=u*d}n[s]=l}return n},calcBSplinePoint:function(e,t,i,r){for(var n=this.findSpan(e,r,t),a=this.calcBasisFunctions(n,r,e,t),o=new Vector4(0,0,0,0),s=0;s<=e;++s){var l=i[n-e+s],c=a[s],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o},calcBasisFunctionDerivatives:function(e,t,i,r,n){for(var a=[],o=0;o<=i;++o)a[o]=0;var s=[];for(o=0;o<=r;++o)s[o]=a.slice(0);var l=[];for(o=0;o<=i;++o)l[o]=a.slice(0);l[0][0]=1;for(var c=a.slice(0),h=a.slice(0),u=1;u<=i;++u){c[u]=t-n[e+1-u],h[u]=n[e+u]-t;for(var d=0,p=0;p<u;++p){var m=h[p+1],f=c[u-p];l[u][p]=m+f;var g=l[p][u-1]/l[u][p];l[p][u]=d+m*g,d=f*g}l[u][u]=d}for(u=0;u<=i;++u)s[0][u]=l[u][i];for(p=0;p<=i;++p){var v=0,y=1,x=[];for(o=0;o<=i;++o)x[o]=a.slice(0);for(var _=x[0][0]=1;_<=r;++_){var b=0,w=p-_,M=i-_;_<=p&&(x[y][0]=x[v][0]/l[1+M][w],b=x[y][0]*l[w][M]);var S=p-1<=M?_-1:i-p;for(u=-1<=w?1:-w;u<=S;++u)x[y][u]=(x[v][u]-x[v][u-1])/l[1+M][w+u],b+=x[y][u]*l[w+u][M];p<=M&&(x[y][_]=-x[v][_-1]/l[1+M][p],b+=x[y][_]*l[p][M]),s[_][p]=b;u=v;v=y,y=u}}for(p=i,_=1;_<=r;++_){for(u=0;u<=i;++u)s[_][u]*=p;p*=i-_}return s},calcBSplineDerivatives:function(e,t,i,r,n){for(var a=n<e?n:e,o=[],s=this.findSpan(e,r,t),l=this.calcBasisFunctionDerivatives(s,r,e,a,t),c=[],h=0;h<i.length;++h){var u=(p=i[h].clone()).w;p.x*=u,p.y*=u,p.z*=u,c[h]=p}for(var d=0;d<=a;++d){for(var p=c[s-e].clone().multiplyScalar(l[d][0]),m=1;m<=e;++m)p.add(c[s-e+m].clone().multiplyScalar(l[d][m]));o[d]=p}for(d=a+1;d<=n+1;++d)o[d]=new Vector4(0,0,0);return o},calcKoverI:function(e,t){for(var i=1,r=2;r<=e;++r)i*=r;var n=1;for(r=2;r<=t;++r)n*=r;for(r=2;r<=e-t;++r)n*=r;return i/n},calcRationalCurveDerivatives:function(e){for(var t=e.length,i=[],r=[],n=0;n<t;++n){var a=e[n];i[n]=new Vector3(a.x,a.y,a.z),r[n]=a.w}for(var o=[],s=0;s<t;++s){var l=i[s].clone();for(n=1;n<=s;++n)l.sub(o[s-n].clone().multiplyScalar(this.calcKoverI(s,n)*r[n]));o[s]=l.divideScalar(r[0])}return o},calcNURBSDerivatives:function(e,t,i,r,n){var a=this.calcBSplineDerivatives(e,t,i,r,n);return this.calcRationalCurveDerivatives(a)},calcSurfacePoint:function(e,t,i,r,n,a,o,s){for(var l=this.findSpan(e,a,i),c=this.findSpan(t,o,r),h=this.calcBasisFunctions(l,a,e,i),u=this.calcBasisFunctions(c,o,t,r),d=[],p=0;p<=t;++p){d[p]=new Vector4(0,0,0,0);for(var m=0;m<=e;++m){var f=n[l-e+m][c-t+p].clone(),g=f.w;f.x*=g,f.y*=g,f.z*=g,d[p].add(f.multiplyScalar(h[m]))}}var v=new Vector4(0,0,0,0);for(p=0;p<=t;++p)v.add(d[p].multiplyScalar(u[p]));v.divideScalar(v.w),s.set(v.x,v.y,v.z)}},NURBSCurve=function(e,t,i,r,n){Curve.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=n||this.knots.length-1;for(var a=0;a<i.length;++a){var o=i[a];this.controlPoints[a]=new Vector4(o.x,o.y,o.z,o.w)}};NURBSCurve.prototype=Object.create(Curve.prototype),NURBSCurve.prototype.constructor=NURBSCurve,NURBSCurve.prototype.getPoint=function(e,t){var i=t||new Vector3,r=NURBSUtils.calcBSplinePoint(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!=r.w&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)},NURBSCurve.prototype.getTangent=function(e,t){var i=t||new Vector3,r=NURBSUtils.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),1);return i.copy(r[1]).normalize(),i};var FBXLoader=function(){var u,d,p;function e(e){Loader.call(this,e)}function a(e,t){this.textureLoader=e,this.manager=t}function o(){}function s(){}function l(){}function c(){}function h(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function m(){}function f(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function g(e){return e/46186158e3}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(t,i,e,r){var n=this,a=""===n.path?LoaderUtils.extractUrlBase(t):n.path,o=new FileLoader(this.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.setRequestHeader(n.requestHeader),o.load(t,function(e){try{i(n.parse(e,a))}catch(e){r?r(e):console.error(e),n.manager.itemError(t)}},e,r)},parse:function(e,t){if((n="Kaydara FBX Binary  \0").length<=(r=e).byteLength&&n===b(r,0,n.length))u=(new c).parse(e);else{var i=b(e);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;for(var r=0;r<t.length;++r){if((a=e[(n=1)-1],e=e.slice(i+n),i++,a)===t[r])return}var n,a;return 1}(i))throw new Error("THREE.FBXLoader: Unknown format.");if(f(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+f(i));u=(new l).parse(i)}var r,n;return new a(new TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(u)}}),a.prototype={constructor:a,parse:function(){d=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),r=this.parseDeformers(),n=(new o).parse(r);return this.parseScene(r,n,i),p},parseConnections:function(){var o=new Map;"Connections"in u&&u.Connections.connections.forEach(function(e){var t=e[0],i=e[1],r=e[2];o.has(t)||o.set(t,{parents:[],children:[]});var n={ID:i,relationship:r};o.get(t).parents.push(n),o.has(i)||o.set(i,{parents:[],children:[]});var a={ID:t,relationship:r};o.get(i).children.push(a)});return o},parseImages:function(){var e={},t={};if("Video"in u.Objects){var i=u.Objects.Video;for(var r in i){var n=i[r];if(e[o=parseInt(r)]=n.RelativeFilename||n.Filename,"Content"in n)if(n.Content instanceof ArrayBuffer&&0<n.Content.byteLength||"string"==typeof n.Content&&""!==n.Content){var a=this.parseImage(i[r]);t[n.RelativeFilename||n.Filename]=a}}}for(var o in e){var s=e[o];e[o]=void 0!==t[s]?t[s]:e[o].split("\\").pop()}return e},parseImage:function(e){var t,i=e.Content,r=e.RelativeFilename||e.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(e){var t=new Map;if("Texture"in u.Objects){var i=u.Objects.Texture;for(var r in i){var n=this.parseTexture(i[r],e);t.set(parseInt(r),n)}}return t},parseTexture:function(e,t){var i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;var r=e.WrapModeU,n=e.WrapModeV,a=void 0!==n?n.value:0;if(i.wrapS=0===(void 0!==r?r.value:0)?RepeatWrapping:ClampToEdgeWrapping,i.wrapT=0===a?RepeatWrapping:ClampToEdgeWrapping,"Scaling"in e){var o=e.Scaling.value;i.repeat.x=o[0],i.repeat.y=o[1]}return i},loadTexture:function(e,t){var i,r,n=this.textureLoader.path,a=d.get(e.id).children;void 0!==a&&0<a.length&&void 0!==t[a[0].ID]&&(0!==(i=t[a[0].ID]).indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));var o=e.FileName.slice(-3).toLowerCase();if("tga"===o){var s=this.manager.getHandler(".tga");r=null===s?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),new Texture):s.load(i)}else r="psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),new Texture):this.textureLoader.load(i);return this.textureLoader.setPath(n),r},parseMaterials:function(e){var t=new Map;if("Material"in u.Objects){var i=u.Objects.Material;for(var r in i){var n=this.parseMaterial(i[r],e);null!==n&&t.set(parseInt(r),n)}}return t},parseMaterial:function(e,t){var i=e.id,r=e.attrName,n=e.ShadingModel;if("object"===_typeof(n)&&(n=n.value),!d.has(i))return null;var a,o=this.parseParameters(e,t,i);switch(n.toLowerCase()){case"phong":a=new MeshPhongMaterial;break;case"lambert":a=new MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',n),a=new MeshPhongMaterial}return a.setValues(o),a.name=r,a},parseParameters:function(e,i,t){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(r.color=(new Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(r.emissive=(new Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new Color).fromArray(e.SpecularColor.value));var n=this;return d.get(t).children.forEach(function(e){var t=e.relationship;switch(t){case"Bump":r.bumpMap=n.getTexture(i,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=n.getTexture(i,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=n.getTexture(i,e.ID),r.map.encoding=sRGBEncoding;break;case"DisplacementColor":r.displacementMap=n.getTexture(i,e.ID);break;case"EmissiveColor":r.emissiveMap=n.getTexture(i,e.ID),r.emissiveMap.encoding=sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=n.getTexture(i,e.ID);break;case"ReflectionColor":r.envMap=n.getTexture(i,e.ID),r.envMap.mapping=EquirectangularReflectionMapping,r.envMap.encoding=sRGBEncoding;break;case"SpecularColor":r.specularMap=n.getTexture(i,e.ID),r.specularMap.encoding=sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=n.getTexture(i,e.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}}),r},getTexture:function(e,t){return"LayeredTexture"in u.Objects&&t in u.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=d.get(t).children[0].ID),e.get(t)},parseDeformers:function(){var e={},t={};if("Deformer"in u.Objects){var i=u.Objects.Deformer;for(var r in i){var n=i[r],a=d.get(parseInt(r));if("Skin"===n.attrType){var o=this.parseSkeleton(a,i);o.ID=r,1<a.parents.length&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=a.parents[0].ID,e[r]=o}else if("BlendShape"===n.attrType){var s={id:r};s.rawTargets=this.parseMorphTargets(a,i),s.id=r,1<a.parents.length&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=s}}}return{skeletons:e,morphTargets:t}},parseSkeleton:function(e,r){var n=[];return e.children.forEach(function(e){var t=r[e.ID];if("Cluster"===t.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new Matrix4).fromArray(t.TransformLink.a)};"Indexes"in t&&(i.indices=t.Indexes.a,i.weights=t.Weights.a),n.push(i)}}),{rawBones:n,bones:[]}},parseMorphTargets:function(e,t){for(var i=[],r=0;r<e.children.length;r++){var n=e.children[r],a=t[n.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;o.geoID=d.get(parseInt(n.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,i.push(o)}return i},parseScene:function(e,t,i){p=new Group;var r=this.parseModels(e.skeletons,t,i),n=u.Objects.Model,a=this;r.forEach(function(i){a.setLookAtProperties(i,n[i.ID]),d.get(i.ID).parents.forEach(function(e){var t=r.get(e.ID);void 0!==t&&t.add(i)}),null===i.parent&&p.add(i)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),this.setupMorphMaterials(),p.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=y(e.userData.transformData);e.applyMatrix4(t)}});var o=(new s).parse();1===p.children.length&&p.children[0].isGroup&&(p.children[0].animations=o,p=p.children[0]),p.animations=o},parseModels:function(e,t,i){var r=new Map,n=u.Objects.Model;for(var a in n){var o=parseInt(a),s=n[a],l=d.get(o),c=this.buildSkeleton(l,e,o,s.attrName);if(!c){switch(s.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,i);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new Bone;break;case"Null":default:c=new Group}c.name=s.attrName?PropertyBinding.sanitizeNodeName(s.attrName):"",c.ID=o}this.getTransformData(c,s),r.set(o,c)}return r},buildSkeleton:function(e,t,a,o){var s=null;return e.parents.forEach(function(r){for(var e in t){var n=t[e];n.rawBones.forEach(function(e,t){if(e.ID===r.ID){var i=s;(s=new Bone).matrixWorld.copy(e.transformLink),s.name=o?PropertyBinding.sanitizeNodeName(o):"",s.ID=a,n.bones[t]=s,null!==i&&s.add(i)}})}}),s},createCamera:function(e){var t,i;if(e.children.forEach(function(e){var t=u.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)}),void 0===i)t=new Object3D;else{var r=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(r=1);var n=1;void 0!==i.NearPlane&&(n=i.NearPlane.value/1e3);var a=1e3;void 0!==i.FarPlane&&(a=i.FarPlane.value/1e3);var o=window.innerWidth,s=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(o=i.AspectWidth.value,s=i.AspectHeight.value);var l=o/s,c=45;void 0!==i.FieldOfView&&(c=i.FieldOfView.value);var h=i.FocalLength?i.FocalLength.value:null;switch(r){case 0:t=new PerspectiveCamera(c,l,n,a),null!==h&&t.setFocalLength(h);break;case 1:t=new OrthographicCamera(-o/2,o/2,s/2,-s/2,n,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new Object3D}}return t},createLight:function(e){var t,i;if(e.children.forEach(function(e){var t=u.Objects.NodeAttribute[e.ID];void 0!==t&&(i=t)}),void 0===i)t=new Object3D;else{var r;r=void 0===i.LightType?0:i.LightType.value;var n=16777215;void 0!==i.Color&&(n=(new Color).fromArray(i.Color.value));var a=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(a=0);var o=0;void 0!==i.FarAttenuationEnd&&(o=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);switch(r){case 0:t=new PointLight(n,a,o,1);break;case 1:t=new DirectionalLight(n,a);break;case 2:var s=Math.PI/3;void 0!==i.InnerAngle&&(s=MathUtils.degToRad(i.InnerAngle.value));var l=0;void 0!==i.OuterAngle&&(l=MathUtils.degToRad(i.OuterAngle.value),l=Math.max(l,1)),t=new SpotLight(n,a,o,s,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new PointLight(n,a)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(t.castShadow=!0)}return t},createMesh:function(e,t,i){var r,n=null,a=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(n=t.get(e.ID)),i.has(e.ID)&&o.push(i.get(e.ID))}),1<o.length?a=o:0<o.length?a=o[0]:(a=new MeshPhongMaterial({color:13421772}),o.push(a)),"color"in n.attributes&&o.forEach(function(e){e.vertexColors=!0}),n.FBX_Deformer?(o.forEach(function(e){e.skinning=!0}),(r=new SkinnedMesh(n,a)).normalizeSkinWeights()):r=new Mesh(n,a),r},createCurve:function(e,i){return new Line(e.children.reduce(function(e,t){return i.has(t.ID)&&(e=i.get(t.ID)),e},null),new LineBasicMaterial({color:3342591,linewidth:1}))},getTransformData:function(e,t){var i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder="RotationOrder"in t?x(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i},setLookAtProperties:function(r,e){"LookAtProperty"in e&&d.get(r.ID).children.forEach(function(e){if("LookAtProperty"===e.relationship){var t=u.Objects.Model[e.ID];if("Lcl_Translation"in t){var i=t.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(i),p.add(r.target)):r.lookAt((new Vector3).fromArray(i))}}})},bindSkeleton:function(e,t,i){var r=this.parsePoseNodes();for(var n in e){var a=e[n];d.get(parseInt(a.ID)).parents.forEach(function(e){t.has(e.ID)&&d.get(e.ID).parents.forEach(function(e){i.has(e.ID)&&i.get(e.ID).bind(new Skeleton(a.bones),r[e.ID])})})}},parsePoseNodes:function(){var t={};if("Pose"in u.Objects){var e=u.Objects.Pose;for(var i in e)if("BindPose"===e[i].attrType){var r=e[i].PoseNode;Array.isArray(r)?r.forEach(function(e){t[e.Node]=(new Matrix4).fromArray(e.Matrix.a)}):t[r.Node]=(new Matrix4).fromArray(r.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in u&&"AmbientColor"in u.GlobalSettings){var e=u.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],r=e[2];if(0!==t||0!==i||0!==r){var n=new Color(t,i,r);p.add(new AmbientLight(n,1))}}},setupMorphMaterials:function(){var r=this;p.traverse(function(i){i.isMesh&&i.geometry.morphAttributes.position&&i.geometry.morphAttributes.position.length&&(Array.isArray(i.material)?i.material.forEach(function(e,t){r.setupMorphMaterial(i,e,t)}):r.setupMorphMaterial(i,i.material))})},setupMorphMaterial:function(e,t,i){var r=e.uuid,n=t.uuid,a=!1;if(p.traverse(function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach(function(e){e.uuid===n&&t.uuid!==r&&(a=!0)}):t.material.uuid===n&&t.uuid!==r&&(a=!0))}),!0===a){var o=t.clone();o.morphTargets=!0,void 0===i?e.material=o:e.material[i]=o}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(e){var t=new Map;if("Geometry"in u.Objects){var i=u.Objects.Geometry;for(var r in i){var n=d.get(parseInt(r)),a=this.parseGeometry(n,i[r],e);t.set(parseInt(r),a)}}return t},parseGeometry:function(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(e,t,i){var r=i.skeletons,n=[],a=e.parents.map(function(e){return u.Objects.Model[e.ID]});if(0!==a.length){var o=e.children.reduce(function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e},null);e.children.forEach(function(e){void 0!==i.morphTargets[e.ID]&&n.push(i.morphTargets[e.ID])});var s=a[0],l={};"RotationOrder"in s&&(l.eulerOrder=x(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);var c=y(l);return this.genGeometry(t,o,n,c)}},genGeometry:function(e,t,i,r){var n=new BufferGeometry;e.attrName&&(n.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(r),n.setAttribute("position",s),0<o.colors.length&&n.setAttribute("color",new Float32BufferAttribute(o.colors,3)),t&&(n.setAttribute("skinIndex",new Uint16BufferAttribute(o.weightsIndices,4)),n.setAttribute("skinWeight",new Float32BufferAttribute(o.vertexWeights,4)),n.FBX_Deformer=t),0<o.normal.length){var l=(new Matrix3).getNormalMatrix(r),c=new Float32BufferAttribute(o.normal,3);c.applyNormalMatrix(l),n.setAttribute("normal",c)}if(o.uvs.forEach(function(e,t){var i="uv"+(t+1).toString();0===t&&(i="uv"),n.setAttribute(i,new Float32BufferAttribute(o.uvs[t],2))}),a.material&&"AllSame"!==a.material.mappingType){var h=o.materialIndex[0],u=0;if(o.materialIndex.forEach(function(e,t){e!==h&&(n.addGroup(u,t-u,h),h=e,u=t)}),0<n.groups.length){var d=n.groups[n.groups.length-1],p=d.start+d.count;p!==o.materialIndex.length&&n.addGroup(p,o.materialIndex.length-p,h)}0===n.groups.length&&n.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(n,e,i,r),n},parseGeoNode:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var i=0;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},null!==t&&(n.skeleton=t).rawBones.forEach(function(i,r){i.indices.forEach(function(e,t){void 0===n.weightTable[e]&&(n.weightTable[e]=[]),n.weightTable[e].push({id:r,weight:i.weights[t]})})}),n},genBuffers:function(h){var u={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},d=0,p=0,m=!1,f=[],g=[],v=[],y=[],x=[],_=[],b=this;return h.vertexIndices.forEach(function(r,n){var e=!1;r<0&&(r^=-1,e=!0);var i=[],t=[];if(f.push(3*r,3*r+1,3*r+2),h.color){var a=w(n,d,r,h.color);v.push(a[0],a[1],a[2])}if(h.skeleton){if(void 0!==h.weightTable[r]&&h.weightTable[r].forEach(function(e){t.push(e.weight),i.push(e.id)}),4<t.length){m||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),m=!0);var o=[0,0,0,0],s=[0,0,0,0];t.forEach(function(e,t){var n=e,a=i[t];s.forEach(function(e,t,i){if(e<n){i[t]=n,n=e;var r=o[t];o[t]=a,a=r}})}),i=o,t=s}for(;t.length<4;)t.push(0),i.push(0);for(var l=0;l<4;++l)x.push(t[l]),_.push(i[l])}if(h.normal){a=w(n,d,r,h.normal);g.push(a[0],a[1],a[2])}if(h.material&&"AllSame"!==h.material.mappingType)var c=w(n,d,r,h.material)[0];h.uv&&h.uv.forEach(function(e,t){var i=w(n,d,r,e);void 0===y[t]&&(y[t]=[]),y[t].push(i[0]),y[t].push(i[1])}),p++,e&&(b.genFace(u,h,f,c,g,v,y,x,_,p),d++,p=0,f=[],g=[],v=[],y=[],x=[],_=[])}),u},genFace:function(i,e,t,r,n,a,o,s,l,c){for(var h=2;h<c;h++)i.vertex.push(e.vertexPositions[t[0]]),i.vertex.push(e.vertexPositions[t[1]]),i.vertex.push(e.vertexPositions[t[2]]),i.vertex.push(e.vertexPositions[t[3*(h-1)]]),i.vertex.push(e.vertexPositions[t[3*(h-1)+1]]),i.vertex.push(e.vertexPositions[t[3*(h-1)+2]]),i.vertex.push(e.vertexPositions[t[3*h]]),i.vertex.push(e.vertexPositions[t[3*h+1]]),i.vertex.push(e.vertexPositions[t[3*h+2]]),e.skeleton&&(i.vertexWeights.push(s[0]),i.vertexWeights.push(s[1]),i.vertexWeights.push(s[2]),i.vertexWeights.push(s[3]),i.vertexWeights.push(s[4*(h-1)]),i.vertexWeights.push(s[4*(h-1)+1]),i.vertexWeights.push(s[4*(h-1)+2]),i.vertexWeights.push(s[4*(h-1)+3]),i.vertexWeights.push(s[4*h]),i.vertexWeights.push(s[4*h+1]),i.vertexWeights.push(s[4*h+2]),i.vertexWeights.push(s[4*h+3]),i.weightsIndices.push(l[0]),i.weightsIndices.push(l[1]),i.weightsIndices.push(l[2]),i.weightsIndices.push(l[3]),i.weightsIndices.push(l[4*(h-1)]),i.weightsIndices.push(l[4*(h-1)+1]),i.weightsIndices.push(l[4*(h-1)+2]),i.weightsIndices.push(l[4*(h-1)+3]),i.weightsIndices.push(l[4*h]),i.weightsIndices.push(l[4*h+1]),i.weightsIndices.push(l[4*h+2]),i.weightsIndices.push(l[4*h+3])),e.color&&(i.colors.push(a[0]),i.colors.push(a[1]),i.colors.push(a[2]),i.colors.push(a[3*(h-1)]),i.colors.push(a[3*(h-1)+1]),i.colors.push(a[3*(h-1)+2]),i.colors.push(a[3*h]),i.colors.push(a[3*h+1]),i.colors.push(a[3*h+2])),e.material&&"AllSame"!==e.material.mappingType&&(i.materialIndex.push(r),i.materialIndex.push(r),i.materialIndex.push(r)),e.normal&&(i.normal.push(n[0]),i.normal.push(n[1]),i.normal.push(n[2]),i.normal.push(n[3*(h-1)]),i.normal.push(n[3*(h-1)+1]),i.normal.push(n[3*(h-1)+2]),i.normal.push(n[3*h]),i.normal.push(n[3*h+1]),i.normal.push(n[3*h+2])),e.uv&&e.uv.forEach(function(e,t){void 0===i.uvs[t]&&(i.uvs[t]=[]),i.uvs[t].push(o[t][0]),i.uvs[t].push(o[t][1]),i.uvs[t].push(o[t][2*(h-1)]),i.uvs[t].push(o[t][2*(h-1)+1]),i.uvs[t].push(o[t][2*h]),i.uvs[t].push(o[t][2*h+1])})},addMorphTargets:function(i,r,e,n){if(0!==e.length){i.morphTargetsRelative=!0,i.morphAttributes.position=[];var a=this;e.forEach(function(e){e.rawTargets.forEach(function(e){var t=u.Objects.Geometry[e.geoID];void 0!==t&&a.genMorphGeometry(i,r,t,n,e.name)})})}},genMorphGeometry:function(e,t,i,r,n){for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==i.Vertices?i.Vertices.a:[],s=void 0!==i.Indexes?i.Indexes.a:[],l=new Float32Array(3*e.attributes.position.count),c=0;c<s.length;c++){var h=3*s[c];l[h]=o[3*c],l[1+h]=o[3*c+1],l[2+h]=o[3*c+2]}var u=new Float32BufferAttribute(this.genBuffers({vertexIndices:a,vertexPositions:l}).vertex,3);u.name=n||i.attrName,u.applyMatrix4(r),e.morphAttributes.position.push(u)},parseNormals:function(e){var t=e.ReferenceInformationType,i=[];return"IndexToDirect"===t&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:e.Normals.a,indices:i,mappingType:e.MappingInformationType,referenceType:t}},parseUVs:function(e){var t=e.ReferenceInformationType,i=[];return"IndexToDirect"===t&&(i=e.UVIndex.a),{dataSize:2,buffer:e.UV.a,indices:i,mappingType:e.MappingInformationType,referenceType:t}},parseVertexColors:function(e){var t=e.ReferenceInformationType,i=[];return"IndexToDirect"===t&&(i=e.ColorIndex.a),{dataSize:4,buffer:e.Colors.a,indices:i,mappingType:e.MappingInformationType,referenceType:t}},parseMaterialIndices:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var r=e.Materials.a,n=[],a=0;a<r.length;++a)n.push(a);return{dataSize:1,buffer:r,indices:n,mappingType:t,referenceType:i}},parseNurbsGeometry:function(e){if(void 0===NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new BufferGeometry;for(var i,r,n=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,l=0,c=s.length;l<c;l+=4)o.push((new Vector4).fromArray(s,l));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){r=a.length-1-(i=n);for(l=0;l<n;++l)o.push(o[l])}var h=new NURBSCurve(n,a,o,i,r).getPoints(7*o.length),u=new Float32Array(3*h.length);h.forEach(function(e,t){e.toArray(u,3*t)});var d=new BufferGeometry;return d.setAttribute("position",new BufferAttribute(u,3)),d}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var i in t){var r=this.addClip(t[i]);e.push(r)}return e},parseClips:function(){if(void 0!==u.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}},parseAnimationCurveNodes:function(){var e=u.Objects.AnimationCurveNode,t=new Map;for(var i in e){var r=e[i];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var n={id:r.id,attr:r.attrName,curves:{}};t.set(n.id,n)}}return t},parseAnimationCurves:function(e){var t=u.Objects.AnimationCurve;for(var i in t){var r={id:t[i].id,times:t[i].KeyTime.a.map(g),values:t[i].KeyValueFloat.a},n=d.get(r.id);if(void 0!==n){var a=n.parents[0].ID,o=n.parents[0].relationship;o.match(/X/)?e.get(a).curves.x=r:o.match(/Y/)?e.get(a).curves.y=r:o.match(/Z/)?e.get(a).curves.z=r:o.match(/d|DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=r)}}},parseAnimationLayers:function(c){var e=u.Objects.AnimationLayer,t=new Map;for(var i in e){var h=[],r=d.get(parseInt(i));if(void 0!==r)r.children.forEach(function(e,t){if(c.has(e.ID)){var i=c.get(e.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===h[t])if(void 0!==(l=d.get(e.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID)){if(void 0===(n=u.Objects.Model[l.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",e);var r={modelName:n.attrName?PropertyBinding.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};p.traverse(function(e){e.ID===n.id&&(r.transform=e.matrix,e.userData.transformData&&(r.eulerOrder=e.userData.transformData.eulerOrder))}),r.transform||(r.transform=new Matrix4),"PreRotation"in n&&(r.preRotation=n.PreRotation.value),"PostRotation"in n&&(r.postRotation=n.PostRotation.value),h[t]=r}h[t]&&(h[t][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===h[t]){var n,a=d.get(e.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,o=d.get(a).parents[0].ID,s=d.get(o).parents[0].ID,l=d.get(s).parents[0].ID;r={modelName:(n=u.Objects.Model[l]).attrName?PropertyBinding.sanitizeNodeName(n.attrName):"",morphName:u.Objects.Deformer[a].attrName};h[t]=r}h[t][i.attr]=i}}}),t.set(parseInt(i),h)}return t},parseAnimStacks:function(e){var t=u.Objects.AnimationStack,i={};for(var r in t){var n=d.get(parseInt(r)).children;1<n.length&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var a=e.get(n[0].ID);i[r]={name:t[r].attrName,layer:a}}return i},addClip:function(e){var t=[],i=this;return e.layer.forEach(function(e){t=t.concat(i.generateTracks(e))}),new AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],i=new Vector3,r=new Quaternion,n=new Vector3;if(e.transform&&e.transform.decompose(i,r,n),i=i.toArray(),r=(new Euler).setFromQuaternion(r,e.eulerOrder).toArray(),n=n.toArray(),void 0!==e.T&&0<Object.keys(e.T.curves).length){var a=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&0<Object.keys(e.R.curves).length){var o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&0<Object.keys(e.S.curves).length){var s=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,i,r){var n=this.getTimesForAllAxes(t);return new VectorKeyframeTrack(e+"."+r,n,this.getKeyframeTrackValues(n,t,i))},generateRotationTrack:function(e,t,i,r,n,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(MathUtils.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,i);void 0!==r&&((r=r.map(MathUtils.degToRad)).push(a),r=(new Euler).fromArray(r),r=(new Quaternion).setFromEuler(r)),void 0!==n&&((n=n.map(MathUtils.degToRad)).push(a),n=(new Euler).fromArray(n),n=(new Quaternion).setFromEuler(n).inverse());for(var l=new Quaternion,c=new Euler,h=[],u=0;u<s.length;u+=3)c.set(s[u],s[u+1],s[u+2],a),l.setFromEuler(c),void 0!==r&&l.premultiply(r),void 0!==n&&l.multiply(n),l.toArray(h,u/3*4);return new QuaternionKeyframeTrack(e+".quaternion",o,h)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,i=t.values.map(function(e){return e/100}),r=p.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,i)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,i){return i.indexOf(e)==t})},getKeyframeTrackValues:function(e,n,t){var a=t,o=[],s=-1,l=-1,c=-1;return e.forEach(function(e){if(n.x&&(s=n.x.times.indexOf(e)),n.y&&(l=n.y.times.indexOf(e)),n.z&&(c=n.z.times.indexOf(e)),-1!==s){var t=n.x.values[s];o.push(t),a[0]=t}else o.push(a[0]);if(-1!==l){var i=n.y.values[l];o.push(i),a[1]=i}else o.push(a[1]);if(-1!==c){var r=n.z.values[c];o.push(r),a[2]=r}else o.push(a[2])}),o},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var i=e.values[t-1],r=e.values[t]-i,n=Math.abs(r);if(180<=n){for(var a=n/180,o=r/a,s=i+o,l=e.times[t-1],c=(e.times[t]-l)/a,h=l+c,u=[],d=[];h<e.times[t];)u.push(h),h+=c,d.push(s),s+=o;e.times=M(e.times,t,u),e.values=M(e.values,t,d)}}}},l.prototype={constructor:l,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),--this.currentIndent},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new m,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var s=this,l=e.split(/[\r\n]+/);return l.forEach(function(e,t){var i=e.match(/^[\s\t]*;/),r=e.match(/^[\s\t]*$/);if(!i&&!r){var n=e.match("^\\t{"+s.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+s.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),o=e.match("^\\t{"+(s.currentIndent-1)+"}}");n?s.parseNodeBegin(e,n):a?s.parseNodeProperty(e,a,l[++t]):o?s.popStack():e.match(/^[^\s\t}]/)&&s.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var i=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:i},a=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,n):i in o?("PoseNode"===i?o.PoseNode.push(n):void 0!==o[i].id&&(o[i]={},o[i][o[i].id]=o[i]),""!==a.id&&(o[i][a.id]=n)):"number"==typeof a.id?(o[i]={},o[i][a.id]=n):"Properties70"!==i&&(o[i]="PoseNode"===i?[n]:n),"number"==typeof a.id&&(n.id=a.id),""!==a.name&&(n.attrName=a.name),""!==a.type&&(n.attrType=a.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",r="";return 1<e.length&&(i=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:i,type:r}},parseNodeProperty:function(e,t,i){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===n&&(n=i.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===r){var o=n.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),c=n.split(",").slice(3);r="connections",function(e,t){for(var i=0,r=e.length,n=t.length;i<n;i++,r++)e[r]=t[i]}(n=[s,l],c=c.map(function(e){return e.trim().replace(/^"/,"")})),void 0===a[r]&&(a[r]=[])}"Node"===r&&(a.id=n),r in a&&Array.isArray(a[r])?a[r].push(n):"a"!==r?a[r]=n:a.a=n,this.setCurrentProp(a,r),"a"===r&&","!==n.slice(-1)&&(a.a=_(n))}else this.parseNodeSpecialProperty(e,r,n)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=_(t.a))},parseNodeSpecialProperty:function(e,t,i){var r=i.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=r[0],a=r[1],o=r[2],s=r[3],l=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=_(l)}this.getPrevNode()[n]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),n)}},c.prototype={constructor:c,parse:function(e){var t=new h(e);t.skip(23);var i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);for(var r=new m;!this.endOfContent(t);){var n=this.parseNode(t,i);null!==n&&r.add(n.name,n)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var i={},r=7500<=t?e.getUint64():e.getUint32(),n=7500<=t?e.getUint64():e.getUint32();7500<=t?e.getUint64():e.getUint32();var a=e.getUint8(),o=e.getString(a);if(0===r)return null;for(var s=[],l=0;l<n;l++)s.push(this.parseProperty(e));var c=0<s.length?s[0]:"",h=1<s.length?s[1]:"",u=2<s.length?s[2]:"";for(i.singleProperty=1===n&&e.getOffset()===r;r>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,i,d)}return i.propertyList=s,"number"==typeof c&&(i.id=c),""!==h&&(i.attrName=h),""!==u&&(i.attrType=u),""!==o&&(i.name=o),i},parseSubNode:function(e,t,i){if(!0===i.singleProperty){var r=i.propertyList[0];Array.isArray(r)?(t[i.name]=i).a=r:t[i.name]=r}else if("Connections"===e&&"C"===i.name){var n=[];i.propertyList.forEach(function(e,t){0!==t&&n.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(n)}else if("Properties70"===i.name){Object.keys(i).forEach(function(e){t[e]=i[e]})}else if("Properties70"===e&&"P"===i.name){var a,o=i.propertyList[0],s=i.propertyList[1],l=i.propertyList[2],c=i.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[o]={type:s,type2:l,flag:c,value:a}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":i=e.getUint32();return e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),n=e.getUint32(),a=e.getUint32();if(0===n)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===Inflate&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var o=new h(new Inflate(new Uint8Array(e.getArrayBuffer(a))).decompress().buffer);switch(t){case"b":case"c":return o.getBooleanArray(r);case"d":return o.getFloat64Array(r);case"f":return o.getFloat32Array(r);case"i":return o.getInt32Array(r);case"l":return o.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},h.prototype={constructor:h,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],i=0;i<e;i++)t[i]=this.getUint8();var r=t.indexOf(0);return 0<=r&&(t=t.slice(0,r)),LoaderUtils.decodeText(new Uint8Array(t))}},m.prototype={constructor:m,add:function(e,t){this[e]=t}};var v=[];function w(e,t,i,r){var n;switch(r.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=i;break;case"AllSame":n=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(n=r.indices[n]);var a=n*r.dataSize;return function(e,t,i,r){for(var n=i,a=0;n<r;n++,a++)e[a]=t[n];return e}(v,r.buffer,a,a+r.dataSize)}var T=new Euler,A=new Vector3;function y(e){var t,i=new Matrix4,r=new Matrix4,n=new Matrix4,a=new Matrix4,o=new Matrix4,s=new Matrix4,l=new Matrix4,c=new Matrix4,h=new Matrix4,u=new Matrix4,d=new Matrix4,p=e.inheritType?e.inheritType:0;e.translation&&i.setPosition(A.fromArray(e.translation)),e.preRotation&&((t=e.preRotation.map(MathUtils.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(T.fromArray(t)));e.rotation&&((t=e.rotation.map(MathUtils.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(T.fromArray(t)));e.postRotation&&((t=e.postRotation.map(MathUtils.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(T.fromArray(t)));e.scale&&o.scale(A.fromArray(e.scale)),e.scalingOffset&&l.setPosition(A.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(A.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(A.fromArray(e.rotationOffset)),e.rotationPivot&&h.setPosition(A.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(u=e.parentMatrixWorld);var m=r.multiply(n).multiply(a),f=new Matrix4;u.extractRotation(f),(new Matrix4).copyPosition(u);var g=new Matrix4;g.getInverse(f).multiply(u);var v=new Matrix4;if(0===p)v.copy(f).multiply(m).multiply(g).multiply(o);else if(1===p)v.copy(f).multiply(g).multiply(m).multiply(o);else{var y=(new Matrix4).getInverse(o),x=(new Matrix4).multiply(g).multiply(y);v.copy(f).multiply(m).multiply(x).multiply(o)}var _=(new Matrix4).getInverse(h),b=(new Matrix4).getInverse(s),w=new Matrix4;w.copy(i).multiply(c).multiply(h).multiply(r).multiply(n).multiply(a).multiply(_).multiply(l).multiply(s).multiply(o).multiply(b);var M=(new Matrix4).copyPosition(w),S=(new Matrix4).copy(u).multiply(M);return d.copyPosition(S),w=(new Matrix4).multiply(d).multiply(v)}function x(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function _(e){return e.split(",").map(function(e){return parseFloat(e)})}function b(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),LoaderUtils.decodeText(new Uint8Array(e,t,i))}function M(e,t,i){return e.slice(0,t).concat(i).concat(e.slice(t))}return e}(),WView=function(e){var n,a,o,s,l=!1,r=!1,c=null,h=null,u={},d={},p={},m=[],f=[],i=1,t=0,g=0,v=!1,y=null,x=2237218,_=1,b=null,w=null,M=null,S=null,T=!1,A=!1,E=!0,C=!1,L=new Clock,R=new GLTFLoader(e),P=new DRACOLoader;P.setDecoderPath("./js/libs/draco/gltf/"),R.setDRACOLoader(P),R.setDDSLoader(new DDSLoader);function D(e){e.scene=new Scene,e.sceneRoot=new Group,e.markerRoot=new Group,e.markerScale=new Group,e.markerRoot.add(e.markerScale),e.scene.add(e.sceneRoot),e.scene.add(e.markerRoot),e.camera=e.cameraFree=new PerspectiveCamera(e.fov,(window.innerWidth-e.cameraSizeConstraint.width)/(window.innerHeight-e.cameraSizeConstraint.height),.1,1e3),e.cameraInObj=new PerspectiveCamera(e.fov,(window.innerWidth-e.cameraSizeConstraint.width)/(window.innerHeight-e.cameraSizeConstraint.height),.1,1e3),e.controls=null,e.camera.position.x=-12,e.camera.position.y=7,e.camera.position.z=4,e.arCamera=new PerspectiveCamera(e.fov,(window.innerWidth-e.cameraSizeConstraint.width)/(window.innerHeight-e.cameraSizeConstraint.height),.1,1e3),e.scene.add(e.arCamera),e.setAudioListenerParent(e.camera),e.cameraControls=new OrbitControls(e.camera,h);var t=new WebGLCubeRenderTarget(128,{format:RGBFormat,generateMipmaps:e.cameraControls.screenSpacePanning=!0,minFilter:LinearMipmapLinearFilter});e.cubeCamera=new CubeCamera(.1,1,t),e.scene.background=e.cubeCamera.renderTarget}var k=new FBXLoader(e),B=new MMDLoader(e),F={pause:!1,objects:[],objects_raycaster:[],cameraSizeConstraint:null,camera:null,cameraFree:null,cameraInObj:null,arCamera:null,cameraControls:null,deviceOrientationControls:null,vrControls:null,scene:null,renderer:null,labelRenderer:null,sceneRoot:null,markerRoot:null,markerScale:null,outlineEffect:null,vrEffect:null,stereoEffect:null,effect3:null,effect4:null,sceneRenderHUDSprite:null,arSceneScale:1,arToolkitSource:null,arToolkitContext:null,sunLight:null,playerLight:null,vsize:null,fov:45,fogDepth:1e-4,fogDepthDefault:1e-4,fogDepthMaximum:.0016,iflag_sto:null,audioListener:null,init:function(e){var t=window.innerWidth,i=window.innerHeight;l=this.getMobile(),c=document.createElement("div"),document.body.insertBefore(c,document.body.firstChild),(h=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).style.cssText="position:absolute; top:0; left:0; pointer-events:auto;",l||(h.ondrop=function(e){e.preventDefault()}),this.cameraSizeConstraint={width:e&&e.cameraSizeConstraint&&e.cameraSizeConstraint.width||0,height:e&&e.cameraSizeConstraint&&e.cameraSizeConstraint.height||0},this.vsize=new Vector3(t,i,0),this.vsize.z=this.vsize.x/this.vsize.y,this.sceneRenderHUDSprite=new Scene,(n=new OrthographicCamera(t/-2,t/2,i/2,i/-2,1,10)).position.z=10,o=new Scene,(a=new OrthographicCamera(t/-2,t/2,i/2,i/-2,-1e4,1e4)).position.z=100,o.add(a);var r=new PlaneBufferGeometry(t,i);(s=new Mesh(r,new MeshBasicMaterial({color:0}))).position.z=-500,o.add(s),this.renderer=new WebGLRenderer(this.getContext(null==e.forceGL1||e.forceGL1)),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.autoClear=!1,this.renderer.setClearColor(x,_),this.labelRenderer=new CSS2DRenderer,this.labelRenderer.setSize(window.innerWidth,window.innerHeight),this.labelRenderer.domElement.style.position="absolute",this.labelRenderer.domElement.style.top=0,b=new Vector3,w=new Vector3,c.appendChild(this.labelRenderer.domElement),c.appendChild(h),c.focus(),this.audioListener=new AudioListener,D(this),this.showShadow(!0),this.outlineEffect=new OutlineEffect(this.renderer),this.outlineEffect.setSize(window.innerWidth,window.innerHeight),this.outlineEffect.enabled=!1,this.stereoEffect=new StereoEffect(this.renderer),this.effect3=new HOLO.ThreeSidedDisplay(this.renderer),this.effect4=new HOLO.FourSidedDisplay(this.renderer),this.effect3.setSize(window.innerWidth,window.innerHeight),this.effect4.setSize(window.innerWidth,window.innerHeight),this.onWindowResize(),window.addEventListener("resize",this.onWindowResize,!1)},load:function(e,t){e.type=e.type||"gltf";var i=t||function(){};switch(e.type){case"gltf":this.load_gltf(e,i);break;case"fbx":this.load_fbx(e,i);break;case"mmd":this.load_mmd(e,i)}},load_gltf:function(r,n){console.log("load modeFile---"+r.url);var a=this;if(m[r.name]){var e=SkeletonUtils.clone(m[r.name].model);r.isSet&&a.loadMeshes(e),n(e,r)}else R.load(r.url,function(e){var t={};e.animations.forEach(function(e){t[e.name]=e}),m[r.name]={animations:t,type:"gltf",gltf:e,model:e.scene};var i=SkeletonUtils.clone(m[r.name].model);a.loadMeshes(i),n(i,r)})},load_fbx:function(r,n){console.log("load modeFile---"+r.url);var a=this;if(m[r.name]){var e=SkeletonUtils.clone(m[r.name].model);r.isSet&&a.loadMeshes(e),n(e,r)}else k.load(r.url,function(e){var t={};e.animations.forEach(function(e){t[e.name]=e}),m[r.name]={animations:t,type:"fbx",model:e};var i=SkeletonUtils.clone(m[r.name].model);a.loadMeshes(i),n(i,r)})},load_mmd:function(i,r){console.log("load modeFile---"+i.url);var n=this;if(m[i.name]){var e=SkeletonUtils.clone(m[i.name].model);i.isSet&&n.loadMeshes(e),r(e,i)}else B.load(i.url,function(e){m[i.name]={animations:[],type:"mmd",model:e};var t=SkeletonUtils.clone(m[i.name].model);i.isSet&&n.loadMeshes(t),r(t,i)})},loadMeshes:function(e){e.traverse(function(e){if(e.isMesh){p[e.name]=e;var t=(new Matrix4).makeTranslation(e.position[0],e.position[1],e.position[2]);t.makeRotationFromQuaternion(e.quaternion);var i=e.geometry.clone();i.applyMatrix4(t),d[e.name]=i}else e.isGroup&&(p[e.name]=e)})},loadVMD:function(t,i){(console.log("load VMDFile---"+t.url),f[t.name])?i(f[t.name],t):B.loadVMD(t.url,function(e){i(f[t.name]=e,t)})},getModel:function(e){var t=SkeletonUtils.clone(m[e].model);return t.modelType=m[e].type,t},getAnimations:function(e){return m[e].animations},getMMDAnimation:function(e,t){if(t.isCamera){for(var i=f[e.refVMD],r=i.cameras,n=0,a=r.length;n<a;n++){var o=r[n],s=o.position;o.position=[s[0]*e.positionScale,s[1]*e.positionScale,s[2]*e.positionScale],o.distance=o.distance*e.distanceScale}return B.animationBuilder.buildCameraAnimation(i)}return B.animationBuilder.build(f[e.refVMD],t)},getMesh:function(e){return p[e]?p[e].clone():null},getGeometry:function(e){return d[e]},destroy:function(){for(;0<this.objects.length;){var e=this.objects.pop();e.userData.hasOwnProperty("audio")&&(e.userData.audio.stop(),e.remove(e.userData.audio)),this.removeVisual(e)}this.objects=[]},setAudioListenerParent:function(e){e.add(this.audioListener)},addVisual:function(e){this.objects.push(e),this.addSubObjects(e),6==i?this.markerScale.add(e):this.sceneRoot.add(e)},addSubObjects:function(e){if(0<e.children.length)for(var t=0;t<e.children.length;t++)e.children[t].isGroup?this.addSubObjects(e.children[t]):this.objects_raycaster.push(e.children[t]);else this.objects_raycaster.push(e)},removeVisual:function(e){6==i?this.markerScale.remove(e):e.parent&&e.parent.remove(e)},getVisualObjects:function(){return root.viewObjects},initDefGeosAndMats:function(){d.box=new BoxBufferGeometry(1,1,1),d.sphere=new SphereBufferGeometry(1,12,10),d.cylinder=(new BufferGeometry).fromGeometry(new CylinderGeometry(1,1,1,12,1)),d.cone=(new BufferGeometry).fromGeometry(new CylinderGeometry(0,1,.5)),d.wheel=(new BufferGeometry).fromGeometry(new CylinderGeometry(1,1,1,18)),d.wheel.rotateZ(-Math.PI90)},getContent:function(){return this.sceneRoot},getGeo:function(){return d},getMat:function(){return WMaterials.getMat()},getControler:function(){return this.cameraControls},reset:function(){this.removeFog(),g=t=0,d={},this.pause=!(p={}),this.objects=[],this.objects_raycaster=[],D(this)},updateSunLightSize:function(){},showShadow:function(e){this.renderer.shadowMap.enabled=0!=e},setCameraFollowBehind:function(e){C=e},getMobile:function(){var e=navigator.userAgent;return!!(e.match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone/i)||e.match(/iPad/i)||e.match(/iPod/i)||e.match(/BlackBerry/i)||e.match(/Windows Phone/i))},setBg:function(e,t){x=e,_=void 0!==t?t:_},getContext:function(e){var t,i={antialias:!l,alpha:1!==_,stencil:!1,depth:!0,precision:"highp",premultipliedAlpha:!0,preserveDrawingBuffer:!1};return e||(t=(t=h.getContext("webgl2",i))||h.getContext("experimental-webgl2",i),r=!!t),r||(t=(t=h.getContext("webgl",i))||h.getContext("experimental-webgl",i)),i.canvas=h,i.context=t,i},getWithFog:function(){return v},addFog:function(e){v||(y=void 0!==(e=e||{}).density?new FogExp2(e.color||3886170,e.density):new Fog(e.color||3886170,e.near||1,e.far||300),this.scene.fog=y,v=!0)},setFogColor:function(e){v&&(y.color=e)},removeFog:function(){v&&(this.scene.fog=y=null,v=!1)},activeRay:function(e,t,i){T||(M=new Raycaster,(S=new Mesh(t?new PlaneBufferGeometry(1,1,4,4):new PlaneBufferGeometry(1,1,1,1),new MeshBasicMaterial({color:65280,transparent:!0,opacity:t?.3:0,depthTest:!1,depthWrite:!1,wireframe:!!t}))).castShadow=!1,S.receiveShadow=!1,this.setDragPlane(null,i),this.addVisual(S),this.fray=function(e){this.rayTest(e)}.bind(this),this.mDown=function(e){this.rayTest(e),b.z=1}.bind(this),this.mUp=function(e){b.z=0}.bind(this),h.addEventListener("mousemove",this.fray,!1),h.addEventListener("mousedown",this.mDown,!1),document.addEventListener("mouseup",this.mUp,!1),this.rayCallBack=e,T=!0)},removeRay:function(){T&&(h.removeEventListener("mousemove",this.fray,!1),h.removeEventListener("mousedown",this.mDown,!1),document.removeEventListener("mouseup",this.mUp,!1),this.rayCallBack=function(){},this.removeVisual(S),T=!1,w.set(0,0,0))},rayTest:function(e){b.x=e.clientX/window.innerWidth*2-1,b.y=2*-(e.clientY/window.innerHeight)+1,M.setFromCamera(b,this.camera);var t=M.intersectObject(S);t.length&&(w.copy(t[0].point),this.rayCallBack(w))},setDragPlane:function(e,t){t=t||200,S.scale.set(1,1,1).multiplyScalar(t),e?(S.position.fromArray(e),S.rotation.set(0,this.cameraControls.getAzimuthalAngle(),0)):(S.position.set(0,0,0),S.rotation.set(-Math.PI90,0,0))},getMouse:function(){return b},getControls:function(){return this.cameraControls},addUV2:function(e){GeometryTools.addUV2(e.geometry)},mergeGeometry:function(e){return GeometryTools.mergeGeometryArray(e)},mergeMesh:function(e){return GeometryTools.mergeGeometryArray(e)},prepaGeometry:function(e,t){return GeometryTools.prepaGeometry(e,t)},getGeomtryInfo:function(e){return GeometryTools.getGeomtryInfo(e)},texture:function(e){return WTextures.make(e)},getTexture:function(e){return WTextures.get(e)},material:function(e){return WMaterials.make(e)},getMaterial:function(e){return WMaterials.get(e)},updateEnvmap:function(){WMaterials.updateEnvmap(this.envMap)},setEnvMapRenderTarget:function(e){this.envMapRenderTarget=e,this.cubeCamera.update(this.renderer,this.envMapRenderTarget),this.envMap=this.cubeCamera.renderTarget.texture,this.envMap.minFilter=LinearMipMapLinearFilter,this.envMap.format=RGBAFormat,this.updateEnvmap()},getEnvmap:function(){return this.envMapRenderTarget?(this.cubeCamera.update(this.renderer,this.envMapRenderTarget),this.envMap=this.cubeCamera.renderTarget.texture,this.envMap.minFilter=LinearMipMapLinearFilter,this.envMap.format=RGBAFormat):this.envMap=new Texture,this.envMap},setClearColor:function(e){this.renderer.setClearColor(e,0)},getFps:function(){return g},unPause:function(){},pauseRender:function(){F.pause=E=!0},restartRender:function(){E&&(F.pause=E=!1,F.render(0))},render:function(){E||window.requestAnimationFrame(F.render),t=L.getDelta(),F.pause&&(A=!0),A&&!F.pause&&(A=!1,F.unPause()),F.update(t),1==i?(F.renderer.clear(),F.controlUpdate(t),F.outlineEffect.render(F.scene,F.camera),F.labelRenderer.render(F.scene,F.camera),F.renderer.clearDepth(),F.renderer.render(F.sceneRenderHUDSprite,n)):2==i?(F.deviceOrientationControls.update(t),F.stereoEffect.render(F.scene,F.camera)):3==i?(F.controlUpdate(t),F.effect3.render(F.scene,F.camera)):4==i?(F.controlUpdate(t),F.effect4.render(F.scene,F.camera)):5==i&&(F.vrControls.update(),F.stereoEffect.render(F.scene,F.camera))},update:function(){},onWindowResize:function(){F.cameraInObj.aspect=F.cameraFree.aspect=(window.innerWidth-F.cameraSizeConstraint.width)/(window.innerHeight-F.cameraSizeConstraint.height),F.cameraFree.updateProjectionMatrix(),F.cameraInObj.updateProjectionMatrix(),n.left=-window.innerWidth/2,n.right=window.innerWidth/2,n.top=window.innerHeight/2,n.bottom=-window.innerHeight/2,n.updateProjectionMatrix(),window.WEngine.compass&&window.WEngine.compass.position.set(-window.innerWidth/2+window.WEngine.compass.material.map.image.width/2,window.innerHeight/2-window.WEngine.compass.material.map.image.height/2,0),F.renderer.setSize(window.innerWidth-F.cameraSizeConstraint.width,window.innerHeight-F.cameraSizeConstraint.height),F.labelRenderer.setSize(window.innerWidth-F.cameraSizeConstraint.width,window.innerHeight-F.cameraSizeConstraint.height),F.outlineEffect.setSize(window.innerWidth,window.innerHeight),F.stereoEffect.setSize(window.innerWidth,window.innerHeight),F.effect3.setSize(window.innerWidth,window.innerHeight),F.effect4.setSize(window.innerWidth,window.innerHeight)},createModel:function(e,t,i,r,n){var a={};return t.forEach(function(e){e.opacity=1,e.alphaTest=.5}),n?a.mesh=new SkinnedMesh(e,t):(e.applyMatrix((new Matrix4).makeScale(i,i,i)),a.mesh=new Mesh(e,t)),a},orbit:function(e,t,i){var r=new Vector3,n=t,a=e;r.x=i*Math.sin(n)*Math.sin(a),r.y=i*Math.cos(n),r.z=i*Math.sin(n)*Math.cos(a);var o=new Vector3;return o.copy(this.cameraControls.target).add(r),o},setControle:function(e){this.cameraControls.enableRotate!==e&&(this.cameraControls.enableRotate=e,this.cameraControls.enableZoom=e,this.cameraControls.enablePan=e)},controlUpdate:function(e){if(null!==window.WEngine.currentFollow){if(u.theta=this.cameraControls.getAzimuthalAngle()+Math.Pi,u.phi=-this.cameraControls.getPolarAngle(),u.radius=this.cameraControls.getRadius(),u.oTheta||(u.oTheta=u.theta),u.oRadius||(u.oRadius=u.radius),u.oPhi||(u.oPhi=u.phi),C){var t=new Matrix4;t.extractRotation(window.WEngine.currentFollow.matrix);var i=new Vector3(0,0,1);i.applyMatrix4(t),u.theta=Math.atan2(i.x,i.z),this.camera.position.lerp(this.orbit(u.theta,u.oPhi,u.oRadius),.3)}else u.oRadius=u.radius,u.oPhi=u.phi,u.oTheta=u.theta;this.cameraControls.target.copy(window.WEngine.currentFollow.position),this.cameraControls.update(e)}},enableOutlineEffect:function(e){this.outlineEffect.enabled=e},enableHoloEffect:function(e,t){i=e?t:1,this.onWindowResize()},enableVREffect:function(e){i=e?2:1,this.onWindowResize()},enableWebVREffect:function(e){i=e?5:1,this.onWindowResize()},copy2AR:function(){this.markerScale.add(this.sceneRoot)},copy2Normal:function(){this.scene.add(this.sceneRoot)},setARSceneScale:function(e){this.arSceneScale=e,this.markerScale.scale.set(1,1,1).multiplyScalar(e)},initAR:function(){this.arToolkitSource.ready||(this.arToolkitSource.init(function(){F.arToolkitSource.onResize(F.renderer.domElement)}),this.arToolkitContext.init(function(){F.arCamera.projectionMatrix.copy(F.arToolkitContext.getProjectionMatrix())}))},enableAREffect:function(e){e?(i=6,this.initAR(),this.copy2AR()):(i=1,this.copy2Normal()),this.onWindowResize()}};return F},ConvexHull$1=(Ibe=new Vector3,Object.assign(Jbe.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.vertices.push(new Mbe(e[t]));return this.compute(),this},setFromObject:function(e){var s=[];return e.updateMatrixWorld(!0),e.traverse(function(e){var t,i,r,n=e.geometry;if(void 0!==n)if(n.isGeometry){var a=n.vertices;for(t=0,i=a.length;t<i;t++)(r=a[t].clone()).applyMatrix4(e.matrixWorld),s.push(r)}else if(n.isBufferGeometry){var o=n.attributes.position;if(void 0!==o)for(t=0,i=o.count;t<i;t++)(r=new Vector3).fromBufferAttribute(o,t).applyMatrix4(e.matrixWorld),s.push(r)}}),this.setFromPoints(s)},containsPoint:function(e){for(var t=this.faces,i=0,r=t.length;i<r;i++)if(t[i].distanceToPoint(e)>this.tolerance)return!1;return!0},intersectRay:function(e,t){for(var i=this.faces,r=-1/0,n=1/0,a=0,o=i.length;a<o;a++){var s=i[a],l=s.distanceToPoint(e.origin),c=s.normal.dot(e.direction);if(0<l&&0<=c)return null;var h=0!==c?-l/c:0;if(!(h<=0)&&(0<c?n=Math.min(h,n):r=Math.max(h,r),n<r))return null}return e.at(r!==-1/0?r:n,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,Ibe)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return null===(e.face=t).outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(t.outside=null!==e.next&&e.next.face===t?e.next:null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,i=e.outside;null!==i.next&&i.next.face===e;)i=i.next;return this.assigned.removeSubList(t,i),t.prev=i.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var i=this.removeAllVerticesFromFace(e);if(void 0!==i)if(void 0===t)this.unassigned.appendChain(i);else{var r=i;do{var n=r.next,a=t.distanceToPoint(r.point);this.tolerance<a?this.addVertexToFace(r,t):this.unassigned.append(r),r=n}while(null!==r)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var i=t.next,r=this.tolerance,n=null,a=0;a<e.length;a++){var o=e[a];if(0===o.mark){var s=o.distanceToPoint(t.point);if(r<s&&(r=s,n=o),1e3*this.tolerance<r)break}}null!==n&&this.addVertexToFace(t,n),t=i}while(null!==t)}return this},computeExtremes:function(){var e,t,i,r=new Vector3,n=new Vector3,a=[],o=[];for(e=0;e<3;e++)a[e]=o[e]=this.vertices[0];for(r.copy(this.vertices[0].point),n.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var s=this.vertices[e],l=s.point;for(i=0;i<3;i++)l.getComponent(i)<r.getComponent(i)&&(r.setComponent(i,l.getComponent(i)),a[i]=s);for(i=0;i<3;i++)l.getComponent(i)>n.getComponent(i)&&(n.setComponent(i,l.getComponent(i)),o[i]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(n.x))+Math.max(Math.abs(r.y),Math.abs(n.y))+Math.max(Math.abs(r.z),Math.abs(n.z))),{min:a,max:o}},computeInitialHull:function(){void 0===dde&&(dde=new Line3,ede=new Plane,fde=new Vector3);var e,t,i,r,n,a,o,s,l,c=this.vertices,h=this.computeExtremes(),u=h.min,d=h.max,p=0,m=0;for(a=0;a<3;a++)p<(l=d[a].point.getComponent(a)-u[a].point.getComponent(a))&&(p=l,m=a);for(p=0,dde.set((t=u[m]).point,(i=d[m]).point),a=0,o=this.vertices.length;a<o;a++)(e=c[a])!==t&&e!==i&&(dde.closestPointToPoint(e.point,!0,fde),p<(l=fde.distanceToSquared(e.point))&&(p=l,r=e));for(p=-1,ede.setFromCoplanarPoints(t.point,i.point,r.point),a=0,o=this.vertices.length;a<o;a++)(e=c[a])!==t&&e!==i&&e!==r&&p<(l=Math.abs(ede.distanceToPoint(e.point)))&&(p=l,n=e);var f=[];if(ede.distanceToPoint(n.point)<0)for(f.push(Kbe.create(t,i,r),Kbe.create(n,i,t),Kbe.create(n,r,i),Kbe.create(n,t,r)),a=0;a<3;a++)s=(a+1)%3,f[a+1].getEdge(2).setTwin(f[0].getEdge(s)),f[a+1].getEdge(1).setTwin(f[s+1].getEdge(0));else for(f.push(Kbe.create(t,r,i),Kbe.create(n,t,i),Kbe.create(n,i,r),Kbe.create(n,r,t)),a=0;a<3;a++)s=(a+1)%3,f[a+1].getEdge(2).setTwin(f[0].getEdge((3-a)%3)),f[a+1].getEdge(0).setTwin(f[s+1].getEdge(1));for(a=0;a<4;a++)this.faces.push(f[a]);for(a=0,o=c.length;a<o;a++)if((e=c[a])!==t&&e!==i&&e!==r&&e!==n){p=this.tolerance;var g=null;for(s=0;s<4;s++)p<(l=this.faces[s].distanceToPoint(e.point))&&(p=l,g=this.faces[s]);null!==g&&this.addVertexToFace(e,g)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var i=this.faces[t];0===i.mark&&e.push(i)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,i=this.assigned.first().face,r=i.outside;do{var n=i.distanceToPoint(r.point);t<n&&(t=n,e=r),r=r.next}while(null!==r&&r.face===i);return e}},computeHorizon:function(e,t,i,r){var n;this.deleteFaceVertices(i),i.mark=1,n=null===t?t=i.getEdge(0):t.next;do{var a=n.twin,o=a.face;0===o.mark&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,a,o,r):r.push(n)),n=n.next}while(n!==t);return this},addAdjoiningFace:function(e,t){var i=Kbe.create(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setTwin(t.twin),i.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var i=null,r=null,n=0;n<t.length;n++){var a=this.addAdjoiningFace(e,t[n]);null===i?i=a:a.next.setTwin(r),this.newFaces.push(a.face),r=a}return i.next.setTwin(r),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(Kbe,{create:function(e,t,i){var r=new Kbe,n=new Lbe(e,r),a=new Lbe(t,r),o=new Lbe(i,r);return n.next=o.prev=a,a.next=n.prev=o,o.next=a.prev=n,r.edge=n,r.compute()}}),Object.assign(Kbe.prototype,{getEdge:function(e){for(var t=this.edge;0<e;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===ree&&(ree=new Triangle);var e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return ree.set(e.point,t.point,i.point),ree.getNormal(this.normal),ree.getMidpoint(this.midpoint),this.area=ree.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(Lbe.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return(this.twin=e).twin=this}}),Object.assign(Nbe.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),Jbe),dde,ede,fde,ree,Ibe;function Jbe(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Nbe,this.unassigned=new Nbe,this.vertices=[]}function Kbe(){this.normal=new Vector3,this.midpoint=new Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function Lbe(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function Mbe(e){this.point=e,this.prev=null,this.next=null,this.face=null}function Nbe(){this.head=null,this.tail=null}function geometryInfo(e,t){var i,r,n,a,o,s,l,c,h,u=!1,d=!1;for("mesh"==t&&(d=!0),"convex"==t&&(u=!0),h=(e instanceof BufferGeometry?((s=(new Geometry).fromBufferGeometry(e)).mergeVertices(),l=e.attributes.position.array.length/3,c=s.vertices.length):l=c=(s=e.clone()).vertices.length,s.faces.length),e.realVertices=new Float32Array(3*c),e.realIndices=new(65535<3*h?Uint32Array:Uint16Array)(3*h),i=c;i--;)e.realVertices[n=3*i]=(a=s.vertices[i]).x,e.realVertices[n+1]=a.y,e.realVertices[n+2]=a.z;if(u)return s.dispose(),e.realVertices;for(i=h;i--;)e.realIndices[n=3*i]=(a=s.faces[i]).a,e.realIndices[n+1]=a.b,e.realIndices[n+2]=a.c;if(s.dispose(),d){var p=[];for(i=e.realIndices.length;i--;)p[n=3*i]=e.realVertices[a=3*e.realIndices[i]],p[n+1]=e.realVertices[a+1],p[n+2]=e.realVertices[a+2];return p}var m=[],f=e.attributes.position.array;for(i=c;i--;)for(n=3*i,m[i]=[],r=l;r--;)f[o=3*r]==e.realVertices[n]&&f[1+o]==e.realVertices[n+1]&&f[2+o]==e.realVertices[n+2]&&m[i].push(r);var g=new(65535<c?Uint32Array:Uint16Array)(c),v=new(65535<l?Uint32Array:Uint16Array)(l);for(i=a=0;i<c;i++){for(n=m[i].length,g[i]=a,r=n;r--;)v[a+r]=m[i][r];a+=n}e.numFaces=h,e.numVertices=c,e.maxi=l,e.pPoint=g,e.lPoint=v}function processGeometry(e){var t=new THREE.BufferGeometry;t.setAttribute("position",e.getAttribute("position")),t.setIndex(e.getIndex()),mapIndices(e,BufferGeometryUtils.mergeVertices(t))}function isEqual(e,t,i,r,n,a){return Math.abs(r-e)<1e-6&&Math.abs(n-t)<1e-6&&Math.abs(a-i)<1e-6}function mapIndices(e,t){var i=e.attributes.position.array,r=t.attributes.position.array,n=t.index.array,a=r.length/3,o=i.length/3;e.ammoVertices=r,e.ammoIndices=n,e.ammoIndexAssociation=[];for(var s=0;s<a;s++){var l=[];e.ammoIndexAssociation.push(l);for(var c=3*s,h=0;h<o;h++){var u=3*h;isEqual(r[c],r[1+c],r[2+c],i[u],i[1+u],i[2+u])&&l.push(u)}}}function Capsule(e,t,i,r){BufferGeometry.call(this),this.type="Capsule",e=e||1,t=t||1;var n=Math.PI;i=Math.floor(i)||12;var a=Math.floor(.5*i);r=Math.floor(r)||1;var o=2*Math.PI,s=.5*Math.PI,l=new Geometry,c=new CylinderGeometry(e,e,t,i,r,!0),h=new Matrix4,u=new SphereGeometry(e,i,a,0,o,0,s),d=new SphereGeometry(e,i,a,0,o,s,s),p=(new Matrix4).makeTranslation(0,0,0);6===i&&p.makeRotationY(30*THREE.Math.DEG2RAD);var m=(new Matrix4).makeTranslation(0,.5*t,0),f=(new Matrix4).makeTranslation(0,.5*-t,0);h.makeRotationZ(n),l.merge(c,p.multiply(h)),l.merge(u,m),l.merge(d,f),l.mergeVertices(),l.computeVertexNormals(),c.dispose(),u.dispose(),d.dispose(),this.fromGeometry(l),l.dispose()}function ConvexGeometry$1(e){Geometry.call(this),this.fromBufferGeometry(new ConvexBufferGeometry$1(e)),this.mergeVertices()}function ConvexBufferGeometry$1(e){BufferGeometry.call(this);for(var t=[],i=[],r=(new ConvexHull$1).setFromPoints(e).faces,n=0;n<r.length;n++){var a=r[n],o=a.edge;do{var s=o.head().point;t.push(s.x,s.y,s.z),i.push(a.normal.x,a.normal.y,a.normal.z),o=o.next}while(o!==a.edge)}this.setAttribute("position",new Float32BufferAttribute(t,3)),this.setAttribute("normal",new Float32BufferAttribute(i,3))}Capsule.prototype=Object.create(BufferGeometry.prototype),ConvexGeometry$1.prototype=Object.create(Geometry.prototype),ConvexGeometry$1.prototype.constructor=ConvexGeometry$1,ConvexBufferGeometry$1.prototype=Object.create(BufferGeometry.prototype),ConvexBufferGeometry$1.prototype.constructor=ConvexBufferGeometry$1;var REVISION$1="005",root$1={Ar:null,ArLng:[],ArPos:[],ArMax:0,key:[0,0,0,0,0,0,0,0],constraintDebug:!1,flow:{ray:[],terrain:[],vehicle:[],key:[]},post:null,extraGeo:[],container:null,tmpMat:[],mat:{},geo:{},controler:null,torad:Math.PI/180,refView:null,isRefView:!1,addViewObject:function(e){this.refView.addVisual(e)},correctSize:function(e){return 1===e.length&&(e[1]=e[0]),2===e.length&&(e[2]=e[0]),e},tmpQ:new Quaternion,tmpE:new Euler,tmpM:new Matrix4,toQuatArray:function(e){return root$1.tmpQ.setFromEuler(root$1.tmpE.fromArray(root$1.vectorad(e))).toArray()},vectorad:function(e){for(var t=e.length;t--;)e[t]*=root$1.torad;return e}},map=new Map;function RigidBody(){this.ID=0,this.solids=[],this.bodys=[]}function Constraint(){this.ID=0,this.joints=[]}function Joint(e){this.type="constraint",this.name=e.name,this.isMesh=!1,root$1.constraintDebug&&this.init(e)}Object.assign(RigidBody.prototype,{step:function(r,n){var a;this.bodys.forEach(function(e,t){var i=r[a=n+8*t];e.visible&&(e.isGroup?e.children.forEach(function(e,t){"Mesh"==e.type&&(0<i?("sleep"==e.material.name&&(e.material=root$1.mat.move),50<i&&"move"==e.material.name?e.material=root$1.mat.speed:i<50&&"speed"==e.material.name&&(e.material=root$1.mat.move)):"move"!=e.material.name&&"speed"!=e.material.name||(e.material=root$1.mat.sleep))}):0<i?("sleep"==e.material.name&&(e.material=root$1.mat.move),50<i&&"move"==e.material.name?e.material=root$1.mat.speed:i<50&&"speed"==e.material.name&&(e.material=root$1.mat.move)):"move"!=e.material.name&&"speed"!=e.material.name||(e.material=root$1.mat.sleep)),e.enabled&&(e.position.fromArray(r,a+1),e.quaternion.fromArray(r,a+4))})},clear:function(){for(;0<this.bodys.length;)this.destroy(this.bodys.pop());for(;0<this.solids.length;)this.destroy(this.solids.pop());this.ID=0},destroy:function(e){map.delete(e.name),root$1.destroy(e)},remove:function(e){if(map.has(e)){var t=map.get(e),i="solid"===t.type,r=i?this.solids.indexOf(t):this.bodys.indexOf(t);-1!==r&&(i?this.solids.splice(r,1):this.bodys.splice(r,1),this.destroy(t))}},add:function(e,t){void 0!==e.density&&(e.mass=e.density),void 0!==e.bounce&&(e.restitution=e.bounce),e.mass=void 0===e.mass?0:e.mass,e.kinematic=e.kinematic||!1;var i="body";0!==e.mass||e.kinematic||(i="static"),e.name=void 0!==e.name?e.name:i+this.ID++,this.remove(e.name),e.breakable&&("hardbox"!==e.type&&"box"!==e.type&&"sphere"!==e.type&&"cylinder"!==e.type&&"cone"!==e.type||(e.type="real"+e.type));var r=!1;e.type=void 0===e.type?"box":e.type,e.pos=void 0===e.pos?[0,0,0]:e.pos,e.size=null==e.size?[1,1,1]:e.size,e.size=root$1.correctSize(e.size),e.geoSize&&(e.geoSize=root$1.correctSize(e.geoSize)),e.quat=void 0===e.quat?[0,0,0,1]:e.quat,void 0!==e.rot&&(e.quat=root$1.toQuatArray(e.rot),delete e.rot);var n=null;if("plane"!==e.type){var a,o,s;if(void 0!==e.material?a=e.material.constructor===String?root$1.mat[e.material]:e.material:(a=0!==e.mass||e.kinematic?root$1.mat.move:root$1.mat.static,e.kinematic&&(a=root$1.mat.kinematic)),"compound"===e.type){for(var l=0;l<e.shapes.length;l++)(s=e.shapes[l]).size=void 0===s.size?[1,1,1]:s.size,1===s.size.length&&(s.size[1]=s.size[0]),2===s.size.length&&(s.size[2]=s.size[0]),s.pos=void 0===s.pos?[0,0,0]:s.pos,s.rot=void 0===s.rot?[0,0,0]:root$1.vectorad(s.rot),s.quat=void 0===s.quat?(new THREE.Quaternion).setFromEuler((new THREE.Euler).fromArray(s.rot)).toArray():s.quat;if(n=e.geometry?new THREE.Mesh(e.geometry,a):new THREE.Group,e.geometry&&root$1.extraGeo.push(e.geometry),!e.geometry||e.debug){n.material=a;for(l=0;l<e.shapes.length;l++){var c=null;"capsule"===(s=e.shapes[l]).type?c=new Capsule(e.size[0],e.size[1]):"convex"===s.type?(s.v=geometryInfo(c=s.shape,s.type),delete s.shape):c=root$1.geo[s.type],"capsule"!==s.type&&"convex"!==s.type||root$1.extraGeo.push(c),(o=new THREE.Mesh(c,e.debug?root$1.mat.debug:a)).scale.fromArray(s.size),o.position.fromArray(s.pos),o.quaternion.fromArray(s.quat),n.add(o)}}}else"mesh"===e.type||"convex"===e.type?(r=!0,e.shape&&(e.v=geometryInfo(e.shape,e.type),root$1.extraGeo.push(e.shape)),e.geometry?(e.geoScale&&(e.geometry=e.geometry.clone(),e.geometry.applyMatrix((new THREE.Matrix4).makeScale(e.geoScale[0],e.geoScale[0],e.geoScale[0]))),n=new THREE.Mesh(e.geometry,a),root$1.extraGeo.push(e.geometry)):e.mesh||(n=new THREE.Mesh(e.shape,a))):("capsule"===e.type&&(e.geometry=new Capsule(e.size[0],e.size[1])),"realbox"!==e.type&&"realhardbox"!==e.type||(e.geometry=new THREE.BoxBufferGeometry(e.size[0],e.size[1],e.size[2])),"realsphere"===e.type&&(e.geometry=new THREE.SphereBufferGeometry(e.size[0],16,12)),"realcylinder"===e.type&&(e.geometry=new THREE.CylinderBufferGeometry(e.size[0],e.size[0],.5*e.size[1],12,1)),"realcone"===e.type&&(e.geometry=new THREE.CylinderBufferGeometry(0,.5*e.size[0],.55*e.size[1],12,1)),void 0!==e.radius&&root$1.isRefView&&("box"===e.type&&(e.geometry=new THREE.ChamferBox(e.size[0],e.size[1],e.size[2],e.radius)),"cylinder"===e.type&&(e.geometry=new THREE.ChamferCyl(e.size[0],e.size[0],.5*e.size[1],e.radius)),"cone"===e.type&&(e.geometry=new THREE.ChamferCyl(e.radius,e.size[0],.5*e.size[1],e.radius))),e.geometry&&((e.geoRot||e.geoScale)&&(e.geometry=e.geometry.clone()),e.geoRot&&e.geometry.applyMatrix((new THREE.Matrix4).makeRotationFromEuler((new THREE.Euler).fromArray(root$1.vectorad(e.geoRot)))),e.geoScale&&e.geometry.applyMatrix((new THREE.Matrix4).makeScale(e.geoScale[0],e.geoScale[1],e.geoScale[2]))),n=new THREE.Mesh(e.geometry||root$1.geo[e.type],a),e.geometry&&(root$1.extraGeo.push(e.geometry),e.geoSize&&n.scale.fromArray(e.geoSize),r=!0));if("highsphere"===e.type&&(e.type="sphere"),"isGeometry"==t)return s;if(n||e.mesh){if(e.mesh)n=new THREE.Group,e.mesh.position.set(0,0,0),n.add(e.mesh);else if(!r&&!n.isGroup){n.scale.fromArray(e.size);var h=n;(n=new THREE.Group).add(h)}n.position.fromArray(e.pos),n.quaternion.fromArray(e.quat),n.updateMatrix(),n.name=e.name,n.enabled=!0,e.flag&&2==e.flag&&(n.visible=!1),void 0!==e.parent?(e.parent.add(n),e.parent=null):root$1.addViewObject(n),void 0===e.noShadow&&(n.isGroup&&(Object.defineProperty(n,"receiveShadow",{get:function(){return this.children[0].receiveShadow},set:function(e){for(var t=this.children.length;t--;)this.children[t].receiveShadow=e}}),Object.defineProperty(n,"castShadow",{get:function(){return this.children[0].castShadow},set:function(e){for(var t=this.children.length;t--;)this.children[t].castShadow=e}})),n.receiveShadow=!0,n.castShadow=e.castShadow?e.castShadow:!(0===e.mass&&!e.kinematic))}return e.shape&&delete e.shape,e.geometry&&delete e.geometry,e.material&&delete e.material,e.mesh&&delete e.mesh,void 0===e.noPhy&&(n&&(0!==e.mass||e.kinematic?this.bodys.push(n):this.solids.push(n)),root$1.post("add",e)),n?(n.type=0!==e.mass||e.kinematic?"body":"solid",n.userData.mass=e.mass,map.set(e.name,n),void 0!==e.autoMatrix&&(n.matrixAutoUpdate=e.autoMatrix),n):void 0}root$1.post("add",e)}}),Object.assign(Constraint.prototype,{step:function(i,r){root$1.constraintDebug&&this.joints.forEach(function(e,t){e.step(r+14*t,i)})},clear:function(){for(;0<this.joints.length;)this.destroy(this.joints.pop());this.ID=0},destroy:function(e){map.delete(e.name),e.clear()},remove:function(e){if(map.has(e)){var t=map.get(e),i=this.joints.indexOf(t);this.joints.splice(i,1),this.destroy(t)}},add:function(e){e.name=void 0!==e.name?e.name:"joint"+this.ID++,this.remove(e.name);var t=new Joint(e);return this.joints.push(t),map.set(t.name,t),void 0!==e.parent&&(e.parent=null),root$1.post("add",e),t}}),Object.assign(Joint.prototype,{step:function(e,t){if(this.isMesh){this.mesh.visible||(this.mesh.visible=!0);var i=this.pos.array;i[0]=t[e],i[1]=t[e+1],i[2]=t[e+2],i[3]=t[e+7],i[4]=t[e+8],i[5]=t[e+9],this.pos.needsUpdate=!0,this.p1.position.fromArray(t,e),this.p1.quaternion.fromArray(t,e+3),this.p2.position.fromArray(t,e+7),this.p2.quaternion.fromArray(t,e+10)}},init:function(e){var t=new Float32Array([0,0,0,0,0,0]),i=new Float32Array([0,1,0,1,1,0]),r=new THREE.BufferGeometry;r.setAttribute("position",new THREE.BufferAttribute(t,3)),r.setAttribute("color",new THREE.BufferAttribute(i,3)),this.mesh=new THREE.Line(r,root$1.mat.jointLine),this.mesh.name=e.name,this.p1=new THREE.Mesh(root$1.geo.joint,root$1.mat.jointP1),this.p2=new THREE.Mesh(root$1.geo.joint,root$1.mat.jointP2),this.p1.receiveShadow=!1,this.p1.castShadow=!1,this.p2.receiveShadow=!1,this.p2.castShadow=!1,this.mesh.receiveShadow=!1,this.mesh.castShadow=!1,this.mesh.add(this.p1),this.mesh.add(this.p2),this.mesh.frustumCulled=!1,this.pos=this.mesh.geometry.attributes.position,this.mesh.visible=!1,void 0!==e.parent?(e.parent.add(this.mesh),e.parent=null):root$1.container.add(this.mesh),this.isMesh=!0},clear:function(){this.isMesh&&(this.mesh.geometry.dispose(),root$1.destroy(this.mesh),this.mesh=null,this.p1=null,this.p2=null,this.isMesh=!1)}});var Tubular=function(e,t,i,r,n,a){if(BufferGeometry.call(this),this.debug=!1,this.type="Tubular",this.geoType=a||"tube",this.tubularSegments=t||64,this.radius=i||1,this.radialSegments=r||8,this.closed=n||!1,this.scalar=1,e instanceof Array)this.positions=e;else{this.positions=[];var o=(new Vector3).fromArray(e.start),s=(new Vector3).fromArray(e.end),l=s.clone().sub(o),c=e.numSegment-1;this.positions.push(o);for(var h=1;h<c;h++)this.positions.push(new Vector3(l.x/c*h,l.y/c*h,l.z/c*h).add(o));this.positions.push(s)}this.rotations=[];for(h=1;h<this.positions.length+1;h++)this.rotations.push(new Quaternion);this.path=new CatmullRomCurve3(this.positions),this.path.type="catmullrom",this.path.closed=this.closed,this.frames=this.path.computeFrenetFrames(this.tubularSegments,this.closed,this.rotations),this.vertex=new Vector3,this.normal=new Vector3,this.uv=new Vector2,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.indices=[],this.generatePath(),this.setIndex(new(65535<this.indices.length?Uint32BufferAttribute:Uint16BufferAttribute)(this.indices,1)),this.setAttribute("position",new Float32BufferAttribute(this.vertices,3)),this.setAttribute("color",new Float32BufferAttribute(this.colors,3)),this.setAttribute("normal",new Float32BufferAttribute(this.normals,3)),this.setAttribute("uv",new Float32BufferAttribute(this.uvs,2))};function SoftBody(){this.ID=0,this.softs=[],this.tmpMat=null}function softMesh(e,t){var i=e.shape.clone();i.scale(e.size[0],e.size[1],e.size[2]),processGeometry(i),root$1.extraGeo.push(i),e.v=i.ammoVertices,e.i=i.ammoIndices,e.ntri=i.ammoIndices.length/3,i.translate(e.pos[0],e.pos[1],e.pos[2]),i.applyMatrix4(root$1.tmpM.makeRotationFromQuaternion(root$1.tmpQ.fromArray(e.quat)));var r=new THREE.Mesh(i,t);return r.castShadow=!0,r.receiveShadow=!0,r.softType=5,r.points=e.v.length/3,e.shape&&delete e.shape,e.material&&delete e.material,{mesh:r,o:e}}function softCloth(e,t){var i=e.size||[4,3,5,5],r=e.pos||[0,0,0],n=i[0],a=i[1],o=n*i[2],s=a*i[3],l=[1+o,1+s],c=l[0]*l[1],h=new THREE.PlaneBufferGeometry(n,a,o,s);h.setAttribute("color",new THREE.BufferAttribute(new Float32Array(3*c),3));var u=new THREE.Mesh(h,t);return u.material.needsUpdate=!0,u.castShadow=!0,u.receiveShadow=!0,u.softType=1,u.points=h.attributes.position.array.length/3,e.size=i,e.div=l,e.pos=r,{mesh:u,o:e}}function softRope(e,t){void 0===e.numSeg&&(e.numSeg=e.numSegment);var i=new Tubular(e,e.numSeg||10,e.radius||.2,e.numRad||6,!1),r=new THREE.Mesh(i,t);return r.castShadow=!0,r.receiveShadow=!0,r.softType=2,r.points=i.positions.length,{mesh:r,o:e}}function ellipsoid(e){var t,i,r,n,a,o=e.lng,s=[],l=e.a;for(t=0;t<o;t++)a=3*t,s.push(new THREE.Vector3(l[a],l[a+1],l[a+2]));var c=new ConvexGeometry$1(s),h=new Uint32Array(3*c.faces.length),u=new Float32Array(3*o),d=new Float32Array(o);for(n=c.vertices,t=o;t--;)for(i=o;i--;)l[a=3*i]==n[t].x&&l[a+1]==n[t].y&&l[a+2]==n[t].z&&(d[i]=t);for(t=o;t--;)u[r=3*d[t]]=l[a=3*t],u[1+r]=l[a+1],u[2+r]=l[a+2];for(t=c.faces.length;t--;){var p=c.faces[t];h[a=3*t]=p.a,h[a+1]=p.b,h[a+2]=p.c}var m=new THREE.BufferGeometry;if(m.setIndex(new THREE.BufferAttribute(h,1)),m.setAttribute("position",new THREE.BufferAttribute(u,3)),m.setAttribute("color",new THREE.BufferAttribute(new Float32Array(3*o),3)),m.setAttribute("order",new THREE.BufferAttribute(d,1)),c.uvs){var f=new Float32Array(2*c.uvs.length);m.setAttribute("uv",new THREE.BufferAttribute(f,2).copyVector2sArray(c.uvs),2)}m.computeVertexNormals(),root$1.extraGeo.push(m),c.dispose();var g=new THREE.Mesh(m,root$1.mat.soft);return g.softType=3,g.type="soft",g.points=m.attributes.position.array.length/3,g.castShadow=!0,g.receiveShadow=!0,g}function Terrain$1(){this.ID=0,this.terrains=[]}Tubular.prototype=Object.create(BufferGeometry.prototype),Tubular.prototype.constructor=Tubular,Tubular.prototype.addDebug=function(e){this.path.g=new Geometry;for(var t=0;t<this.tubularSegments+1;t++)this.path.g.vertices.push(new Vector3);this.path.mesh=new Line(this.path.g,new LineBasicMaterial({color:16746496,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0})),e.add(this.path.mesh),this.debug=!0},Tubular.prototype.setTension=function(e){this.path.tension=e},Tubular.prototype.generateSegment=function(e){var t=e/this.tubularSegments,i=this.scalar;"sphere"===this.geoType&&(i=2*Math.sqrt(Math.pow(.5,2)-Math.pow(t-.5,2)));var r,n=3*e*(this.radialSegments+1),a=this.path.getPointAt(t);this.debug&&this.path.g.vertices[e].copy(a);for(var o=this.frames.normals[e],s=this.frames.binormals[e],l=!0,c=1,h=0;h<=this.radialSegments;h++){var u=h/this.radialSegments*Math.PI*2;1===this.radialSegments&&(u=0),r=3*h;var d=Math.sin(u),p=-Math.cos(u);1===this.radialSegments?(l=l?!(c=.5):(c=-.5,!0),this.normal.copy(o).negate().projectOnPlane(new Vector3(0,1,0))):(this.normal.x=p*o.x+d*s.x,this.normal.y=p*o.y+d*s.y,this.normal.z=p*o.z+d*s.z),this.normal.normalize(),this.normals[n+r]=this.normal.x,this.normals[n+r+1]=this.normal.y,this.normals[n+r+2]=this.normal.z,this.normal.multiplyScalar(i),this.vertices[n+r]=a.x+this.radius*this.normal.x*c,this.vertices[n+r+1]=a.y+this.radius*this.normal.y*c,this.vertices[n+r+2]=a.z+this.radius*this.normal.z*c,this.colors[n+r]=Math.abs(this.normal.x),this.colors[n+r+1]=Math.abs(this.normal.y),this.colors[n+r+2]=Math.abs(this.normal.z),1===this.radialSegments&&(this.normals[n+r]=0,this.normals[n+r+1]=1,this.normals[n+r+2]=0)}},Tubular.prototype.generateIndicesAndUv=function(){for(var e=0;e<=this.tubularSegments;e++)for(var t=0;t<=this.radialSegments;t++){if(0<t&&0<e){var i=(this.radialSegments+1)*e+(t-1),r=(this.radialSegments+1)*e+t,n=(this.radialSegments+1)*(e-1)+t;this.indices.push((this.radialSegments+1)*(e-1)+(t-1),i,n),this.indices.push(i,r,n)}this.uv.x=t/this.radialSegments,this.uv.y=e/this.tubularSegments,this.uvs.push(this.uv.x,this.uv.y)}},Tubular.prototype.generatePath=function(e){for(var t=0;t<=this.tubularSegments;t++)this.generateSegment(t);this.generateIndicesAndUv()},Tubular.prototype.updatePath=function(e){this.frames=this.path.computeFrenetFrames(this.tubularSegments,this.closed,this.rotations),this.normals=this.attributes.normal.array,this.vertices=this.attributes.position.array,this.colors=this.attributes.color.array;for(var t=0;t<=this.tubularSegments;t++)this.generateSegment(t);this.attributes.color.needsUpdate=!0,this.attributes.position.needsUpdate=!0,this.attributes.normal.needsUpdate=!0,this.attributes.uv.needsUpdate=!0,this.debug&&(this.path.g.verticesNeedUpdate=!0),"sphere"===this.geoType&&this.computeVertexNormals(),this.computeBoundingSphere()},Tubular.prototype.updateUV=function(){var e,t;this.uvs=this.attributes.uv.array;for(var i=0;i<=this.tubularSegments;i++){e=2*i*(this.radialSegments+1);for(var r=0;r<=this.radialSegments;r++)t=2*r,this.uv.x=i/this.tubularSegments,this.uv.y=r/this.radialSegments,this.uvs[e+t]=this.uv.x,this.uvs[e+t+1]=this.uv.y}this.attributes.uv.needsUpdate=!0},Tubular.prototype.updateIndices=function(){var e,t;this.indices=[];for(var i=0;i<=this.tubularSegments;i++){t=2*i*(this.radialSegments+1);for(var r=0;r<=this.radialSegments;r++){if(0<r&&0<i){var n=(this.radialSegments+1)*i+(r-1),a=(this.radialSegments+1)*i+r,o=(this.radialSegments+1)*(i-1)+r;this.indices.push((this.radialSegments+1)*(i-1)+(r-1),n,o),this.indices.push(n,a,o)}this.uv.x=i/this.tubularSegments,this.uv.y=r/this.radialSegments,this.uvs[t+e]=this.uv.y,this.uvs[t+e+1]=this.uv.x,e=2*r}}},Object.assign(SoftBody.prototype,{step:function(_,e){var b=e;this.softs.forEach(function(e){var t,i,r,n,a=e.geometry,o=e.softType,s=null,l=!!a.attributes.color;if(2===o){for(d=a.positions.length;d--;)a.positions[d].set(_[t=b+3*d],_[t+1],_[t+2]);a.updatePath()}else{if(!a.attributes.position)return;if(n=a.attributes.position.array,l&&(i=a.attributes.color.array),5===o||4===o){for(var c=a.attributes.position.array,h=a.ammoIndexAssociation,u=h.length,d=0;d<u;d++)for(var p=_[t=3*d+b],m=_[t+1],f=_[t+2],g=h[d],v=0,y=g.length;v<y;v++){var x=g[v];c[x]=p,c[++x]=m,c[++x]=f}a.attributes.position.needsUpdate=!0,a.computeVertexNormals(),a.attributes.normal.needsUpdate=!0}else if(a.attributes.order&&(s=a.attributes.order.array),d=n.length,t=2,null!==s)for(d=s.length;d--;)n[v=3*s[d]]=_[t=3*d+b],n[v+1]=_[t+1],n[v+2]=_[t+2],r=Math.abs(_[t+1]/10),i[v]=r,i[v+1]=r,i[v+2]=r;else for(;d--;)n[d]=_[d+b],1==t&&(r=Math.abs(n[d]/10),i[d-1]=r,i[d]=r,i[d+1]=r),t=--t<0?2:t;2!==o&&a.computeVertexNormals(),a.attributes.normal.needsUpdate=!0,l&&(a.attributes.color.needsUpdate=!0),a.attributes.position.needsUpdate=!0}b+=3*e.points})},clear:function(){for(;0<this.softs.length;)this.destroy(this.softs.pop());this.ID=0},destroy:function(e){e.parent&&e.parent.remove(e),map.delete(e.name)},remove:function(e){if(map.has(e)){var t=map.get(e),i=this.softs.indexOf(t);-1!==i&&(this.softs.splice(i,1),this.destroy(t))}},add:function(e){var t,i,r,n=void 0!==e.name?e.name:e.type+this.ID++;switch(this.remove(n),e.pos=void 0===e.pos?[0,0,0]:e.pos,e.size=null==e.size?[1,1,1]:e.size,e.size=root$1.correctSize(e.size),e.quat=void 0===e.quat?[0,0,0,1]:e.quat,void 0!==e.rot&&(e.quat=root$1.toQuatArray(e.rot),delete e.rot),t=void 0!==e.material?e.material.constructor===String?root$1.mat[e.material]:e.material:root$1.mat.soft,e.type){case"softMesh":case"softTriMesh":case"softConvex":i=softMesh(e,t);break;case"softCloth":i=softCloth(e,t);break;case"softRope":i=softRope(e,t);break;case"softEllips":return this.tmpMat=t,void root$1.post("add",e)}e=i.o,(r=i.mesh).name=n,r.type="soft",e.material&&delete e.material,root$1.addViewObject(r),this.softs.push(r),map.set(n,r),root$1.post("add",e)},createEllipsoid:function(e){var t=ellipsoid(e);this.tmpMat&&(t.material=this.tmpMat),t.name=e.name,root$1.container.add(t),this.softs.push(t),map.set(e.name,t)}}),Object.assign(Terrain$1.prototype,{step:function(){root$1.flow.terrain=[],this.terrains.forEach(function(e){e.needsUpdate&&(e.updateGeometry(),root$1.flow.terrain.push({name:e.name,heightData:e.heightData}),e.needsUpdate=!1)})},clear:function(){for(;0<this.terrains.length;)this.destroy(this.terrains.pop());this.ID=0},destroy:function(e){e.parent&&e.parent.remove(e),map.delete(e.name)},remove:function(e){if(map.has(e)){var t=map.get(e),i=this.terrains.indexOf(t);-1!==i&&(this.terrains.splice(i,1),this.destroy(t))}},add:function(e){var t,i=void 0!==e.name?e.name:e.type+this.ID++;return this.remove(i),e.sample=void 0===e.sample?[64,64]:e.sample,e.pos=void 0===e.pos?[0,0,0]:e.pos,e.complexity=void 0===e.complexity?30:e.complexity,e.name=i,e.mesh?(t=e.mesh,delete e.mesh,e.heightData=e.hdata,delete e.hdata,t.needsUpdate=!1,t.type="terrain"):((t=new Terrain(e)).position.set(e.pos[0],e.pos[1],e.pos[2]),t.needsUpdate=!1,t.type="terrain",delete e.physicsUpdate,e.heightData=t.heightData),e.offset=0,root$1.addViewObject(t),this.terrains.push(t),map.set(i,t),root$1.post("add",e),t},move:function(e,t,i){if(map.has(e)){var r=map.get(e);r.local.x+=t||0,r.local.z+=i||0,r.update(!0),r.needsUpdate=!0}}});var CarHelper=function(e,t,i){var r=.6*-i;this.py=e[1]-t[1];var n=new Float32Array([-.2,0,0,.2,0,0,0,0,0,0,.4,0,0,0,-.2,0,0,.2,e[0]-r,this.py,e[2],e[0]-r,this.py+1,e[2],r-e[0],this.py,e[2],r-e[0],this.py+1,e[2],r-e[0],this.py,-e[2],r-e[0],this.py+1,-e[2],e[0]-r,this.py,-e[2],e[0]-r,this.py+1,-e[2],e[0]-r,this.py,e[2],r-e[0],this.py,e[2],e[0]-r,this.py,-e[2],r-e[0],this.py,-e[2]]),a=new Float32Array([1,1,0,1,1,0,1,1,0,0,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0]);this.geometry=new BufferGeometry,this.geometry.setAttribute("position",new BufferAttribute(n,3)),this.geometry.setAttribute("color",new BufferAttribute(a,3)),this.positions=this.geometry.attributes.position.array,this.material=new LineBasicMaterial({vertexColors:VertexColors,name:"helper"}),LineSegments.call(this,this.geometry,this.material)},kpe;function Vehicle(){this.ID=0,this.cars=[]}function Character(){this.ID=0,this.heroes=[]}function Collision(){this.ID=0,this.pairs=[]}function Pair(e,t){this.name=e,this.callback=t||function(){},this.type="collision",this.hit=0}function RayCaster(){this.ID=0,this.rays=[]}function Ray$1(e){Line.call(this),this.type="ray",this.name=e.name,this.enabled=void 0===e.enabled||e.enabled,this.precision=void 0!==e.precision?e.precision:1,this.callback=e.callback||function(){},this.position.fromArray(e.pos||[0,0,0]),this.group=void 0!==e.group?e.group:1,this.mask=void 0!==e.mask?e.mask:-1,this.origin=[0,0,0],this.dest=[0,0,0],this.start=(new Vector3).fromArray(e.start||[0,0,0]),this.end=(new Vector3).fromArray(e.end||[0,10,0]),this.maxDistance=this.start.distanceTo(this.end),this.tmp=new Vector3,this.normal=new Vector3,this.inv=new Matrix4,this.c1=[.1,.1,.1],this.c2=[1,.1,.1],this.vertices=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.local=[0,0,0,0,0,0],this.geometry.setAttribute("position",new Float32BufferAttribute(this.vertices,3)),this.geometry.setAttribute("color",new Float32BufferAttribute(this.colors,3)),this.vertices=this.geometry.attributes.position.array,this.colors=this.geometry.attributes.color.array,this.material.color.setHex(16777215),this.material.vertexColors=VertexColors,this.base=!1,this.info={hit:!1,name:"",distance:0},this.upGeo()}function ConvexObjectBreaker(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new Line3,this.tempPlane1=new Plane,this.tempPlane2=new Plane,this.tempPlane_Cut=new Plane,this.tempCM1=new Vector3,this.tempCM2=new Vector3,this.tempVector3=new Vector3,this.tempVector3_2=new Vector3,this.tempVector3_3=new Vector3,this.tempVector3_P0=new Vector3,this.tempVector3_P1=new Vector3,this.tempVector3_P2=new Vector3,this.tempVector3_N0=new Vector3,this.tempVector3_N1=new Vector3,this.tempVector3_AB=new Vector3,this.tempVector3_CB=new Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var i=0;i<900;i++)this.segments[i]=!1}CarHelper.prototype=Object.create(LineSegments.prototype),CarHelper.prototype.constructor=CarHelper,CarHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},CarHelper.prototype.updateSuspension=function(e,t,i,r){this.positions[22]=this.py-e,this.positions[28]=this.py-t,this.positions[34]=this.py-i,this.positions[40]=this.py-r,this.geometry.attributes.position.needsUpdate=!0},Object.assign(Vehicle.prototype,{step:function(h,u){var d;this.cars.forEach(function(e,t){var i,r,n=e.userData.NumWheels,a=56;e.userData.speed=h[d=u+64*t],e.userData.wr=[h[d+62],h[d+63]],e.position.fromArray(h,d+1),e.quaternion.fromArray(h,d+4);var o=e.userData.radius,s=h[d+8];if(e.userData.steering=s,e.userData.steeringWheel&&(e.userData.steeringWheel.rotation.y=15*-s),e.userData.isWithBrake){var l=h[d+8],c=h[d+16];for(i=n;i--;)0===i&&(e.userData.b[i].rotation.y=c),1===i&&(e.userData.b[i].rotation.y=Math.Pi-l),e.userData.b[i].position.y=o-h[d+a+i]}if(e.userData.isWithSusp)for(i=n;i--;)r=(r=1<(r=5*h[d+a+i])?1:r)<-1?-1:r;for(e.userData.helper&&(2===n&&e.userData.helper.updateSuspension(h[d+a+0],h[d+a+0],h[d+a+1],h[d+a+1]),4===n&&e.userData.helper.updateSuspension(h[d+a+0],h[d+a+1],h[d+a+2],h[d+a+3]));n--;)e.userData.suspension[n]=h[d+56+n],e.userData.w[n].position.fromArray(h,d+(a=8*(n+1))+1),e.userData.w[n].quaternion.fromArray(h,d+a+4)})},clear:function(){for(;0<this.cars.length;)this.destroy(this.cars.pop());this.ID=0},destroy:function(e){for(var t,i=0,r=e.userData.w.length;i<r;i++)(t=e.userData.w[i]).parent&&t.parent.remove(t);e.parent&&e.parent.remove(e),map.delete(e.name)},remove:function(e){if(map.has(e)){var t=map.get(e),i=this.cars.indexOf(t);-1!==i&&(this.cars.splice(i,1),this.destroy(t))}},add:function(e){var t=void 0!==e.name?e.name:e.type+this.ID++;this.remove(t);var i,r,n=e.size||[2,.5,4],a=e.pos||[0,0,0],o=e.rot||[0,0,0];if(e.massCenter=void 0===e.massCenter?[0,0,0]:e.massCenter,Math.vectorad(o),e.mesh)(r=new THREE.Group).add(e.mesh);else if(e.geometry)r=new THREE.Mesh(e.geometry,e.material),root$1.extraGeo.push(e.geometry);else{var s=(new THREE.BufferGeometry).fromGeometry(new THREE.BoxGeometry(n[0],n[1],n[2]));s.translate(-e.massCenter[0],-e.massCenter[1],-e.massCenter[2]),root$1.extraGeo.push(s),r=new THREE.Mesh(s,root$1.mat.move)}e.debug&&e.shape&&(r=new THREE.Mesh(e.shape,root$1.mat.debug)),r.position.set(a[0],a[1],a[2]),r.rotation.set(o[0],o[1],o[2]),e.quat=r.quaternion.toArray(),root$1.addViewObject(r),r.userData.speed=0,r.userData.NumWheels=e.nWheel||4,r.userData.suspension=[0,0,0,0,0,0],r.userData.wr=[0,0],r.userData.steering=0,r.userData.type="car",r.userData.steeringWheel=e.meshSteeringWheel||null;var l=e.radius||.4,c=e.radiusBack||l,h=e.deep||.3;i=e.wPos||[1,-.25,1.6];var u,d=[],p=[],m=[],f=void 0!==e.meshSusp,g=void 0!==e.meshBrake,v=null==e.wheel,y=e.wheel||root$1.geo.wheel,x=y.clone();x.rotateY(Math.Pi),root$1.extraGeo.push(x);var _=root$1.mat.move;void 0!==e.wheelMaterial&&(_=e.wheelMaterial.constructor===String?root$1.mat[e.wheelMaterial]:e.wheelMaterial);for(var b,w=e.nWheel||4,M=e.decalYBack||0,S=0;S<w;S++){if(0===S&&(b=!0),1===S&&(b=!0),2===S&&(b=![-i[0],i[1],-i[2]]),3===S&&(b=![i[0],i[1],-i[2]]),4===S&&(b=![-i[0],i[1],-i[3]]),5===S&&(b=![i[0],i[1],-i[3]]),2===w&&(0===S&&(b=!0),1===S&&(b=![0,i[1]+M,-i[2]])),3===w&&(0===S&&(b=!0),1===S&&(b=![i[0],i[1]+M,-i[2]]),2===S&&(b=![-i[0],i[1]+M,-i[2]])),e.meshBrake&&(u=e.meshBrake.clone(),r.add(u),u.position.y=l,1==S||2==S?(u.rotation.y=Math.Pi,u.position.x=i[0],u.rotation.x=Math.Pi):u.position.x=-i[0],u.position.z=0==S||1==S?i[2]:-i[2],m[S]=u),e.meshSusp&&(u=e.meshSusp.clone(),r.add(u),u.position.y=l,1!=S&&2!=S||(u.rotation.y=Math.Pi),u.position.z=0==S||1==S?i[2]:-i[2],p[S]=u.children[0]),e.meshWheel)if(d[S]=e.meshWheel.clone(),v=!1,1==S||2==S){d[S]=new THREE.Group;var T=e.meshWheel.clone();T.rotation.y=Math.Pi,d[S].add(T)}else{d[S]=e.meshWheel.clone();for(var A=d[S].children.length;A--;)"h_pneu"===d[S].children[A].name&&(d[S].children[A].rotation.y=Math.Pi)}else d[S]=1==S||2==S?new THREE.Mesh(y,root$1.mat.move):new THREE.Mesh(x,root$1.mat.move);v&&d[S].scale.set(h,b?l:c,b?l:c),d[S].material=_,d[S].castShadow=!0,d[S].receiveShadow=!0,root$1.addViewObject(d[S])}if(e.extraWeels){var E=e.meshWheel.clone();E.children[0].visible=!1,E.rotation.z=.5*-Math.Pi,E.position.set(0,1.25,-1.11),r.add(E)}return r.userData.radius=l,r.userData.w=d,r.userData.s=p,r.userData.b=m,r.userData.isWithSusp=f,r.userData.isWithBrake=g,void 0===e.noShadow&&(r.castShadow=!0,r.receiveShadow=!0),r.name=t,e.helper&&(r.userData.helper=new CarHelper(i,e.massCenter,h),r.add(r.userData.helper)),e.mesh&&(e.mesh=null),e.wheel&&(e.wheel=null),"mesh"!=e.shapeType&&"convex"!=e.shapeType||(e.v=geometryInfo(e.shape,e.shapeType)),e.shape&&delete e.shape,e.geometry&&delete e.geometry,e.material&&delete e.material,e.mesh&&delete e.mesh,e.meshWheel&&delete e.meshWheel,e.meshSusp&&delete e.meshSusp,e.meshBrake&&delete e.meshBrake,e.meshSteeringWheel&&delete e.meshSteeringWheel,e.wheelMaterial&&delete e.wheelMaterial,this.cars.push(r),map.set(t,r),root$1.post("add",e),r}}),Object.assign(Character.prototype,{step:function(n,a){var o;this.heroes.forEach(function(e,t){var i=n[o=a+8*t];e.position.fromArray(n,o+1),e.quaternion.fromArray(n,o+4);var r=root$1.flow.key[t];1==i&&(e.userData.avatar.isJumping=!1),r&&!e.userData.findPath&&(1==r[6]&&e.userData.avatar.canJump&&1==i?e.userData.avatar.playAction("prejump"):0==r[6]&&"prejump"==e.userData.avatar.curActionName?(e.userData.avatar.playAction("jump"),e.userData.avatar.canJump=!1,e.userData.avatar.isJumping=!0):0==i?e.userData.avatar.playAction("jump"):r[1]<0?e.userData.avatar.playAction(1==r[7]?"run":1==r[5]?"walk_cf":"walk_f"):0<r[1]?e.userData.avatar.playAction(1==r[5]?"walk_cb":"walk_b"):1==r[5]?e.userData.avatar.playAction("crouch"):1==r[9]?(e.userData.avatar.addHandGun(),e.userData.avatar.playAction("aim_r_handgun")):0<e.userData.avatar.life?(e.userData.avatar.playAction("idle"),e.userData.avatar.canJump=!0):e.userData.avatar.playAction("dead"))})},step1:function(r,n){var a;this.heroes.forEach(function(e,t){var i=3.33*r[a=n+8*t];e.userData.speed=i,e.position.fromArray(r,a+1),e.quaternion.fromArray(r,a+4),e.skin&&(0==i?e.skin.play(0,.3):(e.skin.play(1,.3),e.skin.setTimeScale(i)))})},clear:function(){for(;0<this.heroes.length;)this.destroy(this.heroes.pop());this.ID=0},destroy:function(e){e.parent&&e.parent.remove(e),map.delete(e.name)},remove:function(e){if(map.has(e)){var t=map.get(e),i=this.heroes.indexOf(t);-1!==i&&(this.heroes.splice(i,1),this.destroy(t))}},add:function(e){var t=void 0!==e.ename?e.ename:e.type+this.ID++;this.remove(e.name=t),e.scale=e.scale||1,e.size=void 0!==e.size?e.size:[.25,2];var i=new Capsule(e.size[0],e.size[1],6),r=new THREE.Group;if(r.ename=t,e.debug){var n=new THREE.Mesh(i,root$1.mat.debug);root$1.extraGeo.push(i),n.visible=!1,r.add(n),r.userData.capsule=n}return e.avatar&&(r.add(e.avatar.model),r.userData.avatar=e.avatar,delete e.avatar),r.userData.speed=0,r.userData.type="hero",r.position.fromArray(e.pos),r.quaternion.fromArray(e.quat),r.castShadow=!0,r.receiveShadow=!0,r.name=t,e.material&&delete e.material,e.mesh&&delete e.mesh,e.scale&&delete e.scale,root$1.addViewObject(r),this.heroes.push(r),map.set(t,r),root$1.post("add",e),r},add1:function(e){var t,i=void 0!==e.ename?e.ename:e.type+this.ID++;if(this.remove(e.name=i),e.scale=e.scale||1,e.size=void 0!==e.size?e.size:[.25,2],e.mesh){var r=e.mesh.geometry,n=(Math.abs(r.boundingBox.max.y)+Math.abs(r.boundingBox.min.y))*e.scale,a=-(Math.abs(r.boundingBox.max.y)-Math.abs(r.boundingBox.min.y))*e.scale*.5;e.size[1]=n}e.size[1]=e.size[1]-2*e.size[0],e.pos=void 0===e.pos?[0,0,0]:e.pos,e.rot=null==e.rot?[0,0,0]:Math.vectorad(e.rot),e.quat=(new THREE.Quaternion).setFromEuler((new THREE.Euler).fromArray(e.rot)).toArray(),t=void 0!==e.material?e.material.constructor===String?root$1.mat[e.material]:e.material:root$1.mat.hero;var o=new Capsule(e.size[0],e.size[1],6),s=new THREE.Group;if(e.debug){var l=new THREE.Mesh(o,root$1.mat.debug);root$1.extraGeo.push(o),s.add(l)}if(e.mesh){var c=e.mesh;c.material=t,c.scale.multiplyScalar(e.scale),c.position.set(0,a,0),c.setTimeScale(.5),c.play(0),s.add(c),s.skin=c}else{var h=new THREE.Mesh(o,t);root$1.extraGeo.push(o),s.add(h)}return s.userData.speed=0,s.userData.type="hero",s.position.fromArray(e.pos),s.quaternion.fromArray(e.quat),s.castShadow=!0,s.receiveShadow=!0,s.name=i,e.material&&delete e.material,e.mesh&&delete e.mesh,e.scale&&delete e.scale,root$1.container.add(s),this.heroes.push(s),map.set(i,s),root$1.post("add",e),s}}),Object.assign(Collision.prototype,{step:function(i,r){this.pairs.forEach(function(e,t){e.hit=i[r+t]?i[r+t]:0,e.callback(i[r+t]||0)})},clear:function(){for(;0<this.pairs.length;)this.destroy(this.pairs.pop());this.ID=0},destroy:function(e){e.clear(),map.delete(e.name)},remove:function(e){if(map.has(e)){var t=map.get(e),i=this.pairs.indexOf(t);-1!==i&&(this.pairs.splice(i,1),this.destroy(t))}},add:function(e){var t=void 0!==e.name?e.name:"pair"+this.ID++;this.remove(t);var i=new Pair(t,e.callback);return this.pairs.push(i),delete e.callback,map.set(t,i),root$1.post("add",e),i}}),Object.assign(Pair.prototype,{clear:function(){this.name=null,this.hit=0,this.callback=null}}),Object.assign(RayCaster.prototype,{step:function(){var e=this.rays.length,t=root$1.flow.ray.length;if(e){if(e===t)for(;t--;)this.rays[t].update(root$1.flow.ray[t]);root$1.flow.ray=[],this.rays.forEach(function(e,t){e.updateMatrixWorld(),root$1.flow.ray.push({origin:e.origin,dest:e.dest,group:e.group,mask:e.mask,precision:e.precision})})}},clear:function(){for(;0<this.rays.length;)this.destroy(this.rays.pop());this.ID=0},destroy:function(e){e.parent&&e.parent.remove(e),map.delete(e.name)},remove:function(e){if(map.has(e)){var t=map.get(e),i=this.rays.indexOf(t);-1!==i&&(this.rays.splice(i,1),this.destroy(t))}},add:function(e){e.name=void 0!==e.name?e.name:"ray"+this.ID++,this.remove(e.name);var t=new Ray$1(e);return void 0!==e.visible&&(t.visible=e.visible),void 0!==e.parent?e.parent.add(t):root$1.addViewObject(t),this.rays.push(t),map.set(e.name,t),delete e.callback,delete e.parent,root$1.post("add",e),t}}),Ray$1.prototype=Object.assign(Object.create(Line.prototype),{setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.start.setFromMatrixPosition(t.matrixWorld),this.tmp.set(e.x,e.y,.5).unproject(t).sub(this.start).normalize(),this.end.copy(this.tmp).multiplyScalar(t.far).add(this.start)):t&&t.isOrthographicCamera?(this.start.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.normal.set(0,0,-1).transformDirection(t.matrixWorld),this.end.addScaledVector(this.normal,t.far)):console.error("THREE.Raycaster: Unsupported camera type.")},updateMatrixWorld:function(e){Line.prototype.updateMatrixWorld.call(this,e),this.tmp.copy(this.start).applyMatrix4(this.matrixWorld),this.tmp.toArray(this.origin,0),this.tmp.copy(this.end).applyMatrix4(this.matrixWorld),this.tmp.toArray(this.dest,0),this.inv.getInverse(this.matrixWorld)},upGeo:function(e){if(this.enabled){var t,i,r=this.vertices,n=this.colors,a=this.local;if(e)this.isBase=!1,n[0]=n[3]=n[15]=n[18]=this.c2[0],n[1]=n[4]=n[16]=n[19]=this.c2[1],n[2]=n[5]=n[17]=n[20]=this.c2[2],r[3]=r[6]=r[12]=r[15]=a[0],r[4]=r[7]=r[13]=r[16]=a[1],r[5]=r[8]=r[14]=r[17]=a[2],r[18]=a[3],r[19]=a[4],r[20]=a[5],this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0;else{if(this.isBase)return;for(var o=7;o--;)i=o<3,n[t=3*o]=this.c1[0],n[1+t]=this.c1[1],n[2+t]=this.c1[2],r[t]=i?this.start.x:this.end.x,r[1+t]=i?this.start.y:this.end.y,r[2+t]=i?this.start.z:this.end.z;this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0,this.isBase=!0}}},update:function(e){if(this.info.hit=e.hit,this.info.name=e.name||"",this.info.distance=0,e.hit){if(this.enabled){this.tmp.fromArray(e.point).applyMatrix4(this.inv);var t=this.tmp.distanceTo(this.end);e.distance=this.maxDistance-t,this.info.distance=e.distance,this.tmp.toArray(this.local,0),this.normal.fromArray(e.normal),this.tmp.addScaledVector(this.normal,t),this.tmp.toArray(this.local,3),this.upGeo(!0)}}else this.upGeo();this.callback(e)}}),ConvexObjectBreaker.prototype={constructor:ConvexObjectBreaker,prepareBreakableObject:function(e,t,i,r,n){e.geometry.isBufferGeometry||console.error("ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var a=e.userData;a.mass=t,a.velocity=void 0!==i?i.clone():new Vector3,a.angularVelocity=void 0!==r?r.clone():new Vector3,a.breakable=n},subdivideByImpact:function(l,e,t,c,i){var h=[],u=(new Vector3).fromArray(e),d=(new Vector3).fromArray(t),p=this.tempPlane1,m=this.tempPlane2;this.tempVector3.addVectors(u,d),p.setFromCoplanarPoints(u,l.position,this.tempVector3);var f=i+c,g=this;return function e(t,i,r,n){if(Math.random()<.05*n||f<n)h.push(t);else{var a=Math.PI;0===n?(m.normal.copy(p.normal),m.constant=p.constant):n<=c?(a=(r-i)*(.2+.6*Math.random())+i,g.tempVector3_2.copy(l.position).sub(u).applyAxisAngle(d,a).add(u),m.setFromCoplanarPoints(u,g.tempVector3,g.tempVector3_2)):(a=(.5*(1&n)+.2*(2-Math.random()))*Math.PI,g.tempVector3_2.copy(u).sub(t.position).applyAxisAngle(d,a).add(t.position),g.tempVector3_3.copy(d).add(t.position),m.setFromCoplanarPoints(t.position,g.tempVector3_3,g.tempVector3_2)),g.cutByPlane(t,m,g.tempResultObjects);var o=g.tempResultObjects.object1,s=g.tempResultObjects.object2;o&&e(o,i,a,n+1),s&&e(s,a,r,n+1)}}(l,0,2*Math.PI,0),h},cutByPlane:function(e,t,i){var r=e.geometry;if(!r)return console.log(e,"no geometry ?"),0;var n=r.attributes.position.array,a=r.attributes.normal.array,o=n.length/3,s=o/3,l=r.getIndex();function c(e,t){var i=3*e+t;return l?l[i]:i}l&&(s=(l=l.array).length/3);for(var h=[],u=[],d=this.smallDelta,p=o*o,m=0;m<p;m++)this.segments[m]=!1;var f=this.tempVector3_P0,g=this.tempVector3_P1,v=this.tempVector3_N0,y=this.tempVector3_N1;for(m=0;m<s-1;m++){var x=c(m,0),_=c(m,1),b=c(m,2);v.set(a[x],a[x]+1,a[x]+2);for(var w=m+1;w<s;w++){var M=c(w,0),S=c(w,1),T=c(w,2);y.set(a[M],a[M]+1,a[M]+2),1-v.dot(y)<d&&(x===M||x===S||x===T?_===M||_===S||_===T?(this.segments[x*o+_]=!0,this.segments[_*o+x]=!0):(this.segments[b*o+x]=!0,this.segments[x*o+b]=!0):_!==M&&_!==S&&_!==T||(this.segments[b*o+_]=!0,this.segments[_*o+b]=!0))}}var A=this.tempPlane_Cut;e.updateMatrix(),ConvexObjectBreaker.transformPlaneToLocalSpace(t,e.matrix,A);for(m=0;m<s;m++)for(var E=c(m,0),C=c(m,1),L=c(m,2),R=0;R<3;R++){var P=0===R?E:1===R?C:L,D=0===R?C:1===R?L:E;if(!this.segments[P*o+D]){this.segments[P*o+D]=!0,this.segments[D*o+P]=!0,f.set(n[3*P],n[3*P+1],n[3*P+2]),g.set(n[3*D],n[3*D+1],n[3*D+2]);var k=0,B=A.distanceToPoint(f);d<B?(k=2,u.push(f.clone())):B<-d?(k=1,h.push(f.clone())):(k=3,h.push(f.clone()),u.push(f.clone()));var F=0;if(d<(B=A.distanceToPoint(g))?(F=2,u.push(g.clone())):B<-d?(F=1,h.push(g.clone())):(F=3,h.push(g.clone()),u.push(g.clone())),1===k&&2===F||2===k&&1===F){this.tempLine1.start.copy(f),this.tempLine1.end.copy(g);var I=new Vector3;if(void 0===(I=A.intersectLine(this.tempLine1,I)))return console.error("Internal error: segment does not intersect plane."),i.segmentedObject1=null,i.segmentedObject2=null,0;h.push(I),u.push(I.clone())}}}var O=.5*e.userData.mass;this.tempCM1.set(0,0,0);var V=0,U=h.length;if(0<U){for(m=0;m<U;m++)this.tempCM1.add(h[m]);this.tempCM1.divideScalar(U);for(m=0;m<U;m++){(z=h[m]).sub(this.tempCM1),V=Math.max(V,z.x,z.y,z.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var G=0,N=u.length;if(0<N){for(m=0;m<N;m++)this.tempCM2.add(u[m]);this.tempCM2.divideScalar(N);for(m=0;m<N;m++){var z;(z=u[m]).sub(this.tempCM2),G=Math.max(G,z.x,z.y,z.z)}this.tempCM2.add(e.position)}var H=null,j=null,W=0;return 4<U&&((H=new Mesh(new ConvexBufferGeometry$1(h),e.material)).position.copy(this.tempCM1),H.quaternion.copy(e.quaternion),this.prepareBreakableObject(H,O,e.userData.velocity,e.userData.angularVelocity,this.minSizeForBreak<2*V),W++),4<N&&((j=new Mesh(new ConvexBufferGeometry$1(u),e.material)).position.copy(this.tempCM2),j.quaternion.copy(e.quaternion),this.prepareBreakableObject(j,O,e.userData.velocity,e.userData.angularVelocity,this.minSizeForBreak<2*G),W++),i.object1=H,i.object2=j,W}},ConvexObjectBreaker.transformFreeVector=function(e,t){var i=e.x,r=e.y,n=e.z,a=t.elements;return e.x=a[0]*i+a[4]*r+a[8]*n,e.y=a[1]*i+a[5]*r+a[9]*n,e.z=a[2]*i+a[6]*r+a[10]*n,e},ConvexObjectBreaker.transformFreeVectorInverse=function(e,t){var i=e.x,r=e.y,n=e.z,a=t.elements;return e.x=a[0]*i+a[1]*r+a[2]*n,e.y=a[4]*i+a[5]*r+a[6]*n,e.z=a[8]*i+a[9]*r+a[10]*n,e},ConvexObjectBreaker.transformTiedVectorInverse=function(e,t){var i=e.x,r=e.y,n=e.z,a=t.elements;return e.x=a[0]*i+a[1]*r+a[2]*n-a[12],e.y=a[4]*i+a[5]*r+a[6]*n-a[13],e.z=a[8]*i+a[9]*r+a[10]*n-a[14],e},ConvexObjectBreaker.transformPlaneToLocalSpace=(kpe=new Vector3,function(e,t,i){i.normal.copy(e.normal),i.constant=e.constant;var r=ConvexObjectBreaker.transformTiedVectorInverse(e.coplanarPoint(kpe),t);ConvexObjectBreaker.transformFreeVectorInverse(i.normal,t),i.constant=-r.dot(i.normal)});var LZMA=(qpe=qpe||{},qpe.OutWindow=function(){this._windowSize=0},qpe.OutWindow.prototype.create=function(e){this._buffer&&this._windowSize===e||(this._buffer=[]),this._windowSize=e,this._pos=0,this._streamPos=0},qpe.OutWindow.prototype.flush=function(){var e=this._pos-this._streamPos;if(0!==e){for(;e--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._windowSize<=this._pos&&(this._pos=0),this._streamPos=this._pos}},qpe.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},qpe.OutWindow.prototype.setStream=function(e){this.releaseStream(),this._stream=e},qpe.OutWindow.prototype.init=function(e){e||(this._streamPos=0,this._pos=0)},qpe.OutWindow.prototype.copyBlock=function(e,t){var i=this._pos-e-1;for(i<0&&(i+=this._windowSize);t--;)this._windowSize<=i&&(i=0),this._buffer[this._pos++]=this._buffer[i++],this._windowSize<=this._pos&&this.flush()},qpe.OutWindow.prototype.putByte=function(e){this._buffer[this._pos++]=e,this._windowSize<=this._pos&&this.flush()},qpe.OutWindow.prototype.getByte=function(e){var t=this._pos-e-1;return t<0&&(t+=this._windowSize),this._buffer[t]},qpe.RangeDecoder=function(){},qpe.RangeDecoder.prototype.setStream=function(e){this._stream=e},qpe.RangeDecoder.prototype.releaseStream=function(){this._stream=null},qpe.RangeDecoder.prototype.init=function(){var e=5;for(this._code=0,this._range=-1;e--;)this._code=this._code<<8|this._stream.readByte()},qpe.RangeDecoder.prototype.decodeDirectBits=function(e){for(var t,i=0,r=e;r--;)this._range>>>=1,this._code-=this._range&(t=this._code-this._range>>>31)-1,i=i<<1|1-t,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return i},qpe.RangeDecoder.prototype.decodeBit=function(e,t){var i=e[t],r=(this._range>>>11)*i;return(2147483648^this._code)<(2147483648^r)?(this._range=r,e[t]+=2048-i>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=r,this._code-=r,e[t]-=i>>>5,0==(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},qpe.initBitModels=function(e,t){for(;t--;)e[t]=1024},qpe.BitTreeDecoder=function(e){this._models=[],this._numBitLevels=e},qpe.BitTreeDecoder.prototype.init=function(){qpe.initBitModels(this._models,1<<this._numBitLevels)},qpe.BitTreeDecoder.prototype.decode=function(e){for(var t=1,i=this._numBitLevels;i--;)t=t<<1|e.decodeBit(this._models,t);return t-(1<<this._numBitLevels)},qpe.BitTreeDecoder.prototype.reverseDecode=function(e){for(var t,i=1,r=0,n=0;n<this._numBitLevels;++n)i=i<<1|(t=e.decodeBit(this._models,i)),r|=t<<n;return r},qpe.reverseDecode2=function(e,t,i,r){for(var n,a=1,o=0,s=0;s<r;++s)a=a<<1|(n=i.decodeBit(e,t+a)),o|=n<<s;return o},qpe.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new qpe.BitTreeDecoder(8),this._numPosStates=0},qpe.LenDecoder.prototype.create=function(e){for(;this._numPosStates<e;++this._numPosStates)this._lowCoder[this._numPosStates]=new qpe.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new qpe.BitTreeDecoder(3)},qpe.LenDecoder.prototype.init=function(){var e=this._numPosStates;for(qpe.initBitModels(this._choice,2);e--;)this._lowCoder[e].init(),this._midCoder[e].init();this._highCoder.init()},qpe.LenDecoder.prototype.decode=function(e,t){return 0===e.decodeBit(this._choice,0)?this._lowCoder[t].decode(e):0===e.decodeBit(this._choice,1)?8+this._midCoder[t].decode(e):16+this._highCoder.decode(e)},qpe.Decoder2=function(){this._decoders=[]},qpe.Decoder2.prototype.init=function(){qpe.initBitModels(this._decoders,768)},qpe.Decoder2.prototype.decodeNormal=function(e){for(var t=1;(t=t<<1|e.decodeBit(this._decoders,t))<256;);return 255&t},qpe.Decoder2.prototype.decodeWithMatchByte=function(e,t){var i,r,n=1;do{if(i=t>>7&1,t<<=1,n=n<<1|(r=e.decodeBit(this._decoders,(1+i<<8)+n)),i!==r){for(;n<256;)n=n<<1|e.decodeBit(this._decoders,n);break}}while(n<256);return 255&n},qpe.LiteralDecoder=function(){},qpe.LiteralDecoder.prototype.create=function(e,t){var i;if(!this._coders||this._numPrevBits!==t||this._numPosBits!==e)for(this._numPosBits=e,this._posMask=(1<<e)-1,this._numPrevBits=t,this._coders=[],i=1<<this._numPrevBits+this._numPosBits;i--;)this._coders[i]=new qpe.Decoder2},qpe.LiteralDecoder.prototype.init=function(){for(var e=1<<this._numPrevBits+this._numPosBits;e--;)this._coders[e].init()},qpe.LiteralDecoder.prototype.getDecoder=function(e,t){return this._coders[((e&this._posMask)<<this._numPrevBits)+((255&t)>>>8-this._numPrevBits)]},qpe.Decoder=function(){this._outWindow=new qpe.OutWindow,this._rangeDecoder=new qpe.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new qpe.BitTreeDecoder(4),this._lenDecoder=new qpe.LenDecoder,this._repLenDecoder=new qpe.LenDecoder,this._literalDecoder=new qpe.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new qpe.BitTreeDecoder(6),this._posSlotDecoder[1]=new qpe.BitTreeDecoder(6),this._posSlotDecoder[2]=new qpe.BitTreeDecoder(6),this._posSlotDecoder[3]=new qpe.BitTreeDecoder(6)},qpe.Decoder.prototype.setDictionarySize=function(e){return!(e<0||(this._dictionarySize!==e&&(this._dictionarySize=e,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),0))},qpe.Decoder.prototype.setLcLpPb=function(e,t,i){var r=1<<i;return!(8<e||4<t||4<i||(this._literalDecoder.create(t,e),this._lenDecoder.create(r),this._repLenDecoder.create(r),this._posStateMask=r-1,0))},qpe.Decoder.prototype.init=function(){var e=4;for(this._outWindow.init(!1),qpe.initBitModels(this._isMatchDecoders,192),qpe.initBitModels(this._isRep0LongDecoders,192),qpe.initBitModels(this._isRepDecoders,12),qpe.initBitModels(this._isRepG0Decoders,12),qpe.initBitModels(this._isRepG1Decoders,12),qpe.initBitModels(this._isRepG2Decoders,12),qpe.initBitModels(this._posDecoders,114),this._literalDecoder.init();e--;)this._posSlotDecoder[e].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},qpe.Decoder.prototype.decode=function(e,t,i){var r,n,a,o,s,l,c=0,h=0,u=0,d=0,p=0,m=0,f=0;for(this._rangeDecoder.setStream(e),this._outWindow.setStream(t),this.init();i<0||m<i;)if(0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(c<<4)+(r=m&this._posStateMask)))n=this._literalDecoder.getDecoder(m++,f),f=7<=c?n.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(h)):n.decodeNormal(this._rangeDecoder),this._outWindow.putByte(f),c=c<4?0:c-(c<10?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,c))(a=0)===this._rangeDecoder.decodeBit(this._isRepG0Decoders,c)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(c<<4)+r)&&(c=c<7?9:11,a=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,c)?o=u:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,c)?o=d:(o=p,p=d),d=u),u=h,h=o),0===a&&(a=2+this._repLenDecoder.decode(this._rangeDecoder,r),c=c<7?8:11);else if(p=d,d=u,u=h,a=2+this._lenDecoder.decode(this._rangeDecoder,r),c=c<7?7:10,4<=(s=this._posSlotDecoder[a<=5?a-2:3].decode(this._rangeDecoder))){if(h=(2|1&s)<<(l=(s>>1)-1),s<14)h+=qpe.reverseDecode2(this._posDecoders,h-s-1,this._rangeDecoder,l);else if(h+=this._rangeDecoder.decodeDirectBits(l-4)<<4,(h+=this._posAlignDecoder.reverseDecode(this._rangeDecoder))<0){if(-1===h)break;return!1}}else h=s;if(m<=h||this._dictionarySizeCheck<=h)return!1;this._outWindow.copyBlock(h,a),m+=a,f=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},qpe.Decoder.prototype.setDecoderProperties=function(e){var t,i;return!(e.size<5)&&(t=e.readByte(),!!this.setLcLpPb(t%9,(t=~~(t/9))%5,~~(t/5))&&(i=e.readByte(),i|=e.readByte()<<8,i|=e.readByte()<<16,i+=16777216*e.readByte(),this.setDictionarySize(i)))},qpe.decompress=function(e,t,i,r){var n=new qpe.Decoder;if(!n.setDecoderProperties(e))throw"Incorrect stream properties";if(!n.decode(t,i,r))throw"Error in data stream";return!0},qpe.decompressFile=function(e,t){var i,r=new qpe.Decoder;if(!r.setDecoderProperties(e))throw"Incorrect stream properties";if(i=e.readByte(),i|=e.readByte()<<8,i|=e.readByte()<<16,i+=16777216*e.readByte(),e.readByte(),e.readByte(),e.readByte(),e.readByte(),!r.decode(e,t,i))throw"Error in data stream";return!0},qpe),qpe;function LZMAdecompact(e){e=new Uint8Array(e);var t={data:[],position:0,writeByte:function(e){this.data[this.position++]=e}};return LZMA.decompressFile({data:e,position:0,readByte:function(){return this.data[this.position++]}},t),new Uint8Array(t.data).buffer}var physic=(ire="LZMA",lre=null,mre=window.URL||window.webkitURL,nre="undefined"==typeof performance?Date:performance,ore={now:0,delta:0,then:0,deltaTime:0,inter:0,tmp:0,n:0,timerate:0,steptime:0},pre=null,qre=!1,rre=!1,sre=!1,tre="",ure="",vre=.5*Math.PI,Ere=null,Fre=null,Gre="free",Hre=[],Ire=[],Jre="",Kre=!1,Lre={worldscale:1,gravity:[0,-9.8,0],fps:60,substep:2,broadphase:2,soft:!0,animFrame:!0,fixed:!0,jointDebug:!1},{folder:"./js/libs/",message:function(e){var t=e.data;switch(t.Ar&&(root$1.Ar=t.Ar),t.flow&&(root$1.flow=t.flow),t.m){case"initEngine":physic.initEngine();break;case"start":physic.start();break;case"step":physic.step(t.fps,t.delta);break;case"moveSolid":physic.moveSolid(t.o);break;case"ellipsoid":physic.ellipsoidMesh(t.o);break;case"makeBreak":physic.makeBreak(t.o)}},init:function(e,t,i,r){switch(this.initArray(r),this.defaultRoot(),kre=e,ore.timerate=1/(Lre={fps:(i=i||{}).fps||60,worldscale:i.worldscale||1,gravity:i.gravity||[0,-9.8,0],substep:i.substep||2,broadphase:i.broadphase||2,soft:void 0===i.soft||i.soft,fixed:void 0===i.fixed||i.fixed,animFrame:void 0===i.animFrame||i.animFrame,jointDebug:void 0!==i.jointDebug&&i.jointDebug,isInternUpdate:Kre=i.use_intern_update||!1}).fps*1e3,ire=t||"LZMA"){case"min":physic.load(physic.folder+"ammo.hex",!0);break;case"LZMA":case"lzma":case"compact":physic.load(physic.folder+"ammo.hex");break;case"WASM":case"wasm":lre=document.location.href.replace(/\/[^/]*$/,"/")+physic.folder+"ammo.wasm.js",physic.startWorker();break;case"BASIC":case"basic":lre=document.location.href.replace(/\/[^/]*$/,"/")+physic.folder+"ammo.js",physic.startWorker()}},set:function(e){ore.timerate=void 0!==(e=e||Lre).fps?1/e.fps*1e3:ore.timerate,Lre.fixed=e.fixed||!1,Lre.animFrame=e.animFrame||!1,Lre.jointDebug=e.jointDebug||!1,e.isInternUpdate=Kre,root$1.constraintDebug=Lre.jointDebug,this.post("set",e)},load:function(e,t){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||0===i.status?(lre=mre.createObjectURL(new Blob([LZMAdecompact(i.response)],{type:"application/javascript"})),physic.startWorker(t)):console.error("Couldn't load ["+e+"] ["+i.status+"]"))},i.send(null)},startWorker:function(){(jre=new Worker(physic.folder+"ammowker.js")).postMessage=jre.webkitPostMessage||jre.postMessage,jre.onmessage=physic.message;var e=new ArrayBuffer(1);jre.postMessage({m:"test",ab:e},[e]),qre=!e.byteLength,Kre&&(qre=!1),physic.post("init",{blob:lre,ArPos:root$1.ArPos,ArMax:root$1.ArMax,isBuffer:qre,option:Lre}),root$1.post=physic.post},initArray:function(e){var t={maxBody:(e=e||{}).maxBody||1400,maxContact:e.maxContact||200,maxCharacter:e.maxCharacter||10,maxCar:e.maxCar||14,maxSoftPoint:e.maxSoftPoint||8192,maxJoint:e.maxJoint||1e3};root$1.ArLng=[8*t.maxBody,t.maxContact,8*t.maxCharacter,64*t.maxCar,3*t.maxSoftPoint,14*t.maxJoint],root$1.ArPos=[0,root$1.ArLng[0],root$1.ArLng[0]+root$1.ArLng[1],root$1.ArLng[0]+root$1.ArLng[1]+root$1.ArLng[2],root$1.ArLng[0]+root$1.ArLng[1]+root$1.ArLng[2]+root$1.ArLng[3],root$1.ArLng[0]+root$1.ArLng[1]+root$1.ArLng[2]+root$1.ArLng[3]+root$1.ArLng[4]],root$1.ArMax=root$1.ArLng[0]+root$1.ArLng[1]+root$1.ArLng[2]+root$1.ArLng[3]+root$1.ArLng[4]+root$1.ArLng[5]},initEngine:function(){mre.revokeObjectURL(lre),lre=null,this.initObject(),console.log("WPhysic "+REVISION$1+" | "+(qre?"buffer":"no buffer")+" | "+ire),kre&&kre()},start:function(e){if(!rre){if(physic.stop(),sre=!0,qre&&(root$1.Ar=new Float32Array(root$1.ArMax)),ore.then=nre.now(),e||Kre||(pre=Lre.animFrame?requestAnimationFrame(physic.sendData):setInterval(function(){physic.sendData()},ore.timerate)),!e&&Kre){var t=physic.getKey();jre.postMessage({m:"internStep",o:{steptime:ore.steptime,key:t},flow:root$1.flow,Ar:root$1.Ar})}physic.setMode(ure)}},prevUpdate:function(){},postUpdate:function(){},pastUpdate:function(){},update:function(){physic.postUpdate(ore.delta),wre.step(root$1.Ar,root$1.ArPos[0]),Bre.step(root$1.Ar,root$1.ArPos[1]),Are.step(root$1.Ar,root$1.ArPos[2]),zre.step(root$1.Ar,root$1.ArPos[3]),xre.step(root$1.Ar,root$1.ArPos[4]),Dre.step(root$1.Ar,root$1.ArPos[5]),yre.step(),Cre.step(),physic.pastUpdate(ore.delta)},step:function(e,t){Kre?(ore.fps=e,ore.delta=t):(ore.tmp<ore.now-1e3&&(ore.tmp=ore.now,ore.fps=ore.n,ore.n=0),ore.n++),physic.tell(),physic.update(),physic.stepRemove(),physic.stepAdd(),sre=!0,Kre&&physic.sendStep()},sendData:function(e){if(!Kre)if(root$1.refView&&root$1.refView.pause)physic.stop();else if(Lre.animFrame)pre=requestAnimationFrame(physic.sendData),ore.now=void 0===e?nre.now():e,ore.deltaTime=ore.now-ore.then,ore.delta=.001*ore.deltaTime,ore.timerate<ore.deltaTime&&(ore.then=ore.now-ore.deltaTime%ore.timerate,physic.sendStep());else{if(!sre)return;ore.delta=.001*(ore.now-ore.then),ore.then=ore.now,physic.sendStep()}},sendStep:function(){if(sre){ore.now=nre.now(),physic.prevUpdate(ore.delta);var e=physic.getKey();Kre?qre&&jre.postMessage({m:"internStep",o:{steptime:ore.steptime,key:e},flow:root$1.flow,Ar:root$1.Ar},[root$1.Ar.buffer]):qre?jre.postMessage({m:"step",o:{delta:ore.delta,key:e},flow:root$1.flow,Ar:root$1.Ar},[root$1.Ar.buffer]):jre.postMessage({m:"step",o:{delta:ore.delta,key:e},flow:root$1.flow,Ar:root$1.Ar}),sre=!1}},simpleStep:function(e){var t=physic.getKey();jre.postMessage({m:"step",o:{delta:e,key:t}})},stepRemove:function(){if(0!==Hre.length)for(this.post("setRemove",Hre);0<Hre.length;)this.remove(Hre.pop(),!0)},stepAdd:function(){if(0!==Ire.length)for(;0<Ire.length;)this.add(Ire.shift())},setView:function(e){root$1.refView=e,root$1.mat=Object.assign({},root$1.mat,e.getMat()),root$1.geo=Object.assign({},root$1.geo,e.getGeo()),root$1.container=e.getContent(),root$1.controler=e.getControler(),root$1.isRefView=!0},getFps:function(){return ore.fps},getDelta:function(){return ore.delta},getIsFixed:function(){return Lre.fixed},getKey:function(){return[0,0,0,0,0,0,0,0]},tell:function(){},log:function(){},post:function(e,t){jre.postMessage({m:e,o:t})},reset:function(e){for(physic.postUpdate=function(){},physic.pastUpdate=function(){},rre=!(physic.prevUpdate=function(){}),ure=tre,physic.setMode(""),physic.stop(),physic.clear();0<root$1.tmpMat.length;)root$1.tmpMat.pop().dispose();Hre=[],Ire=[],Jre="",root$1.refView&&root$1.refView.reset(e),physic.post("reset",{full:e})},pause:function(){rre=!0},play:function(){rre&&(rre=!1,physic.start())},stop:function(){null!==pre&&(Lre.animFrame?window.cancelAnimationFrame(pre):clearInterval(pre),pre=null)},destroy:function(){jre.terminate(),jre=void 0},addMat:function(e){root$1.tmpMat.push(e)},ellipsoidMesh:function(e){xre.createEllipsoid(e)},updateTmpMat:function(e,t){for(var i,r=root$1.tmpMat.length;r--;)void 0!==(i=root$1.tmpMat[r]).envMap&&(i.envMap="MeshStandardMaterial"!==i.type&&t?null:e,i.needsUpdate=!0)},setVehicle:function(e){root$1.flow.vehicle.push(e)},drive:function(e){this.post("setDrive",e)},move:function(e){this.post("setMove",e)},forces:function(e,t){physic.post((t=t||!1)?"directForces":"setForces",e)},options:function(e,t){physic.post((t=t||!1)?"directOptions":"setOptions",e)},matrix:function(e,t){physic.post((t=t||!1)?"directMatrix":"setMatrix",e)},clearFlow:function(){root$1.flow={ray:[],terrain:[],vehicle:[]}},anchor:function(e){this.post("addAnchor",e)},break:function(e){this.post("addBreakable",e)},moveSolid:function(e){if(map.has(e.name)){var t=map.get(e.name);void 0!==e.pos&&t.position.fromArray(e.pos),void 0!==e.quat&&t.quaternion.fromArray(e.quat)}},getBodys:function(){return wre.bodys},initObject:function(){wre=new RigidBody,xre=new SoftBody,yre=new Terrain$1,zre=new Vehicle,Are=new Character,Bre=new Collision,Cre=new RayCaster,Dre=new Constraint},clear:function(){for(physic.clearFlow(),wre.clear(),Bre.clear(),yre.clear(),zre.clear(),Are.clear(),xre.clear(),Cre.clear(),Dre.clear();0<root$1.extraGeo.length;)root$1.extraGeo.pop().dispose()},remove:function(e,t){t||this.post("remove",e);var i=physic.byName(e);if(null!==i)switch(i.type){case"solid":case"body":wre.remove(e);break;case"soft":xre.remove(e);break;case"terrain":yre.remove(e);break;case"collision":Bre.remove(e);break;case"ray":Cre.remove(e);break;case"constraint":Dre.remove(e)}},info:function(){return{solids:wre.solids.length,bodys:wre.bodys.length,softs:xre.softs.length,terrains:yre.terrains.length,cars:zre.cars.length,rays:Cre.rays.length,pairs:Bre.pairs.length,joints:Dre.joints.length}},removes:function(e){Hre=Hre.concat(e)},removesDirect:function(e){this.post("directRemoves",e)},byName:function(e){return map.has(e)?map.get(e):(physic.tell("no find object !!"),null)},has:function(e){return map.has(e)},addGroup:function(e){Ire=Ire.concat(e)},add:function(e){var t=void 0===(e=e||{}).type?"box":e.type,i=t.substring(0,4);return"join"===i?Dre.add(e):"soft"===i?xre.add(e):"terrain"===t?yre.add(e):"character"===t?Are.add(e):"collision"===t?Bre.add(e):"car"===t?zre.add(e):"ray"===t?Cre.add(e):wre.add(e)},defaultRoot:function(){var e={circle:new THREE.CircleBufferGeometry(1,6),plane:new THREE.PlaneBufferGeometry(1,1,1,1),box:new THREE.BoxBufferGeometry(1,1,1),hardbox:new THREE.BoxBufferGeometry(1,1,1),cone:new THREE.CylinderBufferGeometry(0,1,.5),wheel:new THREE.CylinderBufferGeometry(1,1,1,18),sphere:new THREE.SphereBufferGeometry(1,16,12),highsphere:new THREE.SphereBufferGeometry(1,32,24),cylinder:new THREE.CylinderBufferGeometry(1,1,1,12,1),hardcylinder:new THREE.CylinderBufferGeometry(1,1,1,12,1),joint:new THREE.ConeBufferGeometry(.1,.2,4)};e.circle.rotateX(-vre),e.plane.rotateX(-vre),e.wheel.rotateZ(-vre),e.joint.translate(0,.1,0),e.joint.rotateZ(.5*-Math.PI),root$1.geo=e,root$1.mat={hide:new THREE.MeshBasicMaterial({name:"debug",color:0,depthTest:!1,depthWrite:!1,visible:!1}),move:new THREE.MeshLambertMaterial({color:13421772,name:"move",wireframe:!1,shadowSide:!1}),speed:new THREE.MeshLambertMaterial({color:16763955,name:"speed",wireframe:!1,shadowSide:!1}),sleep:new THREE.MeshLambertMaterial({color:3394815,name:"sleep",wireframe:!1,shadowSide:!1}),static:new THREE.MeshLambertMaterial({color:3355443,name:"static",wireframe:!1,shadowSide:!1,transparent:!0,opacity:.3,depthTest:!0,depthWrite:!1}),kinematic:new THREE.MeshLambertMaterial({color:8978227,name:"kinematic",wireframe:!1,shadowSide:!1}),soft:new THREE.MeshLambertMaterial({name:"soft",vertexColors:THREE.VertexColors,shadowSide:!1}),debug:new THREE.MeshBasicMaterial({name:"debug",color:65280,depthTest:!1,depthWrite:!1,wireframe:!0,shadowSide:!1}),jointLine:new THREE.LineBasicMaterial({name:"jointLine",vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0}),jointP1:new THREE.MeshBasicMaterial({name:"jointP1",color:65280,depthTest:!1,depthWrite:!0,wireframe:!0}),jointP2:new THREE.MeshBasicMaterial({name:"jointP2",color:16776960,depthTest:!1,depthWrite:!0,wireframe:!0})},root$1.container=new THREE.Group,root$1.destroy=function(e){for(var t;0<e.children.length;){for(t=e.children.pop();0<t.children.length;)t.remove(t.children.pop());e.remove(t)}e.parent&&e.parent.remove(e)}},getContainer:function(){return root$1.container},makeBreak:function(e){var t=e.name;if(map.has(t)){null===Ere&&(Ere=new ConvexObjectBreaker);var i=map.get(t),r=e.breakOption,n=Ere.subdivideByImpact(i,e.pos,e.normal,r[1],r[2]);--r[3],Hre.push(t);for(var a=n.length;a--;)Ire.push(this.addDebris(t,a,n[a],r))}},addDebris:function(e,t,i,r){var n={name:e+"_debris"+t,material:i.material,type:"convex",shape:i.geometry,pos:i.position.toArray(),quat:i.quaternion.toArray(),mass:i.userData.mass,linearVelocity:i.userData.velocity.toArray(),angularVelocity:i.userData.angularVelocity.toArray(),margin:.05};return 0<r[3]&&(n.breakable=!0,n.breakOption=r),n},setMode:function(e){console.log("mode==="+e),e!==tre&&("picker"===tre&&physic.removeRayCamera(),"shoot"===tre&&physic.removeShootCamera(),"lock"===tre&&physic.removeLockCamera()),"picker"===(tre=e)&&physic.addRayCamera(),"shoot"===tre&&physic.addShootCamera(),"lock"===tre&&physic.addLockCamera()},addLockCamera:function(){},removeLockCamera:function(){},addShootCamera:function(){},removeShootCamera:function(){},addRayCamera:function(){root$1.refView&&(Fre=physic.add({name:"cameraRay",type:"ray",callback:physic.onRay,mask:1,visible:!1}),root$1.refView.activeRay(physic.updateRayCamera,!1))},removeRayCamera:function(){root$1.refView&&(physic.remove("cameraRay"),root$1.refView.removeRay(),physic.log())},updateRayCamera:function(e){"drag"===Gre&&physic.matrix([{name:"dragger",pos:e.toArray(),keepRot:!0}])},onRay:function(e){var t=root$1.refView.getMouse(),i=root$1.refView.getControls(),r=void 0===e.name?"":e.name;Fre.setFromCamera(t,i.object),0===t.z?("drag"===Gre&&(i.enableRotate=!0,physic.removeConnector()),Gre="free"):"free"===Gre&&(r?"drag"!==Gre&&(root$1.refView.setDragPlane(e.point),i.enableRotate=!1,physic.addConnector(e),Gre="drag"):Gre="rotate"),physic.log(Gre+"   "+r)},addConnector:function(e){var t=physic.byName(e.name);if(null!==t){physic.testCurrentFollow(e.name);var i=(new THREE.Vector3).fromArray(e.point),r=t.quaternion.toArray(),n=physic.getLocalPoint(i,t).toArray();physic.add({name:"dragger",type:"sphere",size:[.2],pos:e.point,quat:r,mass:0,kinematic:!0,group:32,mask:32}),physic.add({name:"connector",type:"joint_fixe",b1:"dragger",b2:e.name,pos1:[0,0,0],pos2:n,collision:!1})}},removeConnector:function(){physic.remove("dragger"),physic.remove("connector"),""!==Jre&&physic.setCurrentFollow(Jre)},getLocalPoint:function(e,t){t.updateMatrix();var i=new THREE.Matrix4,r=new THREE.Vector3(1,1,1),n=(new THREE.Matrix4).compose(t.position,t.quaternion,r);return i.getInverse(n),e.applyMatrix4(i)},setCurrentFollow:function(e,t){if(root$1.refView){var i=physic.byName(e);null!==i?root$1.refView.getControls().initFollow(i,t):root$1.refView.getControls().resetFollow(),Jre=""}},testCurrentFollow:function(e){Jre="",root$1.refView&&root$1.refView.getControls().followTarget&&root$1.refView.getControls().followTarget.name===e&&(root$1.refView.getControls().resetFollow(),Jre=e)}}),jre,kre,wre,xre,yre,zre,Are,Bre,Cre,Dre,ire,lre,mre,nre,ore,pre,qre,rre,sre,tre,ure,vre,Ere,Fre,Gre,Hre,Ire,Jre,Kre,Lre,BVHLoader=function(e){Loader.call(this,e),this.animateBonePositions=!0,this.animateBoneRotations=!0};BVHLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BVHLoader,load:function(e,t,i,r){var n=this,a=new FileLoader(n.manager);a.setPath(n.path),a.load(e,function(e){t(n.parse(e))},i,r)},parse:function(e){function c(e,t,i){if("ENDSITE"!==i.type){var r={time:t,position:new Vector3,rotation:new Quaternion};i.frames.push(r);for(var n=new Quaternion,a=new Vector3(1,0,0),o=new Vector3(0,1,0),s=new Vector3(0,0,1),l=0;l<i.channels.length;l++)switch(i.channels[l]){case"Xposition":r.position.x=parseFloat(e.shift().trim());break;case"Yposition":r.position.y=parseFloat(e.shift().trim());break;case"Zposition":r.position.z=parseFloat(e.shift().trim());break;case"Xrotation":n.setFromAxisAngle(a,parseFloat(e.shift().trim())*Math.PI/180),r.rotation.multiply(n);break;case"Yrotation":n.setFromAxisAngle(o,parseFloat(e.shift().trim())*Math.PI/180),r.rotation.multiply(n);break;case"Zrotation":n.setFromAxisAngle(s,parseFloat(e.shift().trim())*Math.PI/180),r.rotation.multiply(n);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(l=0;l<i.children.length;l++)c(e,t,i.children[l])}}function h(e){for(var t;0===(t=e.shift().trim()).length;);return t}var u=this,t=function(e){"HIERARCHY"!==h(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");var t=[],i=function e(t,i,r){var n={name:"",type:"",frames:[]};r.push(n);var a=i.split(/[\s]+/);"END"===a[0].toUpperCase()&&"SITE"===a[1].toUpperCase()?(n.type="ENDSITE",n.name="ENDSITE"):(n.name=a[1],n.type=a[0].toUpperCase());"{"!==h(t)&&console.error("THREE.BVHLoader: Expected opening { after type & name");a=h(t).split(/[\s]+/);"OFFSET"!==a[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+a[0]);4!==a.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");var o=new Vector3(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));(isNaN(o.x)||isNaN(o.y)||isNaN(o.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET.");n.offset=o;if("ENDSITE"!==n.type){"CHANNELS"!==(a=h(t).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");var s=parseInt(a[1]);n.channels=a.splice(2,s),n.children=[]}for(;;){var l=h(t);if("}"===l)return n;n.children.push(e(t,l,r))}}(e,h(e),t);"MOTION"!==h(e)&&console.error("THREE.BVHLoader: MOTION expected.");var r=h(e).split(/[\s]+/),n=parseInt(r[1]);isNaN(n)&&console.error("THREE.BVHLoader: Failed to read number of frames."),r=h(e).split(/[\s]+/);var a=parseFloat(r[2]);isNaN(a)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(var o=0;o<n;o++)c(r=h(e).split(/[\s]+/),o*a,i);return t}(e.split(/[\r\n]+/g)),i=[];!function e(t,i){var r=new Bone;if(i.push(r),r.position.add(t.offset),r.name=t.name,"ENDSITE"!==t.type)for(var n=0;n<t.children.length;n++)r.add(e(t.children[n],i));return r}(t[0],i);var r=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];if("ENDSITE"!==r.type){for(var n=[],a=[],o=[],s=0;s<r.frames.length;s++){var l=r.frames[s];n.push(l.time),a.push(l.position.x+r.offset.x),a.push(l.position.y+r.offset.y),a.push(l.position.z+r.offset.z),o.push(l.rotation.x),o.push(l.rotation.y),o.push(l.rotation.z),o.push(l.rotation.w)}u.animateBonePositions&&t.push(new VectorKeyframeTrack(".bones["+r.name+"].position",n,a)),u.animateBoneRotations&&t.push(new QuaternionKeyframeTrack(".bones["+r.name+"].quaternion",n,o))}}return new AnimationClip("animation",-1,t)}(t);return{skeleton:new Skeleton(i),clip:r}}});var lzma=(Yve=0x10000000000000000,Zve=4294967295,$ve=2147483647,_ve=2147483648,awe=16777216,cxe="function"==typeof setImmediate?setImmediate:setTimeout,dxe=4294967296,exe=[Zve,-dxe],fxe=[0,0],gxe=[1,0],{decompress:function(e,n,a){var o,i,s,l,c={},t=void 0===n&&void 0===a;if("function"!=typeof n&&(i=n,n=a=0),a=a||function(e){return void 0!==i?void Xve():void 0},n=n||function(e,t){return void 0!==i?Xve():void 0},t){for(c.d=qwe({},e);Awe(c.d.Q););return _we(mwe(c.d.S))}try{c.d=qwe({},e),l=axe(c.d.N),s=-1<l,a(0)}catch(e){return n(null,e)}cxe(function e(){try{for(var t,i=0,r=(new Date).getTime();Awe(c.d.Q);)if(++i%1e3==0&&200<(new Date).getTime()-r)return s&&(o=axe(c.d.Q.h.d)/l,a(o)),cxe(e,0),0;a(1),t=_we(mwe(c.d.S)),cxe(n.bind(null,t),0)}catch(e){n(null,e)}},0)}}),Xve,Yve,Zve,$ve,_ve,awe,cxe,dxe,exe,fxe,gxe;function cwe(e){var t=[];return t[e-1]=void 0,t}function dwe(e,t){return fwe(e[0]+t[0],e[1]+t[1])}function ewe(e,t){var i,r,n,a;return e[0]==t[0]&&e[1]==t[1]?0:(r=t[1]<0,(i=e[1]<0)&&!r?-1:!i&&r?1:fwe((n=e)[0]-(a=t)[0],n[1]-a[1])[1]<0?-1:1)}function fwe(e,t){var i,r;for(e%=Yve,t=(t%=Yve)-(i=t%dxe)+(r=Math.floor(e/dxe)*dxe),e=e-r+i;e<0;)e+=dxe,t-=dxe;for(;Zve<e;)e-=dxe,t+=dxe;for(t%=Yve;0x7fffffff00000000<t;)t-=Yve;for(;t<-Yve;)t+=Yve;return[e,t]}function gwe(e){return 0<=e?[e,0]:[e+dxe,-dxe]}function hwe(e){return _ve<=e[0]?~~Math.max(Math.min(e[0]-dxe,$ve),-_ve):~~Math.max(Math.min(e[0],$ve),-_ve)}function kwe(e){return e.O<=e.cb?-1:255&e.ab[e.cb++]}function mwe(e){var t=e.ab;return t.length=e.O,t}function nwe(e,t,i,r){(function(e,t,i,r,n){for(var a=0;a<n;++a)i[r+a]=e[t+a]})(t,i,e.ab,e.O,r),e.O+=r}function pwe(e,t,i){var r,n,a,o,s,l,c,h="",u=[];for(n=0;n<5;++n){if(-1==(a=kwe(t)))throw Error("truncated input");u[n]=a<<24>>24}if(!function(e,t){var i,r,n,a,o,s,l;if(t.length<5)return;for(n=(l=255&t[0])%9,a=(s=~~(l/9))%5,o=~~(s/5),r=i=0;r<4;++r)i+=(255&t[1+r])<<8*r;return!(99999999<i)&&function(e,t,i,r){if(8<t||4<i||4<r)return;!function(e,t,i){var r,n;if(null==e.F||e.g!=i||e.y!=t)for(e.y=t,e.Y=(1<<t)-1,e.g=i,e.F=cwe(n=1<<e.g+e.y),r=0;r<n;++r)e.F[r]=((a={}).v=cwe(768),a);var a}(e.k,i,t);var n=1<<r;return Jwe(e.C,n),Jwe(e.o,n),e.P=n-1,1}(e,n,a,o)&&function(e,t){return t<0?0:(e.z!=t&&(e.z=t,e.m=Math.max(e.z,1),function(e,t){null!=e.x&&e.c==t||(e.x=cwe(t)),e.c=t,e.D=0,e.w=0}(e.b,Math.max(e.m,4096))),1)}(e,i)}(r=function(e){e.b={},e.a={},e.q=cwe(192),e.E=cwe(12),e.s=cwe(12),e.u=cwe(12),e.r=cwe(12),e.n=cwe(192),e.j=cwe(4),e.J=cwe(114),e.t=Twe({},4),e.C=Lwe({}),e.o=Lwe({}),e.k={};for(var t=0;t<4;++t)e.j[t]=Twe({},6);return e}({}),u))throw Error("corrupted input");for(n=0;n<64;n+=8){if(-1==(a=kwe(t)))throw Error("truncated input");1==(a=a.toString(16)).length&&(a="0"+a),h=a+""+h}/^0+$|^f+$/i.test(h)?e.N=exe:(o=parseInt(h,16),e.N=Zve<o?exe:gwe(o)),e.Q=(l=i,c=e.N,(s=r).a.K=t,wwe(s.b),s.b.V=l,function(e){e.b.w=0,e.b.D=0,$we(e.q),$we(e.n),$we(e.E),$we(e.s),$we(e.u),$we(e.r),$we(e.J),function(e){var t,i;for(i=1<<e.g+e.y,t=0;t<i;++t)$we(e.F[t].v)}(e.k);for(var t=0;t<4;++t)$we(e.j[t].B);Mwe(e.C),Mwe(e.o),$we(e.t.B),function(e){e.p=0,e.i=-1;for(var t=0;t<5;++t)e.p=e.p<<8|kwe(e.K)}(e.a)}(s),s.f=0,s.l=0,s.T=0,s.R=0,s._=0,s.U=c,s.d=fxe,s.I=0,function(e,t){return e.h=t,e.bb=null,e.X=1,e}({},s))}function qwe(e,t){return e.S=((n={}).ab=cwe(32),n.O=0,n),pwe(e,((i={}).ab=r=t,i.cb=0,i.O=r.length,i),e.S),e;var i,r,n}function twe(e){var t=e.D-e.w;t&&(nwe(e.V,e.x,e.w,t),e.c<=e.D&&(e.D=0),e.w=e.D)}function uwe(e,t){var i=e.D-t-1;return i<0&&(i+=e.c),e.x[i]}function wwe(e){twe(e),e.V=null}function Awe(e){if(!e.X)throw Error("bad state");if(e.bb)throw Error("No encoding");return function(e){var t=function(e){var t,i,r,n,a,o;if(o=hwe(e.d)&e.P,Xwe(e.a,e.q,(e.f<<4)+o)){if(Xwe(e.a,e.E,e.f))r=0,Xwe(e.a,e.s,e.f)?(Xwe(e.a,e.u,e.f)?(Xwe(e.a,e.r,e.f)?(i=e._,e._=e.R):i=e.R,e.R=e.T):i=e.T,e.T=e.l,e.l=i):Xwe(e.a,e.n,(e.f<<4)+o)||(e.f=e.f<7?9:11,r=1),r||(r=Kwe(e.o,e.a,o)+2,e.f=e.f<7?8:11);else if(e._=e.R,e.R=e.T,e.T=e.l,r=2+Kwe(e.C,e.a,o),e.f=e.f<7?7:10,4<=(a=Uwe(e.j[function(e){return(e-=2)<4?e:3}(r)],e.a))){if(e.l=(2|1&a)<<(n=(a>>1)-1),a<14)e.l+=function(e,t,i,r){var n,a,o=1,s=0;for(a=0;a<r;++a)n=Xwe(i,e,t+o),o<<=1,o+=n,s|=n<<a;return s}(e.J,e.l-a-1,e.a,n);else if(e.l+=function(e,t){var i,r,n=0;for(i=t;0!=i;--i)e.i>>>=1,e.p-=e.i&(r=e.p-e.i>>>31)-1,n=n<<1|1-r,-awe&e.i||(e.p=e.p<<8|kwe(e.K),e.i<<=8);return n}(e.a,n-4)<<4,e.l+=function(e,t){var i,r,n=1,a=0;for(r=0;r<e.A;++r)i=Xwe(t,e.B,n),n<<=1,n+=i,a|=i<<r;return a}(e.t,e.a),e.l<0)return-1==e.l?1:-1}else e.l=a;if(0<=ewe(gwe(e.l),e.d)||e.m<=e.l)return-1;(function(e,t,i){var r=e.D-t-1;for(r<0&&(r+=e.c);0!=i;--i)e.c<=r&&(r=0),e.x[e.D++]=e.x[r++],e.c<=e.D&&twe(e)})(e.b,e.l,r),e.d=dwe(e.d,gwe(r)),e.I=uwe(e.b,0)}else t=function(e,t,i){return e.F[((t&e.Y)<<e.g)+((255&i)>>>8-e.g)]}(e.k,hwe(e.d),e.I),e.I=e.f<7?function(e,t){var i=1;for(;i=i<<1|Xwe(t,e.v,i),i<256;);return i<<24>>24}(t,e.a):function(e,t,i){var r,n,a=1;do{if(n=i>>7&1,i<<=1,r=Xwe(t,e.v,(1+n<<8)+a),a=a<<1|r,n!=r){for(;a<256;)a=a<<1|Xwe(t,e.v,a);break}}while(a<256);return a<<24>>24}(t,e.a,uwe(e.b,e.l)),function(e,t){e.x[e.D++]=t,e.c<=e.D&&twe(e)}(e.b,e.I),e.f=function(e){return e<4?0:e<10?e-3:e-6}(e.f),e.d=dwe(e.d,gxe);return 0}(e.h);if(-1==t)throw Error("corrupted input");e.$=exe,e.Z=e.h.d,(t||0<=ewe(e.h.U,fxe)&&0<=ewe(e.h.d,e.h.U))&&(twe(e.h.b),wwe(e.h.b),e.h.a.K=null,e.X=0)}(e),e.X}function Jwe(e,t){for(;e.e<t;++e.e)e.G[e.e]=Twe({},3),e.H[e.e]=Twe({},3)}function Kwe(e,t,i){return Xwe(t,e.M,0)?8+(Xwe(t,e.M,1)?8+Uwe(e.L,t):Uwe(e.H[i],t)):Uwe(e.G[i],t)}function Lwe(e){return e.M=cwe(2),e.G=cwe(16),e.H=cwe(16),e.L=Twe({},8),e.e=0,e}function Mwe(e){$we(e.M);for(var t=0;t<e.e;++t)$we(e.G[t].B),$we(e.H[t].B);$we(e.L.B)}function Twe(e,t){return e.A=t,e.B=cwe(1<<t),e}function Uwe(e,t){var i,r=1;for(i=e.A;0!=i;--i)r=(r<<1)+Xwe(t,e.B,r);return r-(1<<e.A)}function Xwe(e,t,i){var r,n=t[i];return(-_ve^e.p)<(-_ve^(r=(e.i>>>11)*n))?(e.i=r,t[i]=n+(2048-n>>>5)<<16>>16,-awe&e.i||(e.p=e.p<<8|kwe(e.K),e.i<<=8),0):(e.i-=r,e.p-=r,t[i]=n-(n>>>5)<<16>>16,-awe&e.i||(e.p=e.p<<8|kwe(e.K),e.i<<=8),1)}function $we(e){for(var t=e.length-1;0<=t;--t)e[t]=1024}function _we(e){for(var t,i,r,n=0,a=0,o=e.length,s=[],l=[];n<o;++n,++a){if(128&(t=255&e[n]))if(192==(224&t)){if(o<=n+1)return e;if(128!=(192&(i=255&e[++n])))return e;l[a]=(31&t)<<6|63&i}else{if(224!=(240&t))return e;if(o<=n+2)return e;if(128!=(192&(i=255&e[++n])))return e;if(128!=(192&(r=255&e[++n])))return e;l[a]=(15&t)<<12|(63&i)<<6|63&r}else{if(!t)return e;l[a]=t}16383==a&&(s.push(String.fromCharCode.apply(String,l)),a=-1)}return 0<a&&(l.length=a,s.push(String.fromCharCode.apply(String,l))),s.join("")}function axe(e){return e[1]+e[0]}var WAvatarPhySkeleton=function(e){this.bones=e.bones,this.data=new Float32Array(8*this.bones.length),this.isRunning=!1,this.boneDecal=[],this.phyBones=[],this.root=e,this.matrix=e.model.matrixWorld,this.matrixAutoUpdate=!1};WAvatarPhySkeleton.prototype={constructor:WAvatarPhySkeleton,distance:function(e,t){var i=t.clone().sub(e);return Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)},init:function(){for(var e,t,i,r,n,a,o,s=new Vector3,l=new Vector3,c=this.bones.length;c--;)(i=this.bones[c]).ammobodyName=o=this.root.ename+"_"+(r=i.name),i.getWorldPosition(s),0<i.children.length&&i.children[0].getWorldPosition(l),n=.1,a=.04,this.boneDecal[c]=.5*.32,e=null,"Head"===r?(e="sphere",t=[.08],this.boneDecal[c]=.025):"Neck"===r||"Neck1"===r||"neck"===r?(e="cylinder",t=[a,n,a],this.boneDecal[c]=-.005):"Spine"===r||"chest"===r?(e="sphere",t=[.16]):"LowerBack"===r||"abdomen"===r?(e="sphere",t=[.14]):"Hips"===r||"hip"===r?(e="sphere",t=[.12],this.boneDecal[c]=0):"LeftUpLeg"===r||"RightUpLeg"===r||"lThigh"===r||"rThigh"===r?(a=.06,i.children[0]&&(n=this.distance(s,l)+.02),e="cylinder",t=[a,n,a]):"LeftLeg"===r||"RightLeg"===r||"lShin"===r||"rShin"===r?(e="cylinder",t=[a=.046,n=this.distance(i.parent.position,i.position)+.02,a]):"LeftFoot"===r||"RightFoot"===r||"lFoot"===r||"rFoot"===r?(e="box",t=[2*(a=.032),n=.12,a],this.boneDecal[c]=0):"LeftToeBase"===r||"RightToeBase"===r||"lFoot"===r||"rFoot"===r?(n=.06,e="box",t=[2*(a=.032),n,a],this.boneDecal[c]=0):"LeftShoulder"==r||"RightShoulder"==r||"lCollar"===r||"rCollar"===r?(e="sphere",t=[.046]):"LeftArm"==r||"RightArm"==r||"lShldr"===r||"rShldr"===r?(a=.046,i.children[0]&&(n=this.distance(s,l)+.04),e="cylinder",t=[a,n,a]):"LeftForeArm"==r||"RightForeArm"==r||"lForeArm"===r||"rForeArm"===r?(e="cylinder",t=[a=.02,n=this.distance(i.parent.position,i.position)+.03,a]):"LeftHand"!=r&&"RightHand"!=r&&"lHand"!==r&&"rHand"!==r||(i.children[0]&&(n=this.distance(s,l)),e="box",t=[a,n,a]),null!=e&&this.phyBones.push(window.WEngine.add({type:e,size:t,pos:s.toArray(),name:o,mass:3,flag:2,state:4,friction:.5,restitution:.9,kinematic:!0,mask:2}));this.isRunning=!0},showPhyBones:function(e){for(var t=this.phyBones.length;t--;)this.phyBones[t].visible=e},update:function(){if(this.isRunning)for(var e,t=new Matrix4,i=new Vector3,r=new Quaternion,n=this.bones.length;n--;){var a=new Matrix4,o=new Matrix4;e=this.bones[n],14!=n&&15!=n&&24!=n&&25!=n&&(o.makeTranslation(0,this.boneDecal[n],0),a.multiply(o),t.multiplyMatrices(e.matrixWorld,a),i.setFromMatrixPosition(t),r.setFromRotationMatrix(t),window.WEngine.options({name:e.ammobodyName,type:"Rigid",flag:2,trans:[i.x,i.y,i.z,r.x,r.y,r.z,r.w]}))}}};var WAvatar=function(e){this.index=0,this.ename=e.ename,this.cname=e.cname,this.findPath=!1,this.life=100,this.isTestBvh=!1,this.logicPlay=!1,this.bvhLoader=new BVHLoader,this.animations=[],this.actions=[],this.boneTracks=[],this.bvhData=[],this.boneNames=[],this.bones=[],this.freezeBones=[],this.hipParentMtx=null,this.canJump=!0,this.isJumping=!1,this.curActionName=null,this.curFreezeActionName=null,this.mixamoOffset=new Vector3(0,0,0),this.size=e.size,this.addModel(window.WEngine.view.getModel(this.ename)),this.initActions(e),this.damageUUIDS=[],e.physicBody&&this.initPhysicSkeleton(),this.isReady=!0};WAvatar.prototype={constructor:WAvatar,clearFreezeBones:function(){this.freezeBones=[]},addNameLabel:function(){var e=document.createElement("div");e.className="label",e.textContent=this.cname,e.style.marginTop="-1em";var t=new CSS2DObject(e);return t.position.set(0,this.halfExtent.y+.1,0),this.model.parent.add(t),t},addDamage:function(e,t){-1==this.damageUUIDS.indexOf(e)&&(this.damageUUIDS.push(e),this.life-=t,this.life<=0&&(this.life=0))},getBoneList:function(e){var t=[];e&&e.isBone&&-1==this.boneNames.indexOf(e.name)&&(t.push(e),this.boneNames.push(e.name));for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},setBvhPlaySpeed:function(e){this.isTestBvh&&(this.mixer.timeScale=e)},enableTestBvhData:function(e){this.isTestBvh=e,null!=this.curActionName&&null!=this.actions[this.curActionName]&&this.actions[this.curActionName].stop(),e||(this.mixer.timeScale=1)},loadAndPlayBvhData:function(o,s){this.enableTestBvhData(!0);function l(e,t){if(!r.animations.hasOwnProperty(t)){var i=r.makeAnimation(e,t,{name:t,reverse:!1});r.actions[t]=r.mixer.clipAction(i)}r.doAction(t)}var r=this;window.setTimeout(function(){var e=s.substring(s.indexOf(".")+1,s.length),t=s.substring(0,s.indexOf(".")),i=-1!=s.indexOf("mixamo");if("z"===e)lzma.decompress(new Uint8Array(o),function(e){l(e,t)});else if("bvh"===e||"BVH"===e){for(var r="",n=new Uint8Array(o),a=0;a<n.length;++a)r+=String.fromCharCode(n[a]);l({type:i?"mixamo":"common",data:r},t)}},500)},makeAnimation:function(e,t,i){var r=this.bvhData[t]=this.bvhLoader.parse(e.data);r.actionName=t,r.bvhType=e.type,r.meta=i;var n=this.getAnimationClip(this.model,r,this.tPose_idx);return this.freezeBones[t]=i.freezebones||[],this.animations[t]=n},playAction:function(e){this.isTestBvh||!this.hasActions||this.logicPlay||this.doAction(e)},doAction:function(e){if(window.WEngine.playSound(this.model.parent,e),e!=this.curActionName&&window.WEngine.stopPlaySound(this.model.parent,this.curActionName),this.curFreezeActionName!=e){if(0<this.freezeBones[e].length&&(this.curFreezeActionName=e),null!=this.curFreezeActionName&&this.curFreezeActionName!=e)if(this.actions[e+"_"+this.curFreezeActionName])this.actions[e+"_"+this.curFreezeActionName].play();else{for(var t=this.animations[e].clone(),i=0;i<t.tracks.length;i++)for(var r=t.tracks[i].name,n=0;n<this.freezeBones[this.curFreezeActionName].length;n++){var a=this.freezeBones[this.curFreezeActionName][n];if(-1!=r.indexOf(a)&&this.boneTracks[this.curFreezeActionName].hasOwnProperty(a)){t.tracks[i]=this.boneTracks[this.curFreezeActionName][a];break}}this.animations[e+"_"+this.curFreezeActionName]=t,this.actions[e+"_"+this.curFreezeActionName]=this.mixer.clipAction(t),this.actions[e+"_"+this.curFreezeActionName].play()}else null==this.actions[e]&&(this.actions[e]=this.mixer.clipAction(this.animations[e])),this.actions[e].play();null!=this.curActionName&&null!=this.actions[this.curActionName]&&this.curActionName!=e&&this.curActionName!=e+"_"+this.curFreezeActionName&&this.actions[this.curActionName].stop(),this.curActionName=null!=this.curFreezeActionName&&this.curFreezeActionName!=e?e+"_"+this.curFreezeActionName:e}else this.curFreezeActionName=null},getKey:function(){return window.WEngine.currentFollow&&window.WEngine.currentFollow.userData.avatar==this?window.WEngine.user.keyboard.getKey():new Float32Array(20)},addHandGun:function(){this.handGun&&this.handR.remove(this.handGun);var e=window.WEngine.byName("handgun1");e.position.set(-.05,.05,0),e.rotation.set(0,Math.PI/2,Math.PI/2*.85),this.handR.add(e),this.handGun=e},getThrowPos:function(){var e=new Vector3;return this.handGun?(e.set(0,0,0),e.add(this.handGun.userData.muzzle.getWorldPosition(new Vector3))):(e.set(0,2,0),e.add(this.parent.position)),e},getThrowDir:function(){var e=new Vector3;if(this.handGun){var t=this.handGun.userData.muzzle.getWorldPosition(new Vector3),i=this.handGun.userData.muzzleBack.getWorldPosition(new Vector3);e.copy(t),e.sub(i)}else{var r=this.model.parent.userData.characterController.rotation-Math.PI/2;e.set(Math.cos(r),0,-Math.sin(r))}return e.multiplyScalar(250),e},update:function(e){this.mixer.update(e),this.physicSkeleton&&this.physicSkeleton.update(e)}},WAvatar.prototype.addModel=function(e,t){if(e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.material.alphaTest=.1)}),this.model=e,this.size?this.halfExtent=new Vector3(this.size[0],this.size[1],this.size[2]):(this.box=(new Box3).setFromObject(e),this.halfExtent=new Vector3(.25*(this.box.max.x-this.box.min.x),.5*(this.box.max.y-this.box.min.y),.25*(this.box.max.z-this.box.min.z)),this.size=[this.halfExtent.x,this.halfExtent.y,this.halfExtent.z]),this.model.position.set(0,-this.size[1],0),this.mixer=new AnimationMixer(this.model),void 0===this.tPose_idx&&(this.tPose_idx=[]),void 0===this.sizes&&(this.sizes={}),"fbx"==e.modelType){for(var i=0;i<e.children.length;i++)if(e.children[i].isGroup){this.bones=this.getBoneList(e.children[i]);break}}else"gltf"==e.modelType&&(this.bones=this.getBoneList(e));this.model.skeleton=new Skeleton(this.bones);var r,n,a,o=e.name,s=this.bones,l=s.length,c=new Vector3,h=[];for(r=0;r<l;r++)(n=s[r]).skeleton=this.model.skeleton,"hip"!==n.name&&"Hips"!==n.name&&"hips"!==n.name&&"mixamorigHips"!==n.name||(this.hipParentMtx=n.parent.matrixWorld.clone()),n.parent&&(n.userData.id=s.indexOf(n.parent)),void 0!==t&&this.renameBone(n,t.names),a=-1,"rThigh"!==n.name&&"RightUpLeg"!==n.name&&"thighR"!==n.name&&"mixamorigRightUpLeg"!==n.name||(a=1),"rShin"!==n.name&&"RightLeg"!==n.name&&"shinR"!==n.name&&"mixamorigRightLeg"!==n.name||(a=2),"rFoot"!==n.name&&"RightFoot"!==n.name&&"footR"!==n.name&&"mixamorigRightFoot"!==n.name||(a=3),-1!==a&&(h[a]=n.getWorldPosition(c.clone())),"RightHand"!==n.name&&"handR"!==n.name&&"mixamorigRightHand"!==n.name||(this.handR=n),this.tPose_idx[r]=n.matrixWorld.clone();this.sizes[o]=h[1].distanceTo(h[2])+h[2].distanceTo(h[3])},WAvatar.prototype.renameBone=function(e,t){for(var i in t)e.name===i&&(e.name=t[i])},WAvatar.prototype.findBoneRealName=function(e,t){return"Hips"==e||"hips"==e||"mixamorigHips"==e?e="mixamo"===t?"mixamorig:Hips":"hip":"LowerBack"==e||"spine"==e||"mixamorigSpine"==e?e="mixamo"===t?"mixamorig:Spine":"abdomen":"Neck"==e||"neck"==e||"mixamorigNeck"==e?e="mixamo"===t?"mixamorig:Neck":"neck":"Spine"==e||"chest"==e||"chest1"==e||"mixamorigSpine1"==e?e="mixamo"===t?"mixamorig:Spine1":"chest":"Head"==e||"head"==e||"mixamorigHead"==e?e="mixamo"===t?"mixamorig:Head":"head":"LeftUpLeg"==e||"thighL"==e||"mixamorigLeftUpLeg"==e?e="mixamo"===t?"mixamorig:LeftUpLeg":"lThigh":"RightUpLeg"==e||"thighR"==e||"mixamorigRightUpLeg"==e?e="mixamo"===t?"mixamorig:RightUpLeg":"rThigh":"LeftLeg"==e||"shinL"==e||"mixamorigLeftLeg"==e?e="mixamo"===t?"mixamorig:LeftLeg":"lShin":"RightLeg"==e||"shinR"==e||"mixamorigRightLeg"==e?e="mixamo"===t?"mixamorig:RightLeg":"rShin":"LeftFoot"==e||"footL"==e||"mixamorigLeftFoot"==e?e="mixamo"===t?"mixamorig:LeftFoot":"lFoot":"RightFoot"==e||"footR"==e||"mixamorigRightFoot"==e?e="mixamo"===t?"mixamorig:RightFoot":"rFoot":"LeftShoulder"==e||"shoulderL"==e||"mixamorigLeftShoulder"==e?e="mixamo"===t?"mixamorig:LeftShoulder":"lCollar":"RightShoulder"==e||"shoulderR"==e||"mixamorigRightShoulder"==e?e="mixamo"===t?"mixamorig:RightShoulder":"rCollar":"LeftArm"==e||"upper_armL"==e||"mixamorigLeftArm"==e?e="mixamo"===t?"mixamorig:LeftArm":"lShldr":"RightArm"==e||"upper_armR"==e||"mixamorigRightArm"==e?e="mixamo"===t?"mixamorig:RightArm":"rShldr":"LeftForeArm"==e||"forearmL"==e||"mixamorigLeftForeArm"==e?e="mixamo"===t?"mixamorig:LeftForeArm":"lForeArm":"RightForeArm"==e||"forearmR"==e||"mixamorigRightForeArm"==e?e="mixamo"===t?"mixamorig:RightForeArm":"rForeArm":"LeftHand"==e||"handL"==e||"mixamorigLeftHand"==e?e="mixamo"===t?"mixamorig:LeftHand":"lHand":"RightHand"==e||"handR"==e||"mixamorigRightHand"==e?e="mixamo"===t?"mixamorig:RightHand":"rHand":"thumb01L"==e||"mixamorigLeftHandThumb1"==e?e="mixamo"===t?"mixamorig:LeftHandThumb1":e:"thumb02L"==e||"mixamorigLeftHandThumb2"==e?e="mixamo"===t?"mixamorig:LeftHandThumb2":e:"thumb03L"==e||"mixamorigLeftHandThumb3"==e?e="mixamo"===t?"mixamorig:LeftHandThumb3":e:"f_index01L"==e||"mixamorigLeftHandIndex2"==e?e="mixamo"===t?"mixamorig:LeftHandIndex2":e:"f_index02L"==e||"mixamorigLeftHandIndex3"==e?e="mixamo"===t?"mixamorig:LeftHandIndex3":e:"f_index03L"==e||"mixamorigLeftHandIndex4"==e?e="mixamo"===t?"mixamorig:LeftHandIndex4":e:"f_middle01L"==e||"mixamorigLeftHandMiddle2"==e?e="mixamo"===t?"mixamorig:LeftHandMiddle2":e:"f_middle02L"==e||"mixamorigLeftHandMiddle3"==e?e="mixamo"===t?"mixamorig:LeftHandMiddle3":e:"f_middle03L"==e||"mixamorigLeftHandMiddle4"==e?e="mixamo"===t?"mixamorig:LeftHandMiddle4":e:"f_ring01L"==e||"mixamorigLeftHandRing2"==e?e="mixamo"===t?"mixamorig:LeftHandRing2":e:"f_ring02L"==e||"mixamorigLeftHandRing3"==e?e="mixamo"===t?"mixamorig:LeftHandRing3":e:"f_ring03L"==e||"mixamorigLeftHandRing4"==e?e="mixamo"===t?"mixamorig:LeftHandRing4":e:"f_pinky01L"==e||"mixamorigLeftHandPinky2"==e?e="mixamo"===t?"mixamorig:LeftHandPinky2":e:"f_pinky02L"==e||"mixamorigLeftHandPinky3"==e?e="mixamo"===t?"mixamorig:LeftHandPinky3":e:"f_pinky03L"==e||"mixamorigLeftHandPinky4"==e?e="mixamo"===t?"mixamorig:LeftHandPinky4":e:"thumb01R"==e||"mixamorigRightHandThumb1"==e?e="mixamo"===t?"mixamorig:RightHandThumb1":e:"thumb02R"==e||"mixamorigRightHandThumb2"==e?e="mixamo"===t?"mixamorig:RightHandThumb2":e:"thumb03R"==e||"mixamorigRightHandThumb3"==e?e="mixamo"===t?"mixamorig:RightHandThumb3":e:"f_index01R"==e||"mixamorigRightHandIndex2"==e?e="mixamo"===t?"mixamorig:RightHandIndex2":e:"f_index02R"==e||"mixamorigRightHandIndex3"==e?e="mixamo"===t?"mixamorig:RightHandIndex3":e:"f_index03R"==e||"mixamorigRightHandIndex4"==e?e="mixamo"===t?"mixamorig:RightHandIndex4":e:"f_middle01R"==e||"mixamorigRightHandMiddle2"==e?e="mixamo"===t?"mixamorig:RightHandMiddle2":e:"f_middle02R"==e||"mixamorigRightHandMiddle3"==e?e="mixamo"===t?"mixamorig:RightHandMiddle3":e:"f_middle03R"==e||"mixamorigRightHandMiddle4"==e?e="mixamo"===t?"mixamorig:RightHandMiddle4":e:"f_ring01R"==e||"mixamorigRightHandRing2"==e?e="mixamo"===t?"mixamorig:RightHandRing2":e:"f_ring02R"==e||"mixamorigRightHandRing3"==e?e="mixamo"===t?"mixamorig:RightHandRing3":e:"f_ring03R"==e||"mixamorigRightHandRing4"==e?e="mixamo"===t?"mixamorig:RightHandRing4":e:"f_pinky01R"==e||"mixamorigRightHandPinky2"==e?e="mixamo"===t?"mixamorig:RightHandPinky2":e:"f_pinky02R"==e||"mixamorigRightHandPinky3"==e?e="mixamo"===t?"mixamorig:RightHandPinky3":e:"f_pinky03R"!=e&&"mixamorigRightHandPinky4"!=e||(e="mixamo"===t?"mixamorig:RightHandPinky4":e),e},WAvatar.prototype.findBoneTrack=function(e,t,i){e=this.findBoneRealName(e,i);for(var r,n,a,o=[],s=0;s<t.length;++s)n=(r=t[s].name).substring(r.indexOf("[")+1,r.indexOf("]")),a=r.substring(r.lastIndexOf(".")+1),e===n&&("position"===a?o[0]=s:o[1]=s);return o},WAvatar.prototype.findTime=function(e,t){var i,r=e.length,n=0;for(i=0;i<r&&!(t<e[i]);i++)n=i;return n},WAvatar.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},WAvatar.prototype.findSize=function(e,t,i){var r=.5,n=t.getBoneByName("mixamo"===i?"mixamorig:Hips":"hip"),a=t.getBoneByName("mixamo"===i?"mixamorig:RightUpLeg":"rThigh"),o=t.getBoneByName("mixamo"===i?"mixamorig:RightLeg":"rShin"),s=t.getBoneByName("mixamo"===i?"mixamorig:RightFoot":"rFoot");if(void 0!==n&&void 0!==a&&void 0!==o&&void 0!==s){var l=0,c=[];if(o.userData.offset)c[1]=new Vector3,c[2]=o.userData.offset.clone(),c[3]=s.userData.offset.clone(),l=c[1].distanceTo(c[2])+c[1].distanceTo(c[3]);else{var h=new Vector3;n.updateMatrixWorld(!0),c[1]=a.getWorldPosition(h.clone()),c[2]=o.getWorldPosition(h.clone()),c[3]=s.getWorldPosition(h.clone()),l=c[1].distanceTo(c[2])+c[2].distanceTo(c[3])}r=+(this.sizes[e.name]/l).toFixed(4)}else console.log("Bad bvh name = unexpected result !!");return console.log("this.halfExtent.y=="+this.halfExtent.y+"    p[3].y*ratio="+c[3].y*r),"gltf"==e.modelType?(this.offset=new Vector3(0,.1+this.halfExtent.y,0),this.mixamoOffset=new Vector3(0,5.5*-this.halfExtent.y+3.6,0),{ratio:r,footY:c[3].y*r}):"fbx"==e.modelType?(this.offset=new Vector3(0,c[3].y*r*8.35,0),this.mixamoOffset=new Vector3(0,0,0),{ratio:r,footY:-c[3].y*r*8.5-this.halfExtent.y+.78}):void 0},WAvatar.prototype.getAnimationClip=function(e,t,i,r){var n,a,o,s,l,c,h,u,d,p,m,f,g=this.findSize(e,t.skeleton,t.bvhType);console.log("footY=="+g.footY);var v,y,x,_,b,w,M,S,T=g.ratio,A=t.clip,E=this.bones,C=A.tracks,L=[],R=(new Matrix4).getInverse(e.matrixWorld),P=new Quaternion,D=new Vector3,k=new Matrix4,B=new Matrix4,F=new Quaternion,I=new Vector3,O=new Vector3;if(t.meta.freezebones&&(this.boneTracks[t.actionName]=[]),null==i)for(i=[],a=E.length,c=0;c<a;c++)i[c]=E[c].matrixWorld.clone();for(a=E.length,c=0;c<a;++c)L[c]=this.findBoneTrack(p=(d=E[c]).name,C,t.bvhType);var V=Math.floor(1e3*A.frameTime),U=1/30;33===V&&(U=1/30),16===V&&(U=1/60),11===V&&(U=1/90),8===V&&(U=1/120);var G,N=A.name,z=0,H=0,j=0,W=0,q=1,$=[[A.name,0,A.frames]];for(void 0!==r&&r.length&&($=r),o=$.length,u=0;u<o;u++){for(N=$[u][0],q=void 0!==$[u][3]?$[u][3]:1,z=$[u][1]*U,H=$[u][2]*U,f=[],a=E.length,c=0;c<a;c++)if("hip"!==(p=(d=E[c]).name)&&"Hips"!==p&&"hips"!==p&&"mixamorigHips"!==p||(G=c),2===L[c].length){if(S=d.parent?d.parent.matrixWorld:R,j=this.findTime(C[M=L[c][1]].times,z),W=this.findTime(C[M].times,H)+1,m=AnimationUtils.arraySlice(C[M].times,j,W),_=AnimationUtils.arraySlice(C[M].values,4*j,4*W),b=[],v=[],n=m.length,1==t.meta.reverse)for(h=0;h<n;h++)v[h]=m[h]-z,l=4*h,P.set(_[s=4*(n-h-1)],_[s+1],_[s+2],_[s+3]),k.identity().makeRotationFromQuaternion(P),k.multiply(i[c]),B.identity().getInverse(S),B.multiply(k),B.decompose(I,F,O),F.normalize(),b[l]=F.x,b[l+1]=F.y,b[l+2]=F.z,b[l+3]=F.w;else for(h=0;h<n;h++)v[h]=m[h]-z,P.set(_[s=4*h],_[s+1],_[s+2],_[s+3]),k.identity().makeRotationFromQuaternion(P),k.multiply(i[c]),B.identity().getInverse(S),B.multiply(k),B.decompose(I,F,O),F.normalize(),b[s]=F.x,b[s+1]=F.y,b[s+2]=F.z,b[s+3]=F.w;if(0<v.length){var X=new QuaternionKeyframeTrack(".bones["+p+"].quaternion",v,b);t.meta.freezebones&&-1!=t.meta.freezebones.indexOf(p)&&(this.boneTracks[t.actionName][p]=X),f.push(X)}}if(p=(d=E[c=G]).name,2===L[c].length){if(j=this.findTime(C[w=L[c][0]].times,z),W=this.findTime(C[w].times,H)+1,m=AnimationUtils.arraySlice(C[w].times,j,W),y=AnimationUtils.arraySlice(C[w].values,3*j,3*W),v=[],x=[],n=m.length,1==t.meta.reverse)for(h=0;h<n;h++)v[h]=m[h]-z,l=3*h,D.set(y[s=3*(n-h-1)],y[s+1],y[s+2]),D.multiplyScalar(T),D.add(new Vector3(0,g.footY,0)),D.add("mixamo"===t.bvhType?this.mixamoOffset:this.offset),k.identity(),k.setPosition(D),B.identity().getInverse(this.hipParentMtx),B.multiply(k),B.decompose(I,F,O),x[l]=I.x,x[l+1]=I.y,x[l+2]=I.z;else for(h=0;h<n;h++)v[h]=m[h]-z,D.set(y[s=3*h],y[s+1],y[s+2]),D.multiplyScalar(T),D.add(new Vector3(0,g.footY,0)),D.add("mixamo"===t.bvhType?this.mixamoOffset:this.offset),k.identity(),k.setPosition(D),B.identity().getInverse(this.hipParentMtx),B.multiply(k),B.decompose(I,F,O),x[s]=I.x,x[s+1]=I.y,x[s+2]=I.z;0<v.length&&f.push(new VectorKeyframeTrack(".bones["+p+"].position",v,x))}var Y=new AnimationClip(N,-1,f);return Y.frameTime=U,Y.repeat=1===q,Y.timeScale=1,Y.uuid=this.uuid(),Y}},WAvatar.prototype.initPhysicSkeleton=function(){console.log("initPhysicSkeleton=="+this.ename),this.physicSkeleton=new WAvatarPhySkeleton(this),this.physicSkeleton.init()},WAvatar.prototype.initActions=function(e){if(e.hasOwnProperty("actions")){this.hasActions=!0;for(var t=e.actions,i=0;i<t.length;i++){var r=window.WEngine.getActionData(t[i].refBVH),n=this.makeAnimation(r,t[i].name,t[i]);this.actions[t[i].name]=this.mixer.clipAction(n)}}else this.hasActions=!1},WAvatar.prototype.addHelper=function(){this.helper=new SkeletonHelper(this.model),window.WEngine.view.addVisual(this.helper)},WAvatar.prototype.removeHelper=function(){null!=this.helper&&(window.WEngine.view.removeVisual(this.helper),this.helper=null)},WAvatar.prototype.showSkeleton=function(e){e?this.addHelper():this.removeHelper()};var WAnimalPhySkeleton=function(e){this.bones=e.bones,this.data=new Float32Array(8*this.bones.length),this.isRunning=!1,this.boneDecal=[],this.phyBones=[],this.root=e,this.matrix=e.model.matrixWorld,this.matrixAutoUpdate=!1};WAnimalPhySkeleton.prototype={constructor:WAnimalPhySkeleton,distance:function(e,t){var i=t.clone().sub(e);return Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)},init:function(){for(var e,t,i,r,n,a,o,s=new Vector3,l=new Vector3,c=this.bones.length;c--;)(i=this.bones[c]).ammobodyName=o=this.root.ename+"_"+(r=i.name),i.getWorldPosition(s),0<i.children.length&&i.children[0].getWorldPosition(l),n=.1,a=.04,this.boneDecal[c]=.5*.32,e=null,"Head"===r?(e="sphere",t=[.08],this.boneDecal[c]=.025):"Neck"===r||"Neck1"===r||"neck"===r?(e="cylinder",t=[a,n,a],this.boneDecal[c]=-.005):"Spine"===r||"chest"===r?(e="sphere",t=[.16]):"LowerBack"===r||"abdomen"===r?(e="sphere",t=[.14]):"Hips"===r||"hip"===r?(e="sphere",t=[.12],this.boneDecal[c]=0):"LeftUpLeg"===r||"RightUpLeg"===r||"lThigh"===r||"rThigh"===r?(a=.06,i.children[0]&&(n=this.distance(s,l)+.02),e="cylinder",t=[a,n,a]):"LeftLeg"===r||"RightLeg"===r||"lShin"===r||"rShin"===r?(e="cylinder",t=[a=.046,n=this.distance(i.parent.position,i.position)+.02,a]):"LeftFoot"===r||"RightFoot"===r||"lFoot"===r||"rFoot"===r?(e="box",t=[2*(a=.032),n=.12,a],this.boneDecal[c]=0):"LeftToeBase"===r||"RightToeBase"===r||"lFoot"===r||"rFoot"===r?(n=.06,e="box",t=[2*(a=.032),n,a],this.boneDecal[c]=0):"LeftShoulder"==r||"RightShoulder"==r||"lCollar"===r||"rCollar"===r?(e="sphere",t=[.046]):"LeftArm"==r||"RightArm"==r||"lShldr"===r||"rShldr"===r?(a=.046,i.children[0]&&(n=this.distance(s,l)+.04),e="cylinder",t=[a,n,a]):"LeftForeArm"==r||"RightForeArm"==r||"lForeArm"===r||"rForeArm"===r?(e="cylinder",t=[a=.02,n=this.distance(i.parent.position,i.position)+.03,a]):"LeftHand"!=r&&"RightHand"!=r&&"lHand"!==r&&"rHand"!==r||(i.children[0]&&(n=this.distance(s,l)),e="box",t=[a,n,a]),null!=e&&this.phyBones.push(window.WEngine.add({type:e,size:t,pos:s.toArray(),name:o,mass:3,flag:2,state:4,friction:.5,restitution:.9,kinematic:!0,mask:2}));this.isRunning=!0},showPhyBones:function(e){for(var t=this.phyBones.length;t--;)this.phyBones[t].visible=e},update:function(){if(this.isRunning)for(var e,t=new Matrix4,i=new Vector3,r=new Quaternion,n=this.bones.length;n--;){var a=new Matrix4,o=new Matrix4;e=this.bones[n],14!=n&&15!=n&&24!=n&&25!=n&&(o.makeTranslation(0,this.boneDecal[n],0),a.multiply(o),t.multiplyMatrices(e.matrixWorld,a),i.setFromMatrixPosition(t),r.setFromRotationMatrix(t),window.WEngine.options({name:e.ammobodyName,type:"Rigid",flag:2,trans:[i.x,i.y,i.z,r.x,r.y,r.z,r.w]}))}}};var WAnimal=function(e){this.index=0,this.ename=e.ename,this.cname=e.cname,this.findPath=!1,this.life=100,this.isTestBvh=!1,this.logicPlay=!1,this.bvhLoader=new BVHLoader,this.animations=[],this.actions=[],this.boneTracks=[],this.bvhData=[],this.boneNames=[],this.bones=[],this.freezeBones=[],this.hipParentMtx=null,this.canJump=!0,this.isJumping=!1,this.curActionName=null,this.curFreezeActionName=null,this.size=e.size,this.addModel(window.WEngine.view.getModel(e.modelName),e),this.damageUUIDS=[],e.physicBody&&this.initPhysicSkeleton(),this.animations=window.WEngine.view.getAnimations(e.modelName),this.initActions(e),this.isReady=!0};WAnimal.prototype={constructor:WAnimal,clearFreezeBones:function(){this.freezeBones=[]},addNameLabel:function(){var e=document.createElement("div");e.className="label",e.textContent=this.cname,e.style.marginTop="-1em";var t=new CSS2DObject(e);return t.position.set(0,this.halfExtent.y+.1,0),this.model.parent.add(t),t},addDamage:function(e,t){-1==this.damageUUIDS.indexOf(e)&&(this.damageUUIDS.push(e),this.life-=t,this.life<=0&&(this.life=0))},getBoneList:function(e){var t=[];e&&e.isBone&&-1==this.boneNames.indexOf(e.name)&&(t.push(e),this.boneNames.push(e.name));for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},playAction:function(e){this.hasActions&&!this.logicPlay&&this.doAction(e)},doAction:function(e){this.actions[e]&&(this.actions[e].play(),null!=this.curActionName&&this.curActionName!=e&&this.actions[this.curActionName].stop(),this.curActionName=e)},getKey:function(){return window.WEngine.currentFollow&&window.WEngine.currentFollow.userData.avatar==this?window.WEngine.user.keyboard.getKey():new Float32Array(20)},update:function(e){this.mixer.update(e),this.physicSkeleton&&this.physicSkeleton.update(e)}},WAnimal.prototype.addModel=function(e,t){if(e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.material.alphaTest=.1)}),t.scale&&e.scale.fromArray([t.scale[0],t.scale[1],t.scale[2]]),this.model=e,this.size?this.halfExtent=new Vector3(this.size[0],this.size[1],this.size[2]):(this.box=(new Box3).setFromObject(e),this.halfExtent=new Vector3(.5*(this.box.max.x-this.box.min.x),.5*(this.box.max.y-this.box.min.y),.5*(this.box.max.z-this.box.min.z)),this.size=[this.halfExtent.x,this.halfExtent.y,this.halfExtent.z]),t.offset?this.model.position.set(t.offset[0],-this.size[1]+t.offset[1],t.offset[2]):this.model.position.set(0,-this.size[1],0),this.mixer=new AnimationMixer(this.model),void 0===this.tPose&&(this.tPose=[]),void 0===this.sizes&&(this.sizes={}),"fbx"==e.modelType){for(var i=0;i<e.children.length;i++)if(e.children[i].isGroup){this.bones=this.getBoneList(e.children[i]);break}}else"gltf"==e.modelType&&(this.bones=this.getBoneList(e))},WAnimal.prototype.initPhysicSkeleton=function(){console.log("initPhysicSkeleton=="+this.ename),this.physicSkeleton=new WAnimalPhySkeleton(this),this.physicSkeleton.init()},WAnimal.prototype.initActions=function(e){if(e.hasOwnProperty("actions")){this.hasActions=!0;for(var t=e.actions,i=0;i<t.length;i++){var r=this.animations[t[i].clipName];t[i].duration&&(r.duration=t[i].duration),this.actions[t[i].name]=this.mixer.clipAction(r)}}else this.hasActions=!1},WAnimal.prototype.addHelper=function(){this.helper=new SkeletonHelper(this.model),window.WEngine.view.addVisual(this.helper)},WAnimal.prototype.removeHelper=function(){null!=this.helper&&(window.WEngine.view.removeVisual(this.helper),this.helper=null)},WAnimal.prototype.showSkeleton=function(e){e?this.addHelper():this.removeHelper()};var posN=new Vector3,quatWO=new Quaternion,quatWN=new Quaternion,quatLO=new Quaternion,WMMDPhySkeleton=function(e){this.wmmd=e,this.scale=e.scale,this.bones=e.model.skeleton.bones;var t=e.model.geometry.userData;this.rigidBodies=t.MMD.rigidBodies,this.constraints=t.MMD.constraints,this.ammoBodies=[],this.isRunning=!1,this.updateAll=!1,this.updateBone=!1},WGe;function GrantSolver(e,t){this.mesh=e,this.grants=t||[]}WMMDPhySkeleton.prototype={constructor:WMMDPhySkeleton,init:function(){var e=this;setTimeout(function(){e.initRigidBodies(),e.resetRigidBodies(),e.initConstraints(),e.isRunning=!0,setTimeout(function(){e.updateBone=!0},5e3)},5e3)},initRigidBodies:function(){var e,t,i,r,n,a=this.scale,o=new Vector3,s=new THREE.Quaternion,l=new THREE.Euler,c=new Matrix4;console.log(this.wmmd.ename+"--rigidBodies.length-"+this.rigidBodies.length);for(var h=0,u=this.rigidBodies.length;h<u;h++){switch(n=this.wmmd.ename+"_"+h,-1==(i=this.rigidBodies[h]).boneIndex?r=new Bone:((r=this.bones[i.boneIndex]).updateMatrixWorld(!0),r.getWorldPosition(o)),console.log(r.name+"--type--"+i.type+"--shapeType--"+i.shapeType),e=null,i.shapeType){case 0:e="sphere",t=[i.width*a,i.width*a,i.width*a];break;case 1:e="box",t=[2*i.width*a,2*i.height*a,2*i.depth*a];break;case 2:e="capsule",t=[i.width*a,i.height*a,i.width*a];break;default:throw"unknown shape type "+i.shapeType}if(null!=e){r.bodyType=i.type;var d=s.setFromEuler(l.fromArray(i.rotation)).toArray(),p=[i.position[0]*a,i.position[1]*a,i.position[2]*a];console.log(n+"--"+i.name+"--type-"+e);var m={type:e,size:t,pos:p,quat:d,bonePos:o.toArray(),name:n,friction:i.friction*a,restitution:i.restitution*a,damping:[i.positionDamping*a,i.rotationDamping*a]};0===i.type?(m.group=4,m.mask=8,m.flag=2,m.state=4,m.mass=0,m.kinematic=!0):(m.group=8,m.mask=6,m.flag=2,m.mass=i.weight*a,m.kinematic=!0,m.neverSleep=!0);var f=window.WEngine.physic.add(m);c.identity(),c.makeTranslation(p[0],p[1],p[2]),c.makeRotationFromQuaternion(s);var g=new Matrix4;g.getInverse(c),f.mmdData={p:p,q:d,imtx:g,boneIndex:i.boneIndex,type:i.type},this.ammoBodies.push(f)}}console.log(this.wmmd.ename+"--ammoBodies.length-"+this.ammoBodies.length)},initConstraints_test:function(){for(var e=window.WEngine.physic,t=0;t<20;t++)e.add({type:"box",name:"box"+t,mass:1,pos:[2*t-2.1,.2,0],size:[.2],group:8,mask:6,kinematic:!1,neverSleep:!0});e.add({type:"joint_spring_dof",name:"joint_head",b1:"miku_0",b2:"box0",pos1:[.1,0,0],pos2:[-.1,0,0],axe1:[0,0,1],axe2:[0,0,1],linLower:[0,0,0],linUpper:[0,0,0],angLower:[-20,-20,-20],angUpper:[20,20,20],collision:!1,local:!0});for(t=0;t<19;t++)e.add({type:"joint_spring_dof",name:"joint"+t,b1:"box"+t,b2:"box"+(t+1),pos1:[.1,0,0],pos2:[-.1,0,0],axe1:[0,0,1],axe2:[0,0,1],linLower:[0,0,0],linUpper:[0,0,0],angLower:[-20,-20,-20],angUpper:[20,20,20],collision:!1,local:!0})},initConstraints:function(){for(var e,t,i=this.scale,r=new THREE.Quaternion,n=new THREE.Euler,a=180/Math.PI,o=0,s=this.constraints.length;o<s;o++){var l=this.constraints[o],c=this.ammoBodies[l.rigidBodyIndex1],h=this.ammoBodies[l.rigidBodyIndex2],u=l.translationLimitation1,d=l.translationLimitation2,p=l.rotationLimitation1,m=l.rotationLimitation2,f=l.springPosition,g=l.springRotation;console.log("create joint_"+c.name+"_"+h.name),e=[l.position[0]*i+this.wmmd.initPos[0],l.position[1]*i+this.wmmd.initPos[1],l.position[2]*i+this.wmmd.initPos[2]],console.log("p--"+l.position[0]*i+" "+l.position[1]*i+" "+l.position[2]*i),t=r.setFromEuler(n.fromArray(l.rotation)).toArray(),window.WEngine.physic.add({type:"joint_spring_dof",name:"joint_"+c.name+"_"+h.name,b1:c.name,b2:h.name,pos1:e,quat1:t,pos2:e,quat2:t,linLower:[u[0]*i,u[1]*i,u[2]*i],linUpper:[d[0]*i,d[1]*i,d[2]*i],angLower:[p[0]*a,p[1]*a,p[2]*a],angUpper:[m[0]*a,m[1]*a,m[2]*a],spring:[f[0]*i,f[1]*i,f[2]*i,g[0],g[1],g[2]],params:[[2,.475],[2,.475],[2,.475],[2,.475],[2,.475],[2,.475]],collision:!1,local:!1}),window.WEngine.physic.options({name:h.name,type:"body",flag:0})}},showPhyBones:function(e){for(var t=this.ammoBodies.length;t--;)this.ammoBodies[t].visible=e},update:function(){this.isRunning&&(this.updateRigidBodies(),this.updateBones())},updateBones:function(){if(this.updateBone)for(var e,t=0,i=this.ammoBodies.length;t<i;t++)if(0!=(e=this.ammoBodies[t]).mmdData.type){if(e.mmdData.boneIndex<0)continue;this.updateOneBoneFromAmmoBody(this.bones[e.mmdData.boneIndex],e)}},updateOneBoneFromAmmoBody:function(e,t){var i=t.matrix.clone().multiply(t.mmdData.imtx);posN.setFromMatrixPosition(i),quatWN.setFromRotationMatrix(i),quatLO.setFromRotationMatrix(e.matrix),quatWO.setFromRotationMatrix(e.matrixWorld),quatWO.conjugate().multiply(quatWN),e.quaternion.multiply(quatWO),1===t.mmdData.type&&0!=e.parent.bodyType&&(e.parent&&e.parent.worldToLocal(posN),e.position.copy(posN)),e.updateMatrixWorld(!0)},updateRigidBodies:function(){for(var e,t=new Vector3,i=new Quaternion,r=new Vector3,n=this.ammoBodies.length;n--;)if(e=this.ammoBodies[n],this.updateAll||0===e.mmdData.type){if(e.mmdData.boneIndex<0)continue;this.bones[e.mmdData.boneIndex].matrixWorld.decompose(t,i,r),window.WEngine.physic.options({name:e.name,type:"body",mmdPos:e.mmdData.p,mmdQuat:e.mmdData.q,trans:[t.x,t.y,t.z,i.x,i.y,i.z,i.w]},!0)}},resetRigidBodies:function(){var e;this.wmmd.model.updateMatrixWorld(!0);for(var t=new Vector3,i=new Quaternion,r=new Vector3,n=this.ammoBodies.length;n--;)(e=this.ammoBodies[n]).mmdData.boneIndex<0?(t.fromArray(this.wmmd.initPos),i.set(0,0,0,1)):this.bones[e.mmdData.boneIndex].matrixWorld.decompose(t,i,r),window.WEngine.options({name:e.name,type:"body",mmdPos:e.mmdData.p,mmdQuat:e.mmdData.q,trans:[t.x,t.y,t.z,i.x,i.y,i.z,i.w]},!0)}},GrantSolver.prototype={constructor:GrantSolver,update:(WGe=new Quaternion,function(){for(var e=this.mesh.skeleton.bones,t=this.grants,i=0,r=t.length;i<r;i++){var n=t[i],a=e[n.index],o=e[n.parentIndex];n.isLocal||n.affectRotation&&(WGe.set(0,0,0,1),WGe.slerp(o.quaternion,n.ratio),a.quaternion.multiply(WGe))}return this})};var WMMD=function(e){this.index=0,this.ename=e.ename,this.cname=e.cname,this.findPath=!1,this.life=100,this.scale=e.scale,this.initPos=e.position,this.physicBody=e.physicBody,this.isTestBvh=!1,this.logicPlay=!1,this.bvhLoader=new BVHLoader,this.animations=[],this.actions=[],this.boneTracks=[],this.bvhData=[],this.boneNames=[],this.bones=[],this.freezeBones=[],this.hipParentMtx=null,this.canJump=!0,this.isJumping=!1,this.curActionName=null,this.curFreezeActionName=null,this.size=e.size,this.addModel(window.WEngine.view.getModel(this.ename),e),this.initActions(e),this.ikSolver=this.createCCDIKSolver(this.model),this.grantSolver=this.createGrantSolver(this.model),this.damageUUIDS=[],this.isReady=!0};WMMD.prototype={constructor:WMMD,clearFreezeBones:function(){this.freezeBones=[]},addNameLabel:function(){var e=document.createElement("div");e.className="label",e.textContent=this.cname,e.style.marginTop="-1em";var t=new CSS2DObject(e);return t.position.set(0,this.halfExtent.y+.2,0),this.model.parent.add(t),t},getBoneList:function(e){var t=[];e&&e.isBone&&-1==this.boneNames.indexOf(e.name)&&(t.push(e),this.boneNames.push(e.name));for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},setBvhPlaySpeed:function(e){this.isTestBvh&&(this.mixer.timeScale=e)},enableTestBvhData:function(e){this.isTestBvh=e,null!=this.curActionName&&null!=this.actions[this.curActionName]&&this.actions[this.curActionName].stop(),e||(this.mixer.timeScale=1)},loadAndPlayBvhData:function(o,s){this.enableTestBvhData(!0);function l(e,t){if(!r.animations.hasOwnProperty(t)){var i=r.makeAnimation(e,t,{name:t,reverse:!1});r.actions[t]=r.mixer.clipAction(i)}r.doAction(t)}var r=this;window.setTimeout(function(){var e=s.substring(s.indexOf(".")+1,s.length),t=s.substring(0,s.indexOf(".")),i=-1!=s.indexOf("mixamo");if("z"===e)lzma.decompress(new Uint8Array(o),function(e){l(e,t)});else if("bvh"===e||"BVH"===e){for(var r="",n=new Uint8Array(o),a=0;a<n.length;++a)r+=String.fromCharCode(n[a]);l({type:i?"mixamo":"common",data:r},t)}},500)},playAction:function(e){this.isTestBvh||!this.hasActions||this.logicPlay||this.doAction(e)},doAction:function(e){this.actions[e]&&(this.isVMDAction=this.actions[e].isVMD,this.actions[e].play(),null!=this.curActionName&&this.curActionName!=e&&this.actions[this.curActionName].stop(),this.curActionName=e)},getKey:function(){return window.WEngine.currentFollow&&window.WEngine.currentFollow.userData.avatar==this?window.WEngine.user.keyboard.getKey():new Float32Array(20)},update:function(e){this.physicBody&&(null==this.physicSkeleton||0==this.physicSkeleton.isRunning)||(this.restoreBones(this.model),this.mixer.update(e),this.saveBones(this.model),this.isVMDAction&&(this.model.updateMatrixWorld(!0),this.ikSolver.update(),this.grantSolver.update()),this.physicSkeleton&&this.physicSkeleton.update(e))}},WMMD.prototype.addModel=function(e,t){e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.material.alphaTest=.1)}),t.usePhongMat&&(e.material=function(e){for(var t,i,r=[],n=0,a=e.length;n<a;n++){var o=new THREE.MeshPhongMaterial;Material.prototype.copy.call(i=o,t=e[n]),i.color.copy(t.color),i.map=t.map,i.gradientMap=t.gradientMap,i.lightMap=t.lightMap,i.lightMapIntensity=t.lightMapIntensity,i.aoMap=t.aoMap,i.aoMapIntensity=t.aoMapIntensity,i.emissive.copy(t.emissive),i.emissiveMap=t.emissiveMap,i.emissiveIntensity=t.emissiveIntensity,i.bumpMap=t.bumpMap,i.bumpScale=t.bumpScale,i.normalMap=t.normalMap,i.normalMapType=t.normalMapType,i.normalScale.copy(t.normalScale),i.displacementMap=t.displacementMap,i.displacementScale=t.displacementScale,i.displacementBias=t.displacementBias,i.alphaMap=t.alphaMap,i.wireframe=t.wireframe,i.wireframeLinewidth=t.wireframeLinewidth,i.wireframeLinecap=t.wireframeLinecap,i.wireframeLinejoin=t.wireframeLinejoin,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,o.needsUpdate=!0,o.envMap=window.WEngine.view.getEnvmap(),r.push(o)}return r}(e.material)),this.model=e,t.scale&&this.model.scale.fromArray([t.scale,t.scale,t.scale]),this.size?this.halfExtent=new Vector3(this.size[0],this.size[1],this.size[2]):(this.box=(new Box3).setFromObject(this.model),this.halfExtent=new Vector3(.25*(this.box.max.x-this.box.min.x),.5*(this.box.max.y-this.box.min.y),.25*(this.box.max.z-this.box.min.z)),this.size=[this.halfExtent.x,this.halfExtent.y,this.halfExtent.z]),t.offset?(this.vmdOffset=t.offset,this.model.position.set(t.offset[0],-this.size[1]+t.offset[1],t.offset[2])):this.model.position.set(0,-this.size[1],0),this.mixer=new AnimationMixer(this.model),void 0===this.tPose_idx&&(this.tPose_idx=[]),void 0===this.sizes&&(this.sizes={}),this.bones=e.skeleton.bones;var i,r,n,a=e.name,o=this.bones,s=o.length,l=new Vector3,c=[];for(i=0;i<s;i++)(r=o[i]).skeleton=this.model.skeleton,"hip"!==r.name&&"Hips"!==r.name&&"hips"!==r.name&&""!==r.name||(this.hipParentMtx=r.parent.matrixWorld.clone()),r.parent&&(r.userData.id=o.indexOf(r.parent)),void 0!==t&&this.renameBone(r,t.names),n=-1,"rThigh"!==r.name&&"RightUpLeg"!==r.name&&"thighR"!==r.name&&""!==r.name||(n=1),"rShin"!==r.name&&"RightLeg"!==r.name&&"shinR"!==r.name&&""!==r.name||(n=2),"rFoot"!==r.name&&"RightFoot"!==r.name&&"footR"!==r.name&&""!==r.name||(n=3),-1!==n&&(c[n]=r.getWorldPosition(l.clone())),"RightHand"!==r.name&&"handR"!==r.name&&""!==r.name||(this.handR=r),""===r.name&&r.matrixWorld.multiply((new THREE.Matrix4).makeRotationFromEuler((new THREE.Euler).fromArray(window.WEngine.toRad([0,0,45])))),""===r.name&&r.matrixWorld.multiply((new THREE.Matrix4).makeRotationFromEuler((new THREE.Euler).fromArray(window.WEngine.toRad([0,0,-45])))),this.tPose_idx[i]=r.matrixWorld.clone();this.sizes[a]=c[1].distanceTo(c[2])+c[2].distanceTo(c[3])},WMMD.prototype.createCCDIKSolver=function(e){if(void 0===CCDIKSolver)throw new Error("THREE.MMDAnimationHelper: Import CCDIKSolver.");return new CCDIKSolver(e,e.geometry.userData.MMD.iks)},WMMD.prototype.createGrantSolver=function(e){return new GrantSolver(e,e.geometry.userData.MMD.grants)},WMMD.prototype.saveBones=function(e){var t=e.skeleton.bones;void 0===this.backupBones&&(this.backupBones=new Float32Array(7*t.length));for(var i=0,r=t.length;i<r;i++){var n=t[i];n.position.toArray(this.backupBones,7*i),n.quaternion.toArray(this.backupBones,7*i+3)}},WMMD.prototype.restoreBones=function(e){if(void 0!==this.backupBones)for(var t=e.skeleton.bones,i=0,r=t.length;i<r;i++){var n=t[i];n.position.fromArray(this.backupBones,7*i),n.quaternion.fromArray(this.backupBones,7*i+3)}},WMMD.prototype.initPhysicSkeleton=function(){console.log("initPhysicSkeleton=="+this.ename),this.physicSkeleton=new WMMDPhySkeleton(this),this.physicSkeleton.init()},WMMD.prototype.initActions=function(e){if(e.hasOwnProperty("actions")){this.hasActions=!0;for(var t=e.actions,i=0;i<t.length;i++){var r=null,n=!1;if(t[i].refVMD)n=!0,r=window.WEngine.view.getMMDAnimation(t[i],this.model);else if(t[i].refBVH){n=!1;var a=window.WEngine.getActionData(t[i].refBVH);r=this.makeAnimation(a,t[i].name,t[i])}null!=r&&(this.actions[t[i].name]=this.mixer.clipAction(r)),this.actions[t[i].name].isVMD=n}}else this.hasActions=!1},WMMD.prototype.makeAnimation=function(e,t,i){var r=this.bvhData[t]=this.bvhLoader.parse(e.data);r.actionName=t,r.bvhType=e.type,r.meta=i;var n=this.getAnimationClip(this.model,r,this.tPose_idx);return this.freezeBones[t]=i.freezebones||[],this.animations[t]=n},WMMD.prototype.getAnimationClip=function(e,t,i,r){var n,a,o,s,l,c,h,u,d,p,m,f,g=this.findSize(e,t.skeleton,t.bvhType);console.log("footY=="+g.footY);var v,y,x,_,b,w,M,S,T=g.ratio,A=t.clip,E=this.bones,C=A.tracks,L=[],R=(new Matrix4).getInverse(e.matrixWorld),P=new Quaternion,D=new Vector3,k=new Matrix4,B=new Matrix4,F=new Quaternion,I=new Vector3,O=new Vector3;if(t.meta.freezebones&&(this.boneTracks[t.actionName]=[]),null==i)for(i=[],a=E.length,c=0;c<a;c++)i[c]=E[c].matrixWorld.clone();for(a=E.length,c=0;c<a;++c)L[c]=this.findBoneTrack(p=(d=E[c]).name,C,t.bvhType);var V=Math.floor(1e3*A.frameTime),U=1/30;33===V&&(U=1/30),16===V&&(U=1/60),11===V&&(U=1/90),8===V&&(U=1/120);var G,N=A.name,z=0,H=0,j=0,W=0,q=1,$=[[A.name,0,A.frames]];for(void 0!==r&&r.length&&($=r),o=$.length,u=0;u<o;u++){for(N=$[u][0],q=void 0!==$[u][3]?$[u][3]:1,z=$[u][1]*U,H=$[u][2]*U,f=[],a=E.length,c=0;c<a;c++)if("hip"!==(p=(d=E[c]).name)&&"Hips"!==p&&"hips"!==p&&""!==p||(G=c),2===L[c].length){if(S=d.parent?d.parent.matrixWorld:R,j=this.findTime(C[M=L[c][1]].times,z),W=this.findTime(C[M].times,H)+1,m=AnimationUtils.arraySlice(C[M].times,j,W),_=AnimationUtils.arraySlice(C[M].values,4*j,4*W),b=[],v=[],n=m.length,1==t.meta.reverse)for(h=0;h<n;h++)v[h]=m[h]-z,l=4*h,P.set(_[s=4*(n-h-1)],_[s+1],_[s+2],_[s+3]),k.identity().makeRotationFromQuaternion(P),k.multiply(i[c]),B.identity().getInverse(S),B.multiply(k),B.decompose(I,F,O),F.normalize(),b[l]=F.x,b[l+1]=F.y,b[l+2]=F.z,b[l+3]=F.w;else for(h=0;h<n;h++)v[h]=m[h]-z,P.set(_[s=4*h],_[s+1],_[s+2],_[s+3]),k.identity().makeRotationFromQuaternion(P),k.multiply(i[c]),B.identity().getInverse(S),B.multiply(k),B.decompose(I,F,O),F.normalize(),b[s]=F.x,b[s+1]=F.y,b[s+2]=F.z,b[s+3]=F.w;if(0<v.length){var X=new QuaternionKeyframeTrack(".bones["+p+"].quaternion",v,b);t.meta.freezebones&&-1!=t.meta.freezebones.indexOf(p)&&(this.boneTracks[t.actionName][p]=X),f.push(X)}}if(p=(d=E[c=G]).name,2===L[c].length){if(j=this.findTime(C[w=L[c][0]].times,z),W=this.findTime(C[w].times,H)+1,m=AnimationUtils.arraySlice(C[w].times,j,W),y=AnimationUtils.arraySlice(C[w].values,3*j,3*W),v=[],x=[],n=m.length,1==t.meta.reverse)for(h=0;h<n;h++)v[h]=m[h]-z,l=3*h,D.set(y[s=3*(n-h-1)],y[s+1],y[s+2]),D.multiplyScalar(T),D.add(new Vector3(0,g.footY,0)),D.add("mixamo"===t.bvhType?this.mixamoOffset:this.offset),k.identity(),k.setPosition(D),B.identity().getInverse(this.hipParentMtx),B.multiply(k),B.decompose(I,F,O),x[l]=I.x,x[l+1]=I.y,x[l+2]=I.z;else for(h=0;h<n;h++)v[h]=m[h]-z,D.set(y[s=3*h],y[s+1],y[s+2]),D.multiplyScalar(T),D.add(new Vector3(0,g.footY,0)),D.add("mixamo"===t.bvhType?this.mixamoOffset:this.offset),k.identity(),k.setPosition(D),B.identity().getInverse(this.hipParentMtx),B.multiply(k),B.decompose(I,F,O),x[s]=I.x,x[s+1]=I.y,x[s+2]=I.z;0<v.length&&f.push(new VectorKeyframeTrack(".bones["+p+"].position",v,x))}var Y=new AnimationClip(N,-1,f);return Y.frameTime=U,Y.repeat=1===q,Y.timeScale=1,Y.uuid=this.uuid(),Y}},WMMD.prototype.findSize=function(e,t,i){var r=.5,n=t.getBoneByName("mixamo"===i?"mixamorig:Hips":"hip"),a=t.getBoneByName("mixamo"===i?"mixamorig:RightUpLeg":"rThigh"),o=t.getBoneByName("mixamo"===i?"mixamorig:RightLeg":"rShin"),s=t.getBoneByName("mixamo"===i?"mixamorig:RightFoot":"rFoot");if(void 0!==n&&void 0!==a&&void 0!==o&&void 0!==s){var l=0,c=[];if(o.userData.offset)c[1]=new Vector3,c[2]=o.userData.offset.clone(),c[3]=s.userData.offset.clone(),l=c[1].distanceTo(c[2])+c[1].distanceTo(c[3]);else{var h=new Vector3;n.updateMatrixWorld(!0),c[1]=a.getWorldPosition(h.clone()),c[2]=o.getWorldPosition(h.clone()),c[3]=s.getWorldPosition(h.clone()),l=c[1].distanceTo(c[2])+c[2].distanceTo(c[3])}r=+(this.sizes[e.name]/l).toFixed(4)}else console.log("Bad bvh name = unexpected result !!");return console.log("this.halfExtent.y=="+this.halfExtent.y+"    p[3].y*ratio="+c[3].y*r),this.offset=new Vector3(0,this.halfExtent.y-(this.vmdOffset?this.vmdOffset[1]:0),0),this.mixamoOffset=new Vector3(0,-this.halfExtent.y-(this.vmdOffset?this.vmdOffset[1]:0)-.4,0),{ratio:r,footY:c[3].y*r}},WMMD.prototype.findTime=function(e,t){var i,r=e.length,n=0;for(i=0;i<r&&!(t<e[i]);i++)n=i;return n},WMMD.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},WMMD.prototype.renameBone=function(e,t){for(var i in t)e.name===i&&(e.name=t[i])},WMMD.prototype.findBoneRealName=function(e,t){return"Hips"==e||"hips"==e||""==e?e="mixamo"===t?"mixamorig:Hips":"hip":"LowerBack"==e||"spine"==e||"2"==e?e="mixamo"===t?"mixamorig:Spine":"abdomen":"Neck"==e||"neck"==e||""==e?e="mixamo"===t?"mixamorig:Neck":"neck":"Spine"==e||"chest"==e||"chest1"==e||""==e?e="mixamo"===t?"mixamorig:Spine1":"chest":"Head"==e||"head"==e||""==e?e="mixamo"===t?"mixamorig:Head":"head":"LeftUpLeg"==e||"thighL"==e||""==e?e="mixamo"===t?"mixamorig:LeftUpLeg":"lThigh":"RightUpLeg"==e||"thighR"==e||""==e?e="mixamo"===t?"mixamorig:RightUpLeg":"rThigh":"LeftLeg"==e||"shinL"==e||""==e?e="mixamo"===t?"mixamorig:LeftLeg":"lShin":"RightLeg"==e||"shinR"==e||""==e?e="mixamo"===t?"mixamorig:RightLeg":"rShin":"LeftFoot"==e||"footL"==e||""==e?e="mixamo"===t?"mixamorig:LeftFoot":"lFoot":"RightFoot"==e||"footR"==e||""==e?e="mixamo"===t?"mixamorig:RightFoot":"rFoot":"LeftShoulder"==e||"shoulderL"==e||""==e?e="mixamo"===t?"mixamorig:LeftShoulder":"lCollar":"RightShoulder"==e||"shoulderR"==e||""==e?e="mixamo"===t?"mixamorig:RightShoulder":"rCollar":"LeftArm"==e||"upper_armL"==e||""==e?e="mixamo"===t?"mixamorig:LeftArm":"lShldr":"RightArm"==e||"upper_armR"==e||""==e?e="mixamo"===t?"mixamorig:RightArm":"rShldr":"LeftForeArm"==e||"forearmL"==e||""==e?e="mixamo"===t?"mixamorig:LeftForeArm":"lForeArm":"RightForeArm"==e||"forearmR"==e||""==e?e="mixamo"===t?"mixamorig:RightForeArm":"rForeArm":"LeftHand"==e||"handL"==e||""==e?e="mixamo"===t?"mixamorig:LeftHand":"lHand":"RightHand"==e||"handR"==e||""==e?e="mixamo"===t?"mixamorig:RightHand":"rHand":"thumb01L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandThumb1":e:"thumb02L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandThumb2":e:"thumb03L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandThumb3":e:"f_index01L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandIndex2":e:"f_index02L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandIndex3":e:"f_index03L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandIndex4":e:"f_middle01L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandMiddle2":e:"f_middle02L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandMiddle3":e:"f_middle03L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandMiddle4":e:"f_ring01L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandRing2":e:"f_ring02L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandRing3":e:"f_ring03L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandRing4":e:"f_pinky01L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandPinky2":e:"f_pinky02L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandPinky3":e:"f_pinky03L"==e||""==e?e="mixamo"===t?"mixamorig:LeftHandPinky4":e:"thumb01R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandThumb1":e:"thumb02R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandThumb2":e:"thumb03R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandThumb3":e:"f_index01R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandIndex2":e:"f_index02R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandIndex3":e:"f_index03R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandIndex4":e:"f_middle01R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandMiddle2":e:"f_middle02R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandMiddle3":e:"f_middle03R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandMiddle4":e:"f_ring01R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandRing2":e:"f_ring02R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandRing3":e:"f_ring03R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandRing4":e:"f_pinky01R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandPinky2":e:"f_pinky02R"==e||""==e?e="mixamo"===t?"mixamorig:RightHandPinky3":e:"f_pinky03R"!=e&&""!=e||(e="mixamo"===t?"mixamorig:RightHandPinky4":e),e},WMMD.prototype.findBoneTrack=function(e,t,i){e=this.findBoneRealName(e,i);for(var r,n,a,o=[],s=0;s<t.length;++s)n=(r=t[s].name).substring(r.indexOf("[")+1,r.indexOf("]")),a=r.substring(r.lastIndexOf(".")+1),e===n&&("position"===a?o[0]=s:o[1]=s);return o},WMMD.prototype.addHelper=function(){this.helper=new SkeletonHelper(this.model),window.WEngine.view.addVisual(this.helper)},WMMD.prototype.removeHelper=function(){null!=this.helper&&(window.WEngine.view.removeVisual(this.helper),this.helper=null)},WMMD.prototype.showSkeleton=function(e){e?this.addHelper():this.removeHelper()};var WUser=function(){var n=Object.assign(Object.create(EventDispatcher.prototype),{key:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],keyboard:{keyCodes:{16:"shift",17:"ctrl",32:"space",65:"a",68:"d",83:"s",87:"w",67:"c",70:"f",72:"h",90:"z",88:"x",81:"q",82:"r"},pressed:{},onKeyDown:function(e){var t=n.key;if(n.keyboard.pressed[n.keyboard.keyCodes[e.keyCode]]=!0,n.keyboard.pressed.ctrl&&n.keyboard.pressed.shift&&n.keyboard.pressed.d)return window.WEngine.showDebugPanel(!0),void e.preventDefault();switch(e.keyCode){case 65:t[0]=-1;break;case 68:t[0]=t[0]=1;break;case 87:t[1]=t[1]=-1;break;case 83:t[1]=t[1]=1;break;case 37:t[2]=-1;break;case 39:t[2]=1;break;case 38:t[3]=-1;break;case 40:t[3]=1;break;case 81:t[4]=-1;break;case 69:t[4]=1;break;case 67:t[5]=1;break;case 32:t[6]=1;break;case 16:t[7]=1;break;case 71:window.WEngine.sh_grid();break;case 72:t[9]=1}n.dispatchEvent({type:"onKeyDown",keyCode:e.keyCode}),e.preventDefault()},onKeyUp:function(e){var t=n.key;switch(n.keyboard.pressed[n.keyboard.keyCodes[e.keyCode]]=!1,e.keyCode){case 65:t[0]=t[0]<0?0:t[0];break;case 68:t[0]=0<t[0]?0:t[0];break;case 87:case 90:t[1]=t[1]<0?0:t[1];break;case 83:t[1]=0<t[1]?0:t[1];break;case 37:t[2]=t[2]<0?0:t[2];break;case 39:t[2]=0<t[2]?0:t[2];break;case 38:t[3]=t[3]<0?0:t[3];break;case 40:t[3]=0<t[3]?0:t[3];break;case 81:t[4]=t[4]<0?0:t[4];break;case 69:t[4]=0<t[4]?0:t[4];break;case 17:case 67:t[5]=0;break;case 32:t[6]=0;break;case 16:t[7]=0;break;case 72:t[9]=0}},getKey:function(){return n.key},setKeyFromBtns:function(e){var t=-1,i=e.key+":"+e.type;"A:down"==i?key[6]=1:"B:down"==i?t=82:"C:down"==i?t=70:"D:down"==i?key[9]=1:"A:up"==i?key[6]=0:"B:up"==i?t=82:"C:up"==i?t=70:"D:up"==i?key[9]=0:"Play:down"==i||"Play:up"==i&&(window.WEngine.run?window.WEngine.play(!1):window.WEngine.play(!0)),n.dispatchEvent("down"==e.type?{type:"onKeyDown",keyCode:t}:{type:"onKeyUp",keyCode:t})}},mouse:{mouseDown:!1,mouseWheelDown:!1,onPointerDownPointerX:0,onPointerDownPointerY:0,onMouseDown:function(e){n.mouse.onPointerDownPointerX=e.clientX,n.mouse.onPointerDownPointerY=e.clientY,n.mouse.mouseDown=!0,1==e.button&&(n.mouse.mouseWheelDown=!0)},onMouseUp:function(e){n.mouse.mouseDown=!1,1==e.button&&(n.mouse.mouseWheelDown=!1)},onMouseMove:function(e){n.mouse.mouseWheelDown&&(n.dispatchEvent({type:"updateCameraOffsetV",offset:(n.mouse.onPointerDownPointerX-e.clientX+(e.clientY-n.mouse.onPointerDownPointerY))/2*.1}),e.preventDefault())},onMousewheel:function(e){var t=e.wheelDelta||e.wheelDeltaY,i=0<t?"Up":"Down",r=Math.abs(t);n.dispatchEvent({type:"mousewheel",dir:i,vel:r}),e.preventDefault()}},init:function(){document.addEventListener("keydown",n.keyboard.onKeyDown,!1),document.addEventListener("keyup",n.keyboard.onKeyUp,!1),document.addEventListener("mousewheel",n.mouse.onMousewheel,!1),document.addEventListener("mousedown",n.mouse.onMouseDown,!1),document.addEventListener("mouseup",n.mouse.onMouseUp,!1),document.addEventListener("mousemove",n.mouse.onMouseMove,!1)},onKeyDown:function(){}});return n};window.THREE=THREE$1,window.TWEEN=TWEEN,window.world=window.world||{},window.world.scenes=window.world.scenes||{},window.WEngine=function(){Math.torad=Math.PI/180,Math.halfdegtorad=Math.PI/360,Math.radtodeg=180/Math.PI,Math.Pi=3.141592653589793,Math.TwoPI=6.283185307179586,Math.PI90=1.570796326794896,Math.PI270=4.712388980384689,Math.lerp=function(e,t,i){return e+(t-e)*i},Math.rand=function(e,t){return Math.lerp(e,t,Math.random())},Math.randInt=function(e,t,i){return+Math.lerp(e,t,Math.random()).toFixed(i||0)},Math.int=function(e){return~~e},Math.generateUUID=function(){var i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==e?t:7&t|8).toString(16)})},Math.vectorad=function(e){for(var t=e.length;t--;)e[t]*=Math.torad;return e},Math.perlin=null,Math.noise=function(e,t){null===Math.perlin&&(Math.perlin=new SimplexNoise);var i,r,n=(t=t||{}).level||[1,.2,.05],a=t.frequency||[.016,.05,.2],o=0,s=0;for(i=0;i<n.length;i++)r=a[i],o+=n[i]*(.5+.5*Math.perlin.noise3d(e.x*r,e.y*r,e.z*r)),s+=n[i];return o/=s};var _engine=Object.assign(Object.create(EventDispatcher.prototype),{run:!1,colors:{black:0,white:16777215,darkGreen:790292,green:1039244,brightGreen:10813330,cyan:3735001},ddlsOffset:new Vector3(0,0,0),moveObjNames:[],objects:[],compass:null,compassAngle:0,bvhReader:null,currentFollow:null,isShadow:!0,ddlsRender:null,enableWorldEvent:!0,addMoveObjName:function(e){_engine.moveObjNames.push(e),1==_engine.moveObjNames.length&&_engine.follow(e)},enableDDLSDebug:function(e){_engine.ddlsRender.show(e)},debugTell:function(e){_engine.gui.log(e)},statusTell:function(e){_engine.gui.tell(e)},showDebugPanel:function(e){_engine.gui.showDebugPanel(e)},follow:function(e){this.currentFollow=_engine.byName(e)},createRandomColor:function(){return Math.floor(Math.random()*(1<<24))},toRad:function(e){for(var t=e.length;t--;)e[t]*=Math.torad;return e},createColorMaterial:function(e){return new MeshPhongMaterial({color:e=e||this.createRandomColor()})}}),mmdHelper,isMMDLoaded=!1,isAmmoImport=!1,isTouch=!!("ontouchstart"in window),clock=new Clock,geo={},sounds={},actions={},labels=[],extraGeo=[],lightHelpers=[],heros=[],terrains=[],waters=[],statics=[],keys=[],keys_tmp=[],terrainData=null,content,contentMesh,raycaster,raycaster_compass,mouse,mouseCoords=new Vector2,driveSpeed=0,_gui,_user,_view,_physic,_phyinfo,showPhyinfo=!1,_ddlsworld,_ddlsRender,ddlsObj=[],ddlsHeros=[],axisHelper=null,clickMeasureEnabled=!1,sizeGroup=null,sizeDivs=[],tmpI=0,loadingManager=new LoadingManager;loadingManager.onProgress=function(e,t,i){_gui.showProcess(t,i,",..."),console.log("url=="+e)},loadingManager.onLoad=function(){_gui.hideProcess()};var bvhFileLoader=new FileLoader(loadingManager);bvhFileLoader.setResponseType("arraybuffer");var fileLoader=new FileLoader,audioLoader=new AudioLoader(loadingManager),fontLoader=new FontLoader(loadingManager);return _engine.getKeys=function(){keys_tmp=[],_engine.moveObjNames.forEach(function(e,t){keys_tmp.push(_engine.currentFollow&&e==_engine.currentFollow.name?_user.key:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}),keys=keys_tmp},_engine.showAmmoSkeleton=function(e){for(var t=heros.length;t--;)heros[t].userData.avatar.physicSkeleton&&heros[t].userData.avatar.physicSkeleton.showPhyBones(e)},_engine.playSounds=function(e){for(var t=_engine.objects.length;t--;){var i=_engine.objects[t];i.userData.hasOwnProperty("audios")&&i.userData.hasOwnProperty("defaudio")&&i.userData.audios[i.userData.defaudio].play()}},_engine.showHeroCapsule=function(e){for(var t=heros.length;t--;)heros[t].userData.capsule&&(heros[t].userData.capsule.visible=e)},_engine.showHero=function(e){for(var t=heros.length;t--;)heros[t].visible=e},_engine.updateHero=function(e){for(var t=heros.length;t--;)heros[t].userData.avatar.update(e)},_engine.changeHero=function(){var e;if(_view.camera==_view.cameraInObj)_view.camera=_view.cameraFree,_engine.follow(_engine.moveObjNames[e=0]);else if(null!=_engine.currentFollow){var t=_engine.moveObjNames.indexOf(_engine.currentFollow.name);_engine.moveObjNames.length<=(e=t+1)?null!=_view.cameraInObj.parent?(_view.camera=_view.cameraInObj,_engine.currentFollow=null):_engine.follow(_engine.moveObjNames[e=0]):_engine.follow(_engine.moveObjNames[e])}else _view.camera=_view.cameraInObj,_engine.currentFollow=null},_engine.showTerrain=function(e){for(var t=terrains.length;t--;)terrains[t].visible=e},_engine.showAxisHelper=function(e){axisHelper&&(axisHelper.visible=e)},_engine.enableClickMeasure=function(e){if(0==e&&null!=sizeGroup){for(var t=sizeDivs.length-1;0<=t;t--)sizeDivs[t].parentNode&&sizeDivs[t].parentNode.removeChild(sizeDivs[t]);sizeDivs=[];for(t=0;t<sizeGroup.children.length;t++)sizeGroup.remove(sizeGroup.children[t]);sizeGroup.parent.remove(sizeGroup),sizeGroup=null}clickMeasureEnabled=e},_engine.showPhysicInfo=function(e){showPhyinfo=e},_engine.getBBoxGeometry=function(e){var t=(new Box3).setFromObject(e);return new BoxGeometry(t.max.x-t.min.x,t.max.y-t.min.y,t.max.z-t.min.z)},_engine.getGeo=function(){return geo},_engine.generateTexture=function(e,t,i,r,n){var a,o,s,l,c,h,u,d;h=new Vector3(0,0,0),(u=_engine.sunLight.position.clone()).normalize(),(a=document.createElement("canvas")).width=i,a.height=r,(s=a.getContext("2d")).fillStyle="#000",s.fillRect(0,0,i,r);for(var p=0,m=0,f=(c=(l=s.getImageData(0,0,a.width,a.height)).data).length;p<f;p+=4,m++){h.x=(t[m-2]?t[m-2]:t[m])-(t[m+2]?t[m+2]:t[m]),h.y=2,h.z=(t[m-2*i]?t[m-2*i]:t[m])-(t[m+2*i]?t[m+2*i]:t[m]),h.normalize(),d=h.dot(u);for(var g=t[m]/e,v=0,y=0;y<n.length;y++)if(g<=n[y].ratio){v=n[y].color;break}var x=new Color(255,255,255);x.setHex(v),c[p]=255*x.r*d,c[p+1]=255*x.g*d,c[p+2]=255*x.b*d}s.putImageData(l,0,0),(o=document.createElement("canvas")).width=4*i,o.height=4*r,(s=o.getContext("2d")).scale(4,4),s.drawImage(a,0,0);for(p=0,f=(c=(l=s.getImageData(0,0,o.width,o.height)).data).length;p<f;p+=4){var _=~~(5*Math.random());c[p]+=_,c[p+1]+=_,c[p+2]+=_}return s.putImageData(l,0,0),o},_engine.create_terrainc=function(p){var m={type:"terrain",name:p.name,pos:p.position,size:p.size,sample:p.sample,complexity:p.complexity,flipEdge:p.flipEdge,hdt:p.hdt,friction:p.friction,restitution:p.restitution,group:p.group||1};m.sample=null==m.sample?[64,64]:m.sample,m.size=null==m.size?[100,10,100]:m.size,m.pos=null==m.pos?[0,0,0]:m.pos,m.lng=m.sample[0]*m.sample[1],m.hdata=new Float32Array(m.lng);var f=new PlaneBufferGeometry(m.size[0],m.size[2],m.sample[0]-1,m.sample[1]-1);f.rotateX(-Math.PI90);var g=f.attributes.position.array;WTextures.make({url:p.heightMapUrl,name:p.name+"_hmap",onLoad:function(e){var t=e.image,i=m.size[1],r=document.createElement("canvas");r.width=t.width,r.height=t.height;var n=r.getContext("2d");n.drawImage(t,0,0);for(var a=n.getImageData(0,0,t.width,t.height).data,o=0,s=0,l=a.length;s<l;s+=4){g[3*o+1]=m.hdata[o++]=(a[s]+a[s+1]+a[s+2])/3/255*i}var c=new Vector3(m.pos[0],m.pos[1],m.pos[2]);terrainData=new TerrainData(c,m.size[0],m.size[2],i,{type:"hdata",data:m.hdata},1,m.sample[0],m.sample[1]),p.hasOwnProperty("onTerrainObjects")&&_engine.createOnTerrainObjects(p,c,terrainData);var h=new CanvasTexture(_engine.generateTexture(m.size[1],m.hdata,m.sample[0],m.sample[1],p.colors));h.wrapS=ClampToEdgeWrapping,h.wrapT=ClampToEdgeWrapping,extraGeo.push(f);var u=new MeshPhongMaterial({map:h});BufferGeometryUtils.computeTangents(f);var d=new Mesh(f,u);d.userData={maxH:m.size[1],hdata:m.hdata,width:m.sample[0],height:m.sample[1],colors:p.colors},d.updateMaterial=function(e){this.material.map.image=_engine.generateTexture(this.userData.maxH,this.userData.hdata,this.userData.width,this.userData.height,this.userData.colors),this.material.map.needsUpdate=!0},d.position.set(m.pos[0],m.pos[1],m.pos[2]),d.castShadow=!1,d.receiveShadow=!0,terrains.push(d),m.mesh=d,_engine.add(m)}})},_engine.addObject=function(e,t){_engine.objects.push(e),t&&_view.addVisual(e)},_engine.createPlaneGeometry=function(e){if("string"==typeof e.pic)var t=WTextures.make({url:e.pic,name:e.name});else t=new CanvasTexture(e.pic);var i={map:t,side:FrontSide,transparent:e.transparent,opacity:e.opacity};e.blending&&(i.blending=AdditiveBlending);var r=new MeshBasicMaterial(i),n=new Mesh(new PlaneGeometry(e.width,e.height,1,1),r);return n.position.x=e.position.x,n.position.y=e.position.y,n.position.z=e.position.z,n.rotation.x=e.rotation.x,n.rotation.y=e.rotation.y,n.rotation.z=e.rotation.z,n},_engine.createGlasses=function(e){var t=_engine.createPlaneGeometry(e);_engine.addObject(t),e.rotation.y=Math.PI+e.rotation.y;var i=_engine.createPlaneGeometry(e);_engine.addObject(i,!0)},_engine.createHole=function(e,t){var i=1,r=e.thick||.4,n=((e.startDot.x||0)+(e.endDot.x||0))/2,a=((e.startDot.y||0)+(e.endDot.y||0))/2,o=((e.startDot.z||0)+(e.endDot.z||0))/2;e.startDot.z==e.endDot.z?(i=Math.abs(e.startDot.x-e.endDot.x),r=e.thick||.4):e.startDot.x==e.endDot.x&&(i=e.thick||.4,r=Math.abs(e.startDot.z-e.endDot.z));var s={size:[i,e.height||3,r],rotation:e.rotation,position:[n,a,o],uuid:e.uuid,name:e.name,style:{skinColor:9991439,skin:e.skin}},l=_engine.createCube(s,t);return l.userData={size:s.size,position:s.position},l},_engine.mergeModel=function(e,t,i,r){var n=new ThreeBSP(t),a=new ThreeBSP(i),o=null;if("-"==e)o=n.subtract(a);else if("+"==e)o=n.union(a);else{if("#"==e)return i.updateMatrix(),t.geometry.merge(i.geometry,i.matrix),t;if("&"!=e)return t;o=n.intersect(a)}var s=null;s=r.matname?_view.getMaterial(r.matname):new MeshPhongMaterial(r.style);var l=o.toMesh(s);return l.material.flatShading=!0,l.geometry.computeFaceNormals(),l.geometry.computeVertexNormals(),l.uuid=t.uuid+e+i.uuid,l.name=t.name+e+i.name,l.material.needsUpdate=!0,l.geometry.buffersNeedUpdate=!0,l.geometry.uvsNeedUpdate=!0,l.castShadow=!0,l.receiveShadow=!0,l},_engine.PointInPoly=function(e,t){for(var i=!1,r=-1,n=t.length,a=n-1;++r<n;a=r)(t[r].y<=e.y&&e.y<t[a].y||t[a].y<=e.y&&e.y<t[r].y)&&e.x<(t[a].x-t[r].x)*(e.y-t[r].y)/(t[a].y-t[r].y)+t[r].x&&(i=!i);return i},_engine.createCube=function(e,t){for(var i=e.size[0]||1e3,r=e.size[2]||i,n=e.size[1]||10,a=e.position[0]||0,o=e.position[1]||0,s=e.position[2]||0,l=e.style.skinColor||9991439,c=new BoxGeometry(i,n,r,0,0,1),h=0;h<c.faces.length;h+=2){var u=l||5445700*Math.random();c.faces[h].color.setHex(u),c.faces[h+1].color.setHex(u)}var d={vertexColors:FaceColors},p=d,m=d,f=d,g=d,v=d;null!=e.style&&void 0!==e.style&&null!=e.style.skin&&void 0!==e.style.skin&&(null!=e.style.skin.opacity&&void 0!==e.style.skin.opacity&&console.log(e.style.skin.opacity),d=_engine.createSkinOptionOnj(i,r,e.style.skin.skin_up,c,4),p=_engine.createSkinOptionOnj(i,r,e.style.skin.skin_down,c,6),m=_engine.createSkinOptionOnj(i,n,e.style.skin.skin_fore,c,0),f=_engine.createSkinOptionOnj(i,n,e.style.skin.skin_behind,c,2),g=_engine.createSkinOptionOnj(r,n,e.style.skin.skin_left,c,8),v=_engine.createSkinOptionOnj(r,n,e.style.skin.skin_right,c,10));var y=[];y.push(new MeshLambertMaterial(m)),y.push(new MeshLambertMaterial(f)),y.push(new MeshLambertMaterial(d)),y.push(new MeshLambertMaterial(p)),y.push(new MeshLambertMaterial(v)),y.push(new MeshLambertMaterial(g));var x=new Mesh(c,y);return x.castShadow=!0,x.receiveShadow=!0,x.uuid=e.uuid,x.name=e.name,t&&x.position.set(a,o,s),null!=e.rotation&&void 0!==e.rotation&&0<e.rotation.length&&e.rotation.forEach(function(e,t){switch(e.direction){case"x":x.rotateX(e.degree);break;case"y":x.rotateY(e.degree);break;case"z":x.rotateZ(e.degree);break;case"arb":x.rotateOnAxis(new Vector3(e.degree[0],e.degree[1],e.degree[2]),e.degree[3])}}),x},_engine.createEmptyCabinet=function(e){var t=e.size[0],i=e.size[1],r=e.size[2],n=e.size[3],a=_engine.createCube({show:!0,uuid:"",name:"",objType:"cube",size:[t+.01,n+.01,r],position:[.01,i/2-n/2,0],style:{skinColor:e.skin.skinColor,skin:e.skin.skin_up.skin}},!0),o=_engine.createCube({show:!0,uuid:"",name:"",objType:"cube",size:[t,i,n],position:[0,-(i/2-n/2),0-(r/2-n/2)-.01],style:{skinColor:e.skin.skinColor,skin:e.skin.skin_left.skin}},!0),s=_engine.mergeModel("#",a,o),l=_engine.createCube({show:!0,uuid:"",name:"",objType:"cube",size:[t,i,n],position:[0,-(i/2-n/2),r/2-n/2+.01],style:{skinColor:e.skin.skinColor,skin:e.skin.skin_right.skin}},!0);s=_engine.mergeModel("#",s,l);var c=_engine.createCube({show:!0,uuid:"",name:"",objType:"cube",size:[n,i,r],position:[t/2-n/2+.01,-(i/2-n/2),0],style:{skinColor:e.skin.skinColor,skin:e.skin.skin_behind.skin}},!0);s=_engine.mergeModel("#",s,c);var h=_engine.createCube({show:!0,uuid:"",name:"",objType:"cube",size:[t+.01,n,r],position:[-.01,-(i-n)-.01,0],style:{skinColor:e.skin.skinColor,skin:e.skin.skin_down.skin}},!0);s=_engine.mergeModel("#",s,h);var u=new Group;if((u.add(s),u.name=e.name,u.uuid=e.uuid,s.name=e.shellname,_engine.objects.push(s),null!=e.doors&&void 0!==e.doors)&&1==e.doors.skins.length){var d=_engine.createCube({show:!0,uuid:"",name:e.doors.doorname[0],objType:"cube",size:[n,i,r],position:[-t/2-n/2,0,0],style:{skinColor:e.doors.skins[0].skinColor,skin:e.doors.skins[0]}},!0);_engine.objects.push(d),u.add(d)}return null!=e.rotation&&void 0!==e.rotation&&0<e.rotation.length&&e.rotation.forEach(function(e,t){switch(e.direction){case"x":u.rotateX(e.degree);break;case"y":u.rotateY(e.degree);break;case"z":u.rotateZ(e.degree);break;case"arb":u.rotateOnAxis(new Vector3(e.degree[0],e.degree[1],e.degree[2]),e.degree[3])}}),u},_engine.createSkinOptionOnj=function(e,t,i,r,n){return _engine.commonFunc.hasObj(i)?_engine.commonFunc.hasObj(i.imgurl)?{map:_engine.createSkin(e,t,i),transparent:!0}:(_engine.commonFunc.hasObj(i.skinColor)&&(r.faces[n].color.setHex(i.skinColor),r.faces[n+1].color.setHex(i.skinColor)),{vertexColors:FaceColors}):{vertexColors:FaceColors}},_engine.createSkin=function(e,t,i){var r=128;null!=i.height&&void 0!==i.height&&(r=i.height);var n=WTextures.make({url:i.imgurl,name:i.name}),a=!1;return null!=i.repeatx&&void 0!==i.repeatx&&1==i.repeatx&&(n.wrapS=RepeatWrapping,a=!0),null!=i.repeaty&&void 0!==i.repeaty&&1==i.repeaty&&(n.wrapT=RepeatWrapping,a=!0),a&&n.repeat.set(e/r,t/r),n},_engine.commonFunc={hasObj:function(e){return null!=e&&void 0!==e},findObject:function(i){console.log("findObject");var r=null;return _engine.objects.forEach(function(e,t){if(null!=e.name&&""!=e.name&&e.name==i)return r=e,!0}),r},cloneByName:function(e,i){var t=_engine.commonFunc.findObject(e).clone();null!=t.children&&1<t.children.length&&t.children.forEach(function(e,t){e.name=i.childrenname[t],_engine.objects.push(e)}),t.name=i.name,t.uuid=i.uuid;var r=t.userData.size;return delete t.userData,t.userData={size:r},t},cloneObj:function(e,t){var i=_engine.commonFunc.cloneByName(e,t);return _engine.commonFunc.hasObj(t.position)&&(i.position.x=t.position.x,i.position.y=t.position.y,i.position.z=t.position.z),_engine.commonFunc.hasObj(t.scale)&&(i.scale.x=t.scale.x,i.scale.y=t.scale.y,i.scale.z=t.scale.z),_engine.commonFunc.hasObj(t.rotation)&&t.rotation.forEach(function(e,t){switch(e.direction){case"x":i.rotateX(e.degree);break;case"y":i.rotateY(e.degree);break;case"z":i.rotateZ(e.degree);break;case"arb":i.rotateOnAxis(new Vector3(e.degree[0],e.degree[1],e.degree[2]),e.degree[3])}}),i.name=t.name,i.uuid=t.uuid,i},addIdentification:function(e,t){var i=_engine.commonFunc.findObject(e),r=new Sprite(new SpriteMaterial({map:WTextures.make({url:t.imgurl,name:t.name}),useScreenCoordinates:!1}));r.name=t.name,r.position.x=i.position.x+t.position.x,r.position.y=i.position.y+t.position.y,r.position.z=i.position.z+t.position.z,_engine.commonFunc.hasObj(t.size)?r.scale.set(t.size.x,t.size.y):r.scale.set(1,1),_engine.addObject(r)},makeTextSprite:function(e,t){void 0===t&&(t={});var i=t.hasOwnProperty("fontface")?t.fontface:"Arial",r=t.hasOwnProperty("fontsize")?t.fontsize:18,n=t.hasOwnProperty("borderThickness")?t.borderThickness:4,a=t.hasOwnProperty("textColor")?t.textColor:{r:0,g:0,b:0,a:1},o=t.hasOwnProperty("message")?t.message:"",s=t.hasOwnProperty("position")?t.position.x:0,l=t.hasOwnProperty("position")?t.position.y:0,c=t.hasOwnProperty("position")?t.position.z:0,h=document.createElement("canvas"),u=h.getContext("2d");u.font="Bold "+r+"px "+i;var d=u.measureText(o);h.width=d.width,h.height=r+2*n,u.lineWidth=n,u.fillStyle="rgba("+a.r+", "+a.g+", "+a.b+", 1.0)",u.fillText(o,n,r+n);var p=new Texture(h);p.needsUpdate=!0;var m=new Sprite(new SpriteMaterial({map:p})),f=_engine.commonFunc.findObject(e);null!=f&&null==t.parent?(m.position.x=f.position.x+s,m.position.y=f.position.y+l,m.position.z=f.position.z+c):(m.position.x=s,m.position.y=l,m.position.z=c),m.name=t.name,m.scale.set(.01*h.width,.01*h.height,1),t.parent?t.parent.add(m):_engine.addObject(m)}},_engine.has=function(e){return _physic.has(e)},_engine.byName=function(e){return _physic.byName(e)},_engine.add=function(e){e.mass=null==e.mass?0:e.mass,e.type=null==e.type?"box":e.type,0==e.mass&&"character"!=e.type&&(e.group=2),e.position&&(e.pos=e.position,delete e.position),e.pos=null==e.pos?[0,0,0]:e.pos,"pathfindzone"!=e.name&&(e.pos=_engine.offsetPos(e.pos?e.pos:[0,0,0]));var t,i=e.rot=null==e.rot?[0,0,0]:e.rot,r=null!=e.size||null!=e.blockSize;e.size=null==e.size?[1,1,1]:e.size,1==e.size.length?e.size[1]=e.size[0]:2==e.size.length&&(e.size[2]=e.size[0]),e.geoSize&&(1==e.geoSize.length&&(e.geoSize[1]=e.geoSize[0]),2==e.geoSize.length&&(e.geoSize[2]=e.geoSize[0])),2===e.flag?t=_view.getMaterial("kinect"):void 0!==e.material?t=e.material.constructor===String?"random"==e.material?_engine.createColorMaterial():_view.getMaterial(e.material):e.material:(t=_view.getMaterial(0!==e.mass||e.kinematic?"move":"static"),e.kinematic&&(t=_view.getMaterial("kinematic"))),e.material=t;var n=_physic.add(e);if(e.roadblock){var a=null==e.blockSize?e.size:e.blockSize;if(r)ddlsObj[ddlsObj.length]=_ddlsworld.addObject({x:e.pos[0],y:e.pos[2],w:.5*a[0],h:.5*a[2],r:i[1]});else{var o=(new Box3).setFromObject(n);ddlsObj[ddlsObj.length]=_ddlsworld.addObject({x:e.pos[0],y:e.pos[2],w:.5*(o.max.x-o.min.x),h:.5*(o.max.z-o.min.z),r:i[1]})}}return n},_engine.addGroup=function(e){for(var t=0;t<e.length;t++)"pathfindzone"!=e[t].name&&(e[t].pos=_engine.offsetPos(e[t].pos?e[t].pos:[0,0,0]));_physic.addGroup(e)},_engine.options=function(e,t){_physic.options(e,t)},_engine.offsetPos=function(e){return[e[0]+_engine.ddlsOffset.x,e[1]+_engine.ddlsOffset.y,e[2]+_engine.ddlsOffset.z]},_engine.create_custom=function(e){e.customFunc(_engine)},_engine.create_superSky=function(e){var i,r={t:0,fog:0,cloud_size:.45,cloud_covr:.3,cloud_dens:40,inclination:45,azimuth:90,hour:12};i=new SuperSky({scene:_view.scene,renderer:_view.renderer,size:100,callback:function(){i.setData(r);for(var e=terrains.length;e--;)terrains[e].material.envMap=i.envMap,terrains[e].borderMaterial.envMap=i.envMap;for(var t=waters.length;t--;)waters[t].material.uniforms.sunDirection.value.copy(0<i.day?i.sunPosition:i.moonPosition),waters[t].material.uniforms.sunColor.value=0<i.day?i.sun.color:i.moon.color}}),_view.addVisual(i),statics.push(i)},_engine.create_sky=function(e){var t=new Sky;t.scale.setScalar(45e4),_engine.sky=t;var i=new Mesh(new SphereBufferGeometry(2e4,16,8),new MeshBasicMaterial({color:16777215}));i.position.y=-7e5,i.visible=e.sunVisible,_view.scene.add(_engine.sunSphere=i),statics.push(i);var r=t.material.uniforms;r.turbidity.value=10,r.rayleigh.value=2,r.luminance.value=1,r.mieCoefficient.value=.005,r.mieDirectionalG.value=.8,this.sunLight=new DirectionalLight(16777215,1),this.sunLight.castShadow=!0,this.sunLight.shadow.camera.near=e.shadowCamera.near,this.sunLight.shadow.camera.far=e.shadowCamera.far,this.sunLight.shadow.camera.left=e.shadowCamera.left,this.sunLight.shadow.camera.right=e.shadowCamera.right,this.sunLight.shadow.camera.top=e.shadowCamera.top,this.sunLight.shadow.camera.bottom=e.shadowCamera.bottom,this.sunLight.shadow.mapSize.x=e.shadowMapSize[0],this.sunLight.shadow.mapSize.y=e.shadowMapSize[1],this.sunLight.shadow.bias=-.003,this.sunLight.position.y=-e.distance,this.sunLight.distance=e.distance,_engine.has("pathfindzone")?this.sunLight.target=_engine.byName("pathfindzone"):this.sunLight.target.position.set(0,0,0),_view.addVisual(this.sunLight);var n=new DirectionalLightHelper(this.sunLight,10);n.visible=!1,lightHelpers.push(n),_view.addVisual(n),_engine.objects.push(this.sunSphere),_engine.objects.push(this.sunLight),_engine.objects.push(n),_engine.setHour(e.hour)},_engine.create_compass=function(e){WTextures.make({url:e.texture.url,name:e.name,onLoad:function(e){var t=new SpriteMaterial({map:e,opacity:1});_engine.compass=new Sprite(t);var i=t.map.image.width,r=t.map.image.height;_engine.compass.scale.set(i,r,1),_engine.compass.position.set(-window.innerWidth/2+i/2,window.innerHeight/2-r/2,0),_view.sceneRenderHUDSprite.add(_engine.compass);_engine.scene.loopFunctions.push(function(){t.rotation=_engine.compassAngle})}})},_engine.create_fog=function(e){_view.addFog(e)},_engine.create_snow=function(e){var t,i,r,n,a,o=[];i=new Geometry;var s=WTextures.make({url:"sprites/snowflake1.png",name:"snowflake1"}),l=WTextures.make({url:"sprites/snowflake2.png",name:"snowflake2"}),c=WTextures.make({url:"sprites/snowflake3.png",name:"snowflake3"}),h=WTextures.make({url:"sprites/snowflake4.png",name:"snowflake4"}),u=WTextures.make({url:"sprites/snowflake5.png",name:"snowflake5"});for(n=0;n<1e4;n++){var d=new Vector3;d.x=Math.random()*e.size[0]-.5*e.size[0],d.y=Math.random()*e.size[1]-.5*e.size[1],d.z=Math.random()*e.size[2]-.5*e.size[2],i.vertices.push(d)}for(r=[[[1,.2,.5],l,.2],[[.95,.1,.5],c,.15],[[.9,.05,.5],s,.1],[[.85,0,.5],u,.08],[[.8,0,.5],h,.05]],n=0;n<r.length;n++)a=r[n][0],o[n]=new PointsMaterial({size:r[n][2],map:r[n][1],blending:AdditiveBlending,depthTest:!1,transparent:!0}),o[n].color.setHSL(a[0],a[1],a[2]),(t=new Points(i,o[n])).rotation.x=6*Math.random(),t.rotation.y=6*Math.random(),t.rotation.z=6*Math.random(),_view.addVisual(t),statics.push(t);_engine.scene.loopFunctions.push(function(){var e=5e-5*Date.now();for(n=0;n<_view.scene.children.length;n++){var t=_view.scene.children[n];t instanceof Points&&(t.rotation.y=e*(n<4?n+1:-(n+1)))}for(n=0;n<o.length;n++)o[n].color.setHSL(360*((a=r[n][0])[0]+e)%360/360,a[1],a[2])})},_engine.create_terrain=function(n){var a={type:n.type,terrainType:n.terrainType,name:n.name,pos:n.position,size:n.size,sample:n.sample,frequency:n.frequency,level:n.level,expo:n.expo||0,hdt:n.hdt||"PHY_FLOAT",friction:n.friction||.5,bounce:n.bounce||0,water:n.water||!1,border:n.border||!0,bottom:n.bottom||!0,heightMapUrl:n.heightMapUrl,maxSpeed:n.maxSpeed||.02,physicsUpdate:function(e,t,i){var r=new Vector3(a.pos[0],a.pos[1],a.pos[2]);terrainData=new TerrainData(r,a.size[0],a.size[2],a.size[1],{type:"hdata",data:t},1,a.sample[0],a.sample[1]),n.hasOwnProperty("onTerrainObjects")&&_engine.createOnTerrainObjects(n,r,terrainData)}},e=_engine.add(a);terrains.push(e)},_engine.create_water=function(e){var t=new PlaneBufferGeometry(e.size[0],e.size[1]);if("ocean"==e.waterType){var i={textureWidth:512,textureHeight:512,waterNormals:_view.texture({url:"water/waternormals.jpg",name:"waternormals",repeat:[2,2],anisotropy:16}),alpha:.5,sunDirection:_engine.sunLight.position.clone().normalize(),sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==_view.scene.fog},r=new Water(t,i);r.rotation.x=-Math.PI/2,r.position.set(e.position[0],e.position[1],e.position[2]),r.position.add(_engine.ddlsOffset),r.castShadow=!0,r.receiveShadow=!0,_view.addVisual(r),waters.push(r),statics.push(r);_engine.scene.loopFunctions.push(function(){r.material.uniforms.time.value+=1/60})}else if("water"==e.waterType){var n=new Water$1(t,{color:"#ffffff",scale:4,flowDirection:new Vector2(1,1),textureWidth:512,textureHeight:512});n.rotation.x=-Math.PI/2,n.position.set(e.position[0],e.position[1],e.position[2]),n.position.add(_engine.ddlsOffset),n.castShadow=!0,n.receiveShadow=!0,_view.addVisual(n),waters.push(n),statics.push(n)}},_engine.create_rollercoaster=function(e){var r,t,i=(r=new Vector3,{getPointAt:e.getPointAt,getTangentAt:function(e){var t=Math.max(0,e-1e-4),i=Math.min(1,e+1e-4);return r.copy(this.getPointAt(i)).sub(this.getPointAt(t)).normalize()}});(t=new Mesh(new RollerCoasterGeometry(i,e.segments[0]),new MeshStandardMaterial({roughness:.1,metalness:0,vertexColors:VertexColors}))).castShadow=!0,_view.addVisual(t),statics.push(t),e.haslifter&&((t=new Mesh(new RollerCoasterLiftersGeometry(i,e.segments[1],e.nolifter),new MeshStandardMaterial({roughness:.1,metalness:0}))).position.y=.1,t.castShadow=!0,_view.addVisual(t),statics.push(t));var n=new Object3D;n.halfExtent={x:0,y:0,z:0},n.add(_view.cameraInObj),_view.addVisual(n),statics.push(n);var a=new Vector3,o=new Vector3,s=new Vector3,l=0,c=0;_engine.scene.loopFunctions.push(function(e){var t=e*driveSpeed;c+=l*t,a.copy(i.getPointAt(c%=1)),a.y+=3*.1,n.position.copy(a),o.copy(i.getTangentAt(c)),l-=15e-7*o.y*t,l=Math.max(l,4e-5),n.lookAt(s.copy(a).sub(o))})},_engine.create_plane=function(e){_engine.add({type:"plane",name:e.name||Math.generateUUID(),mass:e.mass,pos:e.position,rot:e.rot,group:e.group||1,friction:.5,restitution:.9})},_engine.create_box=_engine.create_hardbox=function(e){if(e.hasOwnProperty("conFunc"))for(var t=e.conFunc(_engine),i=0,r=t.length;i<r;i++)_engine.add(t[i]);else if(e.hasOwnProperty("positions"))for(i=0,r=e.positions.length;i<r;i++){var n=e.rot||[0,0,0];_engine.add({type:e.type,name:Math.generateUUID(),roadblock:e.roadblock,size:e.size,mass:e.mass,pos:e.positions[i],sounds:e.sounds||null,rot:[n[0],n[1],n[2]],group:e.group||1,breakable:e.breakable||!1,breakOption:void 0!==e.breakOption?e.breakOption:[250,1,2,1],friction:.5,restitution:.9,material:e.material})}else _engine.add({type:e.type,name:e.name||Math.generateUUID(),roadblock:e.roadblock,size:e.size,mass:e.mass,pos:e.position,sounds:e.sounds||null,rot:e.rot,group:e.group||1,breakable:e.breakable||!1,breakOption:void 0!==e.breakOption?e.breakOption:[250,1,2,1],friction:.5,restitution:.9,material:e.material})},_engine.create_sphere=function(e){_engine.add({type:"sphere",name:e.name||Math.generateUUID(),roadblock:e.roadblock,size:[e.radius],mass:e.mass,pos:e.position,sounds:e.sounds||null,group:e.group||1,state:4,friction:.4,restitution:.9,material:e.material})},_engine.create_convex=function(e){_engine.add({type:"convex",name:e.name||Math.generateUUID(),roadblock:e.roadblock,blockSize:e.blockSize,v:e.pointsfun(),shape:new ConvexBufferGeometry(e.pointsfun()),mass:e.mass,pos:e.position,rot:e.rot,group:e.group||1,breakable:e.breakable||!1,state:4,friction:.4,restitution:.9,material:e.material})},_engine.getMeshAndGeo=function(e){var t,i;if(null!=(t=e.modelName?_view.getModel(e.modelName):_view.getMesh(e.meshName))){if(t.isMesh)i=t.geometry;else{var r=[];t.traverse(function(e){if(e.isMesh){e.castShadow=!0,e.receiveShadow=!0,e.material.alphaTest=.1,e.material.envMap=_view.getEnvmap(),e.material.envMapIntensity=1.5;var t=e.geometry.clone();t.applyMatrix4((new Matrix4).makeScale(e.scale.x,e.scale.y,e.scale.z)),t.applyMatrix4((new Matrix4).makeRotationFromQuaternion(e.quaternion)),r.push(t)}}),i=BufferGeometryUtils.mergeBufferGeometries(r,!0)}return{mesh:t,geo:i}}alert(":"+e.meshName+"")},_engine.create_model=function(e){var t=_engine.getMeshAndGeo(e),i=t.mesh,r=t.geo;if(e.hasOwnProperty("positions"))for(var n=0;n<e.positions.length;n++){var a=i.clone();(l=r.clone()).applyMatrix4((new Matrix4).makeScale(a.scale.x,a.scale.y,a.scale.z)),l.applyMatrix4((new Matrix4).makeRotationFromQuaternion(a.quaternion)),e.scale&&(a.scale.fromArray([a.scale.x*e.scale[0],a.scale.y*e.scale[1],a.scale.z*e.scale[2]]),l.applyMatrix4((new Matrix4).makeScale(e.scale[0],e.scale[1],e.scale[2]))),e.rot=e.rot||[0,0,0];var o=[e.rot[0],e.rot[1],e.rot[2]],s={type:"mesh",name:Math.generateUUID(),roadblock:e.roadblock,shape:l,mass:e.mass,pos:e.positions[n],rot:o,friction:.4,receiveShadow:e.receiveShadow,castShadow:e.castShadow};e.debug||(s.mesh=a),_engine.add(s)}else{var l;a=i.clone();(l=r.clone()).applyMatrix4((new Matrix4).makeScale(a.scale.x,a.scale.y,a.scale.z)),l.applyMatrix4((new Matrix4).makeRotationFromQuaternion(a.quaternion)),e.scale&&(a.scale.fromArray([a.scale.x*e.scale[0],a.scale.y*e.scale[1],a.scale.z*e.scale[2]]),l.applyMatrix4((new Matrix4).makeScale(e.scale[0],e.scale[1],e.scale[2])));s={type:"mesh",name:e.name||Math.generateUUID(),roadblock:e.roadblock,shape:l,mass:e.mass,pos:e.position,rot:e.rot,friction:.4,receiveShadow:e.receiveShadow,castShadow:e.castShadow};e.debug||(s.mesh=a),_engine.add(s)}},_engine.create_gun=function(e){var t=_view.getMesh(e.meshName).clone(),i=_view.getGeometry(e.meshName).clone();e.scale&&(t.scale.fromArray(e.scale),i.applyMatrix4((new Matrix4).makeScale(e.scale[0],e.scale[1],e.scale[2])));var r=_engine.add({type:"mesh",mesh:t,geoSize:e.geoSize,name:e.name||Math.generateUUID(),roadblock:e.roadblock,shape:i,mass:e.mass,pos:e.position,rot:e.rot,friction:.4,receiveShadow:e.receiveShadow,castShadow:e.castShadow}),n=new Group;n.position.set(e.muzzle[0],e.muzzle[1],e.muzzle[2]),r.add(n);var a=new Group;a.position.set(e.muzzle[0]-.1,e.muzzle[1],e.muzzle[2]),r.add(a),r.userData.muzzle=n,r.userData.muzzleBack=a},_engine.create_softRope=_engine.create_softCloth=_engine.create_softMesh=function(e){_engine.add(e)},_engine.create_anchor=function(e){_physic.anchor(e)},_engine.create_joint_hinge=function(e){_engine.add(e);_engine.byName(e.body2).userData.lock=e.lock},_engine.create_car=function(e){for(var t=e.conFunc(_engine),i=0,r=t.length;i<r;i++){var n=_engine.add(t[i]);_engine.addMoveObjName(n.name)}},_engine.create_text3D=function(t){function i(e){var t=new TextGeometry(e.text,{size:e.size,height:e.height,curveSegments:e.curveSegments,font:_engine.font3d}),i=[new MeshBasicMaterial({color:e.colors[0],side:DoubleSide}),new MeshBasicMaterial({color:e.colors[1],side:DoubleSide})];_engine.centerPosition(t,[1,1,1]);var r=[e.position[0]+_engine.ddlsOffset.x,e.position[1]+_engine.ddlsOffset.y,e.position[2]+_engine.ddlsOffset.z];_physic.add({type:"mesh",name:e.name||Math.generateUUID(),roadblock:e.roadblock,shape:t,material:i,mass:e.mass,pos:r,rot:e.rot,friction:.4,receiveShadow:e.receiveShadow,castShadow:e.castShadow})}_engine.font3d?i(t):fontLoader.load("./assets/fonts/REEJI-JinGang-ExtraBoldGB1.0_Regular.json",function(e){_engine.font3d=e,i(t)})},_engine.create_cube=function(e){var t=_engine.createCube(e,!1);_engine.objects.push(t);_engine.add({type:"box",name:e.name||Math.generateUUID(),size:e.size,mass:0,pos:e.position,rot:e.rot,mesh:t,group:e.group||1,breakable:e.breakable||!1,friction:.5,restitution:.9,material:e.material})},_engine.create_floor=function(e){var t=_engine.createCube(e,!1);_engine.objects.push(t);_engine.add({type:"box",name:e.name||Math.generateUUID(),size:e.size,mass:0,pos:e.position,rot:e.rot,mesh:t,group:e.group||1,breakable:e.breakable||!1,friction:.5,restitution:.9})},_engine.create_wall=function(m){var f=m.thick||40,g=m.length||100,v=m.height||300,y=m.style.color||9991439;m.wallData.forEach(function(e,t){for(var i=g,r=e.thick||f,n=e.path,a=null,o=0,s=n.length;o<s-1;o++){var l=n[o],c=n[o+1],h=((l[0]||0)+(c[0]||0))/2,u=((l[1]||0)+(c[1]||0))/2,d=((l[2]||0)+(c[2]||0))/2;l[2]==c[2]?(i=Math.abs(l[0]-c[0])+e.thick,r=e.thick||f):l[0]==c[0]&&(i=e.thick||f,r=Math.abs(l[2]-c[2])+e.thick);var p=_engine.createCube({size:[i,e.height||v,r],position:[h,u,d],uuid:e.uuid,name:e.name,style:{skinColor:y,skin:e.skin}},!0);a=null==a?p:_engine.mergeModel("+",a,p,{matname:m.matname,skincolor:y,path:n,skin:m.skin})}_engine.commonFunc.hasObj(e.childrens)&&0<e.childrens.length&&e.childrens.forEach(function(e,t){var i=null;e.op?(i=_engine.createHole(e,!0),a=_engine.mergeModel(e.op,a,i,{matname:m.matname,skincolor:y})):(i=_engine.createHole(e,!1),_physic.add({type:"box",mesh:i,name:e.name||Math.generateUUID(),size:i.userData.size,mass:e.mass||0,pos:i.userData.position,group:1,breakable:!1,friction:e.friction||.5,restitution:e.restitution||.9,material:"basic"}))}),a.geometry=(new BufferGeometry).fromGeometry(a.geometry),_physic.add({type:"mesh",shape:a.geometry,mesh:a,name:e.name,mass:0,pos:[a.position.x,a.position.y,a.position.z],group:1,breakable:!1,friction:.5,restitution:.9})})},_engine.create_planex=function(e){var t=_engine.createPlaneGeometry(e);_engine.addObject(t,!0)},_engine.create_glasses=function(e){_engine.createGlasses(e)},_engine.create_emptyCabinet=function(e){var t=_engine.createEmptyCabinet(e);t.userData={size:e.size},_engine.addObject(t),_engine.add({type:"box",name:e.name||Math.generateUUID(),size:e.size,mass:0,pos:e.position,rot:e.rot,mesh:t,group:e.group||1,breakable:e.breakable||!1,friction:.5,restitution:.9,material:e.material})},_engine.create_cloneObj=function(e){if(e.hasOwnProperty("conFunc"))for(var t=e.conFunc(_engine),i=0,r=t.length;i<r;i++){var n=t[i],a=_engine.commonFunc.cloneByName(t[i].copyfrom,n);_engine.add({type:"box",name:n.name||Math.generateUUID(),size:a.userData.size,mass:0,pos:n.position,rot:n.rot,mesh:a,group:n.group||1,breakable:n.breakable||!1,friction:.5,restitution:.9,material:n.material})}else{a=_engine.commonFunc.cloneByName(e.copyfrom,e);_engine.add({type:"box",name:e.name||Math.generateUUID(),size:a.userData.size,mass:0,pos:e.position,rot:e.rot,mesh:a,group:e.group||1,breakable:e.breakable||!1,friction:.5,restitution:.9,material:e.material})}},_engine.createObject=function(e){"pathfindzone"==e.name&&(_ddlsworld.reset(e.size[0],e.size[2]),_engine.ddlsOffset.set(.5*e.size[0],0,.5*e.size[2]),e.position=[e.position[0]+.5*e.size[0],e.position[1],e.position[2]+.5*e.size[2]]),_engine["create_"+e.type](e)},_engine.createOnTerrainObjects=function(e,t,i){for(var r=ShaderExtras.png.vertexShader,n=ShaderExtras.png.fragmentShader,a=0,o=e.onTerrainObjects.length;a<o;a++){var s=e.onTerrainObjects[a];switch(s.type){case"plant":var l=null;if(s.hasOwnProperty("tuft")){var c=s.tuft;l=new Array(c);for(var h=0;h<c;h++){(p=new Vector3).x=.5<Math.random()?Math.random()*s.randompos.max[1]:Math.random()*s.randompos.max[0],p.z=p.x<=s.randompos.min[0]||s.randompos.min[1]<=p.x?2*(Math.random()-.5)*s.randompos.max[3]:.5<Math.random()?Math.random()*(s.randompos.max[3]-s.randompos.min[3])+s.randompos.min[3]:Math.random()*(s.randompos.max[2]-s.randompos.min[2])+s.randompos.min[2],p.x+=t.x,p.z+=t.z,p.y=i.getHeightAt(p.x,p.z,!0),l[h]=p}}else if(s.hasOwnProperty("positions")){var u=s.positions;l=new Array(u.length);h=0;for(var d=u.length;h<d;h++){var p;(p=new Vector3).x=u[h][0]+t.x,p.z=u[h][2]+t.z,p.y=i.getHeightAt(p.x,p.z,!0)+u[h][1],l[h]=p}}var m,f=new MeshPhongMaterial({specular:197379,map:m=WTextures.make({url:s.image,name:s.name}),alphaTest:.5}),g=PlantTufts.create(l,s.size,f);g.castShadow=!0,g.customDepthMaterial=new ShaderMaterial({uniforms:{texture:{value:m}},vertexShader:r,fragmentShader:n}),_view.addVisual(g)}}},_engine.switchLightHelper=function(e){for(var t=0;t!=lightHelpers.length;t++)lightHelpers[t].visible=e},_engine.switchLightHelper=function(e){for(var t=0;t!=lightHelpers.length;t++)lightHelpers[t].visible=e},_engine.create_light=function(e){if("AmbientLight"==e.lightType){var t=new AmbientLight(e.color,e.intensity);_view.scene.add(t),_engine.objects.push(t)}else if("DirectionalLight"==e.lightType){(t=new DirectionalLight(e.color,e.intensity)).castShadow=!0,t.shadow.camera.near=e.shadowCamera.near,t.shadow.camera.far=e.shadowCamera.far,t.shadow.camera.left=e.shadowCamera.left,t.shadow.camera.right=e.shadowCamera.right,t.shadow.camera.top=e.shadowCamera.top,t.shadow.camera.bottom=e.shadowCamera.bottom,t.shadow.mapSize.x=e.shadowMapSize[0],t.shadow.mapSize.y=e.shadowMapSize[1],t.shadow.bias=-.003,t.position.set(e.position[0],e.position[1],e.position[2]),t.position.add(_engine.ddlsOffset),t.target.position.set(20,2,20),_view.addVisual(t);var i=new DirectionalLightHelper(_engine.sunLight=t,10);i.visible=!1,lightHelpers.push(i),_view.addVisual(i),_engine.objects.push(t),_engine.objects.push(i)}else if("SpotLight"==e.lightType){(t=new SpotLight(16777215,1,0,Math.PI/5,.3)).position.set(e.position[0],e.position[1],e.position[2]),t.target.position.set(0,0,0),t.castShadow=!0,t.shadow.camera.near=e.shadowCamera.near,t.shadow.camera.far=e.shadowCamera.far,t.shadow.bias=1e-4,t.shadow.mapSize.width=e.shadowMapSize[0],t.shadow.mapSize.height=e.shadowMapSize[1];var r=new SpotLightHelper(t);r.visible=!1,lightHelpers.push(r),_view.addVisual(t),_view.addVisual(r),_engine.objects.push(t),_engine.objects.push(r)}},_engine.setHour=function(e){if(_engine.sky){var t=15*e-90,i=400,r=Math.PI*((t-270)/360+(90+t)/360-.5),n=2*Math.PI*(.25-.5);_engine.sunSphere.position.x=i*Math.cos(n),_engine.sunSphere.position.y=i*Math.sin(n)*Math.sin(r),_engine.sunSphere.position.z=i*Math.sin(n)*Math.cos(r),_engine.sky.material.uniforms.sunPosition.value.copy(_engine.sunSphere.position),_engine.sunLight&&(_engine.sunLight.position.x=_engine.sunLight.distance*Math.cos(n),_engine.sunLight.position.y=_engine.sunLight.distance*Math.sin(n)*Math.sin(r),_engine.sunLight.position.z=_engine.sunLight.distance*Math.sin(n)*Math.cos(r),_engine.sunLight.position.add(_engine.ddlsOffset)),_engine.updateMaterialsBySky()}},_engine.updateMaterialsBySky=function(){_view.setEnvMapRenderTarget(_engine.sky);for(var e=terrains.length;e--;)terrains[e].updateMaterial&&terrains[e].updateMaterial(),terrains[e].material.envMap=_view.getEnvmap();for(var t=waters.length;t--;)waters[t].material.uniforms.sunDirection&&waters[t].material.uniforms.sunDirection.value.copy(_engine.sunLight.position).normalize()},_engine.create_avatar=function(e){var t=new WAvatar(e),i={type:"character",ename:e.ename,debug:!0,avatar:t,size:e.size||t.size,pos:e.position,group:1,quat:[0,0,0]};_engine.add(i),e.hasOwnProperty("sounds")&&_engine.addSound(_view.audioListener,t.model.parent,e.sounds),heros.push(t.model.parent),_engine.addMoveObjName(e.ename),labels.push(t.addNameLabel());var r=_ddlsworld.addHeroe({x:i.pos[0],y:i.pos[2],r:i.size[0],speed:1/35});r.mesh=t.model.parent,r.mesh.userData.index=ddlsHeros.length,r.mesh.userData.findPath=!1,r.mesh.userData.findPathCallBack=function(){},ddlsHeros.push(r)},_engine.create_animal=function(e){function t(e,t,i){var r=new WAnimal(e),n={type:"character",ename:e.ename+i,debug:!0,avatar:r,size:e.size||r.size,pos:t,group:1,quat:[0,0,0]};_engine.add(n),e.hasOwnProperty("sounds")&&_engine.addSound(_view.audioListener,r.model.parent,e.sounds),heros.push(r.model.parent),_engine.addMoveObjName(n.ename),labels.push(r.addNameLabel());var a=_ddlsworld.addHeroe({x:n.pos[0],y:n.pos[2],r:n.size[0],speed:1/35});a.mesh=r.model.parent,a.mesh.userData.index=ddlsHeros.length,a.mesh.userData.findPath=!1,a.mesh.userData.findPathCallBack=function(){},ddlsHeros.push(a)}if(e.positions)for(var i=0;i<e.positions.length;i++)t(e,e.positions[i],i);else t(e,e.position,1)},_engine.create_avatar_mmd=function(e){var t=new WMMD(e);if(e.useCharacter){var i={type:"character",ename:e.ename,debug:!0,avatar:t,size:e.size||t.size,pos:e.position,group:16,quat:[0,0,0]};_engine.add(i);e.physicBody&&t.initPhysicSkeleton(),e.hasOwnProperty("sounds")&&_engine.addSound(_view.audioListener,t.mmd.parent,e.sounds),heros.push(t.model.parent),_engine.addMoveObjName(e.ename),labels.push(t.addNameLabel());var r=_ddlsworld.addHeroe({x:i.pos[0],y:i.pos[2],r:i.size[0],speed:1/35});r.mesh=t.model.parent,r.mesh.userData.index=ddlsHeros.length,r.mesh.userData.findPath=!1,r.mesh.userData.findPathCallBack=function(){},ddlsHeros.push(r)}else t.model.position.set(0,0,0),_view.scene.add(t.model),e.physicBody&&t.initPhysicSkeleton(),_engine.scene.loopFunctions.push(function(e){t.playAction("idle"),t.update(e)})},_engine.doCreate_mmd_chars=function(e){if(e.refCameraAction){var t=_view.getMMDAnimation(e.refCameraAction,_view.camera);mmdHelper.add(_view.camera,{animation:t})}for(var i=0;i<e.characters.length;i++)_engine.doCreate_mmd_char(e,e.characters[i]);isMMDLoaded=!0},_engine.doCreate_mmd_char=function(e,t){var i=_view.getModel(t.ename);i.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.material.alphaTest=.1)}),t.usePhongMat&&(i.material=function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=new MeshPhongMaterial;n.copy(e[i]),n.needsUpdate=!0,n.envMap=_view.getEnvmap(),t.push(n)}return t}(i.material)),i.position.set(t.position[0],t.position[1],t.position[2]),t.scale&&i.scale.fromArray([t.scale,t.scale,t.scale]),_view.addVisual(i);var r=_view.getMMDAnimation(e.refAction,i);if(mmdHelper.add(i,{animation:r,physics:e.physicBody}),t.ikHelper){var n=mmdHelper.objects.get(i).ikSolver.createHelper();n.visible=!0,_view.addVisual(n)}if(e.physicBody&&t.physicsHelper){var a=mmdHelper.objects.get(i).physics.createHelper();a.visible=!0,_view.addVisual(a)}},_engine.create_mmd=function(e){null==mmdHelper&&(mmdHelper=new MMDAnimationHelper({afterglow:2}),_engine.scene.loopFunctions.push(function(e){isMMDLoaded&&mmdHelper.update(e)}));var t=new Audio(_view.audioListener).setBuffer(sounds[e.refSound].buffer);mmdHelper.add(t,{delayTime:160/30}),e.physicBody&&0==isAmmoImport?_engine.importScript("./js/libs/ammo.js",function(e,t){Ammo().then(function(e){Ammo=e,isAmmoImport=!0,_engine.doCreate_mmd_chars(t)})},e):_engine.doCreate_mmd_chars(e)},_engine.create_mmd_model=function(e){var t=_view.getModel(e.ename);t.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.material.alphaTest=.1)}),e.usePhongMat&&(t.material=function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=new MeshPhongMaterial;n.copy(e[i]),n.needsUpdate=!0,n.envMap=_view.getEnvmap(),t.push(n)}return t}(t.material)),t.position.set(e.position[0],e.position[1],e.position[2]),e.scale&&t.scale.fromArray(e.scale),_view.addVisual(t)},_engine.loadSceneFile=function(sceneName,callback){var url="./datas/"+sceneName+"/scene.js";fileLoader.load(url,function(data){window.world=window.world||{},window.world.scenes=window.world.scenes||{},eval("window.world.scenes[sceneName]="+data),callback()})},_engine.loadLogicFile=function(sceneName,callback){var url="./datas/"+sceneName+"/logic.js";fileLoader.load(url,function(data){window.world=window.world||{},window.world.logics=window.world.logics||{},eval("window.world.logics[sceneName]="+data),callback(sceneName)})},_engine.loadSceneData=function(i,e){var t=[];t.push(new Promise(function(t,e){_engine.loadSceneFile(i,function(e){t("load scene "+e+" ok")})})),t.push(new Promise(function(t,e){_engine.loadLogicFile(i,function(e){t("load scene "+e+" ok")})})),Promise.all(t).then(function(){e()})},_engine.scene={loopFunctions:[],update:function(e){for(var t=_engine.scene.loopFunctions.length;t--;)_engine.scene.loopFunctions[t](e);t=null},load:function(e){window.world.currentSceneName=e,_engine.loadSceneData(window.world.currentSceneName,function(){_engine.destroy()})},removePlayer:function(){},reversUV:function(e){for(var t=e.attributes.uv.array,i=.25*t.length;i--;)t[2*i]*=-1;e.attributes.uv.needsUpdate=!0},loadModels:function(t,i){var e=[];if(t.hasOwnProperty("models"))for(var r=t.models.length;r--;)e.push(new Promise(function(i,e){_view.load(t.models[r],function(e,t){console.log("load model "+t.url+" ok"),i("load models ok")})}));Promise.all(e).then(function(e){i(e)})},loadMaterials:function(i,t){var e=[];if(i.hasOwnProperty("materials"))for(var r=i.materials.length;r--;)e.push(new Promise(function(e,t){_view.material(i.materials[r]),e("load materials ok")}));Promise.all(e).then(function(e){t(e)})},loadSounds:function(e,t){var i=[];if(e.hasOwnProperty("sounds"))for(var r=e.sounds.length;r--;){var n=e.sounds[r];i.push(new Promise(function(i,e){_engine.loadSound(n,function(e,t){i("load sound "+t.name+" ok")})}))}Promise.all(i).then(function(e){t(e)})},loadActions:function(e,t){var i=[];if(e.hasOwnProperty("actions"))for(var r=e.actions.length;r--;){var n=e.actions[r];i.push(new Promise(function(t,e){_engine.loadAction(n,function(e){t("load action "+e.name+" ok")})}))}Promise.all(i).then(function(e){t(e)})},create:function(){_engine.debugTell("..."),(axisHelper=new AxesHelper(100)).visible=!1,statics.push(axisHelper),_view.addVisual(axisHelper);function e(){if(t.hasOwnProperty("clearColor")&&_view.setClearColor(t.clearColor),t.hasOwnProperty("arSceneScale")&&_view.setARSceneScale(t.arSceneScale),t.hasOwnProperty("uiControls"))for(var e=t.uiControls.length;e--;)_gui.addControl(t.uiControls[e]);_engine.scene.loadModels(t,function(){_engine.scene.loadMaterials(t,function(){_engine.scene.loadSounds(t,function(){_engine.scene.loadActions(t,function(){_engine.createSceneObject(),_engine.loadSceneLogic(),_engine.showTerrain(!0),_engine.showHero(!0),_engine.start()})})})})}var t=null;window.world.scenes.hasOwnProperty(window.world.currentSceneName)?(t=window.world.scenes[window.world.currentSceneName],e()):_engine.loadSceneData(window.world.currentSceneName,function(){t=window.world.scenes[window.world.currentSceneName],e()})}},_engine.createSceneObject=function(){for(var e=window.world.scenes[window.world.currentSceneName],t=0,i=e.objects.length;t<i;t++)_engine.createObject(e.objects[t]);_engine.eventList=e.events,_engine.gui.addBtns(e.btns)},_engine.loadSceneLogic=function(){for(var e=window.world.logics[window.world.currentSceneName],t=0;t<e.length;t++){var i=e[t];if(0!=_engine.has(i.name)){var r=_engine.byName(i.name),n=i.logic();r.userData.cmds=n,r.userData.cmdIndex=0;var a=ddlsHeros[r.userData.index];_engine.scene.loopFunctions.push(function(){var e=n[r.userData.cmdIndex];"move"!=e.type||r.userData.findPath?"play"==e.type&&r.userData.actionName!=e.action&&(r.userData.actionName=e.action,r.userData.avatar.logicPlay=!0,r.userData.avatar.doAction(e.action),setTimeout(function(){r.userData.avatar.logicPlay=!1,r.userData.cmdIndex=r.userData.cmds.length-1<r.userData.cmdIndex+1?0:r.userData.cmdIndex+1},e.interval)):(r.userData.findPath=a.isSelected=!0,r.userData.findPathCallBack=function(){r.userData.cmdIndex=r.userData.cmds.length-1<r.userData.cmdIndex+1?0:r.userData.cmdIndex+1,r.userData.findPathCallBack=function(){}},r.userData.actionName=e.action,console.log("go to "+e.pos[0]+"---"+e.pos[1]+"   "+r.userData.findPath),a.setTarget(e.pos[0],e.pos[1]))})}}},_engine.enableHoloEffect=function(e,t){_view.enableHoloEffect(e,t)},_engine.enableAREffect=function(e){_view.enableAREffect(e)},_engine.enableVREffect=function(e){_view.enableVREffect(e)},_engine.enableWebVREffect=function(e){_view.enableWebVREffect(e)},_engine.centerPosition=function(e,t){e.computeBoundingBox();var i=1==t[0]?-(e.boundingBox.getSize(new Vector3).x/2+e.boundingBox.min.x):0,r=1==t[1]?-(e.boundingBox.getSize(new Vector3).y/2+e.boundingBox.min.y):0,n=1==t[2]?-(e.boundingBox.getSize(new Vector3).z/2+e.boundingBox.min.z):0;e.applyMatrix4((new Matrix4).makeTranslation(i,r,n))},_engine.getDDLSPosition=function(e){return e.add(_engine.ddlsOffset)},_engine.loadAction=function(n,a){n.type&&"vmd"==n.type?_view.loadVMD(n,a):bvhFileLoader.load(n.url,function(e){for(var t="",i=new Uint8Array(e),r=0;r<i.length;++r)t+=String.fromCharCode(i[r]);actions[n.name]={type:n.type||"common",data:t},a(n)})},_engine.getActionData=function(e){return actions[e]},_engine.loadSound=function(t,i,r,n){sounds[t.name]&&sounds[t.name].buffer?i(sounds[t.name].buffer,t,r,n):audioLoader.load(t.url,function(e){sounds[t.name]={name:t.name},i(sounds[t.name].buffer=e,t,r,n)})},_engine.addSound=function(a,e,o){if(null!=a&&null!=o)for(var t in e.userData.audios={},o.data){_engine.loadSound(o.data[t],function(e,t,i,r){var n=new PositionalAudio(a);n.setBuffer(e),n.setRefDistance(t.refdistance),n.setLoop(t.loop),i.userData.audios[r]=n,i.userData.defaudio=o.defsound,i.add(n)},e,t)}},_engine.playSound=function(e,t){if(e.userData.hasOwnProperty("audios")&&e.userData.audios.hasOwnProperty(t)){var i=e.userData.audios[t];i.isPlaying||i.play()}},_engine.stopPlaySound=function(e,t){e.userData.hasOwnProperty("audios")&&e.userData.audios.hasOwnProperty(t)&&e.userData.audios[t].stop()},_engine.avatarFire=function(e,t,i){if(null!=_engine.currentFollow&&(_engine.currentFollow.userData=_engine.currentFollow.userData||{},_engine.currentFollow.userData.weapon=_engine.currentFollow.userData.weapon||{},_engine.currentFollow.userData.weapon.ammo=_engine.currentFollow.userData.weapon.ammo||0,0<_engine.currentFollow.userData.weapon.ammo)){var r=e,n=_view.getMaterial("solid");n.name="solid";var a=_physic.add({type:"sphere",size:[.05],material:n,mass:r,pos:[t.x,t.y,t.z],quat:[0,0,0,1],linearVelocity:[i.x,i.y,i.z]});_engine.addSound(_view.audioListener,a,{data:{fire:{name:"gun01",loop:!1,refdistance:2}}}),_engine.playSound(a,"fire"),_engine.currentFollow.userData.weapon.ammo--}},_engine.play=function(e){e?_view.restartRender():_view.pauseRender(),_engine.run=e},_engine.initEvents=function(){document.addEventListener("mousedown",function(e){if(mouseCoords.set(e.clientX/window.innerWidth*2-1,2*-(e.clientY/window.innerHeight)+1),raycaster.setFromCamera(mouseCoords,_view.camera),0==e.button){if(isTouch)return;var t=new Vector3;t.copy(raycaster.ray.direction),t.add(raycaster.ray.origin);var i=new Vector3;i.copy(raycaster.ray.direction),i.multiplyScalar(50),_engine.avatarFire(20,t,i)}else if(1==e.button)_view.updateSunLightSize(_view.cameraControls.getRadius());else if(2==e.button&&_engine.has("pathfindzone")){var r=_engine.byName("pathfindzone");r.isGroup&&(r=r.children[0]);var n=raycaster.intersectObject(r);if(0<n.length){var a=n[0].point,o=ddlsHeros[_engine.currentFollow.userData.index];o.isSelected=!0,console.log("go to x="+a.x+" z="+a.z),_engine.currentFollow.userData.findPath=!0,_engine.currentFollow.userData.findPathCallBack=function(){},o.setTarget(a.x,a.z)}n=null}var s=raycaster.intersectObjects(_view.objects_raycaster);0<s.length&&(_engine.SELECTED=s[0].object,clickMeasureEnabled&&_engine.showSize(_engine.SELECTED),null!=_engine.eventList&&null!=_engine.eventList.dbclick&&0<_engine.eventList.dbclick.length&&_engine.eventList.dbclick.forEach(function(e,t){"string"==typeof e.obj_name?e.obj_name==_engine.SELECTED.name&&e.obj_event(_engine.SELECTED):null==e.findObject&&"function"!=typeof e.findObject||e.findObject(_engine.SELECTED.name)&&e.obj_event(_engine.SELECTED)})),e.preventDefault()},!1),_user.addEventListener("onKeyDown",function(e){if(9==e.keyCode)_engine.changeHero();else if(87==e.keyCode)driveSpeed++;else if(83==e.keyCode)driveSpeed--;else if(81==e.keyCode)driveSpeed=0;else if(82==e.keyCode)null!=_engine.currentFollow&&(_engine.currentFollow.userData=_engine.currentFollow.userData||{},_engine.currentFollow.userData.weapon=_engine.currentFollow.userData.weapon||{},_engine.currentFollow.userData.weapon.ammo=_engine.currentFollow.userData.weapon.ammo||0,_engine.currentFollow.userData.weapon.ammo++,_engine.playSound(_engine.currentFollow,"addbullet"));else if(70==e.keyCode){var t=_engine.currentFollow.userData.avatar.getThrowPos(),i=_engine.currentFollow.userData.avatar.getThrowDir();_engine.avatarFire(20,t,i)}_view.camera==_view.cameraInObj&&(65==e.keyCode?_view.camera.rotation.y=0:68==e.keyCode?_view.camera.rotation.y=Math.PI:37==e.keyCode?_view.camera.rotation.y+=.01*Math.PI:39==e.keyCode?_view.camera.rotation.y-=.01*Math.PI:38==e.keyCode?_view.camera.rotation.x+=.01*Math.PI:40==e.keyCode&&(_view.camera.rotation.x-=.01*Math.PI))})},_engine.showSize=function(e){var t=(new Box3).setFromObject(e),i=t.max.x-t.min.x,r=t.max.y-t.min.y,n=t.max.z-t.min.z,a=1.01*i,o=1.01*r,s=1.01*n,l=new BoxGeometry(a,o,s),c=new MeshPhongMaterial({color:16777215,transparent:!0,opacity:.2});if(null!=sizeGroup){for(var h=sizeDivs.length-1;0<=h;h--)sizeDivs[h].parentNode&&sizeDivs[h].parentNode.removeChild(sizeDivs[h]);sizeDivs=[];for(h=0;h<sizeGroup.children.length;h++)sizeGroup.remove(sizeGroup.children[h]);sizeGroup.parent.remove(sizeGroup),sizeGroup=null}sizeGroup=new Group;var u=new Mesh(l,c);sizeGroup.add(u);var d=new BoxHelper(u,972231);sizeGroup.add(d);var p=_engine.makeSizeLine(a);p.position.y=o/2+.5,p.position.z=-s/2,sizeGroup.add(p);var m=_engine.makeSizeLine(o);m.rotateZ(Math.PI/2),m.position.x=a/2+.5,m.position.z=-s/2,sizeGroup.add(m);var f=_engine.makeSizeLine(s);f.rotateY(Math.PI/2),f.position.x=a/2,f.position.y=-o/2-.5,sizeGroup.add(f),_engine.makeSizeLabel(sizeGroup,i,p.position),_engine.makeSizeLabel(sizeGroup,r,m.position),_engine.makeSizeLabel(sizeGroup,n,f.position),sizeGroup.position.copy(e.position),e.parent.add(sizeGroup)},_engine.makeSizeLine=function(e){var t=new Vector3(-e/2,0,0),i=new Vector3(-e/2,5,0),r=new Vector3(-e/2,-5,0),n=t.clone().negate(),a=i.clone().negate(),o=r.clone().negate(),s=new Group,l=v([t,n]),c=v([i,r]),h=v([a,o]),u=new Vector3(-e/2+.2,.2,0),d=new Vector3(-e/2+.2,-.2,0),p=u.clone().negate(),m=d.clone().negate(),f=v([u,t,d]),g=v([p,n,m]);return s.add(l,c,h,f,g),s;function v(e){var t=new LineBasicMaterial({color:16777215}),i=new Geometry;return i.vertices=e,new Line(i,t)}},_engine.makeSizeLabel=function(e,t,i){var r=document.createElement("div");r.className="label",r.textContent=t.toFixed(3)+" m",r.style.color="#0ed5c7",r.style.padding="5px 10px",sizeDivs.push(r);var n=new CSS2DObject(r);return n.position.copy(i),e.add(n),n},_engine.updateCompassAngle=function(){var e=new Vector2;e.set(window.innerWidth/2/window.innerWidth*2-1,2*-(window.innerHeight/2/window.innerHeight)+1),raycaster_compass.setFromCamera(e,_view.camera);var t=new Vector3;t.copy(raycaster_compass.ray.direction);var i=new Vector3(0,1,0),r=new Vector3(1,0,0),n=t.projectOnPlane(i),a=n.clone().cross(i).angleTo(r)>Math.PI/2,o=n.angleTo(r);_engine.compassAngle=a?o:2*Math.PI-o},_engine.init=function(e){document.getElementById("overlay").remove(),!1===WEBGL.isWebGLAvailable()&&document.body.appendChild(WEBGL.getWebGLErrorMessage()),document.oncontextmenu=function(){return!1},_engine.initComponents(e),content=new Group,_view.addVisual(content),contentMesh=new Group,_view.addVisual(contentMesh),raycaster=new Raycaster,raycaster_compass=new Raycaster,mouse=new Vector2,_engine.initEvents()},_engine.destroy=function(){_engine.play(!1),_physic.reset(!0),_engine.reset(),_gui.reset(),_view.reset(),_engine.scene.create()},_engine.reset=function(){for(null!=_view.cameraInObj.parent&&(_view.cameraInObj.parent.remove(_view.cameraInObj),_view.cameraInObj.parent=null),null!=_engine.compass&&(_view.sceneRenderHUDSprite.remove(_engine.compass),_engine.compasscompass=null),tmpI=labels.length;tmpI--;)labels[tmpI].parent.remove(labels[tmpI]);if(labels=[],_engine.sunLight=null,_engine.sunSphere=null,_engine.sky=null,_engine.currentFollow=null,_engine.ddlsOffset=new Vector3(0,0,0),null!=mmdHelper){for(var e=0;e<mmdHelper.meshes.length;e++)mmdHelper.remove(mmdHelper.meshes[e]);null!=mmdHelper.camera&&mmdHelper.remove(mmdHelper.camera),null!=mmdHelper.audio&&(mmdHelper.audio.stop(),mmdHelper.remove(mmdHelper.audio)),mmdHelper=null}geo={},sounds={},extraGeo=[],heros=[],terrains=[],waters=[],_engine.moveObjNames=[],statics=[],ddlsObj=[],ddlsHeros=[],_ddlsworld.reset(),terrainData=null,driveSpeed=0,_engine.scene.loopFunctions=[]},_engine.start=function(){console.log(""),_view.restartRender(),_physic.start(),_engine.playSounds(!0),_engine.gui.showBtns(),_engine.debugTell("")},_engine.update=function(e){_engine.getKeys(),_engine.scene.update(e),TWEEN.update(),_engine.updateHero(e),_ddlsRender.update();for(var t=0;t!=lightHelpers.length;t++)lightHelpers[t].visible&&lightHelpers[t].update();_engine.updateCompassAngle()},_engine.importScript=function(i,r,n){fileLoader.load(i,function(e){var t=document.createElement("script");t.type="text/javascript",t.text=e,document.body.appendChild(t),r(i,n)})},_engine.importScripts=function(i,t){for(var e=[],r=(new FileLoader,0);r<i.length;r++)e.push(new Promise(function(t,e){_engine.importScript(i[r],function(e){t("load "+e+" ok")})}));Promise.all(e).then(function(e){t()})},_engine.initComponents=function(e){loadingManager.addHandler(/\.dds$/i,new DDSLoader),_engine.gui=_gui=WGui(),_gui.init(),_engine.user=_user=WUser(),_engine.debugTell("..."),_engine.view=_view=WView(loadingManager),_engine.physic=_physic=physic,_engine.ddlsworld=_ddlsworld=new World(10,10),_view.init(e),_view.update=_engine.update,_engine.ddlsRender=_ddlsRender=new DDLSRender(_ddlsworld,_view.scene),_user.init(),_engine.debugTell("..."),_physic.init(function(){_physic.setView(_view),_view.unPause=function(){_physic.start()},_physic.tell=function(){showPhyinfo?(_phyinfo=_physic.info(),_gui.tell(" ammo "+_physic.getFps()+"\n solids "+_phyinfo.solids+" / bodys "+_phyinfo.bodys+"\n softs "+_phyinfo.softs+" / terrains "+_phyinfo.terrains+"\n cars "+_phyinfo.cars+" / rays "+_phyinfo.rays+"\n pairs "+_phyinfo.pairs+" / joints "+_phyinfo.joints)):_gui.tell("")},_physic.getKey=function(){return keys},_engine.importScripts(["./datas/world.scenes.js"],function(){_gui.initUI_scenes(),_gui.addExtraOption(_physic.setMode),_engine.scene.create()})},"min")},_engine}();var startButton=document.getElementById("startButton");startButton.addEventListener("click",function(){window.WEngine.init({rendererClearColor:window.WEngine.colors.white})})});
